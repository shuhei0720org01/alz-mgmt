{"config":{"lang":["ja"],"separator":"[\\s\\-\u3000\u3001\u3002\uff0c\uff0e]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Azure Landing Zones \u5b8c\u5168\u30de\u30b9\u30bf\u30fc\u30b3\u30fc\u30b9","text":"<ul> <li> <p> \u5b8c\u5168\u306a\u6559\u79d1\u66f8</p> <p>Terraform\u3067Azure Landing Zones\u3092\u30bc\u30ed\u304b\u3089\u7406\u89e3\u3067\u304d\u308b\u3001\u516818\u7ae0\u306e\u5b8c\u5168\u30ac\u30a4\u30c9</p> <p> \u5b66\u7fd2\u3092\u958b\u59cb\u3059\u308b</p> </li> <li> <p> \u521d\u5fc3\u8005\u6b53\u8fce</p> <p>\u300cTerraform\u3063\u3066\u4f55\uff1f\u300d\u30ec\u30d9\u30eb\u304b\u3089\u59cb\u3081\u3089\u308c\u307e\u3059\u3002\u6bb5\u968e\u7684\u306b\u5b66\u3079\u308b\u69cb\u6210\u3067\u3059\u3002</p> <p> \u57fa\u790e\u77e5\u8b58\u3092\u5b66\u3076</p> </li> <li> <p> \u5b9f\u8df5\u7684\u306a\u5185\u5bb9</p> <p>\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\u3092\u5b8c\u5168\u89e3\u8aac\u3002\u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30b3\u30fc\u30c9\u304c\u5168\u3066\u7406\u89e3\u3067\u304d\u307e\u3059\u3002</p> <p> \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020\u3092\u898b\u308b</p> </li> <li> <p> \u3059\u3050\u306b\u30c7\u30d7\u30ed\u30a4</p> <p>\u8aad\u307f\u7d42\u308f\u3063\u305f\u3089\u3001\u81ea\u5206\u306e\u74b0\u5883\u306b\u3059\u3050\u306b\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u307e\u3059\u3002</p> <p> \u30c7\u30d7\u30ed\u30a4\u624b\u9806\u3078</p> </li> </ul>"},{"location":"#_1","title":"\u3053\u306e\u30b3\u30fc\u30b9\u3067\u5b66\u3079\u308b\u3053\u3068","text":"<ul> <li> <p>\u2705 Terraform\u306e\u57fa\u672c\u7684\u306a\u66f8\u304d\u65b9   \u5909\u6570\u3001\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u4f7f\u3044\u65b9\u3092\u5b8c\u5168\u7406\u89e3</p> </li> <li> <p>\u2705 Azure\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u4ed5\u7d44\u307f   \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3001\u30dd\u30ea\u30b7\u30fc\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u3092\u6df1\u304f\u7406\u89e3</p> </li> <li> <p>\u2705 Azure Landing Zones\u306e\u8a2d\u8a08\u601d\u60f3   8\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3068\u5b9f\u88c5\u30d1\u30bf\u30fc\u30f3\u3092\u30de\u30b9\u30bf\u30fc</p> </li> <li> <p>\u2705 \u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5168\u30b3\u30fc\u30c9\u89e3\u8aac   17,896\u884c\u306e\u6559\u79d1\u66f8\u3067\u3001\u5168\u3066\u306e\u30b3\u30fc\u30c9\u3092\u8a73\u3057\u304f\u89e3\u8aac</p> </li> <li> <p>\u2705 \u5b9f\u969b\u306b\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u624b\u9806   GitHub Actions\u3067CI/CD\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u307e\u3067\u69cb\u7bc9</p> </li> <li> <p>\u2705 \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0   \u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc\u3068\u89e3\u6c7a\u65b9\u6cd5\u3092\u7db2\u7f85</p> </li> </ul>"},{"location":"#_2","title":"\u5b66\u7fd2\u306e\u9032\u3081\u65b9","text":""},{"location":"#1-3","title":"\u30ec\u30d9\u30eb1: \u57fa\u790e\u56fa\u3081\uff08\u521d\u65e5\u301c3\u65e5\u76ee\uff09","text":"<p>\u307e\u305a\u306f\u57fa\u790e\u304b\u3089\u3002\u98db\u3070\u3055\u305a\u306b\u8aad\u3093\u3067\u304f\u3060\u3055\u3044\u3002</p> <ul> <li>00. \u306f\u3058\u3081\u306b - \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u5168\u4f53\u50cf</li> <li>01. \u57fa\u790e\u77e5\u8b58 - Terraform\u30fbAzure\u30fbLanding Zones\u306e\u57fa\u790e</li> <li>02. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020 - \u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u306e\u7406\u89e3</li> </ul>"},{"location":"#2-47","title":"\u30ec\u30d9\u30eb2: \u8a2d\u5b9a\u3092\u7406\u89e3\u3059\u308b\uff084\u65e5\u76ee\u301c7\u65e5\u76ee\uff09","text":"<p>\u5b9f\u969b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u89e3\u304d\u307e\u3059\u3002</p> <ul> <li>03. \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5b8c\u5168\u89e3\u8aac - platform-landing-zone.auto.tfvars\u5b8c\u5168\u30ac\u30a4\u30c9</li> <li>04. \u5909\u6570\u5b9a\u7fa9 - variables.tf\u306e\u4ed5\u7d44\u307f</li> <li>05. \u30ed\u30fc\u30ab\u30eb\u5909\u6570 - locals.tf\u306e\u5f79\u5272</li> </ul>"},{"location":"#3-814","title":"\u30ec\u30d9\u30eb3: \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u7406\u89e3\u3059\u308b\uff088\u65e5\u76ee\u301c14\u65e5\u76ee\uff09","text":"<p>\u5404\u30e2\u30b8\u30e5\u30fc\u30eb\u30921\u3064\u305a\u3064\u6df1\u6398\u308a\u3057\u307e\u3059\u3002</p> <ul> <li>06. \u8a2d\u5b9a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 - \u8a2d\u5b9a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3</li> <li>07. \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7 - \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u308a\u65b9</li> <li>08. \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc - \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc</li> <li>09. \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9 - \u76e3\u8996\u30fb\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9</li> <li>10. Hub-and-Spoke - \u30cf\u30d6\u30fb\u30b9\u30dd\u30fc\u30af\u578b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af</li> <li>11. Virtual WAN - Virtual WAN</li> </ul>"},{"location":"#4-1521","title":"\u30ec\u30d9\u30eb4: \u5b9f\u8df5\uff0815\u65e5\u76ee\u301c21\u65e5\u76ee\uff09","text":"<p>\u5b9f\u969b\u306b\u52d5\u304b\u3057\u3066\u307f\u307e\u3059\u3002</p> <ul> <li>12. GitHub Actions - CI/CD\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u69cb\u7bc9</li> <li>13. \u30c7\u30d7\u30ed\u30a4\u624b\u9806 - \u5b9f\u969b\u306e\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5</li> </ul>"},{"location":"#5-22","title":"\u30ec\u30d9\u30eb5: \u904b\u7528\u30fb\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\uff0822\u65e5\u76ee\u301c\uff09","text":"<p>\u904b\u7528\u3067\u5fc5\u8981\u306a\u77e5\u8b58\u3092\u7fd2\u5f97\u3057\u307e\u3059\u3002</p> <ul> <li>14. \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 - \u30a8\u30e9\u30fc\u5bfe\u51e6\u6cd5</li> <li>15. \u30ab\u30b9\u30bf\u30de\u30a4\u30ba - \u74b0\u5883\u306b\u5408\u308f\u305b\u305f\u30ab\u30b9\u30bf\u30de\u30a4\u30ba</li> <li>16. \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9 - \u904b\u7528\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</li> <li>17. FAQ - \u3088\u304f\u3042\u308b\u8cea\u554f</li> </ul>"},{"location":"#_3","title":"\u6559\u79d1\u66f8\u306e\u7279\u5fb4","text":"<p>\u89aa\u3057\u307f\u3084\u3059\u3044\u89e3\u8aac</p> <p>\u30ab\u30b8\u30e5\u30a2\u30eb\u656c\u8a9e\u8abf\u3067\u66f8\u304b\u308c\u3066\u304a\u308a\u3001\u307e\u308b\u3067\u5148\u8f29\u30a8\u30f3\u30b8\u30cb\u30a2\u304c\u96a3\u3067\u6559\u3048\u3066\u304f\u308c\u308b\u3088\u3046\u306a\u611f\u899a\u3067\u5b66\u3079\u307e\u3059\u3002</p> <p>\u5b9f\u8df5\u7684\u306a\u5185\u5bb9</p> <p>\u5168\u3066\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u5b9f\u969b\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u4e00\u81f4\u3057\u3066\u304a\u308a\u3001\u3059\u3050\u306b\u4f7f\u3048\u308b\u77e5\u8b58\u304c\u8eab\u306b\u3064\u304d\u307e\u3059\u3002</p> <p>\u7df4\u7fd2\u554f\u984c\u4ed8\u304d</p> <p>\u4e3b\u8981\u306a\u7ae0\u306b\u306f\u7df4\u7fd2\u554f\u984c\u3068\u89e3\u7b54\u304c\u3042\u308a\u3001\u7406\u89e3\u5ea6\u3092\u78ba\u8a8d\u3057\u306a\u304c\u3089\u9032\u3081\u3089\u308c\u307e\u3059\u3002</p> <p>\u5b8c\u5168\u306a\u4f53\u7cfb</p> <p>\u516818\u7ae0\u300117,896\u884c\u306e\u6559\u79d1\u66f8\u3067\u3001Azure Landing Zones\u3092\u5b8c\u5168\u306b\u30de\u30b9\u30bf\u30fc\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"#_4","title":"\u3088\u304f\u3042\u308b\u8cea\u554f","text":"\u521d\u5fc3\u8005\u3067\u3082\u5927\u4e08\u592b\u3067\u3059\u304b\uff1f <p>\u306f\u3044\u3001\u5927\u4e08\u592b\u3067\u3059\uff01\u300cTerraform\u3063\u3066\u4f55\uff1f\u300d\u30ec\u30d9\u30eb\u304b\u3089\u59cb\u3081\u3089\u308c\u308b\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002</p> <p>\u57fa\u790e\u77e5\u8b58\u304b\u3089\u6bb5\u968e\u7684\u306b\u5b66\u3079\u308b\u306e\u3067\u3001\u7126\u3089\u305a\u306b1\u7ae0\u305a\u3064\u9032\u3093\u3067\u3044\u3051\u3070\u5fc5\u305a\u7406\u89e3\u3067\u304d\u307e\u3059\u3002</p> \u3069\u306e\u304f\u3089\u3044\u306e\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u304b\uff1f <ul> <li>\u57fa\u790e\u56fa\u3081: 3\u65e5\u9593\uff08Chapter 00-02\uff09</li> <li>\u8a2d\u5b9a\u7406\u89e3: 4\u65e5\u9593\uff08Chapter 03-05\uff09</li> <li>\u30e2\u30b8\u30e5\u30fc\u30eb\u7406\u89e3: 7\u65e5\u9593\uff08Chapter 06-11\uff09</li> <li>\u5b9f\u8df5: 7\u65e5\u9593\uff08Chapter 12-13\uff09</li> <li>\u904b\u7528: \u81ea\u5206\u306e\u30da\u30fc\u30b9\u3067\uff08Chapter 14-17\uff09</li> </ul> <p>\u5408\u8a08\u3067\u7d043\u9031\u9593\u3042\u308c\u3070\u3001\u5168\u3066\u306e\u5185\u5bb9\u3092\u7406\u89e3\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u307e\u3067\u5b8c\u4e86\u3067\u304d\u307e\u3059\u3002</p> Azure\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u5fc5\u8981\u3067\u3059\u304b\uff1f <p>Chapter 13\uff08\u30c7\u30d7\u30ed\u30a4\u624b\u9806\uff09\u304b\u3089\u5b9f\u969b\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u3001Azure\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u305d\u308c\u307e\u3067\u306e\u7ae0\u306f\u3001\u30b3\u30fc\u30c9\u3092\u8aad\u3093\u3067\u7406\u89e3\u3059\u308b\u3060\u3051\u306a\u306e\u3067\u30a2\u30ab\u30a6\u30f3\u30c8\u4e0d\u8981\u3067\u3059\u3002</p> \u30b3\u30b9\u30c8\u306f\u3069\u306e\u304f\u3089\u3044\u304b\u304b\u308a\u307e\u3059\u304b\uff1f <p>\u5168\u30ea\u30bd\u30fc\u30b9\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u3001\u6708\u984d\u7d0440\u4e07\u5186\u304b\u304b\u308a\u307e\u3059\u3002</p> <ul> <li>Azure Firewall: \u7d0434\u4e07\u5186/\u6708\uff082\u500b\uff09</li> <li>Log Analytics: \u7d041\u4e07\u5186/\u6708</li> <li>\u305d\u306e\u4ed6: \u7d045\u4e07\u5186/\u6708</li> </ul> <p>\u5b66\u7fd2\u7528\u306b\u306f\u3001Chapter 00\u3067\u89e3\u8aac\u3057\u3066\u3044\u308b\u30b3\u30b9\u30c8\u524a\u6e1b\u65b9\u6cd5\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"#_5","title":"\u3055\u3042\u3001\u59cb\u3081\u307e\u3057\u3087\u3046\uff01","text":"<p>\u6e96\u5099\u306f\u3067\u304d\u307e\u3057\u305f\u304b\uff1f\u305d\u308c\u3067\u306f\u3001\u6700\u521d\u306e\u4e00\u6b69\u3092\u8e0f\u307f\u51fa\u3057\u307e\u3057\u3087\u3046\uff01</p> <ul> <li> Chapter 00: \u306f\u3058\u3081\u306b</li> </ul>      \u6700\u7d42\u66f4\u65b0: 2026\u5e741\u6708 | \u516818\u7ae0 17,896\u884c\u306e\u5b8c\u5168\u6559\u79d1\u66f8"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/","title":"00. \u306f\u3058\u3081\u306b - \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u5168\u4f53\u50cf","text":""},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_1","title":"\u4f55\u3092\u4f5c\u308b\u306e\u304b\uff1f","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u3001Azure Landing Zones\uff08\u30a2\u30b8\u30e5\u30fc\u30eb\u30fb\u30e9\u30f3\u30c7\u30a3\u30f3\u30b0\u30be\u30fc\u30f3\u30ba\uff09\u3068\u3044\u3046\u3001 \u4f01\u696d\u5411\u3051\u306eAzure\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306eTerraform\u30b3\u30fc\u30c9\u3067\u3059\u3002</p> <p>\u300cLanding Zone\u300d\u306f\u98db\u884c\u6a5f\u306e\u7740\u9678\u5e2f\uff1f\u3063\u3066\u610f\u5473\u3067\u3059\u3002 \u5b9f\u969b\u3001\u305d\u306e\u30a4\u30e1\u30fc\u30b8\u3067\u5408\u3063\u3066\u3044\u3066\u3001</p> <p>\u98db\u884c\u6a5f\u304c\u5b89\u5168\u306b\u7740\u9678\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u6ed1\u8d70\u8def\u3060\u3051\u3058\u3083\u306a\u304f\u3066\uff1a - \u7ba1\u5236\u5854\uff08\u8ab0\u304c\u3069\u3053\u306b\u7740\u9678\u3057\u3066\u3044\u3044\u304b\u7ba1\u7406\uff09 - \u8a98\u5c0e\u706f\uff08\u3069\u3053\u306b\u884c\u3051\u3070\u3044\u3044\u304b\u6848\u5185\uff09 - \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b2\u30fc\u30c8\uff08\u5371\u967a\u306a\u3082\u306e\u306f\u5165\u308c\u306a\u3044\uff09 - \u6574\u5099\u5834\uff08\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\uff09</p> <p>\u3053\u308c\u3089\u304c\u5168\u90e8\u63c3\u3063\u3066\u307e\u3059\u3088\u306d\u3002</p> <p>Azure Landing Zones\u3082\u540c\u3058\u3067\u3059\u3002 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u300c\u5b89\u5168\u306b\u7740\u9678\u3055\u305b\u308b\u300d\u305f\u3081\u306e\u74b0\u5883\u3092\u6574\u3048\u307e\u3059\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_2","title":"\u5177\u4f53\u7684\u306b\u4f55\u304c\u3067\u304d\u308b\u306e\uff1f","text":"<p>\u3053\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001Azure\u306b\u3053\u3093\u306a\u74b0\u5883\u304c\u3067\u304d\u307e\u3059\uff1a</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#1","title":"1. \u7d44\u7e54\u69cb\u9020\uff08\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\uff09","text":"<pre><code>\u3042\u306a\u305f\u306e\u4f1a\u793e\n\u251c\u2500\u2500 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\uff08\u57fa\u76e4\u30c1\u30fc\u30e0\uff09\n\u2502   \u251c\u2500\u2500 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u62c5\u5f53\n\u2502   \u251c\u2500\u2500 \u76e3\u8996\u62c5\u5f53\n\u2502   \u2514\u2500\u2500 ID\u7ba1\u7406\u62c5\u5f53\n\u251c\u2500\u2500 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\uff08\u958b\u767a\u30c1\u30fc\u30e0\uff09\n\u2502   \u251c\u2500\u2500 \u672c\u756a\u74b0\u5883\n\u2502   \u2514\u2500\u2500 \u958b\u767a\u74b0\u5883\n\u2514\u2500\u2500 \u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\uff08\u5b9f\u9a13\u7528\uff09\n</code></pre> <p>\u4f1a\u793e\u306e\u7d44\u7e54\u56f3\u307f\u305f\u3044\u306b\u3001Azure\u306e\u30ea\u30bd\u30fc\u30b9\u3082\u968e\u5c64\u69cb\u9020\u3067\u7ba1\u7406\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#2-2","title":"2. \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff082\u62e0\u70b9\u69cb\u6210\uff09","text":"<p>\u6771\u65e5\u672c\u306e\u62e0\u70b9\uff08\u30e1\u30a4\u30f3\uff09 - Azure Firewall: \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3068\u306e\u51fa\u5165\u308a\u53e3\u3092\u5b88\u308b\u9580\u756a - Bastion: \u30b5\u30fc\u30d0\u30fc\u306b\u5b89\u5168\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u305f\u3081\u306e\u5c02\u7528\u30b2\u30fc\u30c8 - VPN Gateway: \u4f1a\u793e\u306e\u30aa\u30d5\u30a3\u30b9\u3068\u63a5\u7d9a - Express Route Gateway: \u5c02\u7528\u7dda\u3067\u63a5\u7d9a\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09 - Private DNS: \u5185\u90e8\u306e\u540d\u524d\u89e3\u6c7a</p> <p>\u897f\u65e5\u672c\u306e\u62e0\u70b9\uff08\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\uff09 - \u6771\u65e5\u672c\u3068\u540c\u3058\u69cb\u6210 - \u707d\u5bb3\u6642\u306e\u5207\u308a\u66ff\u3048\u5148</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#3","title":"3. \u76e3\u8996\u30fb\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0","text":"<ul> <li>Log Analytics: \u5168\u3066\u306e\u30ed\u30b0\u3092\u4e00\u7b87\u6240\u306b\u96c6\u7d04</li> <li>Automation Account: \u5b9a\u671f\u7684\u306a\u4f5c\u696d\u3092\u81ea\u52d5\u5316</li> <li>Data Collection Rules: \u3069\u306e\u30ed\u30b0\u3092\u96c6\u3081\u308b\u304b\u5b9a\u7fa9</li> </ul>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#4-200","title":"4. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30dd\u30ea\u30b7\u30fc\uff08\u7d04200\u500b\uff01\uff09","text":"<p>\u4f8b\u3048\u3070\uff1a - \u300c\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u76f4\u63a5\u7e4b\u304c\u308b\u30ea\u30bd\u30fc\u30b9\u306f\u4f5c\u3063\u3061\u3083\u30c0\u30e1\u300d - \u300c\u6697\u53f7\u5316\u3055\u308c\u3066\u306a\u3044\u901a\u4fe1\u306f\u7981\u6b62\u300d - \u300c\u524a\u9664\u4fdd\u8b77\u3092ON\u306b\u3057\u306a\u3055\u3044\u300d</p> <p>\u306a\u3069\u306a\u3069\u3001\u4f1a\u793e\u306e\u30eb\u30fc\u30eb\u3092\u81ea\u52d5\u3067\u5f37\u5236\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_3","title":"\u306a\u305c\u3053\u3093\u306a\u8907\u96d1\u306a\u306e\uff1f","text":"<p>\u300c\u3053\u3093\u306a\u306b\u8907\u96d1\u306b\u3059\u308b\u5fc5\u8981\u3042\u308b\uff1f\u300d\u3063\u3066\u601d\u3044\u307e\u3059\u3088\u306d\u3002</p> <p>\u3067\u3082\u3001\u4f01\u696d\u3067Azure\u3092\u4f7f\u3046\u3068\u304d\u3001\u3053\u3093\u306a\u554f\u984c\u304c\u8d77\u304d\u308b\u3093\u3067\u3059\uff1a</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#1_1","title":"\u554f\u984c1: \u91ce\u826f\u30ea\u30bd\u30fc\u30b9","text":"<p>\u958b\u767a\u8005\u304c\u52dd\u624b\u306b\u30ea\u30bd\u30fc\u30b9\u4f5c\u3063\u3066\u3001\u8ab0\u3082\u7ba1\u7406\u3057\u3066\u306a\u3044\u3002 \u2192 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7+\u30dd\u30ea\u30b7\u30fc\u3067\u5236\u5fa1</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#2","title":"\u554f\u984c2: \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e8b\u6545","text":"<p>Public IP\u3092\u76f4\u63a5\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u6652\u3057\u3066\u653b\u6483\u3055\u308c\u308b\u3002 \u2192 Firewall\u3067\u5168\u3066\u306e\u901a\u4fe1\u3092\u76e3\u8996</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#3_1","title":"\u554f\u984c3: \u30ed\u30b0\u304c\u30d0\u30e9\u30d0\u30e9","text":"<p>\u3069\u3053\u3067\u4f55\u304c\u8d77\u304d\u305f\u304b\u308f\u304b\u3089\u306a\u3044\u3002 \u2192 Log Analytics\u3067\u5168\u90e8\u96c6\u7d04</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#4","title":"\u554f\u984c4: \u707d\u5bb3\u6642\u306b\u6b62\u307e\u308b","text":"<p>\u6771\u65e5\u672c\u306e\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\u304c\u30c0\u30a6\u30f3\u3057\u305f\u3089\u30b5\u30fc\u30d3\u30b9\u505c\u6b62\u3002 \u2192 \u897f\u65e5\u672c\u306b\u3082\u540c\u3058\u69cb\u6210\u3092\u7528\u610f</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#5","title":"\u554f\u984c5: \u8ab0\u304c\u3069\u3053\u307e\u3067\u3067\u304d\u308b\u304b\u4e0d\u660e\u78ba","text":"<p>\u6a29\u9650\u7ba1\u7406\u304c\u30b0\u30c1\u30e3\u30b0\u30c1\u30e3\u3002 \u2192 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3067\u968e\u5c64\u7684\u306b\u6a29\u9650\u7ba1\u7406</p> <p>Landing Zones\u306f\u3001\u3053\u308c\u3089\u5168\u3066\u306e\u554f\u984c\u3092\u4e00\u6c17\u306b\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306e\u300c\u57fa\u76e4\u300d\u306a\u3093\u3067\u3059\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_4","title":"\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u69cb\u6210","text":"<pre><code>alz-mgmt/\n\u251c\u2500\u2500 platform-landing-zone.auto.tfvars  \u2190 \u3053\u3053\u3060\u3051\u7de8\u96c6\u3059\u308c\u3070OK\n\u251c\u2500\u2500 variables.tf                        \u2190 \u5909\u6570\u306e\u5b9a\u7fa9\n\u251c\u2500\u2500 locals.tf                           \u2190 \u8a08\u7b97\u6e08\u307f\u306e\u5024\n\u251c\u2500\u2500 terraform.tf                        \u2190 Terraform\u306e\u8a2d\u5b9a\n\u251c\u2500\u2500 main.*.tf                           \u2190 \u30e1\u30a4\u30f3\u306e\u51e6\u7406\uff08\u8907\u6570\u30d5\u30a1\u30a4\u30eb\uff09\n\u2502\n\u251c\u2500\u2500 modules/                            \u2190 \u518d\u5229\u7528\u53ef\u80fd\u306a\u90e8\u54c1\n\u2502   \u251c\u2500\u2500 config-templating/              \u2190 \u8a2d\u5b9a\u306e\u5909\u63db\u30a8\u30f3\u30b8\u30f3\n\u2502   \u251c\u2500\u2500 management_groups/              \u2190 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u30fb\u30dd\u30ea\u30b7\u30fc\n\u2502   \u2514\u2500\u2500 management_resources/           \u2190 \u76e3\u8996\u30fb\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\n\u2502\n\u251c\u2500\u2500 lib/                                \u2190 \u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\u306eYAML\n\u2502   \u251c\u2500\u2500 archetype_definitions/          \u2190 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u7a2e\u985e\n\u2502   \u2514\u2500\u2500 architecture_definitions/       \u2190 \u5168\u4f53\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\n\u2502\n\u2514\u2500\u2500 .github/workflows/                  \u2190 GitHub Actions\uff08\u81ea\u52d5\u5b9f\u884c\uff09\n</code></pre>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_5","title":"\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u6cd5\u5247","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u898f\u5247\u7684\u3067\u3059\uff1a</p> <ul> <li><code>main.*.tf</code>: \u30e1\u30a4\u30f3\u306e\u51e6\u7406\u3002<code>*</code>\u306e\u90e8\u5206\u304c\u5f79\u5272\u3092\u8868\u3059</li> <li><code>main.connectivity.hub.and.spoke.virtual.network.tf</code> \u2192 \u30cf\u30d6\u30b9\u30dd\u30fc\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af</li> <li><code>main.management.tf</code> \u2192 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7</li> <li> <p><code>main.resource.groups.tf</code> \u2192 \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7</p> </li> <li> <p><code>variables.*.tf</code>: \u5909\u6570\u5b9a\u7fa9\u3002<code>*</code>\u306e\u90e8\u5206\u304c\u5bfe\u8c61\u3092\u8868\u3059</p> </li> <li><code>variables.connectivity.tf</code> \u2192 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u9023\u306e\u5909\u6570</li> <li> <p><code>variables.management.tf</code> \u2192 \u7ba1\u7406\u95a2\u9023\u306e\u5909\u6570</p> </li> <li> <p><code>*.auto.tfvars</code>: \u81ea\u52d5\u3067\u8aad\u307f\u8fbc\u307e\u308c\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb</p> </li> </ul>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_6","title":"\u30c7\u30fc\u30bf\u306e\u6d41\u308c","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u304c\u3069\u3046\u52d5\u304f\u304b\u3001\u30c7\u30fc\u30bf\u306e\u6d41\u308c\u3067\u898b\u3066\u307f\u307e\u3057\u3087\u3046\uff1a</p> <pre><code>1. \u3042\u306a\u305f\u304c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\n   \u2193\n   platform-landing-zone.auto.tfvars\n   \u300c\u6771\u65e5\u672c\u3068\u897f\u65e5\u672c\u3067\u4f5c\u3063\u3066\uff01\u300d\n\n2. Terraform\u304c\u8aad\u307f\u8fbc\u3080\n   \u2193\n   terraform.tf, variables.tf\n   \u300cOK\u3001\u5909\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u3063\u305f\u3088\u300d\n\n3. \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u304c\u5909\u63db\n   \u2193\n   modules/config-templating\n   \u300c$${starter_location_01}\u3092'japaneast'\u306b\u7f6e\u63db\u300d\n\n4. \u5404\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u5b9f\u884c\u3055\u308c\u308b\n   \u2193\n   main.*.tf\n   \u300c\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u4f5c\u6210\uff01\u300d\n   \u300c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u7bc9\uff01\u300d\n   \u300c\u30dd\u30ea\u30b7\u30fc\u9069\u7528\uff01\u300d\n\n5. Azure\u306b\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u3089\u308c\u308b\n   \u2193\n   Azure\u74b0\u5883\n   \u300c\u5b8c\u6210\uff01\u300d\n</code></pre>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_7","title":"\u5b9f\u969b\u306b\u4f55\u304c\u4f5c\u3089\u308c\u308b\u304b","text":"<p>\u3053\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001Azure\u306b\u3053\u308c\u3060\u3051\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7: \u7d0410\u500b</li> <li>\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af: 2\u500b\uff08\u6771\u65e5\u672c\u30fb\u897f\u65e5\u672c\uff09</li> <li>Azure Firewall: 2\u500b</li> <li>Bastion Host: 2\u500b</li> <li>VPN Gateway: 2\u500b\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09</li> <li>Express Route Gateway: 2\u500b\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09</li> <li>Log Analytics \u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9: 1\u500b</li> <li>Automation Account: 1\u500b</li> <li>\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7: \u7d0410\u500b</li> <li>\u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9: \u7d04200\u500b</li> <li>\u30dd\u30ea\u30b7\u30fc\u30bb\u30c3\u30c8\u5b9a\u7fa9: \u7d0440\u500b</li> <li>\u30dd\u30ea\u30b7\u30fc\u5272\u308a\u5f53\u3066: \u7d0450\u500b</li> <li>\u30ab\u30b9\u30bf\u30e0\u30ed\u30fc\u30eb\u5b9a\u7fa9: \u6570\u500b</li> </ul> <p>\u5408\u8a08\u3067\u3001**500\u500b\u4ee5\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9**\u304c\u4f5c\u3089\u308c\u307e\u3059\u3002 \u3053\u308c\u3092\u624b\u4f5c\u696d\u3067\u3084\u3063\u305f\u3089...\u8003\u3048\u305f\u304f\u306a\u3044\u3067\u3059\u306dw</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_8","title":"\u6240\u8981\u6642\u9593\u3068\u30b3\u30b9\u30c8","text":""},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_9","title":"\u69cb\u7bc9\u6642\u9593","text":"<ul> <li>\u521d\u56de\u5b9f\u884c: \u7d0415\u301c20\u5206</li> <li>\u524a\u9664: \u7d0410\u301c15\u5206</li> </ul>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_10","title":"\u6708\u984d\u30b3\u30b9\u30c8\uff08\u6982\u7b97\uff09","text":"<p>2\u30ea\u30fc\u30b8\u30e7\u30f3\u69cb\u6210\uff08\u6771\u65e5\u672c+\u897f\u65e5\u672c\uff09\u306e\u5834\u5408\uff1a - Azure Firewall: \u7d04\u00a5340,000/\u6708\uff082\u500b \u00d7 \u00a5170,000\u3001Standard SKU\uff09 - VPN Gateway: \u7d04\u00a580,000/\u6708\uff082\u500b \u00d7 \u00a540,000\u3001VpnGw1 SKU\uff09 - Bastion: \u7d04\u00a554,000/\u6708\uff082\u500b \u00d7 \u00a527,000\u3001Basic SKU\uff09 - Log Analytics: \u30c7\u30fc\u30bf\u91cf\u306b\u3088\u308b\uff08\u7d04\u00a510,000\u301c\uff09 - \u305d\u306e\u4ed6: \u7d04\u00a55,000/\u6708</p> <p>\u5408\u8a08: \u7d04\u00a5484,000\u301c/\u6708</p> <p>1\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u307f\u306e\u5834\u5408\uff1a - \u7d04\u00a5242,000/\u6708\uff08\u4e0a\u8a18\u306e\u534a\u5206\uff09</p> <p>\u30b3\u30b9\u30c8\u524a\u6e1b\u306e\u30d2\u30f3\u30c8\uff1a - VPN\u4e0d\u8981\u306a\u3089\u7d04\u00a580,000\u524a\u6e1b - Firewall Basic\u306b\u3059\u308b\u3068\u7d04\u00a5280,000\u524a\u6e1b\uff08Standard \u2192 Basic\uff09 - \u8a73\u7d30\u306fChapter 17\u306eFAQ\u3092\u53c2\u7167</p> <p>\u203b \u5b9f\u9a13\u7528\u306a\u3089\u4e0d\u8981\u306a\u30ea\u30bd\u30fc\u30b9\uff08Firewall\u7b49\uff09\u3092\u7121\u52b9\u5316\u3059\u308c\u3070\u5927\u5e45\u306b\u30b3\u30b9\u30c8\u524a\u6e1b\u53ef\u80fd</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_11","title":"\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u8ce2\u3044\u3068\u3053\u308d","text":""},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#1_2","title":"1. \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u6a5f\u80fd","text":"<p>\u540c\u3058\u8a2d\u5b9a\u3092\u8907\u6570\u5730\u57df\u306b\u30b3\u30d4\u30da\u3057\u306a\u304f\u3066\u3044\u3044\u3002 <code>$${starter_location_01}</code>\u3063\u3066\u66f8\u3051\u3070\u81ea\u52d5\u3067<code>japaneast</code>\u306b\u7f6e\u63db\u3057\u3066\u304f\u308c\u308b\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#2_1","title":"2. \u30e2\u30b8\u30e5\u30fc\u30eb\u5316","text":"<p>\u518d\u5229\u7528\u53ef\u80fd\u306a\u90e8\u54c1\u306b\u5206\u304b\u308c\u3066\u3044\u308b\u3002 \u4ed6\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3082\u4f7f\u3044\u56de\u305b\u308b\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#3-azure-verified-modules-avm","title":"3. Azure Verified Modules (AVM)\u3092\u4f7f\u7528","text":"<p>Microsoft\u304c\u516c\u5f0f\u306b\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u3057\u3066\u3044\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3063\u3066\u308b\u3002 \u81ea\u5206\u3067\u30a4\u30c1\u304b\u3089\u66f8\u304f\u3088\u308a\u5b89\u5168\u3067\u78ba\u5b9f\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#4-yaml","title":"4. \u30dd\u30ea\u30b7\u30fc\u306eYAML\u7ba1\u7406","text":"<p>\u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\u3092YAML\u3067\u7ba1\u7406\u3002 Terraform\u30b3\u30fc\u30c9\u3088\u308a\u8aad\u307f\u3084\u3059\u3044\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#5-github-actions","title":"5. GitHub Actions\u3067\u81ea\u52d5\u5316","text":"<p>\u624b\u5143\u3067Terraform\u5b9f\u884c\u3057\u306a\u304f\u3066\u3044\u3044\u3002 GitHub\u306bpush\u3059\u308c\u3070\u81ea\u52d5\u3067\u30c7\u30d7\u30ed\u30a4\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_12","title":"\u5b66\u7fd2\u306e\u30ed\u30fc\u30c9\u30de\u30c3\u30d7","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u7406\u89e3\u3059\u308b\u305f\u3081\u306e\u9806\u5e8f\uff1a</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#1_3","title":"\u30b9\u30c6\u30c3\u30d71: \u5168\u4f53\u50cf\u3092\u63b4\u3080\uff08\u4eca\u3053\u3053\uff09","text":"<ul> <li>\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u3080</li> <li>\u4f55\u304c\u3067\u304d\u308b\u306e\u304b\u7406\u89e3\u3059\u308b</li> <li>\u306a\u305c\u5fc5\u8981\u306a\u306e\u304b\u7406\u89e3\u3059\u308b</li> </ul>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#2_2","title":"\u30b9\u30c6\u30c3\u30d72: \u57fa\u790e\u3092\u5b66\u3076","text":"<ul> <li>Terraform\u306e\u57fa\u672c</li> <li>Azure\u306e\u57fa\u672c\u6982\u5ff5</li> <li>Landing Zones\u306e\u8a2d\u8a08\u601d\u60f3</li> </ul>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#3_2","title":"\u30b9\u30c6\u30c3\u30d73: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u3080","text":"<ul> <li><code>platform-landing-zone.auto.tfvars</code>\u30921\u884c\u305a\u3064\u7406\u89e3</li> <li>\u3069\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u4f55\u3092\u5236\u5fa1\u3059\u308b\u304b</li> </ul>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#4_1","title":"\u30b9\u30c6\u30c3\u30d74: \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u7406\u89e3\u3059\u308b","text":"<ul> <li>\u5404\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5f79\u5272</li> <li>\u3069\u3046\u9023\u643a\u3057\u3066\u3044\u308b\u304b</li> </ul>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#5_1","title":"\u30b9\u30c6\u30c3\u30d75: \u5b9f\u969b\u306b\u52d5\u304b\u3059","text":"<ul> <li>\u81ea\u5206\u306e\u74b0\u5883\u3067\u5b9f\u884c</li> <li>\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0</li> </ul>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#6","title":"\u30b9\u30c6\u30c3\u30d76: \u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b","text":"<ul> <li>\u81ea\u5206\u306e\u8981\u4ef6\u306b\u5408\u308f\u305b\u3066\u6539\u9020</li> <li>\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u8ffd\u52a0</li> </ul>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_13","title":"\u3088\u304f\u3042\u308b\u52d8\u9055\u3044","text":""},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#1_4","title":"\u52d8\u9055\u30441: \u300c\u5168\u90e8\u7406\u89e3\u3057\u306a\u3044\u3068\u4f7f\u3048\u306a\u3044\u300d","text":"<p>\u2192 NO! \u307e\u305a\u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u7406\u89e3\u3059\u308c\u3070\u4f7f\u3048\u307e\u3059\u3002 \u6df1\u304f\u7406\u89e3\u3059\u308b\u306e\u306f\u5f8c\u304b\u3089\u3067OK\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#2-azure","title":"\u52d8\u9055\u30442: \u300cAzure\u306e\u5c02\u9580\u5bb6\u3058\u3083\u306a\u3044\u3068\u30c0\u30e1\u300d","text":"<p>\u2192 NO! \u3053\u306e\u30b3\u30fc\u30b9\u3067\u5fc5\u8981\u306a\u77e5\u8b58\u306f\u5168\u90e8\u6559\u3048\u307e\u3059\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#3_3","title":"\u52d8\u9055\u30443: \u300c\u4e00\u5ea6\u4f5c\u3063\u305f\u3089\u5909\u66f4\u3067\u304d\u306a\u3044\u300d","text":"<p>\u2192 NO! Terraform\u306a\u306e\u3067\u3001\u8a2d\u5b9a\u5909\u3048\u3066\u518d\u5b9f\u884c\u3059\u308c\u3070\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#4_2","title":"\u52d8\u9055\u30444: \u300c\u672c\u756a\u74b0\u5883\u3067\u4f7f\u3063\u3061\u3083\u30c0\u30e1\u300d","text":"<p>\u2192 NO! Microsoft\u304c\u63a8\u5968\u3059\u308b\u69cb\u6210\u306a\u306e\u3067\u672c\u756a\u3067\u3082\u4f7f\u3048\u307e\u3059\u3002 \u305f\u3060\u3057\u3001\u6700\u521d\u306f\u691c\u8a3c\u74b0\u5883\u3067\u8a66\u3057\u3066\u306d\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_14","title":"\u7df4\u7fd2\u554f\u984c","text":""},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#1_5","title":"\u554f\u984c1","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u69cb\u7bc9\u3055\u308c\u308b\u4e3b\u8981\u306a3\u3064\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u6319\u3052\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#2_3","title":"\u554f\u984c2","text":"<p>\u306a\u305c\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306fTerraform\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304b\uff1f</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#3_4","title":"\u554f\u984c3","text":"<p>\u3069\u306eChapter\u304b\u3089\u8aad\u3080\u3079\u304d\u304b\u3001\u521d\u5fc3\u8005\u3068\u7d4c\u9a13\u8005\u305d\u308c\u305e\u308c\u306e\u5b66\u7fd2\u30eb\u30fc\u30c8\u3092\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_15","title":"\u7df4\u7fd2\u554f\u984c\u306e\u7b54\u3048","text":""},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#1_6","title":"\u7b54\u30481","text":"<p>\u4e3b\u8981\u306a3\u3064\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\uff1a 1. \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7: \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u968e\u5c64\u7684\u306b\u7ba1\u7406\u3057\u3001\u30dd\u30ea\u30b7\u30fc\u3092\u4e00\u62ec\u9069\u7528 2. \u30cd\u30c3\u30c8\u30ef\u30fc\u30af: Hub-and-Spoke\u69cb\u6210\u3067\u30bb\u30ad\u30e5\u30a2\u306a\u901a\u4fe1\u57fa\u76e4\u3092\u69cb\u7bc9 3. \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9: Log Analytics\u3001\u76e3\u8996\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7ba1\u7406</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#2_4","title":"\u7b54\u30482","text":"<p>Terraform\u3092\u4f7f\u3046\u7406\u7531\uff1a - IaC\uff08Infrastructure as Code\uff09: \u30a4\u30f3\u30d5\u30e9\u3092\u30b3\u30fc\u30c9\u3067\u7ba1\u7406\u3067\u304d\u308b - \u518d\u73fe\u6027: \u540c\u3058\u30b3\u30fc\u30c9\u304b\u3089\u4f55\u5ea6\u3067\u3082\u540c\u3058\u74b0\u5883\u3092\u69cb\u7bc9\u3067\u304d\u308b - \u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406: Git\u3067\u5909\u66f4\u5c65\u6b74\u3092\u8ffd\u8de1\u3067\u304d\u308b - \u30de\u30eb\u30c1\u30af\u30e9\u30a6\u30c9\u5bfe\u5fdc: Azure\u4ee5\u5916\u306e\u30af\u30e9\u30a6\u30c9\u3067\u3082\u4f7f\u3048\u308b\u77e5\u8b58 - \u30e2\u30b8\u30e5\u30fc\u30eb\u5316: \u518d\u5229\u7528\u53ef\u80fd\u306a\u90e8\u54c1\u3068\u3057\u3066\u7ba1\u7406\u3067\u304d\u308b</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#3_5","title":"\u7b54\u30483","text":"<p>\u521d\u5fc3\u8005\u30eb\u30fc\u30c8: - Chapter 00\uff08\u5168\u4f53\u50cf\uff09\u2192 Chapter 01\uff08\u57fa\u790e\u77e5\u8b58\uff09\u2192 Chapter 02\uff08\u69cb\u9020\uff09\u2192 Chapter 13\uff08\u30c7\u30d7\u30ed\u30a4\uff09 - \u57fa\u790e\u304b\u3089\u9806\u756a\u306b\u8aad\u3093\u3067\u3001\u307e\u305a\u52d5\u304b\u3057\u3066\u307f\u308b\u3053\u3068\u304c\u91cd\u8981</p> <p>\u7d4c\u9a13\u8005\u30eb\u30fc\u30c8: - Chapter 00\uff08\u5168\u4f53\u50cf\uff09\u2192 Chapter 03\uff08\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff09\u2192 \u5fc5\u8981\u306a\u7b87\u6240\u3060\u3051\u53c2\u7167 - \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7406\u89e3\u3059\u308c\u3070\u3001\u3059\u3050\u306b\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3067\u304d\u308b</p>"},{"location":"00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/#_16","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":"<p>\u5168\u4f53\u50cf\u306f\u63b4\u3081\u307e\u3057\u305f\u304b\uff1f</p> <p>\u6b21\u306f01_\u57fa\u790e\u77e5\u8b58.md\u306b\u9032\u3093\u3067\u3001 Terraform\u30fbAzure\u30fbLanding Zones\u306e\u57fa\u790e\u3092\u5b66\u3073\u307e\u3057\u3087\u3046\u3002</p> <p>\u300c\u3082\u3046\u77e5\u3063\u3066\u308b\u3088\u300d\u3063\u3066\u4eba\u306f\u98db\u3070\u3057\u3066\u3082OK\u3002 \u3067\u3082\u5ff5\u306e\u305f\u3081\u76ee\u3092\u901a\u3059\u3053\u3068\u3092\u30aa\u30b9\u30b9\u30e1\u3057\u307e\u3059\u3002</p> <p>\u6240\u8981\u6642\u9593: 10\u5206 \u96e3\u6613\u5ea6: \u2605\u2606\u2606\u2606\u2606 \u6b21: 01_\u57fa\u790e\u77e5\u8b58.md</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/","title":"01. \u57fa\u790e\u77e5\u8b58 - Terraform\u30fbAzure\u30fbLanding Zones\u5165\u9580","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_1","title":"\u3053\u306e\u7ae0\u3067\u5b66\u3076\u3053\u3068","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u7406\u89e3\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u57fa\u790e\u77e5\u8b58\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ol> <li>Terraform\u3063\u3066\u4f55\uff1f</li> <li>Azure\u306e\u57fa\u672c\u6982\u5ff5</li> <li>Azure Landing Zones\u306e\u8a2d\u8a08\u601d\u60f3</li> <li>Infrastructure as Code\u306e\u8003\u3048\u65b9</li> </ol> <p>\u3059\u3067\u306b\u77e5\u3063\u3066\u308b\u5185\u5bb9\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u5fa9\u7fd2\u306e\u3064\u3082\u308a\u3067\u30b5\u30e9\u30c3\u3068\u8aad\u3093\u3067\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#part-1-terraform","title":"Part 1: Terraform\u3063\u3066\u4f55\uff1f","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_2","title":"\u300c\u30b3\u30fc\u30c9\u3067\u30a4\u30f3\u30d5\u30e9\u3092\u4f5c\u308b\u300d\u3068\u306f\uff1f","text":"<p>\u6614\u3001\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3066\u308b\u3068\u304d\u306f\u3053\u3046\u3067\u3057\u305f\uff1a</p> <pre><code>1. \u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\u306b\u884c\u304f\n2. \u30e9\u30c3\u30af\u304b\u3089\u30b5\u30fc\u30d0\u30fc\u3092\u53d6\u308a\u51fa\u3059\n3. \u30b1\u30fc\u30d6\u30eb\u3092\u7e4b\u3050\n4. OS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n5. \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u624b\u3067\u7de8\u96c6\n</code></pre> <p>\u4eca\u306f\u30af\u30e9\u30a6\u30c9\u6642\u4ee3\u3002\u753b\u9762\u30dd\u30c1\u30dd\u30c1\u3067\u30b5\u30fc\u30d0\u30fc\u304c\u4f5c\u308c\u307e\u3059\uff1a</p> <pre><code>1. Azure\u30dd\u30fc\u30bf\u30eb\u306b\u30ed\u30b0\u30a4\u30f3\n2. \u300c\u4eee\u60f3\u30de\u30b7\u30f3\u300d\u3092\u30af\u30ea\u30c3\u30af\n3. \u30d5\u30a9\u30fc\u30e0\u306b\u5165\u529b\uff08\u540d\u524d\u3001\u30b5\u30a4\u30ba\u3001\u5834\u6240...\uff09\n4. \u300c\u4f5c\u6210\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\n</code></pre> <p>\u3067\u3082\u3001\u3053\u308c\u3063\u3066\uff1a - \u9593\u9055\u3048\u3084\u3059\u3044\uff08\u5165\u529b\u30df\u30b9\uff09 - \u518d\u73fe\u3067\u304d\u306a\u3044\uff08\u3069\u3046\u4f5c\u3063\u305f\u304b\u5fd8\u308c\u308b\uff09 - \u6642\u9593\u304c\u304b\u304b\u308b\uff0810\u500b\u4f5c\u308b\u306a\u308910\u56de\u3084\u308b\uff09</p> <p>\u305d\u3053\u3067Terraform\u3002**\u30b3\u30fc\u30c9\u3067\u30a4\u30f3\u30d5\u30e9\u3092\u5b9a\u7fa9**\u3057\u307e\u3059\uff1a</p> <pre><code>resource \"azurerm_virtual_machine\" \"example\" {\n  name                = \"my-vm\"\n  location            = \"japaneast\"\n  size                = \"Standard_B2s\"\n  # ...\u305d\u306e\u4ed6\u306e\u8a2d\u5b9a\n}\n</code></pre> <p>\u3053\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001VM\u304c\u4f5c\u3089\u308c\u307e\u3059\u3002 \u30b3\u30fc\u30c9\u306a\u306e\u3067\uff1a - \u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u3067\u304d\u308b\uff08Git\uff09 - \u30ec\u30d3\u30e5\u30fc\u3067\u304d\u308b - \u518d\u5229\u7528\u3067\u304d\u308b - \u81ea\u52d5\u5316\u3067\u304d\u308b</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#terraform3","title":"Terraform\u306e3\u3064\u306e\u30b9\u30c6\u30c3\u30d7","text":"<p>Terraform\u306f3\u30b9\u30c6\u30c3\u30d7\u3067\u52d5\u304d\u307e\u3059\uff1a</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#1-write","title":"1. Write\uff08\u66f8\u304f\uff09","text":"<pre><code># main.tf\nresource \"azurerm_resource_group\" \"example\" {\n  name     = \"my-rg\"\n  location = \"japaneast\"\n}\n</code></pre>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#2-plan","title":"2. Plan\uff08\u8a08\u753b\uff09","text":"<pre><code>$ terraform plan\n# Terraform will perform the following actions:\n#   + azurerm_resource_group.example\n#       name:     \"my-rg\"\n#       location: \"japaneast\"\n</code></pre> <p>\u300c\u3053\u308c\u304b\u3089\u4f55\u3092\u4f5c\u308b\u304b\u300d\u3092\u6559\u3048\u3066\u304f\u308c\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#3-apply","title":"3. Apply\uff08\u9069\u7528\uff09","text":"<pre><code>$ terraform apply\n# \u672c\u5f53\u306b\u5b9f\u884c\u3057\u3066\u3082\u3044\u3044\uff1f (yes/no): yes\n# Creating...\n# Creation complete!\n</code></pre> <p>\u5b9f\u969b\u306bAzure\u306b\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#terraform","title":"Terraform\u306e\u8ce2\u3044\u3068\u3053\u308d","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_3","title":"\u5dee\u5206\u7ba1\u7406","text":"<p>Terraform\u306f\u300c\u73fe\u5728\u306e\u72b6\u614b\u300d\u3092\u899a\u3048\u3066\u3044\u307e\u3059\u3002</p> <pre><code># \u6700\u521d\u306f\u3053\u3046\u66f8\u3044\u305f\nresource \"azurerm_resource_group\" \"example\" {\n  name     = \"my-rg\"\n  location = \"japaneast\"\n}\n\n# \u5f8c\u3067\u5834\u6240\u3092\u5909\u66f4\nresource \"azurerm_resource_group\" \"example\" {\n  name     = \"my-rg\"\n  location = \"japanwest\"  # \u2190 \u5909\u66f4\n}\n</code></pre> <p><code>terraform apply</code>\u3059\u308b\u3068\uff1a - \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u3092\u524a\u9664\u3057\u3066 - \u65b0\u3057\u3044\u5834\u6240\u306b\u4f5c\u308a\u76f4\u3059</p> <p>Terraform\u304c\u8ce2\u304f\u5224\u65ad\u3057\u3066\u304f\u308c\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_4","title":"\u4f9d\u5b58\u95a2\u4fc2\u306e\u89e3\u6c7a","text":"<pre><code>resource \"azurerm_resource_group\" \"rg\" {\n  name     = \"my-rg\"\n  location = \"japaneast\"\n}\n\nresource \"azurerm_virtual_network\" \"vnet\" {\n  name                = \"my-vnet\"\n  resource_group_name = azurerm_resource_group.rg.name  # \u2190 \u4f9d\u5b58\n  location            = azurerm_resource_group.rg.location\n  address_space       = [\"10.0.0.0/16\"]\n}\n</code></pre> <p>VNet\u3092\u4f5c\u308b\u524d\u306b\u3001RG\u3092\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 Terraform\u304c\u81ea\u52d5\u3067\u9806\u5e8f\u3092\u5224\u65ad\u3057\u3066\u304f\u308c\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#hcl","title":"HCL\u306e\u57fa\u672c\u6587\u6cd5","text":"<p>Terraform\u306fHCL\uff08HashiCorp Configuration Language\uff09\u3067\u66f8\u304d\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_5","title":"\u30d6\u30ed\u30c3\u30af\u69cb\u9020","text":"<pre><code>&lt;\u30d6\u30ed\u30c3\u30af\u30bf\u30a4\u30d7&gt; \"&lt;\u30e9\u30d9\u30eb&gt;\" \"&lt;\u540d\u524d&gt;\" {\n  &lt;\u5f15\u6570&gt; = &lt;\u5024&gt;\n}\n</code></pre> <p>\u4f8b\uff1a <pre><code>resource \"azurerm_resource_group\" \"example\" {\n  name     = \"my-rg\"\n  location = \"japaneast\"\n}\n</code></pre></p> <ul> <li><code>resource</code>: \u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9</li> <li><code>\"azurerm_resource_group\"</code>: \u30ea\u30bd\u30fc\u30b9\u306e\u30bf\u30a4\u30d7</li> <li><code>\"example\"</code>: Terraform\u5185\u3067\u306e\u8b58\u5225\u540d</li> <li><code>name</code>, <code>location</code>: \u5f15\u6570</li> </ul>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_6","title":"\u30c7\u30fc\u30bf\u578b","text":"<pre><code># \u6587\u5b57\u5217\nname = \"my-resource\"\n\n# \u6570\u5024\ncount = 3\n\n# \u771f\u507d\u5024\nenabled = true\n\n# \u30ea\u30b9\u30c8\nlocations = [\"japaneast\", \"japanwest\"]\n\n# \u30de\u30c3\u30d7\ntags = {\n  environment = \"prod\"\n  team        = \"platform\"\n}\n</code></pre>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_7","title":"\u5909\u6570\u53c2\u7167","text":"<pre><code># \u5909\u6570\u5b9a\u7fa9\nvariable \"location\" {\n  default = \"japaneast\"\n}\n\n# \u5909\u6570\u4f7f\u7528\nresource \"azurerm_resource_group\" \"rg\" {\n  name     = \"my-rg\"\n  location = var.location  # \u2190 var.\u3067\u53c2\u7167\n}\n</code></pre>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_8","title":"\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u53c2\u7167","text":"<pre><code>resource \"azurerm_resource_group\" \"rg\" {\n  name     = \"my-rg\"\n  location = \"japaneast\"\n}\n\nresource \"azurerm_virtual_network\" \"vnet\" {\n  name                = \"my-vnet\"\n  resource_group_name = azurerm_resource_group.rg.name  # \u2190 \u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53c2\u7167\n  location            = azurerm_resource_group.rg.location\n}\n</code></pre>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#part-2-azure","title":"Part 2: Azure\u306e\u57fa\u672c\u6982\u5ff5","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#azure","title":"Azure\u306e\u968e\u5c64\u69cb\u9020","text":"<p>Azure\u306f\u968e\u5c64\u69cb\u9020\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u307e\u3059\uff1a</p> <pre><code>Azure AD\uff08\u8a8d\u8a3c\u306e\u5927\u5143\uff09\n\u2514\u2500\u2500 Tenant\uff08\u30c6\u30ca\u30f3\u30c8 = \u4f1a\u793e\u5168\u4f53\uff09\n    \u2514\u2500\u2500 Management Groups\uff08\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7 = \u90e8\u7f72\u307f\u305f\u3044\u306a\u3082\u306e\uff09\n        \u2514\u2500\u2500 Subscriptions\uff08\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3 = \u4e88\u7b97\u67a0\uff09\n            \u2514\u2500\u2500 Resource Groups\uff08\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7 = \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\uff09\n                \u2514\u2500\u2500 Resources\uff08\u30ea\u30bd\u30fc\u30b9 = \u5b9f\u969b\u306e\u30b5\u30fc\u30d0\u30fc\u3068\u304b\uff09\n</code></pre>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#1-tenant","title":"1. Tenant\uff08\u30c6\u30ca\u30f3\u30c8\uff09","text":"<p>\u4f1a\u793e\u5168\u4f53\u3002\u666e\u901a\u306f1\u793e1\u30c6\u30ca\u30f3\u30c8\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#2-management-groups","title":"2. Management Groups\uff08\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\uff09","text":"<p>\u90e8\u7f72\u307f\u305f\u3044\u306a\u3082\u306e\u3002\u968e\u5c64\u69cb\u9020\u3067\u7ba1\u7406\u3067\u304d\u307e\u3059\uff1a</p> <pre><code>\u672c\u793e\n\u251c\u2500\u2500 \u958b\u767a\u672c\u90e8\n\u2502   \u251c\u2500\u2500 Web\u30a2\u30d7\u30ea\u30c1\u30fc\u30e0Subscription\n\u2502   \u2514\u2500\u2500 \u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u30c1\u30fc\u30e0Subscription\n\u2514\u2500\u2500 \u30a4\u30f3\u30d5\u30e9\u672c\u90e8\n    \u251c\u2500\u2500 \u30cd\u30c3\u30c8\u30ef\u30fc\u30afSubscription\n    \u2514\u2500\u2500 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3Subscription\n</code></pre> <p>\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306b\u30dd\u30ea\u30b7\u30fc\u3092\u9069\u7528\u3059\u308b\u3068\u3001\u914d\u4e0b\u306e\u5168\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306b\u7d99\u627f\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#3-subscriptions","title":"3. Subscriptions\uff08\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\uff09","text":"<p>\u4e88\u7b97\u67a0\u3002\u6708\u672b\u306b\u8acb\u6c42\u304c\u6765\u307e\u3059\u3002 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3084\u74b0\u5883\u3054\u3068\u306b\u5206\u3051\u308b\u306e\u304c\u4e00\u822c\u7684\uff1a</p> <ul> <li>\u672c\u756a\u74b0\u5883\u7528Subscription</li> <li>\u958b\u767a\u74b0\u5883\u7528Subscription</li> <li>\u691c\u8a3c\u74b0\u5883\u7528Subscription</li> </ul>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#4-resource-groups","title":"4. Resource Groups\uff08\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\uff09","text":"<p>\u30ea\u30bd\u30fc\u30b9\u3092\u675f\u306d\u308b\u5165\u308c\u7269\u3002 \u300c\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4f7f\u3046\u30ea\u30bd\u30fc\u30b9\u306f\u5168\u90e8\u3053\u3053\u300d\u307f\u305f\u3044\u306b\u4f7f\u3044\u307e\u3059\u3002</p> <p>\u7279\u5fb4\uff1a - \u540c\u3058\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306a\u304f\u3066\u3082OK - \u307e\u3068\u3081\u3066\u524a\u9664\u3067\u304d\u308b - \u307e\u3068\u3081\u3066\u6a29\u9650\u7ba1\u7406\u3067\u304d\u308b</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#5-resources","title":"5. Resources\uff08\u30ea\u30bd\u30fc\u30b9\uff09","text":"<p>\u5b9f\u969b\u306eVM\u3001VNet\u3001Storage\u306a\u3069\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#azure_1","title":"Azure\u306e\u91cd\u8981\u306a\u6982\u5ff5","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#location","title":"Location\uff08\u30ea\u30fc\u30b8\u30e7\u30f3\uff09","text":"<p>Azure\u306e\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\u306e\u5834\u6240\u3002\u65e5\u672c\u3060\u3068\uff1a</p> <ul> <li><code>japaneast</code>\uff08\u6771\u65e5\u672c = \u57fc\u7389\u30fb\u6771\u4eac\uff09</li> <li><code>japanwest</code>\uff08\u897f\u65e5\u672c = \u5927\u962a\uff09</li> </ul> <p>\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\uff1a - \u4f7f\u3048\u308b\u30b5\u30fc\u30d3\u30b9\u304c\u9055\u3046 - \u4fa1\u683c\u304c\u9055\u3046 - \u7269\u7406\u7684\u306b\u96e2\u308c\u3066\u3044\u308b\u306e\u3067\u707d\u5bb3\u5bfe\u7b56\u306b\u306a\u308b</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#availability-zones","title":"Availability Zones\uff08\u53ef\u7528\u6027\u30be\u30fc\u30f3\uff09","text":"<p>1\u3064\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u5185\u306e\u8907\u6570\u306e\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\u3002 \u4f8b: \u6771\u65e5\u672c\u30ea\u30fc\u30b8\u30e7\u30f3\u5185\u306b3\u3064\u306e\u30be\u30fc\u30f3\uff08Zone 1, 2, 3\uff09</p> <p>\u91cd\u8981: \u65e5\u672c\u30ea\u30fc\u30b8\u30e7\u30f3\u306f\u5168\u3066\u306e\u30b5\u30fc\u30d3\u30b9\u3067Availability Zones\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u307e\u305b\u3093\uff01 \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u30cf\u30de\u3063\u305f\u30dd\u30a4\u30f3\u30c8\u3067\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#resource-provider","title":"Resource Provider","text":"<p>Azure\u306e\u30b5\u30fc\u30d3\u30b9\u63d0\u4f9b\u8005\u3002\u4f8b\uff1a</p> <ul> <li><code>Microsoft.Network</code>: VNet, Firewall\u306a\u3069</li> <li><code>Microsoft.Compute</code>: VM\u306a\u3069</li> <li><code>Microsoft.Storage</code>: \u30b9\u30c8\u30ec\u30fc\u30b8</li> </ul>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#azure-policy","title":"Azure Policy","text":"<p>Azure\u306e\u300c\u4f1a\u793e\u306e\u30eb\u30fc\u30eb\u300d\u3092\u5f37\u5236\u3059\u308b\u4ed5\u7d44\u307f\u3002</p> <p>\u4f8b\uff1a <pre><code>{\n  \"if\": {\n    \"field\": \"type\",\n    \"equals\": \"Microsoft.Network/publicIPAddresses\"\n  },\n  \"then\": {\n    \"effect\": \"deny\"\n  }\n}\n</code></pre></p> <p>\u300cPublic IP\u306f\u4f5c\u3063\u3061\u3083\u30c0\u30e1\u300d\u3068\u3044\u3046\u30eb\u30fc\u30eb\u3002 \u9055\u53cd\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001Azure\u304c\u6b62\u3081\u3066\u304f\u308c\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#policy3","title":"Policy\u306e3\u8981\u7d20","text":"<ol> <li> <p>Policy Definition\uff08\u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\uff09    \u30eb\u30fc\u30eb\u305d\u306e\u3082\u306e\u3002\u300c\u3053\u3046\u3057\u306a\u3055\u3044\u300d\u300c\u3053\u308c\u30c0\u30e1\u300d</p> </li> <li> <p>Policy Set Definition\uff08\u30dd\u30ea\u30b7\u30fc\u30bb\u30c3\u30c8\u5b9a\u7fa9\uff09    \u8907\u6570\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u307e\u3068\u3081\u305f\u3082\u306e\u3002\u300c\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u57fa\u6e96\u30bb\u30c3\u30c8\u300d\u3068\u304b\u3002</p> </li> <li> <p>Policy Assignment\uff08\u30dd\u30ea\u30b7\u30fc\u5272\u308a\u5f53\u3066\uff09    \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3084\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306b\u9069\u7528\u3059\u308b\u3002</p> </li> </ol>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#policyeffect","title":"Policy\u306e\u52b9\u679c\uff08Effect\uff09","text":"<ul> <li><code>Deny</code>: \u62d2\u5426\u3002\u4f5c\u308c\u306a\u3044\u3002</li> <li><code>Audit</code>: \u8b66\u544a\u3002\u4f5c\u308c\u308b\u3051\u3069\u8a18\u9332\u3055\u308c\u308b\u3002</li> <li><code>Append</code>: \u8ffd\u52a0\u3002\u30bf\u30b0\u3092\u81ea\u52d5\u3067\u4ed8\u3051\u308b\u3068\u304b\u3002</li> <li><code>Modify</code>: \u4fee\u6b63\u3002\u8a2d\u5b9a\u3092\u81ea\u52d5\u3067\u5909\u66f4\u3002</li> <li><code>DeployIfNotExists</code>: \u7121\u3051\u308c\u3070\u4f5c\u308b\u3002</li> </ul>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#part-3-azure-landing-zones","title":"Part 3: Azure Landing Zones\u306e\u8a2d\u8a08\u601d\u60f3","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#landing-zones","title":"Landing Zones\u3063\u3066\u4f55\uff1f","text":"<p>Microsoft\u304c\u5b9a\u7fa9\u3057\u305f\u300c\u4f01\u696d\u5411\u3051Azure\u74b0\u5883\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u300d\u3067\u3059\u3002</p> <p>\u306a\u305cLanding Zones\u304c\u5fc5\u8981\u306a\u306e\u304b\uff1f</p> <p>\u3044\u304d\u306a\u308aAzure\u3067\u30a2\u30d7\u30ea\u3092\u4f5c\u308a\u59cb\u3081\u308b\u3068\u3001\u3053\u3093\u306a\u554f\u984c\u304c\u8d77\u304d\u307e\u3059\uff1a</p> <pre><code>\u274c \u3088\u304f\u3042\u308b\u5931\u6557\u4f8b\n\n1. \u30ea\u30bd\u30fc\u30b9\u304c\u30d0\u30e9\u30d0\u30e9\n   \u2192 \u300c\u3042\u306eVM\u3069\u306eRG\u306b\u5165\u308c\u305f\u3063\u3051\uff1f\u300d\n\n2. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u304c\u7518\u3044\n   \u2192 \u300cPublic IP\u5168\u958b\u3067\u672c\u756a\u30c7\u30d7\u30ed\u30a4\u3057\u3061\u3083\u3063\u305f\u2026\u300d\n\n3. \u30b3\u30b9\u30c8\u304c\u898b\u3048\u306a\u3044\n   \u2192 \u300c\u4eca\u6708\u306e\u8acb\u6c42\u3001\u306a\u3093\u3067500\u4e07\u5186\uff01\uff1f\u300d\n\n4. \u6a29\u9650\u304c\u3081\u3061\u3083\u304f\u3061\u3083\n   \u2192 \u300c\u958b\u767a\u8005\u304c\u672c\u756a\u74b0\u5883\u3092\u524a\u9664\u3067\u304d\u3061\u3083\u3046\u300d\n\n5. \u76e3\u8996\u3057\u3066\u306a\u3044\n   \u2192 \u300c\u969c\u5bb3\u306b3\u65e5\u6c17\u3065\u304b\u306a\u304b\u3063\u305f\u300d\n</code></pre> <p>Landing Zones\u306f\u3001**\u3053\u3046\u3044\u3046\u554f\u984c\u3092\u6700\u521d\u304b\u3089\u9632\u3050\u4ed5\u7d44\u307f**\u3067\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_9","title":"\u98db\u884c\u6a5f\u306e\u4f8b\u3067\u7406\u89e3\u3057\u3088\u3046","text":"<p>\u98db\u884c\u6a5f\u306e\u4f8b\u3067\u8a00\u3046\u3068\uff1a</p> <ul> <li>\u6ed1\u8d70\u8def = Subscription\uff08\u30a2\u30d7\u30ea\u304c\u52d5\u304f\u5834\u6240\uff09</li> <li>\u7ba1\u5236\u5854 = Management Groups + Policy\uff08\u8ab0\u304c\u4f55\u3092\u3057\u3066\u3044\u3044\u304b\u7ba1\u7406\uff09</li> <li>\u6574\u5099\u5834 = Log Analytics\uff08\u76e3\u8996\u30fb\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\uff09</li> <li>\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b2\u30fc\u30c8 = Firewall\uff08\u51fa\u5165\u308a\u53e3\u306e\u691c\u67fb\uff09</li> <li>\u8a98\u5c0e\u706f = Private DNS\uff08\u3069\u3053\u306b\u884c\u3051\u3070\u3044\u3044\u304b\u6848\u5185\uff09</li> </ul> <p>\u5168\u90e8\u63c3\u3063\u3066\u3044\u308b\u304b\u3089\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u300c\u5b89\u5168\u306b\u7740\u9678\u300d\u3067\u304d\u308b\u3002</p> <p>Landing Zones\u304c\u306a\u3044\u3068\uff1f</p> <pre><code>\u6574\u5099\u5834\u306a\u3057 \u2192 \u6545\u969c\u3057\u3066\u3082\u6c17\u3065\u304b\u306a\u3044\n\u7ba1\u5236\u5854\u306a\u3057 \u2192 \u8ab0\u3067\u3082\u597d\u304d\u52dd\u624b\u306b\u98db\u3079\u308b\uff08\u5371\u967a\uff01\uff09\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b2\u30fc\u30c8\u306a\u3057 \u2192 \u30c6\u30ed\u30ea\u30b9\u30c8\u3082\u5165\u308a\u653e\u984c\n</code></pre> <p>\u6016\u3044\u3067\u3059\u3088\u306d\u3002\u3060\u304b\u3089\u6700\u521d\u304b\u3089\u300c\u3061\u3083\u3093\u3068\u3057\u305f\u74b0\u5883\u300d\u3092\u4f5c\u308b\u3093\u3067\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#landing-zones8","title":"Landing Zones\u306e8\u3064\u306e\u8a2d\u8a08\u9818\u57df","text":"<p>Microsoft\u306f8\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002 \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u3001\u3053\u308c\u3089\u5168\u3066\u3092\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#1-azure-billing-and-active-directory-tenant","title":"1. Azure Billing and Active Directory Tenant\uff08\u8ab2\u91d1\u3068\u30c6\u30ca\u30f3\u30c8\uff09","text":"<p>\u4f55\u3092\u6c7a\u3081\u308b\u304b\uff1f - \u8ab0\u304c\u304a\u91d1\u3092\u6255\u3046\u304b - \u3069\u3046\u3084\u3063\u3066\u8a8d\u8a3c\u3059\u308b\u304b - \u5951\u7d04\u5f62\u614b\u306f\u3069\u3046\u3059\u308b\u304b</p> <p>\u5177\u4f53\u7684\u306b\u306f\uff1a</p> <pre><code>\u7d44\u7e54\u69cb\u9020\u306e\u4f8b\uff1a\n\nABC\u682a\u5f0f\u4f1a\u793e\n\u251c\u2500\u2500 Azure AD Tenant: abc.onmicrosoft.com\n\u251c\u2500\u2500 Enrollment Account\uff08EA\u5951\u7d04\uff09\n\u2502   \u2514\u2500\u2500 \u8acb\u6c42\u5148: \u7d4c\u7406\u90e8\n\u2514\u2500\u2500 \u90e8\u9580\u5225\u306b\u4e88\u7b97\u914d\u5206\n    \u251c\u2500\u2500 \u958b\u767a\u90e8\u9580: \u6708500\u4e07\u5186\u307e\u3067\n    \u251c\u2500\u2500 \u672c\u756a\u74b0\u5883: \u67081000\u4e07\u5186\u307e\u3067\n    \u2514\u2500\u2500 \u691c\u8a3c\u74b0\u5883: \u6708100\u4e07\u5186\u307e\u3067\n</code></pre> <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\uff1a - 1\u3064\u306eAzure AD\u30c6\u30ca\u30f3\u30c8 - \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID\u3092\u5909\u6570\u3067\u7ba1\u7406 - \u8907\u6570\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306b\u5bfe\u5fdc\u53ef\u80fd</p> <p>\u3088\u304f\u3042\u308b\u8cea\u554f\uff1a - Q: \u8907\u6570\u30c6\u30ca\u30f3\u30c8\u4f5c\u308c\u308b\uff1f - A: \u4f5c\u308c\u308b\u3051\u3069\u30011\u793e1\u30c6\u30ca\u30f3\u30c8\u304c\u57fa\u672c\u3002M&amp;A\u3068\u304b\u3067\u5897\u3048\u308b\u3053\u3068\u306f\u3042\u308b\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#2-identity-and-access-managementid","title":"2. Identity and Access Management\uff08ID\u30fb\u30a2\u30af\u30bb\u30b9\u7ba1\u7406\uff09","text":"<p>\u4f55\u3092\u6c7a\u3081\u308b\u304b\uff1f - \u8ab0\u304c\u4f55\u3092\u3067\u304d\u308b\u304b\uff08RBAC\uff09 - \u3069\u3046\u3084\u3063\u3066\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u304b\uff08MFA\u3001Conditional Access\uff09 - \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u7ba1\u7406</p> <p>\u5177\u4f53\u7684\u306b\u306f\uff1a</p> <pre><code>\u5f79\u5272\u306e\u4f8b\uff1a\n\n\u3010\u672c\u756a\u74b0\u5883\u3011\n- \u95b2\u89a7\u306e\u307f: \u5168\u793e\u54e1\n- \u30c7\u30d7\u30ed\u30a4\u53ef\u80fd: CI/CD\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\uff08\u81ea\u52d5\uff09\u306e\u307f\n- \u524a\u9664\u53ef\u80fd: \u30a4\u30f3\u30d5\u30e9\u8cac\u4efb\u8005\u306e\u307f\uff08MFA\u5fc5\u9808\uff09\n\n\u3010\u958b\u767a\u74b0\u5883\u3011\n- \u30d5\u30eb\u6a29\u9650: \u958b\u767a\u30c1\u30fc\u30e0\n- \u95b2\u89a7\u306e\u307f: \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\n\n\u3010\u7981\u6b62\u4e8b\u9805\u3011\n- Owner\u6a29\u9650\u306e\u4ed8\u4e0e: \u30a4\u30f3\u30d5\u30e9\u8cac\u4efb\u8005\u306e\u627f\u8a8d\u5fc5\u9808\n- \u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c: \u7981\u6b62\uff08\u8a3c\u660e\u66f8\u304bManaged Identity\u4f7f\u3046\uff09\n</code></pre> <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\uff1a - \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u30ec\u30d9\u30eb\u3067RBAC\u8a2d\u5b9a - Managed Identity\u63a8\u5968\uff08\u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\uff09 - \u30dd\u30ea\u30b7\u30fc\u3067\u5371\u967a\u306a\u64cd\u4f5c\u3092\u5236\u9650</p> <p>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\uff1a - \u672c\u756a\u74b0\u5883\u3078\u306e\u624b\u52d5\u64cd\u4f5c\u306f\u6700\u5c0f\u9650\u306b - MFA\uff08\u591a\u8981\u7d20\u8a8d\u8a3c\uff09\u306f\u5fc5\u9808 - \u5b9a\u671f\u7684\u306b\u6a29\u9650\u3092\u68da\u5378\u3057</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#3-resource-organization","title":"3. Resource Organization\uff08\u30ea\u30bd\u30fc\u30b9\u306e\u6574\u7406\uff09","text":"<p>\u4f55\u3092\u6c7a\u3081\u308b\u304b\uff1f - \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u968e\u5c64\u69cb\u9020 - \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306e\u5206\u3051\u65b9 - \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u547d\u540d\u898f\u5247</p> <p>\u5177\u4f53\u7684\u306b\u306f\uff1a</p> <pre><code>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u69cb\u9020\uff1a\n\nRoot Management Group\n\u251c\u2500\u2500 Platform\uff08\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0 = \u57fa\u76e4\uff09\n\u2502   \u251c\u2500\u2500 Management\uff08\u76e3\u8996\u57fa\u76e4\uff09\n\u2502   \u2502   \u2514\u2500\u2500 Subscription: monitoring\n\u2502   \u251c\u2500\u2500 Connectivity\uff08\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u57fa\u76e4\uff09\n\u2502   \u2502   \u2514\u2500\u2500 Subscription: connectivity\n\u2502   \u2514\u2500\u2500 Identity\uff08\u8a8d\u8a3c\u57fa\u76e4\uff09\n\u2502       \u2514\u2500\u2500 Subscription: identity\n\u2514\u2500\u2500 Landing Zones\uff08\u30e9\u30f3\u30c7\u30a3\u30f3\u30b0\u30be\u30fc\u30f3 = \u30a2\u30d7\u30ea\u7528\uff09\n    \u251c\u2500\u2500 Corp\uff08\u793e\u5185\u5411\u3051\u30a2\u30d7\u30ea\uff09\n    \u2502   \u2514\u2500\u2500 Subscription: app-corp-prod\n    \u251c\u2500\u2500 Online\uff08\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u516c\u958b\u30a2\u30d7\u30ea\uff09\n    \u2502   \u2514\u2500\u2500 Subscription: app-online-prod\n    \u2514\u2500\u2500 Sandbox\uff08\u5b9f\u9a13\u7528\uff09\n        \u2514\u2500\u2500 Subscription: sandbox-dev\n</code></pre> <p>\u306a\u305c\u3053\u3046\u5206\u3051\u308b\u304b\uff1f</p> <ol> <li>Platform\uff08\u57fa\u76e4\uff09\u306f\u5206\u96e2</li> <li>\u300c\u30a4\u30f3\u30d5\u30e9\u30c1\u30fc\u30e0\u300d\u304c\u7ba1\u7406</li> <li>\u30a2\u30d7\u30ea\u958b\u767a\u8005\u306f\u89e6\u3089\u305b\u306a\u3044</li> <li> <p>\u5168\u793e\u3067\u5171\u6709\uff08Firewall\u3001\u76e3\u8996\u7b49\uff09</p> </li> <li> <p>Landing Zones\uff08\u30a2\u30d7\u30ea\u7528\uff09\u306f\u3055\u3089\u306b\u5206\u3051\u308b</p> </li> <li>Corp: \u793e\u5185\u5c02\u7528\uff08VPN\u7d4c\u7531\u306e\u307f\uff09</li> <li>Online: \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u516c\u958b\uff08Firewall\u5fc5\u9808\uff09</li> <li> <p>Sandbox: \u5b9f\u9a13\u7528\uff08\u30b3\u30b9\u30c8\u5236\u9650\u3001\u81ea\u52d5\u524a\u9664\uff09</p> </li> <li> <p>\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3067\u4e88\u7b97\u7ba1\u7406</p> </li> <li>1\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3 = 1\u8acb\u6c42\u5358\u4f4d</li> <li>\u300c\u4eca\u6708\u3053\u306e\u30a2\u30d7\u30ea\u3044\u304f\u3089\u4f7f\u3063\u305f\uff1f\u300d\u304c\u898b\u3048\u308b</li> </ol> <p>\u547d\u540d\u898f\u5247\u306e\u4f8b\uff1a</p> <pre><code>\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7:\nrg-{\u7528\u9014}-{\u74b0\u5883}-{\u30ea\u30fc\u30b8\u30e7\u30f3}\n\u4f8b: rg-web-prod-japaneast\n\n\u30ea\u30bd\u30fc\u30b9:\n{\u7a2e\u985e}-{\u7528\u9014}-{\u74b0\u5883}-{\u30ea\u30fc\u30b8\u30e7\u30f3}\n\u4f8b: vm-web-prod-japaneast-001\n</code></pre> <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\uff1a - Terraform\u3067\u81ea\u52d5\u547d\u540d - \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5909\u6570\u3067\u4e00\u62ec\u7ba1\u7406 - \u5168\u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u9808\u30bf\u30b0\uff08environment, cost-center\u7b49\uff09</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#4-network-topology-and-connectivity","title":"4. Network Topology and Connectivity\uff08\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09","text":"<p>\u4f55\u3092\u6c7a\u3081\u308b\u304b\uff1f - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\uff08Hub-Spoke or Virtual WAN\uff09 - \u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u3068\u306e\u63a5\u7d9a\u65b9\u6cd5 - IP\u30a2\u30c9\u30ec\u30b9\u8a2d\u8a08</p> <p>\u5177\u4f53\u7684\u306b\u306f\uff1a</p> <pre><code>Hub-Spoke\u69cb\u6210\u306e\u4f8b\uff1a\n\nHub VNet\uff0810.0.0.0/16\uff09\n\u251c\u2500\u2500 Firewall Subnet\uff0810.0.128.0/26\uff09\n\u251c\u2500\u2500 Gateway Subnet\uff0810.0.1.0/27\uff09 \u2190 VPN/ExpressRoute\n\u251c\u2500\u2500 Bastion Subnet\uff0810.0.0.64/26\uff09\n\u2514\u2500\u2500 Peering \u2192\n\nSpoke VNet 1\uff0810.1.0.0/16\uff09\u2190 Corp\uff08\u793e\u5185\u5411\u3051\uff09\n\u251c\u2500\u2500 App Subnet\uff0810.1.0.0/24\uff09\n\u2514\u2500\u2500 DB Subnet\uff0810.1.1.0/24\uff09\n\nSpoke VNet 2\uff0810.2.0.0/16\uff09\u2190 Online\uff08\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5411\u3051\uff09\n\u251c\u2500\u2500 App Subnet\uff0810.2.0.0/24\uff09\n\u2514\u2500\u2500 DB Subnet\uff0810.2.1.0/24\uff09\n\n\u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u304cHub\u7d4c\u7531\n  \u2193\nFirewall\u3067\u4e00\u5143\u7ba1\u7406\n</code></pre> <p>\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u63a5\u7d9a\u306e\u9078\u629e\u80a2\uff1a</p> \u63a5\u7d9a\u65b9\u6cd5 \u901f\u5ea6 \u30b3\u30b9\u30c8 \u7279\u5fb4 VPN Gateway \u6700\u59271.25Gbps \u00a540,000/\u6708 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u7d4c\u7531\u3001\u5c0e\u5165\u7c21\u5358 ExpressRoute 10Gbps\u301c \u00a550,000/\u6708\u301c \u5c02\u7528\u7dda\u3001\u5b89\u5b9a\u3001\u9ad8\u984d <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\uff1a - Hub-Spoke\u578b\u3068Virtual WAN\u578b\u306e\u4e21\u65b9\u306b\u5bfe\u5fdc - \u6771\u65e5\u672c\u30fb\u897f\u65e5\u672c\u306e2\u30ea\u30fc\u30b8\u30e7\u30f3\u69cb\u6210 - Private DNS\u3067\u540d\u524d\u89e3\u6c7a - \u5168\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092Firewall\u3067\u691c\u67fb</p> <p>\u3088\u304f\u3042\u308b\u5931\u6557\uff1a - IP\u30a2\u30c9\u30ec\u30b9\u304c\u91cd\u8907\uff08\u30aa\u30f3\u30d7\u30ec\u3068\u88ab\u3063\u305f\uff09 - Firewall\u901a\u3055\u305a\u306b\u76f4\u63a5\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\uff08\u5371\u967a\uff01\uff09 - \u30ea\u30fc\u30b8\u30e7\u30f3\u9593\u901a\u4fe1\u3092\u8003\u3048\u3066\u306a\u3044</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#5-security","title":"5. Security\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\uff09","text":"<p>\u4f55\u3092\u6c7a\u3081\u308b\u304b\uff1f - Firewall/WAF\u306e\u8a2d\u5b9a - DDoS\u5bfe\u7b56 - \u30c7\u30fc\u30bf\u6697\u53f7\u5316 - \u8105\u5a01\u691c\u77e5</p> <p>\u5177\u4f53\u7684\u306b\u306f\uff1a</p> <pre><code>\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u5c64\uff08Defense in Depth\uff09\n\n\u3010\u5916\u5074\u3011\n1. DDoS Protection\n   \u2192 \u5927\u91cf\u30a2\u30af\u30bb\u30b9\u653b\u6483\u3092\u9632\u3050\n\n2. Azure Firewall\n   \u2192 \u4e0d\u6b63\u306a\u901a\u4fe1\u3092\u30d6\u30ed\u30c3\u30af\n\n3. WAF\uff08Web Application Firewall\uff09\n   \u2192 SQL\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u7b49\u3092\u9632\u3050\n\n\u3010\u4e2d\u9593\u3011\n4. NSG\uff08Network Security Group\uff09\n   \u2192 \u30b5\u30d6\u30cd\u30c3\u30c8/VM\u5358\u4f4d\u3067\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\n\n5. Private Endpoint\n   \u2192 Storage\u306a\u3069\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304b\u3089\u96a0\u3059\n\n\u3010\u5185\u5074\u3011\n6. Disk Encryption\n   \u2192 \u30c7\u30fc\u30bf\u3092\u6697\u53f7\u5316\n\n7. Key Vault\n   \u2192 \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5b89\u5168\u306b\u4fdd\u7ba1\n\n8. Microsoft Defender for Cloud\n   \u2192 \u8105\u5a01\u3092\u691c\u77e5\u30fb\u901a\u77e5\n</code></pre> <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\uff1a - Azure Firewall Standard\uff08\u8105\u5a01\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30b9\u6709\u52b9\uff09 - Private DNS Zones\uff08\u5185\u90e8\u540d\u524d\u89e3\u6c7a\uff09 - \u30dd\u30ea\u30b7\u30fc\u3067\u300cPublic IP\u7981\u6b62\u300d\u306a\u3069\u3092\u5f37\u5236 - \u5168\u30ea\u30bd\u30fc\u30b9\u306e\u30ed\u30b0\u3092Log Analytics\u306b\u96c6\u7d04</p> <p>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\uff1a - \u300c\u4f55\u3082\u8a2d\u5b9a\u3057\u306a\u3044 = \u5371\u967a\u300d\u3067\u306f\u306a\u304f\u3001\u300c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5b89\u5168\u300d\u306b - \u30dd\u30ea\u30b7\u30fc\u3067\u5371\u967a\u306a\u8a2d\u5b9a\u3092\u81ea\u52d5\u30d6\u30ed\u30c3\u30af - \u5b9a\u671f\u7684\u306b\u8106\u5f31\u6027\u8a3a\u65ad</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#6-management","title":"6. Management\uff08\u7ba1\u7406\uff09","text":"<p>\u4f55\u3092\u6c7a\u3081\u308b\u304b\uff1f - \u76e3\u8996\u30fb\u30ed\u30b0\u53ce\u96c6 - \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u6226\u7565 - \u707d\u5bb3\u5bfe\u7b56\uff08DR\uff09</p> <p>\u5177\u4f53\u7684\u306b\u306f\uff1a</p> <pre><code>\u76e3\u8996\u306e\u57fa\u672c\uff1a\n\n\u3010\u30ed\u30b0\u53ce\u96c6\u3011\nLog Analytics Workspace\n\u251c\u2500\u2500 Activity Log\uff08\u8ab0\u304c\u4f55\u3092\u64cd\u4f5c\u3057\u305f\u304b\uff09\n\u251c\u2500\u2500 Resource Log\uff08VM\u306e\u72b6\u614b\u3001\u30a8\u30e9\u30fc\u7b49\uff09\n\u251c\u2500\u2500 Firewall Log\uff08\u901a\u4fe1\u8a18\u9332\uff09\n\u2514\u2500\u2500 Security Log\uff08\u653b\u6483\u691c\u77e5\uff09\n\n\u3010\u30a2\u30e9\u30fc\u30c8\u8a2d\u5b9a\u3011\n- VM\u505c\u6b62: \u5373\u5ea7\u306b\u901a\u77e5\n- CPU 90%\u8d85: \u8b66\u544a\n- \u4e0d\u5be9\u306a\u30ed\u30b0\u30a4\u30f3: Slack\u306b\u901a\u77e5\n\n\u3010\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3011\n- VM: \u6bce\u65e5\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u300130\u65e5\u4fdd\u6301\n- Database: \u6bce\u6642\u9593\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30017\u65e5\u4fdd\u6301\n- Blob Storage: Geo\u5197\u9577\uff08\u4ed6\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u30b3\u30d4\u30fc\uff09\n</code></pre> <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\uff1a - \u6771\u65e5\u672c\u30ea\u30fc\u30b8\u30e7\u30f3\u306bLog Analytics\u4f5c\u6210 - Azure Monitor Agent\u3067\u81ea\u52d5\u30ed\u30b0\u53ce\u96c6 - Automation Account\uff08\u81ea\u52d5\u904b\u7528\u30bf\u30b9\u30af\u7528\uff09</p> <p>\u3088\u304f\u3042\u308b\u904b\u7528\u30b7\u30ca\u30ea\u30aa\uff1a</p> <pre><code>\u969c\u5bb3\u767a\u751f\uff01\n\n1. Log Analytics\u3067\u8abf\u67fb\n   query: \u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u691c\u7d22\n\n2. \u539f\u56e0\u7279\u5b9a\n   \u2192 Firewall\u304c\u901a\u4fe1\u3092\u30d6\u30ed\u30c3\u30af\u3057\u3066\u305f\n\n3. \u8a2d\u5b9a\u5909\u66f4\n   \u2192 Terraform\u3067\u4fee\u6b63 \u2192 apply\n\n4. \u8a18\u9332\n   \u2192 Git\u306b\u5c65\u6b74\u304c\u6b8b\u308b\n</code></pre>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#7-governance","title":"7. Governance\uff08\u30ac\u30d0\u30ca\u30f3\u30b9\uff09","text":"<p>\u4f55\u3092\u6c7a\u3081\u308b\u304b\uff1f - Policy\u3067\u30eb\u30fc\u30eb\u3092\u5f37\u5236 - \u30bf\u30b0\u3067\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406 - \u30b3\u30b9\u30c8\u7ba1\u7406</p> <p>\u5177\u4f53\u7684\u306b\u306f\uff1a</p> <pre><code>\u30dd\u30ea\u30b7\u30fc\u306e\u4f8b\uff1a\n\n\u3010\u5fc5\u9808\u30dd\u30ea\u30b7\u30fc\u3011\n1. \"\u8a31\u53ef\u3055\u308c\u305f\u30ea\u30fc\u30b8\u30e7\u30f3\"\n   \u2192 \u6771\u65e5\u672c\u30fb\u897f\u65e5\u672c\u4ee5\u5916\u306fNG\n\n2. \"\u5fc5\u9808\u30bf\u30b0\"\n   \u2192 environment, cost-center, owner\n\n3. \"Public IP\u7981\u6b62\"\n   \u2192 \u52dd\u624b\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u516c\u958bNG\n\n4. \"VM\u30b5\u30a4\u30ba\u5236\u9650\"\n   \u2192 Standard_E64s_v3\u4ee5\u4e0a\u306f\u7981\u6b62\uff08\u9ad8\u3059\u304e\u308b\uff09\n\n5. \"\u524a\u9664\u30ed\u30c3\u30af\"\n   \u2192 \u672c\u756a\u74b0\u5883\u306f\u524a\u9664\u7981\u6b62\n\n\u3010\u76e3\u67fb\u30dd\u30ea\u30b7\u30fc\u3011\n- \"Disk\u6697\u53f7\u5316\u306a\u3057\" \u2192 \u8b66\u544a\n- \"\u53e4\u3044TLS\u4f7f\u7528\" \u2192 \u8b66\u544a\n</code></pre> <p>\u30bf\u30b0\u6226\u7565\uff1a</p> <pre><code>\u5fc5\u9808\u30bf\u30b0:\n- environment: prod / dev / staging\n- cost-center: \u90e8\u7f72\u30b3\u30fc\u30c9\n- owner: \u8cac\u4efb\u8005\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n- project: \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\n\n\u4f7f\u3044\u9053:\n\u2192 Cost Management\u3067\u300c\u90e8\u7f72\u5225\u30b3\u30b9\u30c8\u300d\u3092\u96c6\u8a08\n\u2192 \u300c\u3053\u306e\u30ea\u30bd\u30fc\u30b9\u8ab0\u306e\uff1f\u300d\u304c\u3059\u3050\u308f\u304b\u308b\n\u2192 \u81ea\u52d5\u524a\u9664\u5bfe\u8c61\u306e\u5224\u5b9a\uff08dev\u74b0\u5883\u306f\u9031\u672b\u524a\u9664\u7b49\uff09\n</code></pre> <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\uff1a - YAML\u3067\u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\uff08\u8aad\u307f\u3084\u3059\u3044\uff09 - \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306b\u30dd\u30ea\u30b7\u30fc\u3092\u9069\u7528\uff08\u914d\u4e0b\u5168\u3066\u306b\u9069\u7528\uff09 - Terraform\u3067\u30bf\u30b0\u3092\u81ea\u52d5\u4ed8\u4e0e</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#8-platform-automation-and-devops","title":"8. Platform Automation and DevOps\uff08\u81ea\u52d5\u5316\uff09","text":"<p>\u4f55\u3092\u6c7a\u3081\u308b\u304b\uff1f - CI/CD\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 - Infrastructure as Code\uff08IaC\uff09 - \u81ea\u52d5\u30c6\u30b9\u30c8</p> <p>\u5177\u4f53\u7684\u306b\u306f\uff1a</p> <pre><code>\u81ea\u52d5\u5316\u306e\u6d41\u308c\uff1a\n\n\u3010\u958b\u767a\u30d5\u30ed\u30fc\u3011\n1. Terraform\u30b3\u30fc\u30c9\u3092\u66f8\u304f\n   \u2514\u2500 feature/add-vm \u30d6\u30e9\u30f3\u30c1\n\n2. Pull Request\u4f5c\u6210\n   \u2514\u2500 GitHub Actions\u3067\u81ea\u52d5\u30c6\u30b9\u30c8\n\n3. \u30ec\u30d3\u30e5\u30fc\u30fb\u627f\u8a8d\n   \u2514\u2500 terraform plan \u306e\u7d50\u679c\u3092\u78ba\u8a8d\n\n4. main\u30d6\u30e9\u30f3\u30c1\u306b\u30de\u30fc\u30b8\n   \u2514\u2500 \u81ea\u52d5\u3067terraform apply\n\n5. \u30c7\u30d7\u30ed\u30a4\u5b8c\u4e86\n   \u2514\u2500 Slack\u306b\u901a\u77e5\n\n\u3010\u81ea\u52d5\u30c6\u30b9\u30c8\u5185\u5bb9\u3011\n- \u2705 HCL\u6587\u6cd5\u30c1\u30a7\u30c3\u30af\uff08terraform fmt\uff09\n- \u2705 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b9\u30ad\u30e3\u30f3\uff08tfsec\uff09\n- \u2705 \u30b3\u30b9\u30c8\u898b\u7a4d\u3082\u308a\uff08Infracost\uff09\n- \u2705 \u30dd\u30ea\u30b7\u30fc\u9055\u53cd\u30c1\u30a7\u30c3\u30af\n</code></pre> <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\uff1a - GitHub Actions\u3067\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u69cb\u7bc9 - Terraform Cloud\u3067\u30b9\u30c6\u30fc\u30c8\u7ba1\u7406 - Azure\u3078\u306e\u8a8d\u8a3c\u306fOIDC\uff08\u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\uff09</p> <p>\u81ea\u52d5\u5316\u306e\u30e1\u30ea\u30c3\u30c8\uff1a - \u4eba\u7684\u30df\u30b9\u304c\u6e1b\u308b - \u30c7\u30d7\u30ed\u30a4\u304c\u65e9\u3044\uff08\u6570\u5206\uff09 - \u5c65\u6b74\u304c\u6b8b\u308b\uff08\u3044\u3064\u8ab0\u304c\u4f55\u3092\u5909\u66f4\u3057\u305f\u304b\uff09 - \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u7c21\u5358\uff08Git\u3067\u623b\u3059\u3060\u3051\uff09</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#8","title":"\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u300c8\u3064\u5168\u90e8\u300d\u5b9f\u88c5\u3057\u3066\u3044\u308b","text":"\u8a2d\u8a08\u9818\u57df \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u5b9f\u88c5 1. \u8ab2\u91d1\u30fb\u30c6\u30ca\u30f3\u30c8 \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID\u7ba1\u7406\u3001EA\u5bfe\u5fdc 2. ID\u30fb\u30a2\u30af\u30bb\u30b9\u7ba1\u7406 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3067RBAC\u3001Managed Identity 3. \u30ea\u30bd\u30fc\u30b9\u6574\u7406 Platform/Landing Zones\u69cb\u9020 4. \u30cd\u30c3\u30c8\u30ef\u30fc\u30af Hub-Spoke\u30012\u30ea\u30fc\u30b8\u30e7\u30f3\u3001Firewall 5. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3 Firewall\u3001Policy\u3001Private DNS 6. \u7ba1\u7406 Log Analytics\u3001Automation 7. \u30ac\u30d0\u30ca\u30f3\u30b9 YAML Policy\u3001\u30bf\u30b0\u6226\u7565 8. \u81ea\u52d5\u5316 GitHub Actions\u3001Terraform <p>\u3064\u307e\u308a\u3001\u3053\u306e\u30b3\u30fc\u30c9\u3092\u4f7f\u3048\u3070\u3001 **Microsoft\u304c\u63a8\u5968\u3059\u308b\u300c\u3061\u3083\u3093\u3068\u3057\u305f\u4f01\u696d\u5411\u3051Azure\u74b0\u5883\u300d\u304c\u81ea\u52d5\u3067\u4f5c\u308c\u308b**\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_10","title":"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30d1\u30bf\u30fc\u30f3\uff1a\u3069\u3063\u3061\u3092\u9078\u3076\uff1f","text":"<p>Azure Landing Zones\u306b\u306f\u3001\u4e3b\u306b2\u3064\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#1-hub-spoke","title":"\u30d1\u30bf\u30fc\u30f31: Hub-Spoke\u578b\uff08\u30cf\u30d6\u30fb\u30b9\u30dd\u30fc\u30af\uff09","text":"<p>\u56f3\u89e3\uff1a</p> <pre><code>        Hub VNet\uff08\u4e2d\u592e\u62e0\u70b9\uff09\n        10.0.0.0/16\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502 Firewall        \u2502\u2190 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u51fa\u5165\u53e3\n        \u2502 Bastion         \u2502\u2190 \u5b89\u5168\u306aVM\u63a5\u7d9a\n        \u2502 VPN Gateway     \u2502\u2190 \u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u63a5\u7d9a\n        \u2502 Private DNS     \u2502\u2190 \u540d\u524d\u89e3\u6c7a\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502 VNet Peering\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502       \u2502       \u2502\n      Spoke1  Spoke2  Spoke3\n      10.1.x.x 10.2.x.x 10.3.x.x\n      \u2502       \u2502       \u2502\n    WebApp  API    Database\n</code></pre> <p>\u901a\u4fe1\u306e\u6d41\u308c\uff1a</p> <pre><code>\u4f8b1: \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304b\u3089WebApp\u3078\u306e\u30a2\u30af\u30bb\u30b9\n\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\n  \u2193\nHub VNet\u306eFirewall \u2190 \u3053\u3053\u3067\u691c\u67fb\n  \u2193\nSpoke1\uff08WebApp\uff09\n\n\u4f8b2: Spoke1\u304b\u3089Spoke2\u3078\u306e\u901a\u4fe1\n\nSpoke1\uff08WebApp\uff09\n  \u2193\nHub VNet\u306eFirewall \u2190 \u5fc5\u305aHub\u7d4c\u7531\n  \u2193\nSpoke2\uff08API\uff09\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a - \u30b7\u30f3\u30d7\u30eb\u3067\u7406\u89e3\u3057\u3084\u3059\u3044 - \u30b3\u30b9\u30c8\u304c\u6bd4\u8f03\u7684\u5b89\u3044 - \u5c0f\u301c\u4e2d\u898f\u6a21\u306b\u6700\u9069</p> <p>\u30c7\u30e1\u30ea\u30c3\u30c8\uff1a - \u30ea\u30fc\u30b8\u30e7\u30f3\u307e\u305f\u304e\u304c\u9762\u5012 - Spoke\u9593\u901a\u4fe1\u304c\u5fc5\u305aHub\u7d4c\u7531\uff08\u9045\u5ef6\u5897\u3048\u308b\uff09 - \u30b0\u30ed\u30fc\u30d0\u30eb\u5c55\u958b\u306b\u306f\u5411\u304b\u306a\u3044</p> <p>\u3053\u3093\u306a\u4f1a\u793e\u306b\u5411\u3044\u3066\u308b\uff1a - \u65e5\u672c\u56fd\u5185\u3060\u3051\u3067\u5c55\u958b - \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u6570\u304c10\u500b\u4ee5\u5185 - \u4e88\u7b97\u304c\u9650\u3089\u308c\u3066\u3044\u308b</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#2-virtual-wan","title":"\u30d1\u30bf\u30fc\u30f32: Virtual WAN\u578b","text":"<p>\u56f3\u89e3\uff1a</p> <pre><code>         Virtual WAN\uff08\u30b0\u30ed\u30fc\u30d0\u30eb\uff09\n              \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502         \u2502         \u2502\n  vHub1     vHub2     vHub3\n \u6771\u65e5\u672c     \u897f\u65e5\u672c     \u7c73\u56fd\n10.0.0.0/16 10.1.0.0/16 10.2.0.0/16\n    \u2502         \u2502         \u2502\n \u250c\u2500\u2500\u253c\u2500\u2500\u2510   \u250c\u2500\u2500\u253c\u2500\u2500\u2510   \u250c\u2500\u2500\u253c\u2500\u2500\u2510\nSpoke Spoke Spoke Spoke Spoke Spoke\n</code></pre> <p>\u901a\u4fe1\u306e\u6d41\u308c\uff1a</p> <pre><code>\u4f8b: \u6771\u65e5\u672c\u306e\u30a2\u30d7\u30ea\u304b\u3089\u7c73\u56fd\u306eDB\u306b\u30a2\u30af\u30bb\u30b9\n\n\u6771\u65e5\u672c\u306eSpoke\n  \u2193\nvHub1\uff08\u6771\u65e5\u672c\uff09\n  \u2193 Virtual WAN\u30d0\u30c3\u30af\u30dc\u30fc\u30f3\uff08\u9ad8\u901f\u30fb\u4f4e\u9045\u5ef6\uff09\nvHub3\uff08\u7c73\u56fd\uff09\n  \u2193\n\u7c73\u56fd\u306eSpoke\uff08DB\uff09\n\n\u203b Hub-Spoke\u578b\u3088\u308a\u8a2d\u5b9a\u304c\u7c21\u5358\u3067\u901f\u3044\uff01\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a - \u30b0\u30ed\u30fc\u30d0\u30eb\u5c55\u958b\u304c\u7c21\u5358 - \u30ea\u30fc\u30b8\u30e7\u30f3\u9593\u901a\u4fe1\u304c\u9ad8\u901f - \u8a2d\u5b9a\u304c\u30b7\u30f3\u30d7\u30eb\uff08Azure\u304c\u81ea\u52d5\u3067\u6700\u9069\u5316\uff09 - \u62e0\u70b9\u304c\u5897\u3048\u3066\u3082\u7ba1\u7406\u304c\u697d</p> <p>\u30c7\u30e1\u30ea\u30c3\u30c8\uff1a - \u30b3\u30b9\u30c8\u304c\u9ad8\u3044\uff08Virtual WAN\u81ea\u4f53\u306e\u6599\u91d1\uff09 - \u5c0f\u898f\u6a21\u306b\u306f\u904e\u5270</p> <p>\u3053\u3093\u306a\u4f1a\u793e\u306b\u5411\u3044\u3066\u308b\uff1a - \u4e16\u754c\u4e2d\u306b\u62e0\u70b9\u304c\u3042\u308b - \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u6570\u304c\u591a\u3044\uff0820\u500b\u4ee5\u4e0a\uff09 - \u9ad8\u901f\u306a\u901a\u4fe1\u304c\u5fc5\u8981</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_11","title":"\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\u4e21\u65b9\u4f7f\u3048\u308b\uff01","text":"<pre><code># Hub-Spoke\u578b\u3092\u4f7f\u3046\u5834\u5408\nconnectivity_type = \"hub_and_spoke_vnet\"\n\n# Virtual WAN\u578b\u3092\u4f7f\u3046\u5834\u5408\nconnectivity_type = \"virtual_wan\"\n</code></pre> <p>\u5909\u65701\u3064\u5909\u3048\u308b\u3060\u3051\u3067\u5207\u308a\u66ff\u3048\u53ef\u80fd\u3067\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_12","title":"\u3069\u3063\u3061\u3092\u9078\u3079\u3070\u3044\u3044\uff1f","text":"<pre><code>\u8cea\u554f\u306b\u7b54\u3048\u3066\u304f\u3060\u3055\u3044\uff1a\n\nQ1: \u6d77\u5916\u306b\u3082\u5c55\u958b\u3059\u308b\u4e88\u5b9a\u304c\u3042\u308b\uff1f\n  Yes \u2192 Virtual WAN\u63a8\u5968\n  No  \u2192 Q2\u3078\n\nQ2: \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f10\u500b\u4ee5\u4e0a\u3042\u308b\uff1f\n  Yes \u2192 Virtual WAN\u63a8\u5968\n  No  \u2192 Q3\u3078\n\nQ3: \u4e88\u7b97\u306f\u6f64\u6ca2\u306b\u3042\u308b\uff1f\n  Yes \u2192 Virtual WAN \u3067\u3082OK\n  No  \u2192 Hub-Spoke\u63a8\u5968\n\n\u3010\u7d50\u8ad6\u3011\n- \u5c0f\u898f\u6a21\u30fb\u56fd\u5185\u306e\u307f \u2192 Hub-Spoke\n- \u5927\u898f\u6a21\u30fb\u30b0\u30ed\u30fc\u30d0\u30eb \u2192 Virtual WAN\n- \u8ff7\u3063\u305f\u3089 \u2192 Hub-Spoke\u3067\u59cb\u3081\u3066\u3001\u5f8c\u3067\u79fb\u884c\n</code></pre>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_13","title":"\u5b9f\u969b\u306e\u4f01\u696d\u4f8b","text":"<p>Hub-Spoke\u578b\u3092\u9078\u3093\u3060\u4f01\u696d\uff1a - \u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\uff08\u56fd\u5185\u5411\u3051SaaS\uff09 - \u4e2d\u5c0f\u4f01\u696d\uff08\u793e\u5185\u30b7\u30b9\u30c6\u30e0\u306e\u307f\uff09 - \u4e88\u7b97\u91cd\u8996\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8</p> <p>Virtual WAN\u578b\u3092\u9078\u3093\u3060\u4f01\u696d\uff1a - \u30b0\u30ed\u30fc\u30d0\u30eb\u4f01\u696d\uff08\u4e16\u754c10\u62e0\u70b9\u4ee5\u4e0a\uff09 - \u5927\u898f\u6a21SaaS\uff08\u8907\u6570\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u5c55\u958b\uff09 - M&amp;A\u3067\u5897\u3048\u305f\u62e0\u70b9\u306e\u7d71\u5408</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#part-4-infrastructure-as-code-iac","title":"Part 4: Infrastructure as Code (IaC)","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_14","title":"\u306a\u305c\u30b3\u30fc\u30c9\u3067\u66f8\u304f\u306e\u304b\uff1f","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_15","title":"\u5f93\u6765\u306e\u554f\u984c\u70b9","text":"<pre><code>\u624b\u9806\u66f8: \u30b5\u30fc\u30d0\u30fc\u69cb\u7bc9\u624b\u9806.docx\n\n1. \u30dd\u30fc\u30bf\u30eb\u306b\u30ed\u30b0\u30a4\u30f3\n2. \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u300crg-prod\u300d\u3092\u4f5c\u6210\n3. \u5834\u6240\u306f\u300cEast Japan\u300d\u3092\u9078\u629e\n4. ...\uff08\u7701\u7565\uff09...\n20. \u5b8c\u4e86\n</code></pre> <p>\u3053\u308c\u306e\u554f\u984c\uff1a - \u4eba\u306b\u3088\u3063\u3066\u89e3\u91c8\u304c\u9055\u3046 - \u624b\u9806\u66f8\u304c\u53e4\u304f\u306a\u308b - \u30df\u30b9\u304c\u8d77\u304d\u308b - \u518d\u73fe\u304c\u5927\u5909</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#iac","title":"IaC\u306e\u30e1\u30ea\u30c3\u30c8","text":"<p>1. \u518d\u73fe\u6027 <pre><code>resource \"azurerm_resource_group\" \"prod\" {\n  name     = \"rg-prod\"\n  location = \"japaneast\"\n}\n</code></pre></p> <p>\u4f55\u5ea6\u5b9f\u884c\u3057\u3066\u3082\u540c\u3058\u7d50\u679c\u3002</p> <p>2. \u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406 <pre><code>git log\n# commit 3: Firewall\u3092\u8ffd\u52a0\n# commit 2: VNet\u306e\u30b5\u30a4\u30ba\u3092\u5909\u66f4\n# commit 1: \u521d\u671f\u69cb\u7bc9\n</code></pre></p> <p>\u3044\u3064\u8ab0\u304c\u4f55\u3092\u5909\u66f4\u3057\u305f\u304b\u308f\u304b\u308b\u3002</p> <p>3. \u30ec\u30d3\u30e5\u30fc <pre><code>git diff\n# + resource \"azurerm_firewall\" \"fw\" {\n# +   name = \"fw-prod\"\n# + }\n</code></pre></p> <p>\u5909\u66f4\u5185\u5bb9\u3092\u8ab0\u304b\u306b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3082\u3089\u3048\u308b\u3002</p> <p>4. \u81ea\u52d5\u5316 <pre><code># GitHub Actions\non: push\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - terraform apply\n</code></pre></p> <p>Git\u306bpush\u3057\u305f\u3089Full\u81ea\u52d5\u3067\u30c7\u30d7\u30ed\u30a4\u3002</p> <p>5. \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u30b3\u30fc\u30c9\u81ea\u4f53\u304c\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3002 \u300c\u3069\u3046\u4f5c\u3063\u305f\u304b\u300d\u304c\u660e\u78ba\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#iac_1","title":"IaC\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#1","title":"1. \u5c0f\u3055\u304f\u59cb\u3081\u308b","text":"<p>\u3044\u304d\u306a\u308a\u5168\u90e8IaC\u306b\u3057\u306a\u3044\u3002 \u307e\u305a\u306f1\u3064\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#2","title":"2. \u30e2\u30b8\u30e5\u30fc\u30eb\u5316","text":"<p>\u518d\u5229\u7528\u53ef\u80fd\u306a\u90e8\u54c1\u306b\u5206\u3051\u308b\u3002 \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u5316\u306e\u826f\u3044\u4f8b\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#3","title":"3. \u74b0\u5883\u3092\u5206\u3051\u308b","text":"<pre><code>environments/\n\u251c\u2500\u2500 dev/      # \u958b\u767a\u74b0\u5883\n\u251c\u2500\u2500 staging/  # \u691c\u8a3c\u74b0\u5883\n\u2514\u2500\u2500 prod/     # \u672c\u756a\u74b0\u5883\n</code></pre>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#4","title":"4. \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u542b\u3081\u306a\u3044","text":"<p>\u30d1\u30b9\u30ef\u30fc\u30c9\u3084API\u30ad\u30fc\u306f\u30b3\u30fc\u30c9\u306b\u66f8\u304b\u306a\u3044\u3002 \u74b0\u5883\u5909\u6570\u3084Key Vault\u3092\u4f7f\u3046\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#5-plan","title":"5. Plan\u3092\u5fc5\u305a\u898b\u308b","text":"<p><code>terraform apply</code>\u306e\u524d\u306b<code>terraform plan</code>\u3002 \u4f55\u304c\u5909\u308f\u308b\u304b\u5fc5\u305a\u78ba\u8a8d\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#part-5","title":"Part 5: \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4f7f\u3046\u6280\u8853","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#terraformtf","title":"terraform.tf\u306e\u89e3\u8aac","text":"<p>\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\uff1a</p> <pre><code>terraform {\n  required_version = \"~&gt; 1.12\"\n\n  required_providers {\n    alz = {\n      source  = \"Azure/alz\"\n      version = \"0.20.0\"\n    }\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~&gt; 4.0\"\n    }\n    azapi = {\n      source  = \"Azure/azapi\"\n      version = \"~&gt; 2.0\"\n    }\n    local = {\n      source  = \"hashicorp/local\"\n      version = \"~&gt; 2.5\"\n    }\n  }\n\n  backend \"azurerm\" {}\n}\n</code></pre>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#required_version","title":"required_version","text":"<pre><code>required_version = \"~&gt; 1.12\"\n</code></pre> <p>\u300cTerraform 1.12\u4ee5\u4e0a\u3058\u3083\u306a\u3044\u3068\u52d5\u304b\u306a\u3044\u3088\u300d\u3068\u3044\u3046\u5ba3\u8a00\u3002 <code>~&gt; 1.12</code>\u306f\u300c1.12.x\u300d\u306e\u3053\u3068\u30021.13\u30842.0\u306fNG\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#required_providers","title":"required_providers","text":"<p>\u4f7f\u3046\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\uff08Azure\u3068\u304bAWS\u3068\u304b\uff09\u3092\u5ba3\u8a00\u3002</p> <p>alz: Azure Landing Zones\u5c02\u7528\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc azurerm: Azure Resource Manager\uff08Azure\u306e\u30e1\u30a4\u30f3\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\uff09 azapi: Azure API\u76f4\u63a5\u53e9\u304f\u7528\uff08azurerm\u3067\u3067\u304d\u306a\u3044\u3053\u3068\u306b\u4f7f\u3046\uff09 local: \u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u64cd\u4f5c\u7528</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#backend","title":"backend","text":"<pre><code>backend \"azurerm\" {}\n</code></pre> <p>Terraform\u306e\u72b6\u614b\u30d5\u30a1\u30a4\u30eb\uff08terraform.tfstate\uff09\u3092\u3069\u3053\u306b\u4fdd\u5b58\u3059\u308b\u304b\u3002 <code>azurerm</code>= Azure\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u5b58\u3002</p> <p>\u30c1\u30fc\u30e0\u3067\u5171\u6709\u3067\u304d\u308b\u3057\u3001\u6d88\u3048\u306a\u3044\u306e\u3067\u5b89\u5168\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_16","title":"\u307e\u3068\u3081","text":"<p>\u3053\u306e\u7ae0\u3067\u5b66\u3093\u3060\u3053\u3068\uff1a</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#terraform_1","title":"Terraform","text":"<ul> <li>\u30b3\u30fc\u30c9\u3067\u30a4\u30f3\u30d5\u30e9\u3092\u5b9a\u7fa9</li> <li>Plan \u2192 Apply \u306e2\u30b9\u30c6\u30c3\u30d7</li> <li>\u5dee\u5206\u7ba1\u7406\u3068\u4f9d\u5b58\u95a2\u4fc2\u89e3\u6c7a\u304c\u8ce2\u3044</li> </ul>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#azure_2","title":"Azure","text":"<ul> <li>\u968e\u5c64\u69cb\u9020\uff08Tenant \u2192 MG \u2192 Sub \u2192 RG \u2192 Resource\uff09</li> <li>Policy\u3067\u30eb\u30fc\u30eb\u3092\u5f37\u5236</li> <li>\u65e5\u672c\u30ea\u30fc\u30b8\u30e7\u30f3\u306fAZ\u975e\u5bfe\u5fdc\u306e\u30b5\u30fc\u30d3\u30b9\u3042\u308a</li> </ul>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#landing-zones_1","title":"Landing Zones","text":"<ul> <li>\u4f01\u696d\u5411\u3051\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</li> <li>8\u3064\u306e\u8a2d\u8a08\u9818\u57df</li> <li>Hub-Spoke\u578b or Virtual WAN\u578b</li> </ul>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#iac_2","title":"IaC","text":"<ul> <li>\u518d\u73fe\u6027\u30fb\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u30fb\u30ec\u30d3\u30e5\u30fc\u304c\u53ef\u80fd</li> <li>\u30b3\u30fc\u30c9\u81ea\u4f53\u304c\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> <li>\u81ea\u52d5\u5316\u304c\u7c21\u5358</li> </ul>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_17","title":"\u7df4\u7fd2\u554f\u984c","text":"<p>\u7406\u89e3\u5ea6\u30c1\u30a7\u30c3\u30af\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#1_1","title":"\u554f\u984c1","text":"<p>Terraform\u306e<code>terraform plan</code>\u30b3\u30de\u30f3\u30c9\u306f\u4f55\u3092\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3059\u304b\uff1f</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#2_1","title":"\u554f\u984c2","text":"<p>Azure\u3067\u300c\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u300d\u306e\u5f79\u5272\u306f\u4f55\u3067\u3059\u304b\uff1f</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#3_1","title":"\u554f\u984c3","text":"<p>IaC\u306e\u6700\u5927\u306e\u30e1\u30ea\u30c3\u30c8\u30921\u3064\u6319\u3052\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#4_1","title":"\u554f\u984c4","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4f7f\u3063\u3066\u3044\u308b\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u30923\u3064\u6319\u3052\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_18","title":"\u7df4\u7fd2\u554f\u984c\u306e\u7b54\u3048","text":""},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#1_2","title":"\u7b54\u30481","text":"<p><code>terraform plan</code>\u306f\u3001Terraform\u304c\u5b9f\u969b\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u5909\u66f4\u3059\u308b\u524d\u306b\u3001\u300c\u4f55\u304c\u4f5c\u6210/\u5909\u66f4/\u524a\u9664\u3055\u308c\u308b\u304b\u300d\u3092\u8868\u793a\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\u5b9f\u969b\u306b\u306f\u4f55\u3082\u5909\u66f4\u305b\u305a\u3001\u30d7\u30ec\u30d3\u30e5\u30fc\u3060\u3051\u3092\u898b\u305b\u3066\u304f\u308c\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#2_2","title":"\u7b54\u30482","text":"<p>\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306f\u3001\u8907\u6570\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u307e\u3068\u3081\u3066\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u968e\u5c64\u69cb\u9020\u3067\u3059\u3002\u30dd\u30ea\u30b7\u30fc\u3084\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u3092\u4e00\u62ec\u3067\u9069\u7528\u3067\u304d\u3001\u7d44\u7e54\u5168\u4f53\u306e\u30ac\u30d0\u30ca\u30f3\u30b9\u3092\u52b9\u7387\u7684\u306b\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#3_2","title":"\u7b54\u30483","text":"<p>IaC\u306e\u6700\u5927\u306e\u30e1\u30ea\u30c3\u30c8\u306f\u300c\u518d\u73fe\u6027\u300d\u3067\u3059\u3002\u540c\u3058\u30b3\u30fc\u30c9\u304b\u3089\u4f55\u5ea6\u3067\u3082\u540c\u3058\u74b0\u5883\u3092\u4f5c\u308c\u308b\u305f\u3081\u3001\u624b\u4f5c\u696d\u306e\u30df\u30b9\u304c\u306a\u304f\u306a\u308a\u3001\u74b0\u5883\u306e\u5dee\u7570\u3082\u767a\u751f\u3057\u307e\u305b\u3093\u3002</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#4_2","title":"\u7b54\u30484","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4f7f\u3063\u3066\u3044\u308b\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u306f\uff1a 1. alz (Azure Landing Zones\u5c02\u7528\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc) 2. azurerm (Azure\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406) 3. azapi (\u6700\u65b0Azure API\u5bfe\u5fdc)</p>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#terraform_2","title":"\ud83d\udccb Terraform\u30b3\u30de\u30f3\u30c9\u65e9\u898b\u8868","text":"<p>\u57fa\u672c\u30b3\u30de\u30f3\u30c9\uff08\u5b89\u5168\u306a\u3082\u306e\uff09</p> \u30b3\u30de\u30f3\u30c9 \u7528\u9014 \u5371\u967a\u5ea6 \u3088\u304f\u4f7f\u3046 <code>terraform init</code> \u521d\u671f\u5316\uff08\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\uff09 \u5b89\u5168 \u2705 \u6700\u521d\u306b1\u56de <code>terraform fmt</code> \u30b3\u30fc\u30c9\u3092\u6574\u5f62\uff08\u898b\u3084\u3059\u304f\u3059\u308b\uff09 \u5b89\u5168 \u2705 \u6bce\u56de <code>terraform validate</code> \u6587\u6cd5\u30c1\u30a7\u30c3\u30af \u5b89\u5168 \u2705 \u6bce\u56de <code>terraform plan</code> \u5909\u66f4\u5185\u5bb9\u306e\u78ba\u8a8d\uff08\u5b9f\u884c\u3057\u306a\u3044\uff09 \u5b89\u5168 \u2705 \u6bce\u56de <p>\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\uff08\u6ce8\u610f\u304c\u5fc5\u8981\uff09</p> \u30b3\u30de\u30f3\u30c9 \u7528\u9014 \u5371\u967a\u5ea6 \u6ce8\u610f\u70b9 <code>terraform apply</code> \u5909\u66f4\u3092\u5b9f\u969b\u306b\u9069\u7528 \u6ce8\u610f \u26a0\ufe0f plan \u3067\u78ba\u8a8d\u3057\u3066\u304b\u3089 <code>terraform destroy</code> \u5168\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664 \u5371\u967a \ud83d\udea8 \u672c\u756a\u3067\u306f\u7d76\u5bfe\u30c0\u30e1\uff01 <p>\u305d\u306e\u4ed6\u306e\u30b3\u30de\u30f3\u30c9</p> \u30b3\u30de\u30f3\u30c9 \u7528\u9014 \u5371\u967a\u5ea6 <code>terraform show</code> \u73fe\u5728\u306e\u72b6\u614b\u3092\u8868\u793a \u5b89\u5168 \u2705 <code>terraform output</code> \u51fa\u529b\u5024\u3092\u8868\u793a \u5b89\u5168 \u2705 <code>terraform state list</code> \u7ba1\u7406\u4e2d\u306e\u30ea\u30bd\u30fc\u30b9\u4e00\u89a7 \u5b89\u5168 \u2705 <code>terraform refresh</code> \u72b6\u614b\u3092\u6700\u65b0\u306b\u66f4\u65b0 \u6ce8\u610f \u26a0\ufe0f <p>\ud83d\udccc \u57fa\u672c\u7684\u306a\u5b9f\u884c\u306e\u6d41\u308c</p> <pre><code># 1. \u6700\u521d\u306e1\u56de\u3060\u3051\uff08\u521d\u671f\u5316\uff09\nterraform init\n\n# 2. \u30b3\u30fc\u30c9\u3092\u6574\u5f62\nterraform fmt\n\n# 3. \u6587\u6cd5\u30c1\u30a7\u30c3\u30af\nterraform validate\n\n# 4. \u5909\u66f4\u5185\u5bb9\u3092\u78ba\u8a8d\uff08\u4f55\u5ea6\u3067\u3082OK\uff09\nterraform plan\n\n# 5. \u554f\u984c\u306a\u3051\u308c\u3070\u5b9f\u884c\nterraform apply\n# \u2192 \"yes\" \u3068\u5165\u529b\n\n# 6. \u7d50\u679c\u3092\u78ba\u8a8d\nterraform show\n</code></pre> <p>\ud83d\udca1 \u3088\u304f\u3042\u308b\u4f7f\u3044\u65b9</p> <pre><code># \u958b\u767a\u4e2d\uff08\u5909\u66f4\u3092\u78ba\u8a8d\u3057\u306a\u304c\u3089\uff09\nterraform plan\n# \u554f\u984c\u306a\u3057 \u2192 apply\nterraform apply\n\n# \u30c7\u30d0\u30c3\u30b0\uff08\u8a73\u7d30\u30ed\u30b0\u3092\u898b\u305f\u3044\uff09\nTF_LOG=DEBUG terraform plan\n\n# \u7279\u5b9a\u306e\u30ea\u30bd\u30fc\u30b9\u3060\u3051\u524a\u9664\nterraform destroy -target=azurerm_resource_group.example\n\n# \u72b6\u614b\u3092\u78ba\u8a8d\nterraform state list\nterraform state show azurerm_resource_group.example\n</code></pre> <p>\u26a0\ufe0f \u3084\u3063\u3066\u306f\u3044\u3051\u306a\u3044\u3053\u3068</p> <pre><code># \u274c plan \u305b\u305a\u306b apply\nterraform apply -auto-approve  # \u5371\u967a\uff01\u672c\u756a\u3067\u306f\u7d76\u5bfe\u30c0\u30e1\n\n# \u274c state \u30d5\u30a1\u30a4\u30eb\u3092\u76f4\u63a5\u7de8\u96c6\nvim terraform.tfstate  # \u58ca\u308c\u308b\uff01\n\n# \u274c \u8907\u6570\u4eba\u3067\u540c\u6642\u306b apply\n# \u2192 State \u30d5\u30a1\u30a4\u30eb\u304c\u58ca\u308c\u308b\n# \u2192 GitHub Actions \u3067\u6392\u4ed6\u5236\u5fa1\u304c\u5fc5\u8981\n</code></pre>"},{"location":"01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/#_19","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":"<p>\u57fa\u790e\u77e5\u8b58\u306f\u7d42\u308f\u308a\uff01 \u6b21\u306f02_\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020.md\u3067\u3001 \u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u3092\u8a73\u3057\u304f\u898b\u3066\u3044\u304d\u307e\u3059\u3002</p> <p>\u6240\u8981\u6642\u9593: 30\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2606\u2606\u2606 \u524d: 00_\u306f\u3058\u3081\u306b.md \u6b21: 02_\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020.md</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/","title":"02. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020 - \u30d5\u30a1\u30a4\u30eb\u3068\u30d5\u30a9\u30eb\u30c0\u306e\u5168\u4f53\u50cf","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_1","title":"\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u306e\u9ce5\u77b0\u56f3","text":"<p>\u307e\u305a\u3001\u5168\u4f53\u306e\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\uff1a</p> <pre><code>alz-mgmt/\n\u251c\u2500\u2500 \ud83d\udcdd \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08\u3042\u306a\u305f\u304c\u7de8\u96c6\u3059\u308b\uff09\n\u2502   \u251c\u2500\u2500 platform-landing-zone.auto.tfvars  \u2190 \u30e1\u30a4\u30f3\u8a2d\u5b9a\uff08\u3053\u3053\u3060\u3051\u89e6\u308c\u3070OK\uff09\n\u2502   \u251c\u2500\u2500 terraform.tfvars.json              \u2190 \u79d8\u5bc6\u60c5\u5831\uff08Git\u7ba1\u7406\u5916\uff09\n\u2502   \u2514\u2500\u2500 terraform.tf                       \u2190 Terraform\u81ea\u4f53\u306e\u8a2d\u5b9a\n\u2502\n\u251c\u2500\u2500 \ud83c\udfaf \u5909\u6570\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\uff08\u5909\u6570\u306e\u578b\u3092\u5b9a\u7fa9\uff09\n\u2502   \u251c\u2500\u2500 variables.tf                                      \u2190 \u5171\u901a\u5909\u6570\n\u2502   \u251c\u2500\u2500 variables.connectivity.tf                         \u2190 \u63a5\u7d9a\u95a2\u9023\n\u2502   \u251c\u2500\u2500 variables.connectivity.hub.and.spoke.virtual.network.tf\n\u2502   \u251c\u2500\u2500 variables.connectivity.virtual.wan.tf\n\u2502   \u251c\u2500\u2500 variables.management.tf                           \u2190 \u7ba1\u7406\u95a2\u9023\n\u2502   \u2514\u2500\u2500 variables.moved.tf                                \u2190 \u5f8c\u65b9\u4e92\u63db\u7528\n\u2502\n\u251c\u2500\u2500 \ud83d\udd27 \u30ed\u30fc\u30ab\u30eb\u5909\u6570\uff08\u8a08\u7b97\u6e08\u307f\u306e\u5024\uff09\n\u2502   \u2514\u2500\u2500 locals.tf                          \u2190 \u5909\u6570\u3092\u52a0\u5de5\u3057\u305f\u5024\n\u2502\n\u251c\u2500\u2500 \ud83d\ude80 \u30e1\u30a4\u30f3\u51e6\u7406\u30d5\u30a1\u30a4\u30eb\uff08\u5b9f\u969b\u306e\u51e6\u7406\uff09\n\u2502   \u251c\u2500\u2500 main.config.tf                                    \u2190 \u8a2d\u5b9a\u51e6\u7406\n\u2502   \u251c\u2500\u2500 main.resource.groups.tf                           \u2190 \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u4f5c\u6210\n\u2502   \u251c\u2500\u2500 main.management.tf                                \u2190 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u30fb\u30dd\u30ea\u30b7\u30fc\n\u2502   \u251c\u2500\u2500 main.connectivity.hub.and.spoke.virtual.network.tf \u2190 Hub-Spoke\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\u2502   \u2514\u2500\u2500 main.connectivity.virtual.wan.tf                  \u2190 Virtual WAN\n\u2502\n\u251c\u2500\u2500 \ud83d\udce4 \u51fa\u529b\u5b9a\u7fa9\uff08\u4f5c\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u60c5\u5831\u3092\u51fa\u529b\uff09\n\u2502   \u251c\u2500\u2500 outputs.tf                         \u2190 \u51fa\u529b\u5b9a\u7fa9\n\u2502   \u2514\u2500\u2500 outputs.moved.tf                   \u2190 \u5f8c\u65b9\u4e92\u63db\u7528\n\u2502\n\u251c\u2500\u2500 \ud83d\udce6 \u30e2\u30b8\u30e5\u30fc\u30eb\uff08\u518d\u5229\u7528\u53ef\u80fd\u306a\u90e8\u54c1\uff09\n\u2502   \u251c\u2500\u2500 config-templating/                 \u2190 \u8a2d\u5b9a\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\n\u2502   \u251c\u2500\u2500 management_groups/                 \u2190 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u30fb\u30dd\u30ea\u30b7\u30fc\n\u2502   \u2514\u2500\u2500 management_resources/              \u2190 Log Analytics\u7b49\n\u2502\n\u251c\u2500\u2500 \ud83d\udcda \u30e9\u30a4\u30d6\u30e9\u30ea\uff08\u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\u306eYAML\uff09\n\u2502   \u251c\u2500\u2500 alz_library_metadata.json\n\u2502   \u251c\u2500\u2500 archetype_definitions/             \u2190 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u7a2e\u985e\n\u2502   \u2514\u2500\u2500 architecture_definitions/          \u2190 \u5168\u4f53\u69cb\u6210\n\u2502\n\u251c\u2500\u2500 \ud83e\udd16 CI/CD\uff08\u81ea\u52d5\u5316\uff09\n\u2502   \u2514\u2500\u2500 .github/\n\u2502       \u2514\u2500\u2500 workflows/\n\u2502           \u2514\u2500\u2500 cd.yaml                    \u2190 GitHub Actions\u8a2d\u5b9a\n\u2502\n\u2514\u2500\u2500 \ud83d\udcd6 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n    \u251c\u2500\u2500 README.md                          \u2190 \u5143\u306e\u8aac\u660e\u66f8\n    \u251c\u2500\u2500 README_STORY.md                    \u2190 \u30b9\u30c8\u30fc\u30ea\u30fc\u7248\u8aac\u660e\u66f8\n    \u2514\u2500\u2500 docs/                              \u2190 \u3053\u306e\u30d5\u30a9\u30eb\u30c0\uff08\u6559\u79d1\u66f8\uff09\n</code></pre>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_2","title":"\u30d5\u30a1\u30a4\u30eb\u6570\u3068\u30b3\u30fc\u30c9\u91cf","text":"<p>\u5168\u4f53\u3067\uff1a - Terraform\u30d5\u30a1\u30a4\u30eb: \u7d0420\u500b - \u30e2\u30b8\u30e5\u30fc\u30eb\u5185\u30d5\u30a1\u30a4\u30eb: \u7d0410\u500b - YAML\u30d5\u30a1\u30a4\u30eb: \u7d0410\u500b - \u7dcf\u30b3\u30fc\u30c9\u884c\u6570: \u7d043,000\u884c</p> <p>\u4e00\u898b\u591a\u305d\u3046\u3067\u3059\u304c\u3001\u5b9f\u306f\u6574\u7406\u3055\u308c\u3066\u3044\u307e\u3059\u3002</p> <p>\ud83d\udcca \u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u306e\u95a2\u4fc2\u56f3</p> <pre><code>\u3010\u8a2d\u5b9a\u5c64\u3011\nplatform-landing-zone.auto.tfvars \u2190\u2500\u2510 \u3042\u306a\u305f\u304c\u7de8\u96c6\nterraform.tfvars.json            \u2190\u2500\u2524 \u3059\u308b\u90e8\u5206\n                                    \u2502\n        \u2193 \u8aad\u307f\u8fbc\u307f                  \u2502\n                                    \u2502\n\u3010\u5909\u6570\u5b9a\u7fa9\u5c64\u3011                      \u2502\nvariables.tf                        \u2502\nvariables.*.tf                      \u2502\n        \u2193                           \u2502\n                                    \u2502\n\u3010\u52a0\u5de5\u5c64\u3011                          \u2502\nlocals.tf \u2190 \u8a08\u7b97\u30fb\u5909\u63db              \u2502\n        \u2193                           \u2502\n                                    \u2502\n\u3010\u51e6\u7406\u5c64\u3011                          \u2502\nmain.*.tf \u2190 \u5b9f\u969b\u306e\u51e6\u7406              \u2502\n        \u2193                           \u2502\n        \u251c\u2192 modules/config-templating  \u2190 \u8a2d\u5b9a\u306e\u52a0\u5de5\n        \u251c\u2192 modules/management_groups  \u2190 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u4f5c\u6210\n        \u2514\u2192 modules/management_resources \u2190 \u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\n                \u2193                   \u2502\n                                    \u2502\n\u3010\u51fa\u529b\u5c64\u3011                          \u2502\noutputs.tf \u2190 \u4f5c\u6210\u7d50\u679c               \u2502\n        \u2193                           \u2502\n        \u8868\u793a\u30fb\u4ed6\u306eTerraform\u3067\u5229\u7528    \u2502\n                                    \u2502\n        \u2193                           \u2502\n\u3010\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3011                    \u2502\nlib/archetype_definitions/ \u2190\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\nlib/architecture_definitions/        \u968e\u5c64\u5b9a\u7fa9\n</code></pre> <p>\ud83d\udd04 \u5b9f\u969b\u306e\u51e6\u7406\u306e\u6d41\u308c</p> <pre><code>1. \u30e6\u30fc\u30b6\u30fc\u304c\u7de8\u96c6\n   \u2193\n   platform-landing-zone.auto.tfvars\n   starter_locations = [\"japaneast\"]\n\n2. \u5909\u6570\u5b9a\u7fa9\u3067\u578b\u30c1\u30a7\u30c3\u30af\n   \u2193\n   variables.tf\n   variable \"starter_locations\" {\n     type = list(string)\n   }\n\n3. locals\u3067\u52a0\u5de5\n   \u2193\n   locals.tf\n   starter_location_01 = \"japaneast\"\n\n4. module\u3067\u51e6\u7406\n   \u2193\n   modules/config-templating\n   \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5909\u6570\u3092\u5c55\u958b\n\n5. main\u3067\u5b9f\u884c\n   \u2193\n   main.management.tf\n   \u5b9f\u969b\u306b\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\n\n6. output\u3067\u7d50\u679c\u51fa\u529b\n   \u2193\n   outputs.tf\n   \u4f5c\u6210\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u306eID\u306a\u3069\n</code></pre>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#part-1","title":"Part 1: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u305f\u3061","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#platform-landing-zoneautotfvars","title":"platform-landing-zone.auto.tfvars","text":"<p>\u5f79\u5272: \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30a4\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb \u7de8\u96c6: \u2705 \u3042\u306a\u305f\u304c\u7de8\u96c6\u3059\u308b \u91cd\u8981\u5ea6: \u2605\u2605\u2605\u2605\u2605</p> <pre><code>starter_locations = [\"japaneast\", \"japanwest\"]\n\ncustom_replacements = {\n  names = {\n    primary_firewall_enabled = true\n    # ...500\u884c\u304f\u3089\u3044\u7d9a\u304f\n  }\n}\n</code></pre> <p>\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u7de8\u96c6\u3059\u308c\u3070\u3001\u307b\u3068\u3093\u3069\u306e\u8a2d\u5b9a\u304c\u5909\u66f4\u3067\u304d\u307e\u3059\u3002</p> <p>\u306a\u305c<code>.auto.tfvars</code>\uff1f - <code>.tfvars</code>\u3060\u3068<code>terraform apply -var-file=xxx.tfvars</code>\u3063\u3066\u6307\u5b9a\u304c\u5fc5\u8981 - <code>.auto.tfvars</code>\u306f\u81ea\u52d5\u3067\u8aad\u307f\u8fbc\u307e\u308c\u308b - \u697d\u3060\u304b\u3089<code>.auto</code>\u3092\u3064\u3051\u3066\u308b</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#terraformtfvarsjson","title":"terraform.tfvars.json","text":"<p>\u5f79\u5272: \u79d8\u5bc6\u60c5\u5831\uff08\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID\u3068\u304b\uff09 \u7de8\u96c6: \u2705 \u6700\u521d\u3060\u3051\u7de8\u96c6\u3059\u308b \u91cd\u8981\u5ea6: \u2605\u2605\u2605\u2605\u2606</p> <pre><code>{\n  \"subscription_ids\": {\n    \"management\": \"\u3042\u306a\u305f\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID\",\n    \"connectivity\": \"\u3042\u306a\u305f\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID\",\n    \"identity\": \"\u3042\u306a\u305f\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID\"\n  }\n}\n</code></pre> <p>\u306a\u305cJSON\u5f62\u5f0f\uff1f - HCL\u3088\u308a\u6a5f\u68b0\u7684\u306b\u751f\u6210\u3057\u3084\u3059\u3044 - CI/CD\u3067\u52d5\u7684\u306b\u4f5c\u308a\u3084\u3059\u3044</p> <p>\u6ce8\u610f: <code>.gitignore</code>\u306b\u5165\u3063\u3066\u308b\uff08Git\u306b\u30b3\u30df\u30c3\u30c8\u3055\u308c\u306a\u3044\uff09</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#terraformtf","title":"terraform.tf","text":"<p>\u5f79\u5272: Terraform\u81ea\u4f53\u306e\u8a2d\u5b9a \u7de8\u96c6: \u274c \u57fa\u672c\u89e6\u3089\u306a\u3044 \u91cd\u8981\u5ea6: \u2605\u2605\u2605\u2606\u2606</p> <pre><code>terraform {\n  required_version = \"~&gt; 1.12\"\n\n  required_providers {\n    alz = {\n      source  = \"Azure/alz\"\n      version = \"0.20.0\"\n    }\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~&gt; 4.0\"\n    }\n  }\n\n  backend \"azurerm\" {}\n}\n</code></pre>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#required_version","title":"required_version","text":"<p><pre><code>required_version = \"~&gt; 1.12\"\n</code></pre> Terraform 1.12.x \u3058\u3083\u306a\u3044\u3068\u52d5\u304b\u306a\u3044\u5ba3\u8a00\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#required_providers","title":"required_providers","text":"<p>\u4f7f\u3046\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u6307\u5b9a\u3002</p> <p>\u306a\u305c<code>~&gt; 4.0</code>\uff1f - <code>~&gt;</code> = \u4e92\u63db\u6027\u306e\u3042\u308b\u7bc4\u56f2\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7OK - <code>4.0</code> = 4.0.x, 4.1.x, 4.99.x \u306fOK\u30015.0.x \u306fNG - \u30d0\u30b0\u4fee\u6b63\u306f\u53d7\u3051\u53d6\u308a\u305f\u3044\u3051\u3069\u3001\u7834\u58ca\u7684\u5909\u66f4\u306f\u907f\u3051\u305f\u3044</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#backend","title":"backend","text":"<p><pre><code>backend \"azurerm\" {}\n</code></pre> \u72b6\u614b\u30d5\u30a1\u30a4\u30eb\uff08<code>terraform.tfstate</code>\uff09\u3092Azure Storage\u306b\u4fdd\u5b58\u3002</p> <p><code>{}</code>\u304c\u7a7a\u306a\u306e\u306f\u3001\u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3059\u308b\u304b\u3089\uff1a <pre><code>terraform init \\\n  -backend-config=\"resource_group_name=rg-tfstate\" \\\n  -backend-config=\"storage_account_name=stotfstate\" \\\n  -backend-config=\"container_name=tfstate\" \\\n  -backend-config=\"key=terraform.tfstate\"\n</code></pre></p> <p>GitHub Actions\u3067\u3053\u306e\u6307\u5b9a\u3092\u3084\u3063\u3066\u307e\u3059\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#part-2","title":"Part 2: \u5909\u6570\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u305f\u3061","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_3","title":"\u5909\u6570\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u5f79\u5272","text":"<p>Terraform\u306e\u5909\u6570\u306b\u306f**\u578b**\u304c\u3042\u308a\u307e\u3059\u3002</p> <pre><code># variables.tf\nvariable \"location\" {\n  type        = string           # \u578b\u306f\u6587\u5b57\u5217\n  description = \"Azure region\"   # \u8aac\u660e\n  default     = \"japaneast\"      # \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\n}\n</code></pre> <p>\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u300c\u3069\u3093\u306a\u5909\u6570\u3092\u53d7\u3051\u53d6\u308b\u304b\u300d\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#variablestf","title":"variables.tf\uff08\u30e1\u30a4\u30f3\u5909\u6570\uff09","text":"<p>\u5f79\u5272: \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u5168\u4f53\u3067\u4f7f\u3046\u5171\u901a\u5909\u6570 \u7de8\u96c6: \u274c \u89e6\u3089\u306a\u3044 \u91cd\u8981\u5ea6: \u2605\u2605\u2605\u2606\u2606</p> <pre><code>variable \"starter_locations\" {\n  type = list(string)\n  description = &lt;&lt;DESCRIPTION\nThe locations to use for the starter module.\nThe first location in the list is used as the primary location.\nDESCRIPTION\n}\n\nvariable \"custom_replacements\" {\n  type = object({\n    names                      = map(string)\n    resource_group_identifiers = map(string)\n    resource_identifiers       = map(string)\n  })\n  description = \"Custom replacements for the configuration.\"\n}\n</code></pre>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#liststring","title":"list(string)\u578b","text":"<p><pre><code>starter_locations = [\"japaneast\", \"japanwest\"]\n</code></pre> \u6587\u5b57\u5217\u306e\u30ea\u30b9\u30c8\u3002\u4f55\u500b\u3067\u3082OK\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#object","title":"object\u578b","text":"<p><pre><code>custom_replacements = {\n  names = {\n    firewall_name = \"fw-hub\"\n  }\n  resource_group_identifiers = {\n    # ...\n  }\n}\n</code></pre> \u69cb\u9020\u5316\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3002JavaScript\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u307f\u305f\u3044\u306a\u3082\u306e\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#variablesconnectivitytf","title":"variables.connectivity.tf\uff08\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5909\u6570\uff09","text":"<p>\u5f79\u5272: \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u9023\u306e\u5909\u6570\u5b9a\u7fa9 \u7de8\u96c6: \u274c \u89e6\u3089\u306a\u3044 \u91cd\u8981\u5ea6: \u2605\u2605\u2606\u2606\u2606</p> <pre><code>variable \"hub_and_spoke_vnet_settings\" {\n  type = object({\n    enabled = bool\n    primary = object({\n      # ... \u8907\u96d1\u306a\u69cb\u9020 ...\n    })\n    secondary = object({\n      # ... \u8907\u96d1\u306a\u69cb\u9020 ...\n    })\n  })\n  description = \"Hub and spoke network settings\"\n  default     = null\n}\n</code></pre> <p>\u306a\u305c\u30d5\u30a1\u30a4\u30eb\u3092\u5206\u3051\u3066\u308b\uff1f - 1\u30d5\u30a1\u30a4\u30eb\u3060\u3068\u9577\u3059\u304e\u308b\uff081000\u884c\u8d85\u3048\u308b\uff09 - \u5f79\u5272\u3054\u3068\u306b\u5206\u3051\u305f\u65b9\u304c\u898b\u3084\u3059\u3044 - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u62c5\u5f53\u8005\u306f<code>variables.connectivity.tf</code>\u3060\u3051\u898b\u308c\u3070\u3044\u3044</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#variablesmovedtf","title":"variables.moved.tf\uff08\u5f8c\u65b9\u4e92\u63db\u7528\uff09","text":"<p>\u5f79\u5272: \u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u306e\u4e92\u63db\u6027\u7dad\u6301 \u7de8\u96c6: \u274c \u7d76\u5bfe\u89e6\u3089\u306a\u3044 \u91cd\u8981\u5ea6: \u2605\u2606\u2606\u2606\u2606</p> <pre><code>moved {\n  from = var.old_variable_name\n  to   = var.new_variable_name\n}\n</code></pre> <p>\u5909\u6570\u540d\u304c\u5909\u308f\u3063\u305f\u3068\u304d\u3001\u53e4\u3044\u540d\u524d\u3067\u3082\u52d5\u304f\u3088\u3046\u306b\u3059\u308b\u304a\u307e\u3058\u306a\u3044\u3002 \u666e\u901a\u306f\u6c17\u306b\u3057\u306a\u304f\u3066\u3044\u3044\u3067\u3059\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#part-3","title":"Part 3: \u30ed\u30fc\u30ab\u30eb\u5909\u6570\u30d5\u30a1\u30a4\u30eb","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#localstf","title":"locals.tf","text":"<p>\u5f79\u5272: \u5909\u6570\u3092\u52a0\u5de5\u3057\u305f\u5024\u3092\u5b9a\u7fa9 \u7de8\u96c6: \u25b3 \u305f\u307e\u306b\u89e6\u308b \u91cd\u8981\u5ea6: \u2605\u2605\u2605\u2606\u2606</p> <pre><code>locals {\n  # \u8a2d\u5b9a\u30e2\u30b8\u30e5\u30fc\u30eb\u304b\u3089\u306e\u51fa\u529b\u3092\u53d6\u5f97\n  config_template_output = module.config[0].configuration_update_results\n\n  # Hub-Spoke\u8a2d\u5b9a\uff08\u30d7\u30e9\u30a4\u30de\u30ea\uff09\n  hub_and_spoke_vnet_primary_settings = {\n    enabled   = var.hub_and_spoke_vnet_settings.enabled\n    location  = local.config_template_output.starter_locations[0]\n    # ...\n  }\n}\n</code></pre> <p>\u5909\u6570\u3068\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u306e\u9055\u3044</p> \u9805\u76ee \u5909\u6570\uff08variable\uff09 \u30ed\u30fc\u30ab\u30eb\u5909\u6570\uff08local\uff09 \u5b9a\u7fa9 <code>variable \"x\"</code> <code>locals { x = }</code> \u5024\u306e\u8a2d\u5b9a <code>.tfvars</code>\u30d5\u30a1\u30a4\u30eb\u3067 Terraform\u5185\u3067\u8a08\u7b97 \u7528\u9014 \u5916\u90e8\u304b\u3089\u8a2d\u5b9a \u5185\u90e8\u3067\u8a08\u7b97 \u4f8b \u30ea\u30fc\u30b8\u30e7\u30f3\u540d \"japaneast-rg\" <p>\u306a\u305clocals\u3092\u4f7f\u3046\uff1f</p> <p>\u3053\u3046\u3044\u3046\u30b3\u30fc\u30c9\u304c\u3042\u3063\u305f\u3068\u3057\u307e\u3059\uff1a <pre><code>resource \"azurerm_resource_group\" \"primary\" {\n  name     = \"${var.prefix}-rg-${var.location}\"\n  location = var.location\n}\n\nresource \"azurerm_virtual_network\" \"primary\" {\n  name                = \"${var.prefix}-vnet-${var.location}\"\n  resource_group_name = \"${var.prefix}-rg-${var.location}\"  # \u540c\u3058\u8a08\u7b97\u30922\u56de\n  location            = var.location\n}\n</code></pre></p> <p>\u540c\u3058\u8a08\u7b97\u3092\u4f55\u5ea6\u3082\u3057\u3066\u308b\u3002locals\u3092\u4f7f\u3046\u3068\uff1a</p> <pre><code>locals {\n  rg_name = \"${var.prefix}-rg-${var.location}\"\n}\n\nresource \"azurerm_resource_group\" \"primary\" {\n  name     = local.rg_name\n  location = var.location\n}\n\nresource \"azurerm_virtual_network\" \"primary\" {\n  name                = \"${var.prefix}-vnet-${var.location}\"\n  resource_group_name = local.rg_name  # \u518d\u5229\u7528\n  location            = var.location\n}\n</code></pre> <p>DRY\u539f\u5247\uff08Don't Repeat Yourself\uff09\u3067\u3059\u306d\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#part-4","title":"Part 4: \u30e1\u30a4\u30f3\u51e6\u7406\u30d5\u30a1\u30a4\u30eb\u305f\u3061","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_4","title":"\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u547d\u540d\u898f\u5247","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30a4\u30f3\u30d5\u30a1\u30a4\u30eb\u306f<code>main.*.tf</code>\u3068\u3044\u3046\u540d\u524d\u3067\u3059\u3002</p> <ul> <li><code>main.config.tf</code> \u2192 \u8a2d\u5b9a\u51e6\u7406</li> <li><code>main.resource.groups.tf</code> \u2192 \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7</li> <li><code>main.management.tf</code> \u2192 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7</li> <li><code>main.connectivity.hub.and.spoke.virtual.network.tf</code> \u2192 Hub-Spoke</li> <li><code>main.connectivity.virtual.wan.tf</code> \u2192 Virtual WAN</li> </ul> <p>\u306a\u305c\u5206\u3051\u3066\u308b\uff1f - 1\u30d5\u30a1\u30a4\u30eb\u3060\u3068\u5de8\u5927\u3059\u304e\u308b - \u5f79\u5272\u3054\u3068\u306b\u5206\u3051\u308b\u3068\u898b\u3084\u3059\u3044 - \u4e26\u884c\u4f5c\u696d\u3057\u3084\u3059\u3044\uff08\u5225\u306e\u4eba\u304c\u5225\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\uff09</p> <p>Terraform\u306e\u8aad\u307f\u8fbc\u307f\u9806 \u5b9f\u306f\u9806\u756a\u306f\u95a2\u4fc2\u306a\u3044\uff01 Terraform\u304c\u4f9d\u5b58\u95a2\u4fc2\u3092\u89e3\u6790\u3057\u3066\u3001\u81ea\u52d5\u3067\u9806\u5e8f\u3092\u6c7a\u3081\u3066\u304f\u308c\u307e\u3059\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#mainconfigtf","title":"main.config.tf","text":"<p>\u5f79\u5272: \u8a2d\u5b9a\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406 \u91cd\u8981\u5ea6: \u2605\u2605\u2605\u2605\u2606</p> <pre><code>module \"config\" {\n  count  = var.bootstrap_settings.enabled ? 1 : 0\n  source = \"./modules/config-templating\"\n\n  starter_locations = var.starter_locations\n  root_parent_id    = var.management_group_settings.parent_resource_id\n\n  configuration_file_path = \"${path.root}/platform-landing-zone.auto.tfvars\"\n  custom_replacements     = var.custom_replacements\n}\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c81: count <pre><code>count = var.bootstrap_settings.enabled ? 1 : 0\n</code></pre> - <code>enabled</code>\u304c<code>true</code>\u306a\u30891\u500b\u4f5c\u308b\uff08module\u4f5c\u308b\uff09 - <code>false</code>\u306a\u30890\u500b\uff08module\u4f5c\u3089\u306a\u3044\uff09</p> <p>\u6761\u4ef6\u5206\u5c90\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3002</p> <p>\u30dd\u30a4\u30f3\u30c82: path.root <pre><code>configuration_file_path = \"${path.root}/platform-landing-zone.auto.tfvars\"\n</code></pre> <code>path.root</code>= \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3002 \u3069\u3053\u304b\u3089\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3057\u3066\u3082\u540c\u3058\u30d1\u30b9\u306b\u306a\u308b\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#mainresourcegroupstf","title":"main.resource.groups.tf","text":"<p>\u5f79\u5272: \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308b \u91cd\u8981\u5ea6: \u2605\u2605\u2605\u2606\u2606</p> <pre><code>module \"resource_groups\" {\n  source = \"Azure/avm-res-resources-resourcegroup/azurerm\"\n  version = \"0.2.1\"\n\n  for_each = local.resource_groups\n\n  name     = each.value.name\n  location = each.value.location\n  tags     = each.value.tags\n\n  enable_telemetry = var.enable_telemetry\n}\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: for_each <pre><code>for_each = local.resource_groups\n</code></pre></p> <p><code>local.resource_groups</code>\u306f\u4f8b\u3048\u3070\u3053\u3093\u306a\u611f\u3058\uff1a <pre><code>{\n  \"primary_connectivity\" = {\n    name     = \"rg-hub-japaneast\"\n    location = \"japaneast\"\n    tags     = {}\n  }\n  \"secondary_connectivity\" = {\n    name     = \"rg-hub-japanwest\"\n    location = \"japanwest\"\n    tags     = {}\n  }\n}\n</code></pre></p> <p><code>for_each</code>\u3067\u30eb\u30fc\u30d7\u3057\u3066\u3001\u8907\u6570\u306eRG\u3092\u4f5c\u308b\u3002</p> <p><code>each.value.name</code>\u3067\u5404\u8981\u7d20\u306b\u30a2\u30af\u30bb\u30b9\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#mainmanagementtf","title":"main.management.tf","text":"<p>\u5f79\u5272: \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u308b \u91cd\u8981\u5ea6: \u2605\u2605\u2605\u2605\u2605</p> <pre><code>module \"management_groups\" {\n  count  = var.management_group_settings.enabled ? 1 : 0\n  source = \"./modules/management_groups\"\n\n  management_group_settings = {\n    architecture_name = local.config_template_output.architecture_name\n    parent_resource_id = local.config_template_output.root_parent_management_group_id\n    # ... \u9577\u3044\u306e\u3067\u7701\u7565 ...\n  }\n}\n</code></pre> <p>\u3053\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3067200\u500b\u4ee5\u4e0a\u306e\u30dd\u30ea\u30b7\u30fc\u304c\u4f5c\u3089\u308c\u307e\u3059\u3002 \u8a73\u3057\u304f\u306f\u5f8c\u306e\u7ae0\u3067\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#mainconnectivityhubandspokevirtualnetworktf","title":"main.connectivity.hub.and.spoke.virtual.network.tf","text":"<p>\u5f79\u5272: Hub-Spoke\u578b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u308b \u91cd\u8981\u5ea6: \u2605\u2605\u2605\u2605\u2606</p> <p>\u540d\u524d\u304c\u9577\u3059\u304e\u308b\u3088\u306d()</p> <pre><code>module \"hub_and_spoke_vnet\" {\n  count   = var.hub_and_spoke_vnet_settings.enabled ? 1 : 0\n  source  = \"Azure/avm-ptn-alz-connectivity-hub-and-spoke-vnet/azurerm\"\n  version = \"0.16.8\"\n\n  primary_settings = local.hub_and_spoke_vnet_primary_settings\n  secondary_settings = local.hub_and_spoke_vnet_secondary_settings\n  # ...\n}\n</code></pre> <p>Firewall, Bastion, VPN Gateway, VNet\u5168\u90e8\u3053\u3053\u3067\u4f5c\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#mainconnectivityvirtualwantf","title":"main.connectivity.virtual.wan.tf","text":"<p>\u5f79\u5272: Virtual WAN\u3092\u4f5c\u308b \u91cd\u8981\u5ea6: \u2605\u2605\u2605\u2606\u2606</p> <p>Hub-Spoke\u306e\u4ee3\u308f\u308a\u306bVirtual WAN\u3092\u4f7f\u3046\u5834\u5408\u3002</p> <pre><code>module \"virtual_wan\" {\n  count   = var.virtual_wan_settings.enabled ? 1 : 0\n  source  = \"Azure/avm-ptn-alz-connectivity-virtual-wan/azurerm\"\n  version = \"0.13.5\"\n\n  # ...\n}\n</code></pre> <p><code>hub_and_spoke_vnet</code>\u304b<code>virtual_wan</code>\u3001\u3069\u3061\u3089\u304b\u4e00\u65b9\u3060\u3051\u304c\u52d5\u304f\u4ed5\u7d44\u307f\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#part-5","title":"Part 5: \u51fa\u529b\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#outputstf","title":"outputs.tf","text":"<p>\u5f79\u5272: \u4f5c\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u60c5\u5831\u3092\u51fa\u529b \u91cd\u8981\u5ea6: \u2605\u2605\u2606\u2606\u2606</p> <pre><code>output \"resource_groups\" {\n  value = module.resource_groups\n  description = \"Created resource groups\"\n}\n\noutput \"hub_virtual_network_id\" {\n  value = try(\n    module.hub_and_spoke_vnet[0].virtual_networks.primary.id,\n    null\n  )\n  description = \"Primary hub virtual network ID\"\n}\n</code></pre> <p>\u306a\u305c\u51fa\u529b\u3059\u308b\uff1f - \u4ed6\u306eTerraform\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4f7f\u3046 - \u30c7\u30d0\u30c3\u30b0\u7528 - \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u751f\u6210\u7528</p> <p>try\u95a2\u6570 <pre><code>try(\n  module.hub_and_spoke_vnet[0].virtual_networks.primary.id,\n  null\n)\n</code></pre></p> <p><code>hub_and_spoke_vnet</code>\u304c\u7121\u52b9\uff08count=0\uff09\u306a\u3089\u3001\u30a8\u30e9\u30fc\u3058\u3083\u306a\u304f\u3066<code>null</code>\u3092\u8fd4\u3059\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#part-6","title":"Part 6: \u30e2\u30b8\u30e5\u30fc\u30eb\u30d5\u30a9\u30eb\u30c0","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#modulesconfig-templating","title":"modules/config-templating/","text":"<p>\u5f79\u5272: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406</p> <pre><code>modules/config-templating/\n\u251c\u2500\u2500 data.tf          \u2190 \u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u5b9a\u7fa9\n\u251c\u2500\u2500 locals.config.tf \u2190 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u7f6e\u63db\u30ed\u30b8\u30c3\u30af\n\u251c\u2500\u2500 outputs.tf       \u2190 \u51e6\u7406\u7d50\u679c\u3092\u51fa\u529b\n\u251c\u2500\u2500 terraform.tf     \u2190 \u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u8a2d\u5b9a\n\u2514\u2500\u2500 variables.tf     \u2190 \u5165\u529b\u5909\u6570\n</code></pre> <p><code>$${starter_location_01}</code>\u3092<code>japaneast</code>\u306b\u5909\u63db\u3059\u308b\u30a8\u30f3\u30b8\u30f3\u3002</p> <p>\u8a73\u3057\u304f\u306f06_\u8a2d\u5b9a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8.md\u3067\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#modulesmanagement_groups","title":"modules/management_groups/","text":"<p>\u5f79\u5272: \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u308b</p> <pre><code>modules/management_groups/\n\u251c\u2500\u2500 locals.tf     \u2190 \u30ed\u30fc\u30ab\u30eb\u5909\u6570\n\u251c\u2500\u2500 main.tf       \u2190 \u30e1\u30a4\u30f3\u51e6\u7406\n\u251c\u2500\u2500 terraform.tf  \u2190 \u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u8a2d\u5b9a\n\u2514\u2500\u2500 variables.tf  \u2190 \u5165\u529b\u5909\u6570\n</code></pre> <p>\u5b9f\u969b\u306f<code>main.tf</code>\u304c<code>Azure/avm-ptn-alz/azurerm</code>\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u547c\u3093\u3067\u308b\u3060\u3051\u3002 \u30e9\u30c3\u30d1\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u3002(\u30e9\u30c3\u30d1\u30fc\u306f\u56f2\u3046\u3084\u3064\u307f\u305f\u3044\u306a\u611f\u3058\u304b\u306a\u3002\u30b5\u30e9\u30f3\u30e9\u30c3\u30d7\u304c\u30a4\u30e1\u30fc\u30b8\u3057\u3084\u3059\u3044)</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#modulesmanagement_resources","title":"modules/management_resources/","text":"<p>\u5f79\u5272: Log Analytics\u3068Automation Account\u3092\u4f5c\u308b</p> <pre><code>modules/management_resources/\n\u251c\u2500\u2500 main.tf       \u2190 \u30e1\u30a4\u30f3\u51e6\u7406\n\u251c\u2500\u2500 outputs.tf    \u2190 \u51fa\u529b\n\u251c\u2500\u2500 terraform.tf  \u2190 \u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u8a2d\u5b9a\n\u2514\u2500\u2500 variables.tf  \u2190 \u5165\u529b\u5909\u6570\n</code></pre> <p>\u3053\u308c\u3082<code>Azure/avm-ptn-alz-management/azurerm</code>\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30e9\u30c3\u30d1\u30fc\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#part-7","title":"Part 7: \u30e9\u30a4\u30d6\u30e9\u30ea\u30d5\u30a9\u30eb\u30c0","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#lib","title":"lib/","text":"<p>\u5f79\u5272: \u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\u3092YAML\u3067\u7ba1\u7406</p> <pre><code>lib/\n\u251c\u2500\u2500 alz_library_metadata.json        \u2190 \u30e1\u30bf\u30c7\u30fc\u30bf\n\u251c\u2500\u2500 archetype_definitions/           \u2190 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u7a2e\u985e\n\u2502   \u251c\u2500\u2500 connectivity_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 corp_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 landing_zones_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 management_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 online_custom.alz_archetype_override.yaml\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 architecture_definitions/        \u2190 \u5168\u4f53\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\n    \u2514\u2500\u2500 alz_custom.alz_architecture_definition.yaml\n</code></pre> <p>Archetype\uff08\u30a2\u30fc\u30ad\u30bf\u30a4\u30d7\uff09\u3068\u306f\uff1f \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u300c\u7a2e\u985e\u300d\u3002</p> <ul> <li><code>connectivity</code>: \u63a5\u7d9a\u7528\uff08Firewall\u7b49\uff09</li> <li><code>management</code>: \u7ba1\u7406\u7528\uff08Log Analytics\u7b49\uff09</li> <li><code>corp</code>: \u4f01\u696d\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a5\u7d9a\u3042\u308a</li> <li><code>online</code>: \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u306e\u307f</li> <li><code>landing_zones</code>: \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528</li> </ul> <p>\u5404\u30a2\u30fc\u30ad\u30bf\u30a4\u30d7\u306b\u9069\u7528\u3059\u308b\u30dd\u30ea\u30b7\u30fc\u304cYAML\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002</p> <p>\u4f8b: <code>corp_custom.alz_archetype_override.yaml</code> <pre><code>archetypes:\n  corp:\n    policy_assignments:\n      - Deny-Public-IP\n      - Deny-RDP-From-Internet\n      - Enforce-TLS\n    # ...\n</code></pre></p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#part-8-cicd","title":"Part 8: CI/CD\u30d5\u30a9\u30eb\u30c0","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#githubworkflowscdyaml","title":".github/workflows/cd.yaml","text":"<p>\u5f79\u5272: GitHub Actions\u306e\u8a2d\u5b9a</p> <pre><code>name: 02 Azure Landing Zones Continuous Delivery\n\non:\n  workflow_dispatch:\n    inputs:\n      terraform_action:\n        description: 'Terraform action'\n        required: true\n        type: choice\n        options:\n          - apply\n          - destroy\n\njobs:\n  cd:\n    uses: shuhei0720org01/alz-mgmt-templates/.github/workflows/cd-template.yaml@main\n    with:\n      terraform_action: ${{ inputs.terraform_action }}\n    secrets: inherit\n</code></pre> <p>workflow_dispatch: \u624b\u52d5\u5b9f\u884c inputs: \u30e6\u30fc\u30b6\u30fc\u304c\u9078\u3076\uff08apply\u304bdestroy\u304b\uff09 uses: \u5225\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3092\u4f7f\u3046</p> <p>\u5b9f\u969b\u306e\u51e6\u7406\u306f<code>alz-mgmt-templates</code>\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_5","title":"\u307e\u3068\u3081","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_6","title":"\u30d5\u30a1\u30a4\u30eb\u306e\u5f79\u5272\u5206\u62c5","text":"\u30d5\u30a1\u30a4\u30eb \u5f79\u5272 \u7de8\u96c6 <code>platform-landing-zone.auto.tfvars</code> \u30e1\u30a4\u30f3\u8a2d\u5b9a \u2705 <code>terraform.tfvars.json</code> \u79d8\u5bc6\u60c5\u5831 \u2705\u521d\u56de\u306e\u307f <code>terraform.tf</code> Terraform\u8a2d\u5b9a \u274c <code>variables.*.tf</code> \u5909\u6570\u5b9a\u7fa9 \u274c <code>locals.tf</code> \u30ed\u30fc\u30ab\u30eb\u5909\u6570 \u25b3 <code>main.*.tf</code> \u30e1\u30a4\u30f3\u51e6\u7406 \u274c <code>outputs.tf</code> \u51fa\u529b\u5b9a\u7fa9 \u274c <code>modules/</code> \u30e2\u30b8\u30e5\u30fc\u30eb \u25b3 <code>lib/</code> \u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9 \u25b3 <code>.github/</code> CI/CD \u274c"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_7","title":"\u30c7\u30fc\u30bf\u306e\u6d41\u308c\uff08\u518d\u63b2\uff09","text":"<pre><code>.tfvars\uff08\u8a2d\u5b9a\uff09\n  \u2193\nvariables.tf\uff08\u5909\u6570\u5b9a\u7fa9\uff09\n  \u2193\nmodules/config-templating\uff08\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\uff09\n  \u2193\nlocals.tf\uff08\u30ed\u30fc\u30ab\u30eb\u5909\u6570\uff09\n  \u2193\nmain.*.tf\uff08\u30e1\u30a4\u30f3\u51e6\u7406\uff09\n  \u2193\nmodules/\uff08\u5404\u30e2\u30b8\u30e5\u30fc\u30eb\u5b9f\u884c\uff09\n  \u2193\nAzure\uff08\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\uff09\n  \u2193\noutputs.tf\uff08\u7d50\u679c\u51fa\u529b\uff09\n</code></pre>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_8","title":"\u91cd\u8981\u5ea6\u30e9\u30f3\u30ad\u30f3\u30b0","text":"<p>\u7406\u89e3\u3059\u3079\u304d\u512a\u5148\u5ea6\uff1a</p> <ol> <li>\u2605\u2605\u2605\u2605\u2605 <code>platform-landing-zone.auto.tfvars</code></li> <li>\u2605\u2605\u2605\u2605\u2606 <code>main.management.tf</code>, <code>main.connectivity.hub.and.spoke.virtual.network.tf</code></li> <li>\u2605\u2605\u2605\u2606\u2606 <code>locals.tf</code>, <code>main.config.tf</code></li> <li>\u2605\u2605\u2606\u2606\u2606 <code>variables.tf</code>, <code>outputs.tf</code></li> <li>\u2605\u2606\u2606\u2606\u2606 \u305d\u306e\u4ed6</li> </ol>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_9","title":"\u7df4\u7fd2\u554f\u984c","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#1","title":"\u554f\u984c1","text":"<p><code>.auto.tfvars</code>\u30d5\u30a1\u30a4\u30eb\u3068\u666e\u901a\u306e<code>.tfvars</code>\u30d5\u30a1\u30a4\u30eb\u306e\u9055\u3044\u306f\u4f55\u3067\u3059\u304b\uff1f</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#2","title":"\u554f\u984c2","text":"<p><code>locals.tf</code>\u3068<code>variables.tf</code>\u306e\u4f7f\u3044\u5206\u3051\u3092\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#3","title":"\u554f\u984c3","text":"<p><code>main.*.tf</code>\u30d5\u30a1\u30a4\u30eb\u304c\u8907\u6570\u306b\u5206\u304b\u308c\u3066\u3044\u308b\u7406\u7531\u30922\u3064\u6319\u3052\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#4","title":"\u554f\u984c4","text":"<p><code>for_each</code>\u3068<code>count</code>\u306e\u9055\u3044\u306f\u4f55\u3067\u3059\u304b\uff1f</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_10","title":"\u7df4\u7fd2\u554f\u984c\u306e\u7b54\u3048","text":""},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#1_1","title":"\u7b54\u30481","text":"<p><code>.auto.tfvars</code>\u30d5\u30a1\u30a4\u30eb\u306f\u3001Terraform\u304c\u81ea\u52d5\u7684\u306b\u8aad\u307f\u8fbc\u3080\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\u666e\u901a\u306e<code>.tfvars</code>\u30d5\u30a1\u30a4\u30eb\u306f<code>-var-file</code>\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u660e\u793a\u7684\u306b\u6307\u5b9a\u3057\u306a\u3044\u3068\u8aad\u307f\u8fbc\u307e\u308c\u307e\u305b\u3093\u3002<code>.auto.tfvars</code>\u3092\u4f7f\u3046\u3068\u3001<code>terraform apply</code>\u3060\u3051\u3067\u81ea\u52d5\u7684\u306b\u8a2d\u5b9a\u304c\u9069\u7528\u3055\u308c\u308b\u306e\u3067\u4fbf\u5229\u3067\u3059\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#2_1","title":"\u7b54\u30482","text":"<p>**variables.tf**\u306f\u5916\u90e8\u304b\u3089\u6e21\u3055\u308c\u308b\u5909\u6570\u3092\u5b9a\u7fa9\u3057\u307e\u3059\uff08\u5165\u529b\u30d1\u30e9\u30e1\u30fc\u30bf\uff09\u3002**locals.tf**\u306f\u5185\u90e8\u3067\u8a08\u7b97\u3055\u308c\u308b\u5909\u6570\u3092\u5b9a\u7fa9\u3057\u307e\u3059\uff08\u8a08\u7b97\u7d50\u679c\uff09\u3002</p> <p>\u4f8b\uff1a - <code>variables.tf</code>: <code>var.location</code>\uff08\u30e6\u30fc\u30b6\u30fc\u304c\u6307\u5b9a\uff09 - <code>locals.tf</code>: <code>local.location_short</code>\uff08location\u304b\u3089\u81ea\u52d5\u8a08\u7b97\uff09</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#3_1","title":"\u7b54\u30483","text":"<p><code>main.*.tf</code>\u30d5\u30a1\u30a4\u30eb\u304c\u5206\u304b\u308c\u3066\u3044\u308b\u7406\u7531\uff1a</p> <ol> <li>\u5f79\u5272\u306e\u660e\u78ba\u5316: \u30d5\u30a1\u30a4\u30eb\u540d\u3092\u898b\u305f\u3060\u3051\u3067\u4f55\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u5206\u304b\u308b\uff08<code>main.connectivity.*.tf</code>\u306a\u3089\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u9023\uff09</li> <li>\u4fdd\u5b88\u6027\u306e\u5411\u4e0a: \u5909\u66f4\u3057\u305f\u3044\u6a5f\u80fd\u306e\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u3092\u958b\u3051\u3070\u3088\u304f\u3001\u6570\u5343\u884c\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u63a2\u3057\u56de\u308b\u5fc5\u8981\u304c\u306a\u3044</li> </ol>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#4_1","title":"\u7b54\u30484","text":"<p>**count**\u306f\u6570\u5024\u3067\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u308a\u307e\u3059\uff08<code>count = 3</code>\u306a\u30893\u500b\uff09\u3002\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306f<code>count.index</code>\u30670,1,2...</p> <p>**for_each**\u306f\u30de\u30c3\u30d7\u3084\u30bb\u30c3\u30c8\u3067\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\u5404\u8981\u7d20\u306b\u540d\u524d\u304c\u3042\u308a\u3001<code>each.key</code>\u3084<code>each.value</code>\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002</p> <p>\u4f8b\uff1a <pre><code># count: \u30ea\u30bd\u30fc\u30b9\u540d\u304c resource[0], resource[1]...\ncount = 2\n\n# for_each: \u30ea\u30bd\u30fc\u30b9\u540d\u304c resource[\"app1\"], resource[\"app2\"]...\nfor_each = toset([\"app1\", \"app2\"])\n</code></pre></p> <p>**for_each**\u306e\u307b\u3046\u304c\u3001\u30ea\u30bd\u30fc\u30b9\u306e\u8ffd\u52a0\u30fb\u524a\u9664\u6642\u306b\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u306b\u5f71\u97ff\u3057\u306a\u3044\u305f\u3081\u63a8\u5968\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/#_11","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":"<p>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020\u306f\u7406\u89e3\u3067\u304d\u307e\u3057\u305f\u304b\uff1f</p> <p>\u6b21\u306f03_\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5b8c\u5168\u89e3\u8aac.md\u3067\u3001 <code>platform-landing-zone.auto.tfvars</code>\u30921\u884c\u305a\u3064\u89e3\u8aad\u3057\u3066\u3044\u304d\u307e\u3059\u3002</p> <p>\u3053\u308c\u304c\u4e00\u756a\u91cd\u8981\u306a\u7ae0\u3067\u3059\u3002\u3058\u3063\u304f\u308a\u8aad\u3093\u3067\u304f\u3060\u3055\u3044\u3002</p> <p>\u6240\u8981\u6642\u9593: 40\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2606\u2606 \u524d: 01_\u57fa\u790e\u77e5\u8b58.md \u6b21: 03_\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5b8c\u5168\u89e3\u8aac.md</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/","title":"03. \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5b8c\u5168\u89e3\u8aac - platform-landing-zone.auto.tfvars","text":""},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#8","title":"8\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3068\u306e\u5bfe\u5fdc","text":"<p>\u3053\u306eChapter\u306f\u4ee5\u4e0b\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a - \u2705 1. Azure Billing and Active Directory Tenant\uff08\u8ab2\u91d1\u3068\u30c6\u30ca\u30f3\u30c8 - \u30ea\u30fc\u30b8\u30e7\u30f3\u8a2d\u5b9a\uff09 - \u2705 3. Resource Organization\uff08\u30ea\u30bd\u30fc\u30b9\u6574\u7406 - \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u69cb\u6210\uff09 - \u2705 4. Network Topology and Connectivity\uff08\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210 - Hub-and-Spoke/Virtual WAN\u8a2d\u5b9a\uff09 - \u2705 6. Management and Monitoring\uff08\u7ba1\u7406\u3068\u76e3\u8996 - Log Analytics\u8a2d\u5b9a\uff09</p> <p>\u2192 Chapter 01\u3067\u5b66\u3093\u30608\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5fa9\u7fd2\u3057\u305f\u3044\u65b9\u306f01_\u57fa\u790e\u77e5\u8b58.md\u3078</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4e00\u756a\u91cd\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3001<code>platform-landing-zone.auto.tfvars</code>\u30921\u884c\u305a\u3064\u89e3\u8aac\u3057\u3066\u3044\u304d\u307e\u3059\u3002</p> <p>\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u7d04500\u884c\u3042\u308a\u307e\u3059\u304c\u3001\u6016\u304c\u3089\u306a\u304f\u3066\u5927\u4e08\u592b\u3067\u3059\u3002 \u5b9f\u306f\u540c\u3058\u30d1\u30bf\u30fc\u30f3\u306e\u7e70\u308a\u8fd4\u3057\u304c\u591a\u3044\u306e\u3067\u3001\u30d1\u30bf\u30fc\u30f3\u3055\u3048\u899a\u3048\u308c\u3070\u8aad\u3081\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u3053\u306eChapter\u3092\u8aad\u307f\u7d42\u308f\u3063\u305f\u3089\u3001 \u300c\u3053\u3053\u3092\u5909\u3048\u308c\u3070Firewall\u6709\u52b9\u306b\u306a\u308b\u3093\u3060\u300d \u300c\u3053\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u8a2d\u5b9a\u3092\u5909\u3048\u308c\u3070\u3044\u3044\u306e\u304b\u300d \u3068\u3044\u3046\u306e\u304c\u308f\u304b\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#chapter_1","title":"\u3053\u306eChapter\u3092\u8aad\u3080\u524d\u306b\u77e5\u3063\u3066\u304a\u304f\u3079\u304d\u3053\u3068","text":""},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#_1","title":"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5909\u6570\u306b\u3064\u3044\u3066","text":"<p>\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u306f \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5909\u6570 \u3092\u591a\u7528\u3057\u3066\u3044\u307e\u3059\uff1a</p> <pre><code>management_resource_group_name = \"rg-management-$${starter_location_01}\"\n</code></pre> <p>\u4f55\u304c\u8d77\u304d\u308b\u304b: - <code>$${starter_location_01}</code> \u2192 <code>japaneast</code> \u306b\u81ea\u52d5\u7f6e\u63db\u3055\u308c\u308b - \u5b9f\u969b\u306e\u540d\u524d: <code>\"rg-management-japaneast\"</code></p> <p>Terraform\u306e\u5909\u6570\uff08<code>${}</code>\uff09\u3068\u306e\u9055\u3044: | \u8a18\u6cd5 | \u51e6\u7406\u30bf\u30a4\u30df\u30f3\u30b0 | \u7528\u9014 | |------|--------------|------| | <code>${}</code> | Terraform\u5b9f\u884c\u6642\uff08\u5373\u5ea7\uff09 | Terraform\u5909\u6570\u306e\u53c2\u7167 | | <code>$${}</code>  | \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\u6642\uff08\u5f8c\u3067\uff09 | \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5185\u306e\u7f6e\u63db |</p> <p>\u3088\u304f\u4f7f\u308f\u308c\u308b\u7f6e\u63db\u5909\u6570: - <code>$${starter_location_01}</code> \u2192 \u6700\u521d\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\uff08\u4f8b: <code>japaneast</code>\uff09 - <code>$${starter_location_02}</code> \u2192 2\u756a\u76ee\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\uff08\u4f8b: <code>japanwest</code>\uff09 - <code>$${starter_location_01_short}</code> \u2192 \u77ed\u7e2e\u540d\uff08\u4f8b: <code>jp</code>\uff09</p> <p>\u8a73\u7d30\u306f Chapter 06: \u8a2d\u5b9a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 \u3067\u89e3\u8aac\u3057\u307e\u3059\u3002 \u307e\u305a\u306f\u300c\u81ea\u52d5\u3067\u7f6e\u304d\u63db\u308f\u308b\u300d\u3068\u7406\u89e3\u3059\u308c\u3070OK\u3067\u3059\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#_2","title":"\u30d5\u30a1\u30a4\u30eb\u306e\u5168\u4f53\u69cb\u9020","text":"<p>\u307e\u305a\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u3069\u3093\u306a\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u898b\u3066\u307f\u307e\u3057\u3087\u3046\uff1a</p> <pre><code># 1. \u30b3\u30e1\u30f3\u30c8\uff08\u8aac\u660e\u66f8\u304d\uff09\n/*\n--- Built-in Replacements ---\n...\n*/\n\n# 2. \u30ea\u30fc\u30b8\u30e7\u30f3\u8a2d\u5b9a\uff08\u3069\u3053\u306b\u4f5c\u308b\u304b\uff09\nstarter_locations = [\"japaneast\", \"japanwest\"]\n\n# 3. \u30ab\u30b9\u30bf\u30e0\u7f6e\u63db\u8a2d\u5b9a\uff08\u540d\u524d\u3068\u304b\u8a2d\u5b9a\u5024\uff09\ncustom_replacements = {\n  names = { ... }                    # \u540d\u524d\u3068\u304b\u6709\u52b9/\u7121\u52b9\u306e\u8a2d\u5b9a\n  resource_group_identifiers = { ... }  # \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306eID\n  resource_identifiers = { ... }        # \u30ea\u30bd\u30fc\u30b9\u306eID\n}\n\n# 4. \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u8a2d\u5b9a\uff08\u7bb1\u306e\u8a2d\u5b9a\uff09\nmanagement_resource_groups = { ... }\nconnectivity_resource_groups = { ... }\n\n# 5. \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u8a2d\u5b9a\uff08\u30ed\u30b0\u3068\u304b\u76e3\u8996\uff09\nmanagement_resource_settings = { ... }\n\n# 6. \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\uff08Hub-and-Spoke\uff09\nhub_and_spoke_vnet_settings = { ... }\n</code></pre> <p>\u610f\u5916\u3068\u30b7\u30f3\u30d7\u30eb\u3067\u3059\u3088\u306d\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#part-1","title":"Part 1: \u30ea\u30fc\u30b8\u30e7\u30f3\u8a2d\u5b9a","text":""},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#starter_locations","title":"starter_locations","text":"<pre><code>starter_locations = [\"japaneast\", \"japanwest\"]\n</code></pre> <p>\u3053\u308c\u306f\u4f55\u3067\u3057\u3087\u3046\u304b\uff1f - \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4f7f\u3046Azure\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u30ea\u30b9\u30c8\u3067\u3059 - \u6700\u521d\u306e\u9805\u76ee\uff08<code>japaneast</code>\uff09\u304c\u30d7\u30e9\u30a4\u30de\u30ea\uff08\u30e1\u30a4\u30f3\uff09 - 2\u756a\u76ee\u306e\u9805\u76ee\uff08<code>japanwest</code>\uff09\u304c\u30bb\u30ab\u30f3\u30c0\u30ea\uff08\u30b5\u30d6\uff09</p> <p>\u3069\u3046\u4f7f\u308f\u308c\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f \u5f8c\u3067\u51fa\u3066\u304f\u308b\u8a2d\u5b9a\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u81ea\u52d5\u7f6e\u63db\u3055\u308c\u307e\u3059\uff1a</p> <pre><code># \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5185\u3067\nresource_group_name = \"rg-hub-$${starter_location_01}\"\n\n# \u5b9f\u969b\u306b\u306f\nresource_group_name = \"rg-hub-japaneast\"  # \u2190\u81ea\u52d5\u3067\u7f6e\u304d\u63db\u308f\u308b\n</code></pre> <p>\u5909\u3048\u305f\u3044\u6642\u306f\uff1f <pre><code># \u6771\u4eac\u3060\u3051\u306b\u3057\u305f\u3044\nstarter_locations = [\"japaneast\"]\n\n# \u30a2\u30e1\u30ea\u30ab\u306b\u3057\u305f\u3044\nstarter_locations = [\"eastus\", \"westus\"]\n\n# 3\u30ea\u30fc\u30b8\u30e7\u30f3\u4f7f\u3044\u305f\u3044\nstarter_locations = [\"japaneast\", \"japanwest\", \"eastasia\"]\n</code></pre></p> <p>\u7c21\u5358\u3067\u3059\u3088\u306d\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#part-2-names","title":"Part 2: \u30ab\u30b9\u30bf\u30e0\u7f6e\u63db - names \u30bb\u30af\u30b7\u30e7\u30f3","text":"<p>\u3053\u3053\u304b\u3089\u304c\u672c\u756a\u3067\u3059\u3002<code>custom_replacements</code>\u306e\u4e2d\u8eab\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2-1-defender","title":"2-1. Defender\u306e\u30e1\u30fc\u30eb\u8a2d\u5b9a","text":"<pre><code>custom_replacements = {\n  names = {\n    defender_email_security_contact = \"shuhei_0720@icloud.com\"\n</code></pre> <p>\u3053\u308c\u306f\u4f55\u3067\u3057\u3087\u3046\u304b\uff1f - Microsoft Defender for Cloud\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u76e3\u8996\u30b5\u30fc\u30d3\u30b9\uff09\u304c\u8105\u5a01\u3092\u691c\u51fa\u3057\u305f\u3089\u3001\u3053\u3053\u306b\u901a\u77e5\u304c\u98db\u3093\u3067\u304d\u307e\u3059 - \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a2\u30e9\u30fc\u30c8\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3067\u3059</p> <p>\u5909\u66f4\u3059\u308b\u5834\u5408\uff1a <pre><code>defender_email_security_contact = \"security-team@yourcompany.com\"\n</code></pre></p> <p>\u81ea\u5206\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306b\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2-2","title":"2-2. \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u540d","text":"<pre><code>    # Resource group names\n    management_resource_group_name                 = \"rg-management-$${starter_location_01}\"\n    connectivity_hub_primary_resource_group_name   = \"rg-hub-$${starter_location_01}\"\n    connectivity_hub_secondary_resource_group_name = \"rg-hub-$${starter_location_02}\"\n    dns_resource_group_name                        = \"rg-hub-dns-$${starter_location_01}\"\n    ddos_resource_group_name                       = \"rg-hub-ddos-$${starter_location_01}\"\n    asc_export_resource_group_name                 = \"rg-asc-export-$${starter_location_01}\"\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f Azure\u306e\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\uff08\u30ea\u30bd\u30fc\u30b9\u3092\u5165\u308c\u308b\u7bb1\uff09\u306e\u540d\u524d\u3092\u6c7a\u3081\u3066\u308b\u3002</p> <p>\u5b9f\u969b\u306e\u540d\u524d\u306f\uff1f <code>$${starter_location_01}</code>\u304c<code>japaneast</code>\u306b\u7f6e\u304d\u63db\u308f\u308b\u304b\u3089\uff1a</p> \u5909\u6570\u540d \u5b9f\u969b\u306e\u540d\u524d \u4f55\u3092\u5165\u308c\u308b\u7bb1\uff1f <code>management_resource_group_name</code> <code>rg-management-japaneast</code> Log Analytics\u3068\u304b\u7ba1\u7406\u7cfb <code>connectivity_hub_primary_resource_group_name</code> <code>rg-hub-japaneast</code> \u30d7\u30e9\u30a4\u30de\u30eaHub\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af <code>connectivity_hub_secondary_resource_group_name</code> <code>rg-hub-japanwest</code> \u30bb\u30ab\u30f3\u30c0\u30eaHub\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af <code>dns_resource_group_name</code> <code>rg-hub-dns-japaneast</code> Private DNS Zones <code>ddos_resource_group_name</code> <code>rg-hub-ddos-japaneast</code> DDoS Protection <code>asc_export_resource_group_name</code> <code>rg-asc-export-japaneast</code> Defender \u30c7\u30fc\u30bf\u30a8\u30af\u30b9\u30dd\u30fc\u30c8 <p>\u547d\u540d\u898f\u5247 <code>rg-{\u7528\u9014}-{\u30ea\u30fc\u30b8\u30e7\u30f3}</code>\u3063\u3066\u611f\u3058\u3067\u7d71\u4e00\u3055\u308c\u3066\u308b\u3067\u3057\u3087\uff1f \u3053\u308c\u304cAzure\u306e\u63a8\u5968\u547d\u540d\u898f\u5247\u3002</p> <p>\u5909\u3048\u305f\u3044\u6642\u306f\uff1f <pre><code># \u4f1a\u793e\u306e\u30eb\u30fc\u30eb\u306b\u5408\u308f\u305b\u305f\u3044\nmanagement_resource_group_name = \"rg-prod-mgmt-$${starter_location_01}\"\nconnectivity_hub_primary_resource_group_name = \"rg-prod-network-$${starter_location_01}\"\n</code></pre></p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2-3","title":"2-3. \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u306e\u540d\u524d","text":"<pre><code>    # Resource names management\n    log_analytics_workspace_name            = \"law-management-$${starter_location_01}\"\n    ddos_protection_plan_name               = \"ddos-$${starter_location_01}\"\n    ama_user_assigned_managed_identity_name = \"uami-management-ama-$${starter_location_01}\"\n    dcr_change_tracking_name                = \"dcr-change-tracking\"\n    dcr_defender_sql_name                   = \"dcr-defender-sql\"\n    dcr_vm_insights_name                    = \"dcr-vm-insights\"\n</code></pre> <p>\u305d\u308c\u305e\u308c\u89e3\u8aac\u3057\u307e\u3059</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#log_analytics_workspace_name","title":"log_analytics_workspace_name","text":"<pre><code>log_analytics_workspace_name = \"law-management-$${starter_location_01}\"\n# \u5b9f\u969b: \"law-management-japaneast\"\n</code></pre> <p>\u3053\u308c\u306f\u4f55\u3067\u3057\u3087\u3046\u304b\uff1f - Log Analytics Workspace\uff08\u30ed\u30b0\u3092\u96c6\u3081\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\uff09\u306e\u540d\u524d\u3067\u3059 - <code>law</code>\u306fLog Analytics Workspace\u306e\u7565 - \u3059\u3079\u3066\u306e\u30ed\u30b0\u304c\u3053\u3053\u306b\u96c6\u307e\u308a\u307e\u3059</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#ddos_protection_plan_name","title":"ddos_protection_plan_name","text":"<pre><code>ddos_protection_plan_name = \"ddos-$${starter_location_01}\"\n# \u5b9f\u969b: \"ddos-japaneast\"\n</code></pre> <p>\u3053\u308c\u306f\u4f55\u3067\u3057\u3087\u3046\u304b\uff1f - DDoS\u653b\u6483\u304b\u3089\u5b88\u308b\u30b5\u30fc\u30d3\u30b9\u306e\u540d\u524d\u3067\u3059 - \u975e\u5e38\u306b\u9ad8\u984d\u3067\u3059\uff08\u6708\u00a5400,000\u7a0b\u5ea6\uff09 - \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u516c\u958b\u3057\u3066\u3044\u308b\u30a2\u30d7\u30ea\u306b\u306f\u5fc5\u8981\u3067\u3059</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#ama_user_assigned_managed_identity_name","title":"ama_user_assigned_managed_identity_name","text":"<pre><code>ama_user_assigned_managed_identity_name = \"uami-management-ama-$${starter_location_01}\"\n# \u5b9f\u969b: \"uami-management-ama-japaneast\"\n</code></pre> <p>\u3053\u308c\u306f\u4f55\u3067\u3057\u3087\u3046\u304b\uff1f - Azure Monitor Agent\uff08\u76e3\u8996\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\uff09\u304c\u4f7f\u3046\u8a8d\u8a3cID\u3067\u3059 - <code>uami</code>\u306fUser Assigned Managed Identity\u306e\u7565 - VM\u306a\u3069\u306b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u5c0e\u5165\u3059\u308b\u969b\u306b\u4f7f\u3044\u307e\u3059</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#dcr__namedata-collection-rule","title":"dcr_*_name\uff08Data Collection Rule\uff09","text":"<pre><code>dcr_change_tracking_name = \"dcr-change-tracking\"\ndcr_defender_sql_name    = \"dcr-defender-sql\"\ndcr_vm_insights_name     = \"dcr-vm-insights\"\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f - Data Collection Rule\uff08\u30c7\u30fc\u30bf\u53ce\u96c6\u30eb\u30fc\u30eb\uff09\u306e\u540d\u524d - \u3069\u306e\u30c7\u30fc\u30bf\u3092\u53ce\u96c6\u3059\u308b\u304b\u6c7a\u3081\u308b\u30eb\u30fc\u30eb - 3\u7a2e\u985e\uff1a   - <code>change-tracking</code>\uff1a\u30d5\u30a1\u30a4\u30eb\u3068\u304b\u8a2d\u5b9a\u306e\u5909\u66f4\u3092\u8ffd\u8de1   - <code>defender-sql</code>\uff1aSQL Server\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ed\u30b0   - <code>vm-insights</code>\uff1aVM\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30c7\u30fc\u30bf</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2-4","title":"2-4. \u30ea\u30bd\u30fc\u30b9\u306e\u6709\u52b9/\u7121\u52b9\u8a2d\u5b9a\uff08\u30b0\u30ed\u30fc\u30d0\u30eb\uff09","text":"<pre><code>    # Resource provisioning global connectivity\n    ddos_protection_plan_enabled = false\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f - DDoS Protection\u3092\u6709\u52b9\u306b\u3059\u308b\u304b\u7121\u52b9\u306b\u3059\u308b\u304b - <code>true</code>\u306b\u3059\u308b\u3068\u6708\u00a5400,000\u98db\u3076 - \u691c\u8a3c\u74b0\u5883\u306a\u3089<code>false</code>\u3067OK</p> <p>\u5909\u3048\u305f\u3044\u6642\u306f\uff1f <pre><code># \u672c\u756a\u74b0\u5883\u3067\u5fc5\u8981\u306a\u3089\nddos_protection_plan_enabled = true\n</code></pre></p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2-5-hub","title":"2-5. \u30d7\u30e9\u30a4\u30de\u30eaHub\u306e\u8a2d\u5b9a","text":"<pre><code>    # Resource provisioning primary connectivity\n    primary_firewall_enabled                                             = true\n    primary_firewall_management_ip_enabled                               = true\n    primary_virtual_network_gateway_express_route_enabled                = true\n    primary_virtual_network_gateway_express_route_hobo_public_ip_enabled = true\n    primary_virtual_network_gateway_vpn_enabled                          = true\n    primary_private_dns_zones_enabled                                    = true\n    primary_private_dns_auto_registration_zone_enabled                   = true\n    primary_private_dns_resolver_enabled                                 = true\n    primary_bastion_enabled                                              = true\n</code></pre> <p>\u3053\u308c\u304c\u4e00\u756a\u91cd\u8981\u3067\u3059\uff01 \u30d7\u30e9\u30a4\u30de\u30eaHub\uff08Japan East\uff09\u3067\u4f55\u3092\u6709\u52b9\u306b\u3059\u308b\u304b\u6c7a\u3081\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#1","title":"1\u3064\u305a\u3064\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046","text":""},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_firewall_enabled","title":"primary_firewall_enabled","text":"<pre><code>primary_firewall_enabled = true\n</code></pre> <p>\u3053\u308c\u306f\u4f55\u3067\u3057\u3087\u3046\u304b\uff1f - Azure Firewall\uff08\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\uff09\u3092\u4f5c\u308b\u304b\u3069\u3046\u304b\u3067\u3059 - <code>true</code>\uff1a\u4f5c\u308a\u307e\u3059\uff08\u6708\u00a5170,000\u7a0b\u5ea6\u3001Standard SKU\uff09 - <code>false</code>\uff1a\u4f5c\u308a\u307e\u305b\u3093</p> <p>\u3044\u3064false\u306b\u3057\u307e\u3059\u304b\uff1f <pre><code># \u30b3\u30b9\u30c8\u524a\u6e1b\u3057\u305f\u3044\u691c\u8a3c\u74b0\u5883\nprimary_firewall_enabled = false\n\n# \u4ee3\u308f\u308a\u306bNSG\uff08\u7121\u6599\u306e\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\uff09\u3060\u3051\u4f7f\u3046\n</code></pre></p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_firewall_management_ip_enabled","title":"primary_firewall_management_ip_enabled","text":"<pre><code>primary_firewall_management_ip_enabled = true\n</code></pre> <p>\u3053\u308c\u306f\u4f55\u3067\u3057\u3087\u3046\u304b\uff1f - Firewall\u7ba1\u7406\u7528\u306ePublic IP\u3092\u4f5c\u308b\u304b\u3069\u3046\u304b\u3067\u3059 - Basic SKU\u306eFirewall\u3067\u5fc5\u8981\u3067\u3059 - Standard/Premium\u306a\u3089\u4e0d\u8981\u3067\u3059\u304c\u3001\u4f5c\u3063\u3066\u304a\u3044\u3066\u3082\u554f\u984c\u3042\u308a\u307e\u305b\u3093</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_virtual_network_gateway_express_route_enabled","title":"primary_virtual_network_gateway_express_route_enabled","text":"<pre><code>primary_virtual_network_gateway_express_route_enabled = true\n</code></pre> <p>\u3053\u308c\u306f\u4f55\u3067\u3057\u3087\u3046\u304b\uff1f - ExpressRoute Gateway\uff08\u5c02\u7528\u7dda\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\uff09\u3092\u4f5c\u308b\u304b\u3069\u3046\u304b\u3067\u3059 - \u30aa\u30f3\u30d7\u30ec\u3068Azure\u3092\u5c02\u7528\u7dda\u3067\u7e4b\u3050\u6642\u306b\u5fc5\u8981\u3067\u3059 - \u6708\u00a540,000\u301c60,000\u7a0b\u5ea6\u3067\u3059\uff08SKU\u306b\u3088\u308b\uff09</p> <p>\u3044\u3064false\u306b\u3057\u307e\u3059\u304b\uff1f <pre><code># \u30aa\u30f3\u30d7\u30ec\u3068\u306e\u63a5\u7d9a\u304c\u4e0d\u8981\u306a\u3089\nprimary_virtual_network_gateway_express_route_enabled = false\n</code></pre></p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_virtual_network_gateway_vpn_enabled","title":"primary_virtual_network_gateway_vpn_enabled","text":"<pre><code>primary_virtual_network_gateway_vpn_enabled = true\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f - VPN Gateway\uff08VPN\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\uff09\u3092\u4f5c\u308b\u304b - \u30aa\u30f3\u30d7\u30ec\u3068Azure\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u7d4c\u7531\u3067\u7e4b\u3050 - \u6708\u00a540,000\u7a0b\u5ea6\uff08VpnGw1 SKU\uff09</p> <p>ExpressRoute\u3068\u306e\u9055\u3044\u306f\uff1f - ExpressRoute\uff1a\u5c02\u7528\u7dda\uff08\u901f\u3044\u3001\u9ad8\u3044\u3001\u5b89\u5b9a\uff09 - VPN\uff1a\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u7d4c\u7531\uff08\u666e\u901a\u3001\u5b89\u3044\u3001\u4e0d\u5b89\u5b9a\uff09</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_private_dns_zones_enabled","title":"primary_private_dns_zones_enabled","text":"<pre><code>primary_private_dns_zones_enabled = true\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f - Private DNS Zones\uff08Azure\u5185\u90e8\u5c02\u7528\u306eDNS\u30b5\u30fc\u30d3\u30b9\uff09\u3092\u4f5c\u308b\u304b - Azure PaaS\u30b5\u30fc\u30d3\u30b9\uff08Storage\u3001SQL Database\u7b49\uff09\u306b\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3067\u63a5\u7d9a\u3059\u308b\u6642\u306b\u5fc5\u9808 - \u7d76\u5bfe<code>true</code>\u306b\u3057\u3066\u304a\u3053\u3046</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_private_dns_auto_registration_zone_enabled","title":"primary_private_dns_auto_registration_zone_enabled","text":"<pre><code>primary_private_dns_auto_registration_zone_enabled = true\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f - VM\u3092\u4f5c\u3063\u305f\u3089\u81ea\u52d5\u3067DNS\u306b\u767b\u9332\u3059\u308b\u304b - <code>true</code>\u306b\u3057\u3066\u304a\u304f\u3068VM\u306e\u540d\u524d\u3067\u901a\u4fe1\u3067\u304d\u3066\u4fbf\u5229</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_private_dns_resolver_enabled","title":"primary_private_dns_resolver_enabled","text":"<pre><code>primary_private_dns_resolver_enabled = true\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f - Private DNS Resolver\uff08DNS\u4e2d\u7d99\u30b5\u30fc\u30d0\u30fc\uff09\u3092\u4f5c\u308b\u304b - \u30aa\u30f3\u30d7\u30ec\u3068Azure\u9593\u3067DNS\u540d\u524d\u89e3\u6c7a\u3059\u308b\u6642\u306b\u5fc5\u8981</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_bastion_enabled","title":"primary_bastion_enabled","text":"<pre><code>primary_bastion_enabled = true\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f - Azure Bastion\uff08\u5b89\u5168\u306aVM\u30ea\u30e2\u30fc\u30c8\u63a5\u7d9a\u30b5\u30fc\u30d3\u30b9\uff09\u3092\u4f5c\u308b\u304b - VM\u306bSSH/RDP\u3059\u308b\u6642\u3001Bastion\u3092\u7d4c\u7531\u3059\u308b\u3068\u5b89\u5168 - Public IP\u3092VM\u306b\u5272\u308a\u5f53\u3066\u306a\u304f\u3066\u6e08\u3080 - \u6708\u00a527,000\u7a0b\u5ea6\uff08Basic SKU\uff09</p> <p>\u30dd\u30a4\u30f3\u30c8 Japan East\u3067\u306fAvailability Zones\u4f7f\u3048\u306a\u3044\u304b\u3089\u3001\u5f8c\u3067<code>zones = []</code>\u8a2d\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2-6-hub","title":"2-6. \u30bb\u30ab\u30f3\u30c0\u30eaHub\u306e\u8a2d\u5b9a","text":"<pre><code>    # Resource provisioning secondary connectivity\n    secondary_firewall_enabled                                             = true\n    secondary_firewall_management_ip_enabled                               = true\n    secondary_virtual_network_gateway_express_route_enabled                = true\n    secondary_virtual_network_gateway_express_route_hobo_public_ip_enabled = true\n    secondary_virtual_network_gateway_vpn_enabled                          = true\n    secondary_private_dns_zones_enabled                                    = true\n    secondary_private_dns_auto_registration_zone_enabled                   = true\n    secondary_private_dns_resolver_enabled                                 = true\n    secondary_bastion_enabled                                              = true\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f \u30bb\u30ab\u30f3\u30c0\u30eaHub\uff08Japan West\uff09\u306e\u8a2d\u5b9a\u3002\u30d7\u30e9\u30a4\u30de\u30ea\u3068\u540c\u3058\u9805\u76ee\u3002</p> <p>\u30b3\u30b9\u30c8\u524a\u6e1b\u3057\u305f\u3044\u306a\u3089\uff1f \u30bb\u30ab\u30f3\u30c0\u30ea\u306f\u6700\u5c0f\u69cb\u6210\u306b\u3057\u3088\u3046\uff1a</p> <pre><code># \u30bb\u30ab\u30f3\u30c0\u30ea\u306f\u6700\u5c0f\u9650\u306b\u3057\u3066\u30b3\u30b9\u30c8\u524a\u6e1b\nsecondary_firewall_enabled = false\nsecondary_virtual_network_gateway_express_route_enabled = false\nsecondary_virtual_network_gateway_vpn_enabled = false\nsecondary_bastion_enabled = false\n\n# DNS\u7cfb\u3060\u3051\u6709\u52b9\nsecondary_private_dns_zones_enabled = true\nsecondary_private_dns_resolver_enabled = true\n</code></pre> <p>\u3053\u308c\u3067\u30bb\u30ab\u30f3\u30c0\u30ea\u306f\u307b\u307c\u7121\u6599\u3067\u4f7f\u3048\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2-7","title":"2-7. \u30d7\u30e9\u30a4\u30de\u30ea\u30ea\u30bd\u30fc\u30b9\u306e\u540d\u524d","text":"<pre><code>    # Resource names primary connectivity\n    primary_virtual_network_name                                 = \"vnet-hub-$${starter_location_01}\"\n    primary_firewall_name                                        = \"fw-hub-$${starter_location_01}\"\n    primary_firewall_policy_name                                 = \"fwp-hub-$${starter_location_01}\"\n    primary_firewall_public_ip_name                              = \"pip-fw-hub-$${starter_location_01}\"\n    primary_firewall_management_public_ip_name                   = \"pip-fw-hub-mgmt-$${starter_location_01}\"\n    primary_route_table_firewall_name                            = \"rt-hub-fw-$${starter_location_01}\"\n    primary_route_table_user_subnets_name                        = \"rt-hub-std-$${starter_location_01}\"\n    primary_virtual_network_gateway_express_route_name           = \"vgw-hub-er-$${starter_location_01}\"\n    primary_virtual_network_gateway_express_route_public_ip_name = \"pip-vgw-hub-er-$${starter_location_01}\"\n    primary_virtual_network_gateway_vpn_name                     = \"vgw-hub-vpn-$${starter_location_01}\"\n    primary_virtual_network_gateway_vpn_public_ip_name_1         = \"pip-vgw-hub-vpn-$${starter_location_01}-001\"\n    primary_virtual_network_gateway_vpn_public_ip_name_2         = \"pip-vgw-hub-vpn-$${starter_location_01}-002\"\n    primary_private_dns_resolver_name                            = \"pdr-hub-dns-$${starter_location_01}\"\n    primary_bastion_host_name                                    = \"bas-hub-$${starter_location_01}\"\n    primary_bastion_host_public_ip_name                          = \"pip-bastion-hub-$${starter_location_01}\"\n</code></pre> <p>\u30ea\u30bd\u30fc\u30b9\u540d\u306e\u4e00\u89a7\u3002\u547d\u540d\u898f\u5247\u3092\u8868\u306b\u307e\u3068\u3081\u308b\u306d\uff1a</p> \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9 \u610f\u5473 \u4f8b <code>vnet-</code> Virtual Network <code>vnet-hub-japaneast</code> <code>fw-</code> Firewall <code>fw-hub-japaneast</code> <code>fwp-</code> Firewall Policy <code>fwp-hub-japaneast</code> <code>pip-</code> Public IP <code>pip-fw-hub-japaneast</code> <code>rt-</code> Route Table <code>rt-hub-fw-japaneast</code> <code>vgw-</code> Virtual Network Gateway <code>vgw-hub-er-japaneast</code> <code>pdr-</code> Private DNS Resolver <code>pdr-hub-dns-japaneast</code> <code>bas-</code> Bastion Host <code>bas-hub-japaneast</code> <p>**Azure\u306e\u63a8\u5968\u547d\u540d\u898f\u5247\u306b\u5f93\u3063\u3066\u308b**\u304b\u3089\u3001\u305d\u306e\u307e\u307e\u4f7f\u3048\u3070OK\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2-8","title":"2-8. \u30bb\u30ab\u30f3\u30c0\u30ea\u30ea\u30bd\u30fc\u30b9\u306e\u540d\u524d","text":"<pre><code>    # Resource names secondary connectivity\n    secondary_virtual_network_name                                 = \"vnet-hub-$${starter_location_02}\"\n    secondary_firewall_name                                        = \"fw-hub-$${starter_location_02}\"\n    # ... \u4ee5\u4e0b\u540c\u3058\u30d1\u30bf\u30fc\u30f3\n</code></pre> <p>\u30bb\u30ab\u30f3\u30c0\u30ea\u3082\u540c\u3058\u30d1\u30bf\u30fc\u30f3\u3002<code>$${starter_location_02}</code>\u304c<code>japanwest</code>\u306b\u7f6e\u304d\u63db\u308f\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#1_1","title":"\u2615 \u4f11\u61a9\u30bf\u30a4\u30e0\uff081\u56de\u76ee\uff09","text":"<p>\u304a\u75b2\u308c\u69d8\u3067\u3059\uff01\u3053\u3053\u307e\u3067\u3067\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <p>\u2705 \u30ea\u30fc\u30b8\u30e7\u30f3\u8a2d\u5b9a\uff08<code>starter_locations</code>\uff09 \u2705 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5909\u6570\uff08<code>$${starter_location_01}</code>\uff09 \u2705 \u30ab\u30b9\u30bf\u30e0\u7f6e\u63db\u306e<code>names</code>\u30bb\u30af\u30b7\u30e7\u30f3\uff08\u30ea\u30bd\u30fc\u30b9\u540d\u3001\u6709\u52b9/\u7121\u52b9\u8a2d\u5b9a\uff09</p> <p>\u3053\u3053\u304b\u3089\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u7d30\u304b\u3044\u8a2d\u5b9a\u304c\u7d9a\u304d\u307e\u3059\u3002 \u30b3\u30fc\u30d2\u30fc\u3092\u98f2\u3093\u3067\u3001\u5c11\u3057\u4f11\u61a9\u3057\u3066\u304b\u3089\u9032\u307f\u307e\u3057\u3087\u3046\u3002</p> <p>\u6b21\u306e Part 3 \u304b\u3089\u306f\u3001IP\u30a2\u30c9\u30ec\u30b9\u3084Firewall\u306e\u8a2d\u5b9a\u304c\u51fa\u3066\u304d\u307e\u3059\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#part-3","title":"Part 3: \u8a2d\u5b9a\u5024\u306e\u30a2\u30c9\u30ec\u30b9\u7a7a\u9593","text":"<p>\u3053\u3053\u304b\u3089\u5148\u306f\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u7d30\u304b\u3044\u8a2d\u5b9a\u304c\u7d9a\u304f\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#3-1-firewall","title":"3-1. Firewall\u306e\u8a2d\u5b9a","text":"<pre><code>    # Primary firewall settings\n    primary_firewall_sku_tier                           = \"Standard\"\n    primary_firewall_subnet_address_prefix              = \"10.0.128.0/26\"\n    primary_firewall_management_subnet_address_prefix   = \"10.0.128.64/26\"\n    primary_firewall_client_public_ip_zones             = []\n    primary_firewall_management_public_ip_zones         = []\n    primary_virtual_network_address_space               = \"10.0.0.0/16\"\n</code></pre>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_firewall_sku_tier","title":"primary_firewall_sku_tier","text":"<pre><code>primary_firewall_sku_tier = \"Standard\"\n</code></pre> <p>\u9078\u629e\u80a2 - <code>Basic</code>\uff1a\u5b89\u3044\uff08\u6708\u00a530,000\u7a0b\u5ea6\uff09\u3001\u6a5f\u80fd\u5c11\u306a\u3044 - <code>Standard</code>\uff1a\u6a19\u6e96\uff08\u6708\u00a5170,000\u7a0b\u5ea6\uff09\u3001\u8105\u5a01\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30b9\u3042\u308a - <code>Premium</code>\uff1a\u9ad8\u6a5f\u80fd\uff08\u6708\u00a5100,000 + Premium\u8ab2\u91d1\uff09\u3001TLS\u691c\u67fb\u3042\u308a</p> <p>\u304a\u3059\u3059\u3081 - \u691c\u8a3c\uff1a<code>Basic</code> - \u672c\u756a\uff1a<code>Standard</code> - \u9ad8\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8981\u4ef6\uff1a<code>Premium</code></p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_firewall_subnet_address_prefix","title":"primary_firewall_subnet_address_prefix","text":"<pre><code>primary_firewall_subnet_address_prefix = \"10.0.128.0/26\"\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f Firewall\u304c\u4f7f\u3046Subnet\u306eIP\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2\u3002</p> <p>\u306a\u305c/26\uff1f - /26 = 64\u500b\u306eIP\u30a2\u30c9\u30ec\u30b9 - Azure\u304c5\u500b\u4e88\u7d04\u3059\u308b\u304b\u3089\u3001\u5b9f\u969b\u306f59\u500b\u4f7f\u3048\u308b - Firewall\u306b\u306f\u5341\u5206</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#primary_firewall_client_public_ip_zones","title":"primary_firewall_client_public_ip_zones","text":"<pre><code>primary_firewall_client_public_ip_zones = []\n</code></pre> <p>\ud83d\udea8 \u91cd\u8981\uff01zones = [] \u306e\u610f\u5473</p> <p>zones \u306f Availability Zones\uff08\u53ef\u7528\u6027\u30be\u30fc\u30f3\uff09\u306e\u3053\u3068\u3067\u3059\u3002</p> <p>Azure\u3067\u306f\u3001\u30ea\u30bd\u30fc\u30b9\u3092\u8907\u6570\u306e\u30be\u30fc\u30f3\uff08\u7269\u7406\u7684\u306b\u96e2\u308c\u305f\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\uff09\u306b\u5206\u6563\u914d\u7f6e\u3059\u308b\u3053\u3068\u3067\u3001 1\u3064\u306e\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\u969c\u5bb3\u6642\u306b\u3082\u30b5\u30fc\u30d3\u30b9\u3092\u7d99\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002</p> <p>Japan East \u306e\u5236\u7d04: - Firewall\u7b49\u306e\u4e00\u90e8\u30ea\u30bd\u30fc\u30b9\u306f\u3001Japan East\u3067Availability Zones\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093 - \u305d\u306e\u305f\u3081\u3001<code>zones = []</code>\uff08\u7a7a\u30ea\u30b9\u30c8\uff09\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059</p> <p>\u3082\u3057\u7a7a\u30ea\u30b9\u30c8\u306b\u3057\u306a\u3044\u3068\uff1f: <pre><code>Error: zones are not supported in this region\n</code></pre> \u3068\u3044\u3046\u30a8\u30e9\u30fc\u3067\u30c7\u30d7\u30ed\u30a4\u304c\u5931\u6557\u3057\u307e\u3059\u3002</p> <p>US East\u7b49\u306e\u30be\u30fc\u30f3\u5bfe\u5fdc\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306f: <pre><code>primary_firewall_client_public_ip_zones = [\"1\", \"2\", \"3\"]  # \u21903\u3064\u306e\u30be\u30fc\u30f3\u306b\u5206\u6563\n</code></pre> \u3068\u8a2d\u5b9a\u3059\u308b\u3068\u30013\u3064\u306e\u30be\u30fc\u30f3\u306b\u5206\u6563\u914d\u7f6e\u3055\u308c\u3066\u9ad8\u53ef\u7528\u6027\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#3-2-vpn-gateway","title":"3-2. VPN Gateway\u306e\u8a2d\u5b9a","text":"<pre><code>    primary_virtual_network_gateway_vpn_public_ip_name_1 = \"pip-vgw-hub-vpn-$${starter_location_01}-001\"\n    primary_virtual_network_gateway_vpn_public_ip_name_2 = \"pip-vgw-hub-vpn-$${starter_location_01}-002\"\n</code></pre> <p>\u306a\u3093\u30672\u500b\uff1f VPN Gateway\u306f**Active-Active\u69cb\u6210**\uff082\u53f0\u540c\u6642\u7a3c\u50cd\uff09\u306b\u3067\u304d\u308b\u304b\u3089\u3002 - 1\u53f0\u76ee\uff1a<code>-001</code> - 2\u53f0\u76ee\uff1a<code>-002</code></p> <p>\u5197\u9577\u5316\u3057\u3066\u53ef\u7528\u6027\u3092\u4e0a\u3052\u305f\u3044\u6642\u306b\u4f7f\u3046\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#3-3-ip","title":"3-3. IP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u8a08\uff08\u30d7\u30e9\u30a4\u30de\u30ea\uff09","text":"<p>\ud83d\udcda IP\u30a2\u30c9\u30ec\u30b9\u3068CIDR\u8868\u8a18\u306b\u3064\u3044\u3066</p> <p>\u3053\u3053\u304b\u3089<code>10.0.0.0/16</code>\u306e\u3088\u3046\u306a\u8868\u8a18\u304c\u51fa\u3066\u304d\u307e\u3059\u3002 \u3053\u308c\u306f**CIDR\u8868\u8a18**\uff08\u30b5\u30a4\u30c0\u30fc\u8868\u8a18\uff09\u3068\u547c\u3070\u308c\u308bIP\u30a2\u30c9\u30ec\u30b9\u306e\u7bc4\u56f2\u3092\u8868\u3059\u8a18\u6cd5\u3067\u3059\u3002</p> <p>CIDR\u8868\u8a18\u306e\u8aad\u307f\u65b9: <pre><code>10.0.0.0/16\n\u2502      \u2502\n\u2502      \u2514\u2500 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u90e8\u5206\u306e\u30d3\u30c3\u30c8\u6570\uff08/16 = \u6700\u521d\u306e16\u30d3\u30c3\u30c8\u56fa\u5b9a\uff09\n\u2514\u2500 \u958b\u59cbIP\u30a2\u30c9\u30ec\u30b9\n</code></pre></p> <p>\u3088\u304f\u4f7f\u3046\u30b5\u30a4\u30ba\uff08\u899a\u3048\u306a\u304f\u3066OK\u3001\u96f0\u56f2\u6c17\u3060\u3051\uff09: - <code>/16</code>: 65,536\u500b\u306eIP\u30a2\u30c9\u30ec\u30b9\uff08\u5927\u898f\u6a21\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5168\u4f53\uff09 - <code>/22</code>: 1,024\u500b\uff08Hub VNet\u7528\uff09 - <code>/24</code>: 256\u500b\uff08\u4e00\u822c\u7684\u306a\u30b5\u30d6\u30cd\u30c3\u30c8\uff09 - <code>/26</code>: 64\u500b\uff08Firewall\u7b49\u306e\u5c02\u7528\u30b5\u30d6\u30cd\u30c3\u30c8\uff09 - <code>/27</code>: 32\u500b\uff08Gateway\u7528\uff09 - <code>/28</code>: 16\u500b\uff08DNS Resolver\u7528\uff09</p> <p>**\u6570\u5b57\u304c\u5c0f\u3055\u3044\u307b\u3069\u5e83\u3044\u7bc4\u56f2**\u3067\u3059\u3002\u8a73\u3057\u304f\u7406\u89e3\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u300c\u5927\u304d\u306a\u7bc4\u56f2\u3092\u5c0f\u3055\u304f\u533a\u5207\u3063\u3066\u4f7f\u3046\u300d\u3068\u601d\u3048\u3070OK\u3067\u3059\u3002</p> <pre><code>    # IP Ranges Primary\n    # Regional Address Space: 10.0.0.0/16\n    primary_hub_address_space                          = \"10.0.0.0/16\"\n    primary_hub_virtual_network_address_space          = \"10.0.0.0/22\"\n    primary_firewall_subnet_address_prefix             = \"10.0.0.0/26\"\n    primary_firewall_management_subnet_address_prefix  = \"10.0.0.192/26\"\n    primary_bastion_subnet_address_prefix              = \"10.0.0.64/26\"\n    primary_gateway_subnet_address_prefix              = \"10.0.0.128/27\"\n    primary_private_dns_resolver_subnet_address_prefix = \"10.0.0.160/28\"\n</code></pre> <p>\ud83d\udcca IP\u30a2\u30c9\u30ec\u30b9\u306e\u5168\u4f53\u50cf\uff08\u8996\u899a\u5316\uff09</p> <pre><code>10.0.0.0/16\uff08Regional\u5168\u4f53: 65,536\u500b\u306eIP\u30a2\u30c9\u30ec\u30b9\uff09\n\u251c\u2500 10.0.0.0/22\uff08Hub VNet: 1,024\u500b\uff09\n\u2502  \u251c\u2500 10.0.0.0/26    [Firewall Subnet]          64\u500b\n\u2502  \u251c\u2500 10.0.0.64/26   [Bastion Subnet]           64\u500b\n\u2502  \u251c\u2500 10.0.0.128/27  [Gateway Subnet]           32\u500b\n\u2502  \u251c\u2500 10.0.0.160/28  [DNS Resolver Subnet]      16\u500b\n\u2502  \u2514\u2500 10.0.0.192/26  [Firewall Mgmt Subnet]     64\u500b\n\u2502\n\u2514\u2500 10.0.4.0\u301c10.0.255.255\uff08\u6b8b\u308a: 64,512\u500b\uff09\n   \u2514\u2500 Spoke VNet\u7528\u306b\u4e88\u7d04\uff08\u5c06\u6765\u306e\u62e1\u5f35\u7528\uff09\n</code></pre> <p>\u8868\u5f62\u5f0f\u3067\u3082\u898b\u3066\u307f\u307e\u3057\u3087\u3046</p> \u7528\u9014 CIDR IP\u7bc4\u56f2 \u4f7f\u3048\u308b\u6570 Regional\u5168\u4f53 <code>10.0.0.0/16</code> 10.0.0.0 - 10.0.255.255 65,536\u500b Hub VNet <code>10.0.0.0/22</code> 10.0.0.0 - 10.0.3.255 1,024\u500b Firewall <code>10.0.0.0/26</code> 10.0.0.0 - 10.0.0.63 64\u500b Firewall Management <code>10.0.0.192/26</code> 10.0.0.192 - 10.0.0.255 64\u500b Bastion <code>10.0.0.64/26</code> 10.0.0.64 - 10.0.0.127 64\u500b Gateway <code>10.0.0.128/27</code> 10.0.0.128 - 10.0.0.159 32\u500b DNS Resolver <code>10.0.0.160/28</code> 10.0.0.160 - 10.0.0.175 16\u500b <p>\ud83c\udfaf \u8a2d\u8a08\u306e\u30dd\u30a4\u30f3\u30c8 - Hub VNet\u306f<code>10.0.0.0/22</code>\uff081,024\u500b\uff09\u3060\u3051\u4f7f\u3046 - \u6b8b\u308a\u306e64,512\u500b\u306fSpoke VNet\u7528\u306b\u4e88\u7d04 - \u5404Subnet\u304c\u91cd\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u614e\u91cd\u306b\u8a2d\u8a08\u3055\u308c\u3066\u3044\u308b - Firewall\u304c2\u3064\uff08\u672c\u4f53+\u7ba1\u7406\u7528\uff09\u3042\u308b\u3053\u3068\u306b\u6ce8\u76ee</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#3-4-ip","title":"3-4. IP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u8a08\uff08\u30bb\u30ab\u30f3\u30c0\u30ea\uff09","text":"<pre><code>    # IP Ranges Secondary\n    # Regional Address Space: 10.1.0.0/16\n    secondary_hub_address_space                          = \"10.1.0.0/16\"\n    secondary_hub_virtual_network_address_space          = \"10.1.0.0/22\"\n    secondary_firewall_subnet_address_prefix             = \"10.1.0.0/26\"\n    secondary_firewall_management_subnet_address_prefix  = \"10.1.0.192/26\"\n    secondary_bastion_subnet_address_prefix              = \"10.1.0.64/26\"\n    secondary_gateway_subnet_address_prefix              = \"10.1.0.128/27\"\n    secondary_private_dns_resolver_subnet_address_prefix = \"10.1.0.160/28\"\n</code></pre> <p>\u30d1\u30bf\u30fc\u30f3\u540c\u3058\u3067\u3057\u3087\uff1f \u30d7\u30e9\u30a4\u30de\u30ea\u304c<code>10.0.x.x</code>\u3001\u30bb\u30ab\u30f3\u30c0\u30ea\u304c<code>10.1.x.x</code>\u3063\u3066\u3060\u3051\u3002</p> <p>\u3053\u308c\u30672\u3064\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u91cd\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u8a2d\u8a08\u3055\u308c\u3066\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#part-4","title":"Part 4: \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u8b58\u5225\u5b50","text":"<pre><code>  resource_group_identifiers = {\n    management_resource_group_id             = \"/subscriptions/$${subscription_id_management}/resourcegroups/$${management_resource_group_name}\"\n    ddos_protection_plan_resource_group_id   = \"/subscriptions/$${subscription_id_connectivity}/resourcegroups/$${ddos_resource_group_name}\"\n    primary_connectivity_resource_group_id   = \"/subscriptions/$${subscription_id_connectivity}/resourceGroups/$${connectivity_hub_primary_resource_group_name}\"\n    secondary_connectivity_resource_group_id = \"/subscriptions/$${subscription_id_connectivity}/resourceGroups/$${connectivity_hub_secondary_resource_group_name}\"\n    dns_resource_group_id                    = \"/subscriptions/$${subscription_id_connectivity}/resourceGroups/$${dns_resource_group_name}\"\n  }\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e**\u30d5\u30eb\u30d1\u30b9**\uff08\u5b8c\u5168\u306aID\uff09\u3092\u4f5c\u3063\u3066\u308b\u3002</p> <p>\u5f62\u5f0f <pre><code>/subscriptions/{\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID}/resourcegroups/{\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u540d}\n</code></pre></p> <p>\u306a\u305c\u5fc5\u8981\uff1f \u5f8c\u3067\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u53c2\u7167\u3059\u308b\u6642\u306b\u4f7f\u3046\u3002 \u4f8b\u3048\u3070\u3001\u300c\u3053\u306eLog Analytics\u306f\u3069\u306eRG\u306b\u3042\u308b\uff1f\u300d\u3063\u3066\u805e\u304b\u308c\u305f\u6642\u306b\u3001\u3053\u306eID\u3067\u7b54\u3048\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#part-5","title":"Part 5: \u30ea\u30bd\u30fc\u30b9\u8b58\u5225\u5b50","text":"<pre><code>  resource_identifiers = {\n    ama_change_tracking_data_collection_rule_id = \"$${management_resource_group_id}/providers/Microsoft.Insights/dataCollectionRules/$${dcr_change_tracking_name}\"\n    ama_mdfc_sql_data_collection_rule_id        = \"$${management_resource_group_id}/providers/Microsoft.Insights/dataCollectionRules/$${dcr_defender_sql_name}\"\n    ama_vm_insights_data_collection_rule_id     = \"$${management_resource_group_id}/providers/Microsoft.Insights/dataCollectionRules/$${dcr_vm_insights_name}\"\n    ama_user_assigned_managed_identity_id       = \"$${management_resource_group_id}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/$${ama_user_assigned_managed_identity_name}\"\n    log_analytics_workspace_id                  = \"$${management_resource_group_id}/providers/Microsoft.OperationalInsights/workspaces/$${log_analytics_workspace_name}\"\n    ddos_protection_plan_id                     = \"$${ddos_protection_plan_resource_group_id}/providers/Microsoft.Network/ddosProtectionPlans/$${ddos_protection_plan_name}\"\n  }\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f \u500b\u5225\u306e\u30ea\u30bd\u30fc\u30b9\u306e**\u30d5\u30eb\u30d1\u30b9**\uff08Resource ID\uff09\u3092\u4f5c\u3063\u3066\u308b\u3002</p> <p>\u5f62\u5f0f <pre><code>{\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7ID}/providers/{\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7}/{\u30ea\u30bd\u30fc\u30b9\u540d}\n</code></pre></p> <p>\u4f8b <pre><code>/subscriptions/xxx/resourcegroups/rg-management-japaneast/providers/Microsoft.OperationalInsights/workspaces/law-management-japaneast\n</code></pre></p> <p>\u3053\u308c\u3067Log Analytics Workspace\u3092\u4e00\u610f\u306b\u7279\u5b9a\u3067\u304d\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2","title":"\u2615 \u4f11\u61a9\u30bf\u30a4\u30e0\uff082\u56de\u76ee\uff09","text":"<p>\u534a\u5206\u307e\u3067\u6765\u307e\u3057\u305f\uff01\u3053\u3053\u307e\u3067\u3067\u5b66\u3093\u3060\u3053\u3068\uff1a</p> <p>\u2705 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306eIP\u30a2\u30c9\u30ec\u30b9\u8a2d\u5b9a\uff08Part 3\uff09 \u2705 \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u8b58\u5225\u5b50\uff08Part 4\uff09 \u2705 \u30ea\u30bd\u30fc\u30b9\u8b58\u5225\u5b50\uff08Part 5\uff09</p> <p>\u4eca\u304b\u3089\u5b66\u3076\u3053\u3068\uff1a - \u30bf\u30b0\u8a2d\u5b9a\uff08\u30b3\u30b9\u30c8\u7ba1\u7406\u3001\u7ba1\u7406\u7528\uff09 - \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\uff08Log Analytics\u7b49\uff09 - \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc</p> <p>\u3082\u3046\u5c11\u3057\u3067\u7d42\u308f\u308a\u307e\u3059\u3002\u982d\u3092\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u3057\u3066\u304b\u3089\u9032\u307f\u307e\u3057\u3087\u3046\uff01</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#part-6","title":"Part 6: \u30bf\u30b0\u8a2d\u5b9a","text":"<pre><code>tags = {\n  deployed_by = \"terraform\"\n  source      = \"Azure Landing Zones Accelerator\"\n}\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f \u5168\u3066\u306e\u30ea\u30bd\u30fc\u30b9\u306b\u4ed8\u3051\u308b\u30bf\u30b0\uff08\u30e1\u30bf\u30c7\u30fc\u30bf\uff09\u3002</p> <p>\u30bf\u30b0\u306e\u4f7f\u3044\u9053 - \u30b3\u30b9\u30c8\u7ba1\u7406\uff1a\u300cTerraform\u3067\u4f5c\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u30b3\u30b9\u30c8\u306f\uff1f\u300d - \u691c\u7d22\uff1a\u300cALZ\u3067\u4f5c\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u4e00\u89a7\u3092\u51fa\u3057\u3066\u300d - \u81ea\u52d5\u5316\uff1a\u300cterraform\u30bf\u30b0\u304c\u3064\u3044\u3066\u308b\u3084\u3064\u3060\u3051\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u300d</p> <p>\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u4f8b <pre><code>tags = {\n  deployed_by = \"terraform\"\n  source      = \"Azure Landing Zones Accelerator\"\n  environment = \"production\"\n  cost_center = \"IT-Platform\"\n  owner       = \"platform-team@example.com\"\n}\n</code></pre></p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#part-7","title":"Part 7: \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u8a2d\u5b9a","text":"<pre><code>management_resource_settings = {\n  enabled                      = true\n  location                     = \"$${starter_location_01}\"\n  log_analytics_workspace_name = \"$${log_analytics_workspace_name}\"\n  resource_group_name          = \"$${management_resource_group_name}\"\n\n  user_assigned_managed_identities = {\n    ama = {\n      name = \"$${ama_user_assigned_managed_identity_name}\"\n    }\n  }\n\n  data_collection_rules = {\n    change_tracking = {\n      name = \"$${dcr_change_tracking_name}\"\n    }\n    defender_sql = {\n      name = \"$${dcr_defender_sql_name}\"\n    }\n    vm_insights = {\n      name = \"$${dcr_vm_insights_name}\"\n    }\n  }\n}\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f Log Analytics\u306a\u3069\u3001\u76e3\u8996\u7cfb\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u307e\u3068\u3081\u3066\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>enabled = true \u306b\u3059\u308b\u3068\uff1a - Log Analytics Workspace\u4f5c\u3089\u308c\u308b - Data Collection Rule\uff08DCR\uff093\u7a2e\u985e\u4f5c\u3089\u308c\u308b - Managed Identity\u4f5c\u3089\u308c\u308b</p> <p>\u7121\u52b9\u306b\u3057\u305f\u3044\u5834\u5408 <pre><code>management_resource_settings = {\n  enabled = false  # \u2190\u3053\u308c\u3060\u3051\u3067OK\n}\n</code></pre></p> <p>\u30ed\u30b0\u4e0d\u8981\u306a\u691c\u8a3c\u74b0\u5883\u3068\u304b\u3067\u4f7f\u3048\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#part-8","title":"Part 8: \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc","text":"<pre><code>management_group_settings = {\n  enabled = true\n  architecture_name  = \"alz_custom\"\n  location           = \"$${starter_location_01}\"\n  parent_resource_id = \"$${root_parent_management_group_id}\"\n\n  policy_default_values = {\n    ama_change_tracking_data_collection_rule_id = \"$${ama_change_tracking_data_collection_rule_id}\"\n    ama_mdfc_sql_data_collection_rule_id        = \"$${ama_mdfc_sql_data_collection_rule_id}\"\n    ama_vm_insights_data_collection_rule_id     = \"$${ama_vm_insights_data_collection_rule_id}\"\n    ama_user_assigned_managed_identity_id       = \"$${ama_user_assigned_managed_identity_id}\"\n    ama_user_assigned_managed_identity_name     = \"$${ama_user_assigned_managed_identity_name}\"\n    log_analytics_workspace_id                  = \"$${log_analytics_workspace_id}\"\n    ddos_protection_plan_id                     = \"$${ddos_protection_plan_id}\"\n    private_dns_zone_subscription_id            = \"$${subscription_id_connectivity}\"\n    private_dns_zone_region                     = \"$${starter_location_01}\"\n    private_dns_zone_resource_group_name        = \"$${dns_resource_group_name}\"\n  }\n\n  subscription_placement = {\n    identity = {\n      subscription_id       = \"$${subscription_id_identity}\"\n      management_group_name = \"identity\"\n    }\n    connectivity = {\n      subscription_id       = \"$${subscription_id_connectivity}\"\n      management_group_name = \"connectivity\"\n    }\n    management = {\n      subscription_id       = \"$${subscription_id_management}\"\n      management_group_name = \"management\"\n    }\n    security = {\n      subscription_id       = \"$${subscription_id_security}\"\n      management_group_name = \"security\"\n    }\n  }\n}\n</code></pre> <p>\u3053\u308c\u304c\u8d85\u91cd\u8981\uff01</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#architecture_name","title":"architecture_name","text":"<pre><code>architecture_name = \"alz_custom\"\n</code></pre> <p>\u3053\u308c\u304c<code>lib/architecture_definitions/alz_custom.alz_architecture_definition.yaml</code>\u3092\u6307\u3057\u3066\u3044\u307e\u3059\u3002 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u968e\u5c64\u69cb\u9020\u304c\u305d\u3053\u306b\u66f8\u3044\u3066\u3042\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#policy_default_values","title":"policy_default_values","text":"<p>\u30dd\u30ea\u30b7\u30fc\u3067\u4f7f\u3046\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u5168\u3066\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>\u4f8b\u3048\u3070\u3001\u300cVM\u306bAzure Monitor Agent\u3092\u5165\u308c\u308b\u30dd\u30ea\u30b7\u30fc\u300d\u304c\u52d5\u304f\u6642\u3001 \u3053\u3053\u3067\u6307\u5b9a\u3057\u305fManaged Identity\u3068DCR\u304c\u81ea\u52d5\u3067\u8a2d\u5b9a\u3055\u308c\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#subscription_placement","title":"subscription_placement","text":"<p>\u3069\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u3069\u306e\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306b\u5165\u308c\u308b\u304b\u6c7a\u3081\u3066\u308b\u3002</p> <pre><code>root\n\u251c\u2500\u2500 Platform\n\u2502   \u251c\u2500\u2500 Connectivity\uff08\u2190 connectivity subscription\u304c\u3053\u3053\uff09\n\u2502   \u251c\u2500\u2500 Management\uff08\u2190 management subscription\u304c\u3053\u3053\uff09\n\u2502   \u251c\u2500\u2500 Identity\uff08\u2190 identity subscription\u304c\u3053\u3053\uff09\n\u2502   \u2514\u2500\u2500 Security\uff08\u2190 security subscription\u304c\u3053\u3053\uff09\n\u2514\u2500\u2500 Landing Zones\n</code></pre>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#defender","title":"Defender\u306e\u8a2d\u5b9a","text":"<pre><code>  policy_assignments_to_modify = {\n    alz = {\n      policy_assignments = {\n        Deploy-MDFC-Config-H224 = {\n          parameters = {\n            ascExportResourceGroupName                  = \"$${asc_export_resource_group_name}\"\n            ascExportResourceGroupLocation              = \"$${starter_location_01}\"\n            emailSecurityContact                        = \"$${defender_email_security_contact}\"\n            enableAscForServers                         = \"DeployIfNotExists\"\n            enableAscForServersVulnerabilityAssessments = \"DeployIfNotExists\"\n            enableAscForSql                             = \"DeployIfNotExists\"\n            enableAscForAppServices                     = \"DeployIfNotExists\"\n            enableAscForStorage                         = \"DeployIfNotExists\"\n            enableAscForContainers                      = \"DeployIfNotExists\"\n            enableAscForKeyVault                        = \"DeployIfNotExists\"\n            enableAscForSqlOnVm                         = \"DeployIfNotExists\"\n            enableAscForArm                             = \"DeployIfNotExists\"\n            enableAscForOssDb                           = \"DeployIfNotExists\"\n            enableAscForCosmosDbs                       = \"DeployIfNotExists\"\n            enableAscForCspm                            = \"DeployIfNotExists\"\n          }\n        }\n      }\n    }\n  }\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f Microsoft Defender for Cloud\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u76e3\u8996\uff09\u306e\u8a2d\u5b9a\u3002</p> <p>DeployIfNotExists = \u300c\u3082\u3057\u6709\u52b9\u3058\u3083\u306a\u304b\u3063\u305f\u3089\u3001\u81ea\u52d5\u3067\u6709\u52b9\u306b\u3059\u308b\u300d</p> <p>\u5168\u90e8\u306e\u30b5\u30fc\u30d3\u30b9\u3067\u6709\u52b9\u306b\u306a\u3063\u3066\u308b\u3002</p> <p>\u7121\u52b9\u306b\u3057\u305f\u3044\u5834\u5408 <pre><code>enableAscForServers = \"Disabled\"\nenableAscForSql = \"Disabled\"\n# ... \u5168\u90e8Disabled\u306b\n</code></pre></p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#3","title":"\u2615 \u4f11\u61a9\u30bf\u30a4\u30e0\uff083\u56de\u76ee\u30fb\u6700\u5f8c\uff09","text":"<p>\u3042\u3068\u4e00\u606f\u3067\u3059\uff01\u3053\u3053\u307e\u3067\u3067\u5b66\u3093\u3060\u3053\u3068\uff1a</p> <p>\u2705 \u30bf\u30b0\u8a2d\u5b9a\uff08Part 6\uff09 \u2705 \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\uff08Log Analytics\u3001Automation Account\u7b49\uff09\uff08Part 7\uff09 \u2705 \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc\uff08Part 8\uff09</p> <p>\u6b8b\u308a\u306e Part 9 \u306f\u3001\u3053\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30e1\u30a4\u30f3\u30a4\u30d9\u30f3\u30c8\uff01 Hub-and-Spoke\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a73\u7d30\u8a2d\u5b9a\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002</p> <p>Firewall\u3001Bastion\u3001VPN\u3001ExpressRoute\u306e\u8a2d\u5b9a\u304c\u51fa\u3066\u304d\u307e\u3059\u3088\u3002 \u6df1\u547c\u5438\u3057\u3066\u3001\u96c6\u4e2d\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\uff01</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#part-9-hub-and-spoke","title":"Part 9: \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\uff08Hub-and-Spoke\uff09","text":""},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#connectivity_type","title":"connectivity_type","text":"<pre><code>connectivity_type = \"hub_and_spoke_vnet\"\n</code></pre> <p>\u9078\u629e\u80a2 - <code>\"hub_and_spoke_vnet\"</code>\uff1aHub-and-Spoke\u69cb\u6210\uff08\u4e00\u822c\u7684\uff09 - <code>\"virtual_wan\"</code>\uff1aVirtual WAN\u69cb\u6210\uff08\u5927\u898f\u6a21\u5411\u3051\uff09 - <code>\"none\"</code>\uff1a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u3089\u306a\u3044</p> <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306fHub-and-Spoke\u3092\u4f7f\u3063\u3066\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#connectivity_resource_groups","title":"connectivity_resource_groups","text":"<pre><code>connectivity_resource_groups = {\n  ddos = {\n    name     = \"$${ddos_resource_group_name}\"\n    location = \"$${starter_location_01}\"\n    settings = {\n      enabled = \"$${ddos_protection_plan_enabled}\"\n    }\n  }\n  vnet_primary = {\n    name     = \"$${connectivity_hub_primary_resource_group_name}\"\n    location = \"$${starter_location_01}\"\n    settings = {\n      enabled = true\n    }\n  }\n  vnet_secondary = {\n    name     = \"$${connectivity_hub_secondary_resource_group_name}\"\n    location = \"$${starter_location_02}\"\n    settings = {\n      enabled = true\n    }\n  }\n  dns = {\n    name     = \"$${dns_resource_group_name}\"\n    location = \"$${starter_location_01}\"\n    settings = {\n      enabled = \"$${primary_private_dns_zones_enabled}\"\n    }\n  }\n}\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7528\u306e\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u30924\u3064\u4f5c\u3063\u3066\u308b\uff1a 1. ddos\uff1aDDoS Protection\u7528 2. vnet_primary\uff1a\u30d7\u30e9\u30a4\u30de\u30eaHub\u7528 3. vnet_secondary\uff1a\u30bb\u30ab\u30f3\u30c0\u30eaHub\u7528 4. dns\uff1aPrivate DNS Zones\u7528</p> <p><code>enabled</code>\u304c<code>false</code>\u306e\u3084\u3064\u306f\u4f5c\u3089\u308c\u306a\u3044\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#hub_virtual_networks","title":"hub_virtual_networks\uff08\u30d7\u30e9\u30a4\u30de\u30ea\uff09","text":"<p>\u3053\u3053\u304c\u4e00\u756a\u9577\u3044\u3002\u30d7\u30e9\u30a4\u30de\u30eaHub\u306e\u5168\u8a2d\u5b9a\u304c\u5165\u3063\u3066\u308b\u3002</p> <pre><code>hub_virtual_networks = {\n  primary = {\n    location          = \"$${starter_location_01}\"\n    default_parent_id = \"$${primary_connectivity_resource_group_id}\"\n\n    enabled_resources = {\n      firewall                              = \"$${primary_firewall_enabled}\"\n      bastion                               = \"$${primary_bastion_enabled}\"\n      virtual_network_gateway_express_route = \"$${primary_virtual_network_gateway_express_route_enabled}\"\n      virtual_network_gateway_vpn           = \"$${primary_virtual_network_gateway_vpn_enabled}\"\n      private_dns_zones                     = \"$${primary_private_dns_zones_enabled}\"\n      private_dns_resolver                  = \"$${primary_private_dns_resolver_enabled}\"\n    }\n</code></pre> <p>enabled_resources \u3055\u3063\u304dPart 2\u3067\u8a2d\u5b9a\u3057\u305f\u6709\u52b9/\u7121\u52b9\u30d5\u30e9\u30b0\u304c\u3053\u3053\u3067\u4f7f\u308f\u308c\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#vnet","title":"VNet\u8a2d\u5b9a","text":"<pre><code>    hub_virtual_network = {\n      name                          = \"$${primary_virtual_network_name}\"\n      address_space                 = [\"$${primary_hub_virtual_network_address_space}\"]\n      routing_address_space         = [\"$${primary_hub_address_space}\"]\n      route_table_name_firewall     = \"$${primary_route_table_firewall_name}\"\n      route_table_name_user_subnets = \"$${primary_route_table_user_subnets_name}\"\n      subnets                       = {}\n    }\n</code></pre> <p>address_space vs routing_address_space - <code>address_space</code>\uff1aVNet\u5b9f\u969b\u306eIP\u7bc4\u56f2\uff08<code>10.0.0.0/22</code>\uff09 - <code>routing_address_space</code>\uff1a\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3067\u5e83\u544a\u3059\u308b\u7bc4\u56f2\uff08<code>10.0.0.0/16</code>\uff09</p> <p>\u5e83\u3044\u7bc4\u56f2\u3067\u5e83\u544a\u3057\u3066\u304a\u3044\u3066\u3001\u5f8c\u304b\u3089Spoke\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#firewall","title":"Firewall\u8a2d\u5b9a","text":"<pre><code>    firewall = {\n      subnet_address_prefix            = \"$${primary_firewall_subnet_address_prefix}\"\n      management_subnet_address_prefix = \"$${primary_firewall_management_subnet_address_prefix}\"\n      name                             = \"$${primary_firewall_name}\"\n      default_ip_configuration = {\n        public_ip_config = {\n          name = \"$${primary_firewall_public_ip_name}\"\n        }\n      }\n      management_ip_enabled = \"$${primary_firewall_management_ip_enabled}\"\n      management_ip_configuration = {\n        public_ip_config = {\n          name = \"$${primary_firewall_management_public_ip_name}\"\n        }\n      }\n    }\n</code></pre> <p>Firewall\u306b\u306f2\u3064\u306ePublic IP\u304c\u5fc5\u8981\uff1a 1. default_ip_configuration\uff1a\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u7528 2. management_ip_configuration\uff1a\u7ba1\u7406\u7528\uff08Basic SKU</p> <p>\u3067\u5fc5\u8981\uff09</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#vpnexpressroute-gateway","title":"VPN/ExpressRoute Gateway\u8a2d\u5b9a","text":"<pre><code>    virtual_network_gateways = {\n      subnet_address_prefix = \"$${primary_gateway_subnet_address_prefix}\"\n      express_route = {\n        name                                  = \"$${primary_virtual_network_gateway_express_route_name}\"\n        hosted_on_behalf_of_public_ip_enabled = \"$${primary_virtual_network_gateway_express_route_hobo_public_ip_enabled}\"\n        ip_configurations = {\n          default = {\n            public_ip = {\n              name = \"$${primary_virtual_network_gateway_express_route_public_ip_name}\"\n            }\n          }\n        }\n      }\n      vpn = {\n        name = \"$${primary_virtual_network_gateway_vpn_name}\"\n        ip_configurations = {\n          active_active_1 = {\n            public_ip = {\n              name = \"$${primary_virtual_network_gateway_vpn_public_ip_name_1}\"\n            }\n          }\n          active_active_2 = {\n            public_ip = {\n              name = \"$${primary_virtual_network_gateway_vpn_public_ip_name_2}\"\n            }\n          }\n        }\n      }\n    }\n</code></pre> <p>VPN Gateway\u306f**Active-Active**\uff082\u53f0\u69cb\u6210\uff09\u306b\u306a\u3063\u3066\u308b\u3002 ExpressRoute\u306f1\u53f0\u3060\u3051\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#bastion","title":"Bastion\u8a2d\u5b9a","text":"<pre><code>    bastion = {\n      subnet_address_prefix = \"$${primary_bastion_subnet_address_prefix}\"\n      name                  = \"$${primary_bastion_host_name}\"\n      zones                 = []\n      bastion_public_ip = {\n        name  = \"$${primary_bastion_host_public_ip_name}\"\n        zones = []\n      }\n    }\n</code></pre> <p>\u8d85\u91cd\u8981\uff01 <pre><code>zones = []\n</code></pre></p> <p>Japan East\u306fAvailability Zones\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u305f\u3081<code>[]</code>\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u5fd8\u308c\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#_3","title":"\u307e\u3068\u3081","text":"<p>\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\uff01platform-landing-zone.auto.tfvars\u306e\u5168\u4f53\u3092\u898b\u3066\u304d\u307e\u3057\u305f\u3002</p> <p>\u9577\u304b\u3063\u305f\u3067\u3059\u304c\u3001\u30d1\u30bf\u30fc\u30f3\u306f3\u3064\u3060\u3051\u3067\u3059\uff1a 1. \u540d\u524d\u306e\u5b9a\u7fa9\uff08<code>names</code>\u30bb\u30af\u30b7\u30e7\u30f3\uff09 2. \u6709\u52b9/\u7121\u52b9\u306e\u8a2d\u5b9a\uff08<code>xxx_enabled</code>\uff09 3. \u5b9f\u969b\u306e\u30ea\u30bd\u30fc\u30b9\u8a2d\u5b9a\uff08\u5404\u30bb\u30af\u30b7\u30e7\u30f3\uff09</p> <p>\u899a\u3048\u3066\u304a\u304f\u3079\u304d\u30dd\u30a4\u30f3\u30c8\uff1a - \u30ea\u30fc\u30b8\u30e7\u30f3\u306f<code>starter_locations</code>\u3067\u6c7a\u307e\u308a\u307e\u3059 - \u6709\u52b9/\u7121\u52b9\u306f<code>xxx_enabled = true/false</code>\u3067\u8a2d\u5b9a\u3057\u307e\u3059 - Japan East\u306f<code>zones = []</code>\u304c\u5fc5\u9808\u3067\u3059 - \u30b3\u30b9\u30c8\u524a\u6e1b\u3057\u305f\u3044\u306a\u3089Firewall\u3001VPN\u3001Bastion\u3092<code>false</code>\u306b\u8a2d\u5b9a\u3057\u307e\u3059</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#_4","title":"\u7df4\u7fd2\u554f\u984c","text":"<p>\u7406\u89e3\u5ea6\u30c1\u30a7\u30c3\u30af\u3067\u3059\u3002\u4f11\u61a9\u4e2d\u306b\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#1_2","title":"\u554f\u984c1","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u897f\u65e5\u672c\uff08japanwest\uff09\u3060\u3051\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u306b\u306f\u3001 <code>starter_locations</code>\u3092\u3069\u3046\u5909\u66f4\u3059\u308c\u3070\u3044\u3044\u3067\u3059\u304b\uff1f</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2_1","title":"\u554f\u984c2","text":"<p>Firewall\u3092\u7121\u52b9\u5316\u3057\u3066\u30b3\u30b9\u30c8\u3092\u524a\u6e1b\u3057\u305f\u3044\u5834\u5408\u3001 \u3069\u306e\u8a2d\u5b9a\u3092<code>false</code>\u306b\u5909\u66f4\u3059\u308c\u3070\u3044\u3044\u3067\u3059\u304b\uff1f\uff08\u5177\u4f53\u7684\u306a\u5909\u6570\u540d\u3092\u7b54\u3048\u3066\u304f\u3060\u3055\u3044\uff09</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#3_1","title":"\u554f\u984c3","text":"<p><code>management_resource_group_name = \"rg-management-$${starter_location_01}\"</code>\u3068\u3044\u3046\u8a2d\u5b9a\u3067\u3001 <code>starter_locations = [\"japaneast\", \"japanwest\"]</code>\u306e\u5834\u5408\u3001 \u5b9f\u969b\u306e\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u540d\u306f\u4f55\u306b\u306a\u308a\u307e\u3059\u304b\uff1f</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#_5","title":"\u7df4\u7fd2\u554f\u984c\u306e\u7b54\u3048","text":""},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#1_3","title":"\u7b54\u30481","text":"<p><pre><code>starter_locations = [\"japanwest\"]\n</code></pre> 1\u3064\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u3060\u3051\u6307\u5b9a\u3057\u307e\u3059\u3002\u30bb\u30ab\u30f3\u30c0\u30ea\u306f\u4e0d\u8981\u306a\u306e\u3067\u524a\u9664\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#2_2","title":"\u7b54\u30482","text":"<p><pre><code>primary_firewall_enabled = false\nsecondary_firewall_enabled = false\n</code></pre> \u30d7\u30e9\u30a4\u30de\u30ea\u3068\u30bb\u30ab\u30f3\u30c0\u30ea\u4e21\u65b9\u306eFirewall\u3092\u7121\u52b9\u5316\u3057\u307e\u3059\u3002 \u3053\u308c\u3067\u6708\u984d\u7d0428\u4e07\u5186\u306e\u30b3\u30b9\u30c8\u524a\u6e1b\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/#3_2","title":"\u7b54\u30483","text":"<p><pre><code>rg-management-japaneast\n</code></pre> <code>$${starter_location_01}</code>\u304c\u6700\u521d\u306e\u30ea\u30fc\u30b8\u30e7\u30f3<code>japaneast</code>\u306b\u7f6e\u304d\u63db\u308f\u308a\u307e\u3059\u3002</p> <p>\u6b21\u306eChapter\u3067\u306f\u3001<code>variables.tf</code>\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u3053\u306etfvars\u30d5\u30a1\u30a4\u30eb\u306e\u300c\u578b\u5b9a\u7fa9\u300d\u304c\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u304b\u89e3\u8aac\u3057\u307e\u3059\u3002</p> <p>\u6240\u8981\u6642\u9593: 60\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2605 \u524d: 02_\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020.md \u6b21: 04_\u5909\u6570\u5b9a\u7fa9.md</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/","title":"04. \u5909\u6570\u5b9a\u7fa9 - variables.tf\u306e\u8aad\u307f\u65b9","text":""},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>Chapter 3\u3067\u898b\u305f<code>platform-landing-zone.auto.tfvars</code>\uff08\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff09\u306e\u300c\u578b\u5b9a\u7fa9\u300d\u3092\u89e3\u8aac\u3059\u308b\u3002</p> <p>\u4f8b\u3048\u308b\u306a\u3089\uff1a - <code>platform-landing-zone.auto.tfvars</code>\uff1a\u6ce8\u6587\u5185\u5bb9\uff08\u300c\u30e9\u30fc\u30e1\u30f31\u3064\u3001\u9903\u5b502\u3064\u300d\uff09 - <code>variables.tf</code>\uff1a\u30e1\u30cb\u30e5\u30fc\uff08\u300c\u30e9\u30fc\u30e1\u30f3\u306f\u6587\u5b57\u5217\u3001\u9903\u5b50\u306f\u6570\u5024\u300d\uff09</p> <p>\u30e1\u30cb\u30e5\u30fc\u3092\u898b\u308c\u3070\u3001\u4f55\u304c\u6ce8\u6587\u3067\u304d\u308b\u304b\u3001\u3069\u3093\u306a\u5f62\u5f0f\u3067\u66f8\u3051\u3070\u3044\u3044\u304b\u308f\u304b\u308b\u3002</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#variablestf","title":"variables.tf\u306e\u5f79\u5272","text":"<p>3\u3064\u306e\u5f79\u5272\u304c\u3042\u308b\uff1a</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#1","title":"1. \u578b\u306e\u5b9a\u7fa9","text":"<pre><code>variable \"starter_locations\" {\n  type = list(string)  # \u2190\u6587\u5b57\u5217\u306e\u30ea\u30b9\u30c8\n}\n</code></pre> <p>\u300c\u3053\u308c\u306f\u6587\u5b57\u5217\u306e\u30ea\u30b9\u30c8\u3067\u3059\u300d\u3068\u5ba3\u8a00\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#2","title":"2. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>validation {\n  condition     = length(var.starter_locations) &gt; 0\n  error_message = \"\u6700\u4f4e1\u3064\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u5fc5\u8981\u3067\u3059\"\n}\n</code></pre> <p>\u9593\u9055\u3063\u305f\u5024\u304c\u5165\u3063\u3066\u305f\u3089\u30a8\u30e9\u30fc\u3092\u51fa\u3059\u3002</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#3","title":"3. \u30c7\u30d5\u30a9\u30eb\u30c8\u5024","text":"<pre><code>variable \"enable_telemetry\" {\n  type    = bool\n  default = true  # \u2190\u6307\u5b9a\u3057\u306a\u304b\u3063\u305f\u3089true\n}\n</code></pre> <p>\u5024\u3092\u6307\u5b9a\u3057\u306a\u304b\u3063\u305f\u6642\u306e\u521d\u671f\u5024\u3002</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#part-1","title":"Part 1: \u30ea\u30fc\u30b8\u30e7\u30f3\u8a2d\u5b9a","text":""},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#starter_locations","title":"starter_locations","text":"<pre><code>variable \"starter_locations\" {\n  type        = list(string)\n  description = \"The default for Azure resources. (e.g 'uksouth')\"\n\n  validation {\n    condition     = length(var.starter_locations) &gt; 0\n    error_message = \"You must provide at least one starter location region.\"\n  }\n\n  validation {\n    condition     = var.connectivity_type == \"none\" || ((length(var.virtual_hubs) &lt;= length(var.starter_locations)) || (length(var.hub_virtual_networks) &lt;= length(var.starter_locations)))\n    error_message = \"The number of regions supplied in `starter_locations` must match the number of regions specified for connectivity.\"\n  }\n}\n</code></pre> <p>\u5206\u89e3\u3057\u3066\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#type-liststring","title":"type = list(string)","text":"<pre><code>type = list(string)\n</code></pre> <p>\u610f\u5473\uff1a\u6587\u5b57\u5217\u306e\u30ea\u30b9\u30c8</p> <p>OK\u4f8b\uff1a <pre><code>starter_locations = [\"japaneast\", \"japanwest\"]  # \u2705\nstarter_locations = [\"eastus\"]                   # \u2705\n</code></pre></p> <p>NG\u4f8b\uff1a <pre><code>starter_locations = \"japaneast\"     # \u274c \u30ea\u30b9\u30c8\u3058\u3083\u306a\u3044\nstarter_locations = [123, 456]      # \u274c \u6587\u5b57\u5217\u3058\u3083\u306a\u3044\nstarter_locations = []              # \u274c \u7a7a\u306f\u30c0\u30e1\uff08\u6b21\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3067\u30a8\u30e9\u30fc\uff09\n</code></pre></p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#validation-1-1","title":"validation 1: \u6700\u4f4e1\u500b\u5fc5\u8981","text":"<pre><code>validation {\n  condition     = length(var.starter_locations) &gt; 0\n  error_message = \"You must provide at least one starter location region.\"\n}\n</code></pre> <p>\u30c1\u30a7\u30c3\u30af\u5185\u5bb9\uff1a - <code>length(var.starter_locations) &gt; 0</code>\uff1a\u30ea\u30b9\u30c8\u306e\u9577\u3055\u304c0\u3088\u308a\u5927\u304d\u3044\uff1f - \u3064\u307e\u308a\u3001\u6700\u4f4e1\u500b\u306f\u5165\u3063\u3066\u306a\u3044\u3068\u30c0\u30e1</p> <p>\u30a8\u30e9\u30fc\u4f8b\uff1a <pre><code>starter_locations = []  # \u274c\n\n# \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a\n# You must provide at least one starter location region.\n</code></pre></p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#validation-2-hub","title":"validation 2: Hub\u306e\u6570\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u6570\u304c\u5408\u3063\u3066\u308b\u304b","text":"<pre><code>validation {\n  condition     = var.connectivity_type == \"none\" || ((length(var.virtual_hubs) &lt;= length(var.starter_locations)) || (length(var.hub_virtual_networks) &lt;= length(var.starter_locations)))\n  error_message = \"The number of regions supplied in `starter_locations` must match the number of regions specified for connectivity.\"\n}\n</code></pre> <p>\u610f\u5473\uff1a - Hub VNet\u30922\u500b\u4f5c\u308b\u306a\u3089\u3001\u30ea\u30fc\u30b8\u30e7\u30f3\u30822\u500b\u6307\u5b9a\u3057\u3066\u306d - Hub VNet 3\u500b\u306a\u306e\u306b\u30ea\u30fc\u30b8\u30e7\u30f32\u500b\u3060\u3068\u8db3\u308a\u306a\u3044\u304b\u3089\u30a8\u30e9\u30fc</p> <p>\u4f8b\uff1a <pre><code># OK\nstarter_locations = [\"japaneast\", \"japanwest\"]\nhub_virtual_networks = {\n  primary = { ... }\n  secondary = { ... }\n}\n\n# NG\nstarter_locations = [\"japaneast\"]  # \u30ea\u30fc\u30b8\u30e7\u30f31\u500b\nhub_virtual_networks = {\n  primary = { ... }\n  secondary = { ... }  # Hub 2\u500b \u2192 \u8db3\u308a\u306a\u3044\uff01\n}\n</code></pre></p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#starter_locations_short","title":"starter_locations_short","text":"<pre><code>variable \"starter_locations_short\" {\n  type        = map(string)\n  default     = {}\n  description = &lt;&lt;DESCRIPTION\nOptional overrides for the starter location short codes.\n...\nDESCRIPTION\n}\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u77ed\u7e2e\u30b3\u30fc\u30c9\u3092\u624b\u52d5\u3067\u6307\u5b9a\u3057\u305f\u3044\u6642\u306b\u4f7f\u3046\u3002</p> <p>\u30c7\u30d5\u30a9\u30eb\u30c8\u52d5\u4f5c\uff1a - <code>japaneast</code> \u2192 <code>jpe</code>\uff08\u81ea\u52d5\u751f\u6210\uff09 - <code>japanwest</code> \u2192 <code>jpw</code>\uff08\u81ea\u52d5\u751f\u6210\uff09</p> <p>\u624b\u52d5\u3067\u5909\u3048\u305f\u3044\u5834\u5408\uff1a <pre><code>starter_locations_short = {\n  starter_location_01_short = \"je\"   # jpe\u3058\u3083\u306a\u304f\u3066je\u306b\u3057\u305f\u3044\n  starter_location_02_short = \"jw\"   # jpw\u3058\u3083\u306a\u304f\u3066jw\u306b\u3057\u305f\u3044\n}\n</code></pre></p> <p>\u666e\u901a\u306f\u4f7f\u308f\u306a\u3044\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5341\u5206\u3002</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#part-2-id","title":"Part 2: \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID","text":""},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#subscription_ids","title":"subscription_ids\uff08\u65b0\u3057\u3044\u65b9\u5f0f\uff09","text":"<pre><code>variable \"subscription_ids\" {\n  description = \"The list of subscription IDs to deploy the Platform Landing Zones into\"\n  type        = map(string)\n  default     = {}\n  nullable    = false\n\n  validation {\n    condition     = length(var.subscription_ids) == 0 || alltrue([for id in values(var.subscription_ids) : can(regex(\"^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$\", id))])\n    error_message = \"All subscription IDs must be valid GUIDs\"\n  }\n\n  validation {\n    condition     = length(var.subscription_ids) == 0 || alltrue([for id in keys(var.subscription_ids) : contains([\"management\", \"connectivity\", \"identity\", \"security\"], id)])\n    error_message = \"The keys of the subscription_ids map must be one of 'management', 'connectivity', 'identity' or 'security'\"\n  }\n}\n</code></pre> <p>type = map(string) \u30ad\u30fc\u3068\u5024\u306e\u30da\u30a2\u3002</p> <p>\u4f7f\u3044\u65b9\uff1a <pre><code>subscription_ids = {\n  management   = \"12345678-1234-1234-1234-123456789012\"\n  connectivity = \"87654321-4321-4321-4321-210987654321\"\n  identity     = \"11111111-2222-3333-4444-555555555555\"\n  security     = \"99999999-8888-7777-6666-555555555555\"\n}\n</code></pre></p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#validation-1-guid","title":"validation 1: GUID\u5f62\u5f0f\u30c1\u30a7\u30c3\u30af","text":"<pre><code>validation {\n  condition     = length(var.subscription_ids) == 0 || alltrue([for id in values(var.subscription_ids) : can(regex(\"^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$\", id))])\n  error_message = \"All subscription IDs must be valid GUIDs\"\n}\n</code></pre> <p>\u30c1\u30a7\u30c3\u30af\u5185\u5bb9\uff1a - \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID\u304c\u6b63\u3057\u3044GUID\u5f62\u5f0f\u304b\uff1f - <code>xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</code>\u306e\u5f62\u5f0f</p> <p>NG\u4f8b\uff1a <pre><code>subscription_ids = {\n  management = \"abc\"  # \u274c GUID\u5f62\u5f0f\u3058\u3083\u306a\u3044\n}\n\n# \u30a8\u30e9\u30fc: All subscription IDs must be valid GUIDs\n</code></pre></p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#validation-2","title":"validation 2: \u30ad\u30fc\u540d\u30c1\u30a7\u30c3\u30af","text":"<pre><code>validation {\n  condition     = length(var.subscription_ids) == 0 || alltrue([for id in keys(var.subscription_ids) : contains([\"management\", \"connectivity\", \"identity\", \"security\"], id)])\n  error_message = \"The keys of the subscription_ids map must be one of 'management', 'connectivity', 'identity' or 'security'\"\n}\n</code></pre> <p>\u30c1\u30a7\u30c3\u30af\u5185\u5bb9\uff1a \u30ad\u30fc\u540d\u306f<code>management</code>\u3001<code>connectivity</code>\u3001<code>identity</code>\u3001<code>security</code>\u306e\u3069\u308c\u304b\u3058\u3083\u306a\u3044\u3068\u30c0\u30e1\u3002</p> <p>NG\u4f8b\uff1a <pre><code>subscription_ids = {\n  production = \"12345678-...\"  # \u274c production\u306f\u4f7f\u3048\u306a\u3044\n}\n\n# \u30a8\u30e9\u30fc: The keys of the subscription_ids map must be one of 'management', 'connectivity', 'identity' or 'security'\n</code></pre></p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#subscription_id_connectivity","title":"subscription_id_connectivity\uff08\u53e4\u3044\u65b9\u5f0f\uff09","text":"<pre><code>variable \"subscription_id_connectivity\" {\n  description = \"DEPRECATED (use subscription_ids instead): The identifier of the Connectivity Subscription\"\n  type        = string\n  default     = null\n\n  validation {\n    condition     = var.subscription_id_connectivity == null || can(regex(\"^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$\", var.subscription_id_connectivity))\n    error_message = \"The subscription ID must be a valid GUID\"\n  }\n}\n</code></pre> <p>**DEPRECATED**\u3063\u3066\u66f8\u3044\u3066\u3042\u308b\u3067\u3057\u3087\uff1f \u3053\u308c\u306f\u53e4\u3044\u65b9\u5f0f\u3002\u4f7f\u308f\u306a\u3044\u3067\u3002</p> <p>\u6614\u306f\u3053\u3046\u66f8\u3044\u3066\u305f\uff1a <pre><code># \u53e4\u3044\u65b9\u5f0f\uff08\u4f7f\u308f\u306a\u3044\u3067\uff09\nsubscription_id_connectivity = \"12345678-...\"\nsubscription_id_management   = \"87654321-...\"\nsubscription_id_identity     = \"11111111-...\"\n</code></pre></p> <p>\u4eca\u306f\u3053\u3046\uff1a <pre><code># \u65b0\u3057\u3044\u65b9\u5f0f\uff08\u3053\u3063\u3061\u4f7f\u3063\u3066\uff09\nsubscription_ids = {\n  connectivity = \"12345678-...\"\n  management   = \"87654321-...\"\n  identity     = \"11111111-...\"\n}\n</code></pre></p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#part-3","title":"Part 3: \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u8a2d\u5b9a","text":""},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#root_parent_management_group_id","title":"root_parent_management_group_id","text":"<pre><code>variable \"root_parent_management_group_id\" {\n  type        = string\n  default     = \"\"\n  description = \"This is the id of the management group that the ALZ hierarchy will be nested under, will default to the Tenant Root Group\"\n}\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f Landing Zones\u306e\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u968e\u5c64\u3092\u3001\u3069\u3053\u306b\u3076\u3089\u4e0b\u3052\u308b\u304b\u3002</p> <p>\u30c7\u30d5\u30a9\u30eb\u30c8\uff08<code>\"\"</code>\uff09\uff1a <pre><code>Tenant Root Group\uff08\u30c6\u30ca\u30f3\u30c8\u30eb\u30fc\u30c8\uff09\n  \u2514\u2500\u2500 ALZ\u306e\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u968e\u5c64\n</code></pre></p> <p>\u65e2\u5b58\u306e\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u4e0b\u306b\u4f5c\u308a\u305f\u3044\u5834\u5408\uff1a <pre><code>root_parent_management_group_id = \"/providers/Microsoft.Management/managementGroups/my-company\"\n\n# \u7d50\u679c\nmy-company\n  \u2514\u2500\u2500 ALZ\u306e\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u968e\u5c64\n</code></pre></p> <p>\u666e\u901a\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067OK\u3002</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#part-4","title":"Part 4: \u305d\u306e\u4ed6\u306e\u8a2d\u5b9a","text":""},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#enable_telemetry","title":"enable_telemetry","text":"<pre><code>variable \"enable_telemetry\" {\n  type        = bool\n  default     = true\n  description = \"Flag to enable/disable telemetry\"\n}\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f Microsoft\u306b\u4f7f\u7528\u72b6\u6cc1\u30c7\u30fc\u30bf\u3092\u9001\u308b\u304b\u3069\u3046\u304b\u3002</p> <p>true\uff1a\u533f\u540d\u30c7\u30fc\u30bf\u3092\u9001\u308b\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09 false\uff1a\u9001\u3089\u306a\u3044</p> <p>\u7121\u52b9\u306b\u3057\u305f\u3044\u5834\u5408\uff1a <pre><code>enable_telemetry = false\n</code></pre></p> <p>\u500b\u4eba\u60c5\u5831\u306f\u9001\u3089\u308c\u306a\u3044\u304b\u3089\u3001true\u306e\u307e\u307e\u3067\u3044\u3044\u3068\u601d\u3046\u3002</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#custom_replacements","title":"custom_replacements","text":"<pre><code>variable \"custom_replacements\" {\n  type = object({\n    names                      = optional(map(string), {})\n    resource_group_identifiers = optional(map(string), {})\n    resource_identifiers       = optional(map(string), {})\n  })\n  default = {\n    names                      = {}\n    resource_group_identifiers = {}\n    resource_identifiers       = {}\n  }\n  description = \"Custom replacements\"\n}\n</code></pre> <p>\u578b\u304c\u8907\u96d1\uff01 <code>object</code>\u578b\u3067\u3001\u4e2d\u306b3\u3064\u306e<code>map(string)</code>\u304c\u5165\u3063\u3066\u308b\u3002</p> <p>object\u578b\u3068\u306f\uff1f JavaScript\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u307f\u305f\u3044\u306a\u3084\u3064\u3002</p> <pre><code>custom_replacements = {\n  names = {\n    firewall_name = \"fw-custom-name\"\n  }\n  resource_group_identifiers = {\n    ...\n  }\n  resource_identifiers = {\n    ...\n  }\n}\n</code></pre> <p>**optional**\u3063\u3066\u4f55\uff1f - <code>optional(map(string), {})</code>\uff1a\u7701\u7565\u53ef\u80fd\u3002\u7701\u7565\u3057\u305f\u3089\u7a7a\u30de\u30c3\u30d7<code>{}</code>\u306b\u306a\u308b</p> <p>\u3064\u307e\u308a\u3001\u3053\u308c\u3067\u3082OK\uff1a <pre><code>custom_replacements = {\n  names = {\n    firewall_name = \"fw-custom-name\"\n  }\n  # resource_group_identifiers\u7701\u7565\n  # resource_identifiers\u7701\u7565\n}\n</code></pre></p> <p>Chapter 3\u3067\u898b\u305f\u8a2d\u5b9a\u304c\u3001\u3053\u3053\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u308b\u308f\u3051\u3002</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#tags","title":"tags","text":"<pre><code>variable \"tags\" {\n  type        = map(string)\n  default     = null\n  description = \"(Optional) Tags of the resource.\"\n}\n</code></pre> <p>\u578b\uff1a<code>map(string)</code>\uff08\u30ad\u30fc\u3068\u5024\u306e\u30da\u30a2\uff09 \u30c7\u30d5\u30a9\u30eb\u30c8\uff1a<code>null</code>\uff08\u4f55\u3082\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070\u30bf\u30b0\u306a\u3057\uff09</p> <p>\u4f7f\u3044\u65b9\uff1a <pre><code>tags = {\n  environment = \"production\"\n  cost_center = \"IT\"\n  owner       = \"platform-team\"\n}\n</code></pre></p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#part-5","title":"Part 5: \u5909\u6570\u306e\u578b\u307e\u3068\u3081","text":"<p>Terraform\u3067\u3088\u304f\u4f7f\u3046\u578b\u3092\u307e\u3068\u3081\u3068\u304f\u306d\u3002</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_1","title":"\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u578b\uff08\u57fa\u672c\u578b\uff09","text":""},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#string","title":"string\uff08\u6587\u5b57\u5217\uff09","text":"<pre><code>variable \"name\" {\n  type = string\n}\n\n# \u4f7f\u3044\u65b9\nname = \"my-resource\"\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#number","title":"number\uff08\u6570\u5024\uff09","text":"<pre><code>variable \"count\" {\n  type = number\n}\n\n# \u4f7f\u3044\u65b9\ncount = 3\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#bool","title":"bool\uff08\u771f\u507d\u5024\uff09","text":"<pre><code>variable \"enabled\" {\n  type = bool\n}\n\n# \u4f7f\u3044\u65b9\nenabled = true\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_2","title":"\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u578b\uff08\u8907\u6570\u306e\u5024\uff09","text":""},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#list","title":"list\uff08\u30ea\u30b9\u30c8\uff09","text":"<pre><code>variable \"locations\" {\n  type = list(string)\n}\n\n# \u4f7f\u3044\u65b9\nlocations = [\"japaneast\", \"japanwest\"]\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#map","title":"map\uff08\u30de\u30c3\u30d7\uff09","text":"<pre><code>variable \"tags\" {\n  type = map(string)\n}\n\n# \u4f7f\u3044\u65b9\ntags = {\n  env = \"prod\"\n  app = \"web\"\n}\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#set","title":"set\uff08\u30bb\u30c3\u30c8\uff09","text":"<pre><code>variable \"unique_items\" {\n  type = set(string)\n}\n\n# \u4f7f\u3044\u65b9\nunique_items = [\"a\", \"b\", \"c\"]  # \u91cd\u8907\u306f\u81ea\u52d5\u524a\u9664\u3055\u308c\u308b\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_3","title":"\u69cb\u9020\u578b\uff08\u8907\u96d1\u306a\u69cb\u9020\uff09","text":""},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#object","title":"object\uff08\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff09","text":"<pre><code>variable \"vm_config\" {\n  type = object({\n    name = string\n    size = string\n    enabled = bool\n  })\n}\n\n# \u4f7f\u3044\u65b9\nvm_config = {\n  name = \"my-vm\"\n  size = \"Standard_B2s\"\n  enabled = true\n}\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#optional","title":"optional\uff08\u7701\u7565\u53ef\u80fd\uff09","text":"<pre><code>variable \"config\" {\n  type = object({\n    name = string\n    tags = optional(map(string), {})  # \u7701\u7565\u53ef\u3002\u7701\u7565\u3057\u305f\u3089{}\n  })\n}\n\n# \u4f7f\u3044\u65b91: \u5168\u90e8\u6307\u5b9a\nconfig = {\n  name = \"test\"\n  tags = {env = \"dev\"}\n}\n\n# \u4f7f\u3044\u65b92: tags\u7701\u7565\nconfig = {\n  name = \"test\"\n  # tags\u7701\u7565 \u2192 \u81ea\u52d5\u3067{}\u306b\u306a\u308b\n}\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_4","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u66f8\u304d\u65b9","text":""},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_5","title":"\u57fa\u672c\u30d1\u30bf\u30fc\u30f3","text":"<pre><code>variable \"example\" {\n  type = string\n\n  validation {\n    condition     = \u6761\u4ef6\u5f0f\n    error_message = \"\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\"\n  }\n}\n</code></pre> <p>condition\u304cfalse\u306b\u306a\u3063\u305f\u3089\u30a8\u30e9\u30fc</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_6","title":"\u3088\u304f\u4f7f\u3046\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_7","title":"\u9577\u3055\u30c1\u30a7\u30c3\u30af","text":"<pre><code>validation {\n  condition     = length(var.my_list) &gt; 0\n  error_message = \"\u30ea\u30b9\u30c8\u306f\u6700\u4f4e1\u500b\u5fc5\u8981\"\n}\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_8","title":"\u6b63\u898f\u8868\u73fe\u30c1\u30a7\u30c3\u30af","text":"<pre><code>validation {\n  condition     = can(regex(\"^[a-z0-9-]+$\", var.name))\n  error_message = \"\u540d\u524d\u306f\u5c0f\u6587\u5b57\u3001\u6570\u5b57\u3001\u30cf\u30a4\u30d5\u30f3\u306e\u307f\"\n}\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_9","title":"\u5024\u306e\u7bc4\u56f2\u30c1\u30a7\u30c3\u30af","text":"<pre><code>validation {\n  condition     = var.count &gt;= 1 &amp;&amp; var.count &lt;= 10\n  error_message = \"count\u306f1\u301c10\u306e\u9593\"\n}\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_10","title":"\u9078\u629e\u80a2\u30c1\u30a7\u30c3\u30af","text":"<pre><code>validation {\n  condition     = contains([\"dev\", \"stg\", \"prod\"], var.environment)\n  error_message = \"environment\u306fdev\u3001stg\u3001prod\u306e\u3069\u308c\u304b\"\n}\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_11","title":"\u30ea\u30b9\u30c8\u5168\u8981\u7d20\u30c1\u30a7\u30c3\u30af","text":"<pre><code>validation {\n  condition     = alltrue([for item in var.items : length(item) &gt; 3])\n  error_message = \"\u5168\u3066\u306e\u8981\u7d20\u306f4\u6587\u5b57\u4ee5\u4e0a\"\n}\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_12","title":"\u5b9f\u8df5\uff1a\u81ea\u5206\u3067\u5909\u6570\u3092\u8ffd\u52a0\u3057\u3066\u307f\u3088\u3046","text":"<p>\u4f8b\u3048\u3070\u3001\u300cFirewall\u306e\u540d\u524d\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305f\u3044\u300d\u3063\u3066\u6642\u3002</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#1-variablestf","title":"1. variables.tf\u306b\u8ffd\u52a0","text":"<pre><code>variable \"custom_firewall_name\" {\n  type        = string\n  default     = null\n  description = \"Custom name for the firewall\"\n\n  validation {\n    condition     = var.custom_firewall_name == null || can(regex(\"^fw-[a-z0-9-]+$\", var.custom_firewall_name))\n    error_message = \"Firewall name must start with 'fw-' and contain only lowercase letters, numbers, and hyphens\"\n  }\n}\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#2-platform-landing-zoneautotfvars","title":"2. platform-landing-zone.auto.tfvars\u3067\u4f7f\u3046","text":"<pre><code>custom_firewall_name = \"fw-my-custom-firewall\"\n</code></pre>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#3-maintf","title":"3. main.tf\u3067\u53c2\u7167","text":"<pre><code>resource \"azurerm_firewall\" \"example\" {\n  name = var.custom_firewall_name != null ? var.custom_firewall_name : \"fw-default\"\n  ...\n}\n</code></pre> <p>\u7c21\u5358\u3067\u3057\u3087\uff1f</p>"},{"location":"04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/#_13","title":"\u307e\u3068\u3081","text":"<p>variables.tf\u306e\u5f79\u5272\uff1a 1. \u578b\u5b9a\u7fa9\uff1a\u3069\u3093\u306a\u30c7\u30fc\u30bf\u578b\u304b 2. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff1a\u9593\u9055\u3063\u305f\u5024\u3092\u30c1\u30a7\u30c3\u30af 3. \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\uff1a\u7701\u7565\u6642\u306e\u521d\u671f\u5024</p> <p>\u3088\u304f\u4f7f\u3046\u578b\uff1a - <code>string</code>\u3001<code>number</code>\u3001<code>bool</code>\uff1a\u57fa\u672c\u578b - <code>list(type)</code>\u3001<code>map(type)</code>\uff1a\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u578b - <code>object({...})</code>\uff1a\u69cb\u9020\u578b - <code>optional(type, default)</code>\uff1a\u7701\u7565\u53ef\u80fd</p> <p>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff1a - <code>length()</code>\u3001<code>can()</code>\u3001<code>regex()</code>\u3001<code>contains()</code>\u3001<code>alltrue()</code></p> <p>\u6b21\u306eChapter\u3067\u306f\u3001<code>locals.tf</code>\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u5909\u6570\u3092**\u8a08\u7b97\u30fb\u52a0\u5de5**\u3059\u308b\u30ed\u30b8\u30c3\u30af\u304c\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u304b\u89e3\u8aac\u3057\u307e\u3059\u3002</p> <p>\u6240\u8981\u6642\u9593: 35\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2606\u2606 \u524d: 03_\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5b8c\u5168\u89e3\u8aac.md \u6b21: 05_\u30ed\u30fc\u30ab\u30eb\u5909\u6570.md</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/","title":"05. \u30ed\u30fc\u30ab\u30eb\u5909\u6570 - locals.tf\u306e\u5f79\u5272","text":""},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p><code>locals.tf</code>\u306e\u5f79\u5272\u3092\u7406\u89e3\u3059\u308b\u3002</p> <p>\u4f8b\u3048\u308b\u306a\u3089\uff1a - <code>variables.tf</code>\uff1a\u6750\u6599\uff08\u5375\u3001\u7802\u7cd6\u3001\u5c0f\u9ea6\u7c89\uff09 - <code>locals.tf</code>\uff1a\u4e0b\u3054\u3057\u3089\u3048\uff08\u5375\u3092\u6eb6\u304f\u3001\u6750\u6599\u3092\u6df7\u305c\u308b\uff09 - <code>main.tf</code>\uff1a\u8abf\u7406\uff08\u30aa\u30fc\u30d6\u30f3\u3067\u713c\u304f\uff09</p> <p>\u5909\u6570\u3092\u305d\u306e\u307e\u307e\u4f7f\u3046\u3093\u3058\u3083\u306a\u304f\u3066\u3001\u8a08\u7b97\u30fb\u52a0\u5de5\u3057\u3066\u304b\u3089\u4f7f\u3046\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#locals","title":"locals\uff08\u30ed\u30fc\u30ab\u30eb\u5909\u6570\uff09\u3068\u306f\uff1f","text":""},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#_1","title":"\u5b9a\u7fa9\u65b9\u6cd5","text":"<pre><code>locals {\n  project_name = \"alz\"\n  full_name    = \"${local.project_name}-${var.environment}\"\n}\n</code></pre> <p>\u4f7f\u3044\u65b9\uff1a <pre><code>resource \"azurerm_resource_group\" \"example\" {\n  name     = local.full_name  # \u2190local.\u3067\u53c2\u7167\n  location = var.location     # \u2190\u5909\u6570\u306fvar.\u3067\u53c2\u7167\n}\n</code></pre></p> <p>\u30dd\u30a4\u30f3\u30c8\uff1a - \u5b9a\u7fa9\uff1a<code>locals { ... }</code>\uff08\u8907\u6570\u5f62\uff09 - \u53c2\u7167\uff1a<code>local.xxx</code>\uff08\u5358\u6570\u5f62\uff09</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#variables","title":"variables\u3068\u306e\u9055\u3044","text":"<p>\u521d\u5fc3\u8005\u304c\u3088\u304f\u6df7\u4e71\u3059\u308b\u30dd\u30a4\u30f3\u30c8\u3067\u3059\u3002\u3057\u3063\u304b\u308a\u7406\u89e3\u3057\u307e\u3057\u3087\u3046\u3002</p> \u9805\u76ee variables.tf locals.tf \u5916\u90e8\u304b\u3089\u8a2d\u5b9a \u2705 \u3067\u304d\u308b \u274c \u3067\u304d\u306a\u3044 \u8a08\u7b97\u30fb\u52a0\u5de5 \u274c \u3067\u304d\u306a\u3044 \u2705 \u3067\u304d\u308b \u53c2\u7167\u65b9\u6cd5 <code>var.xxx</code> <code>local.xxx</code> \u4f7f\u3046\u5834\u9762 \u30e6\u30fc\u30b6\u30fc\u304c\u8a2d\u5b9a\u3059\u308b\u5024 \u8a08\u7b97\u3057\u305f\u5024 \u5909\u66f4\u306e\u30bf\u30a4\u30df\u30f3\u30b0 \u5b9f\u884c\u6642\u306b\u6307\u5b9a \u30b3\u30fc\u30c9\u5185\u3067\u56fa\u5b9a <p>\u5177\u4f53\u4f8b\u3067\u7406\u89e3\u3059\u308b:</p> <pre><code># variables.tf\uff08\u30e6\u30fc\u30b6\u30fc\u304c\u6c7a\u3081\u308b\uff09\nvariable \"environment\" {\n  type = string\n  default = \"prod\"\n}\n\nvariable \"location\" {\n  type = string\n  default = \"japaneast\"\n}\n\n# locals.tf\uff08\u81ea\u52d5\u3067\u8a08\u7b97\u3059\u308b\uff09\nlocals {\n  # environment\u3068location\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u30ea\u30bd\u30fc\u30b9\u540d\u3092\u4f5c\u308b\n  resource_group_name = \"rg-${var.environment}-${var.location}\"\n  # \u2192 \"rg-prod-japaneast\"\n\n  # \u8907\u96d1\u306a\u6761\u4ef6\u5224\u5b9a\n  is_production = var.environment == \"prod\" ? true : false\n\n  # \u8a08\u7b97\u7d50\u679c\n  subnet_count = var.enable_vpn ? 5 : 4\n}\n</code></pre> <p>\u3069\u3063\u3061\u3092\u4f7f\u3048\u3070\u3044\u3044\u304b\u8ff7\u3063\u305f\u3089:</p> <pre><code>\u30e6\u30fc\u30b6\u30fc\u306b\u5909\u66f4\u3055\u305b\u305f\u3044\uff1f\n  YES \u2192 variables\n  NO  \u2192 locals\n</code></pre> <p>\ud83d\udcca \u51e6\u7406\u30d5\u30ed\u30fc\u306e\u8996\u899a\u5316</p> <pre><code>\u3010Terraform\u5b9f\u884c\u306e\u6d41\u308c\u3011\n\n1. \u5165\u529b\uff08variables\uff09\n   \u2193\n   var.environment = \"prod\"\n   var.location = \"japaneast\"\n   var.enable_vpn = true\n   \u2193\n\n2. \u52a0\u5de5\uff08locals\uff09\n   \u2193\n   local.resource_group_name = \"rg-prod-japaneast\"  \u2190 \u6587\u5b57\u5217\u7d50\u5408\n   local.is_production = true                        \u2190 \u6761\u4ef6\u5224\u5b9a\n   local.subnet_count = 5                            \u2190 \u8a08\u7b97\n   \u2193\n\n3. \u51fa\u529b\uff08resources\uff09\n   \u2193\n   resource \"azurerm_resource_group\" \"example\" {\n     name     = local.resource_group_name  \u2190 \u52a0\u5de5\u6e08\u307f\u306e\u5024\u3092\u4f7f\u3046\n     location = var.location               \u2190 \u5165\u529b\u5024\u3092\u305d\u306e\u307e\u307e\u4f7f\u3046\n   }\n</code></pre> <p>\ud83c\udfaf \u5177\u4f53\u4f8b\u3067\u3082\u3046\u4e00\u5ea6</p> <pre><code># \u2460 \u30e6\u30fc\u30b6\u30fc\u304b\u3089\u306e\u5165\u529b\nvariable \"project\" { default = \"webapp\" }\nvariable \"env\" { default = \"prod\" }\nvariable \"region\" { default = \"japaneast\" }\n\n# \u2461 locals \u3067\u52a0\u5de5\u30fb\u8a08\u7b97\nlocals {\n  # \u540d\u524d\u3092\u81ea\u52d5\u751f\u6210\n  resource_group_name = \"rg-${var.project}-${var.env}-${var.region}\"\n  # \u2192 \"rg-webapp-prod-japaneast\"\n\n  # \u30bf\u30b0\u3092\u81ea\u52d5\u751f\u6210\n  common_tags = {\n    Project     = var.project\n    Environment = var.env\n    ManagedBy   = \"Terraform\"\n  }\n\n  # \u672c\u756a\u74b0\u5883\u304b\u3069\u3046\u304b\u5224\u5b9a\n  is_production = var.env == \"prod\"\n\n  # \u672c\u756a\u306a\u30893\u53f0\u3001\u305d\u308c\u4ee5\u5916\u306f1\u53f0\n  vm_count = local.is_production ? 3 : 1\n}\n\n# \u2462 resources \u3067\u5b9f\u969b\u306b\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\nresource \"azurerm_resource_group\" \"main\" {\n  name     = local.resource_group_name  # \u2190 \u52a0\u5de5\u6e08\u307f\n  location = var.region                 # \u2190 \u305d\u306e\u307e\u307e\n  tags     = local.common_tags          # \u2190 \u52a0\u5de5\u6e08\u307f\n}\n</code></pre> <p>\u899a\u3048\u65b9: - variables: \u5165\u529b\uff08\u30e6\u30fc\u30b6\u30fc\u304c\u6c7a\u3081\u308b\uff09 - locals: \u51e6\u7406\uff08\u81ea\u52d5\u3067\u8a08\u7b97\uff09 - resources: \u51fa\u529b\uff08\u5b9f\u969b\u306b\u4f5c\u308b\uff09</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#part-1","title":"Part 1: \u5b9a\u6570\u5b9a\u7fa9","text":"<pre><code>locals {\n  const = {\n    connectivity = {\n      virtual_wan        = \"virtual_wan\"\n      hub_and_spoke_vnet = \"hub_and_spoke_vnet\"\n      none               = \"none\"\n    }\n  }\n}\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f \u5b9a\u6570\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\u30de\u30b8\u30c3\u30af\u30b9\u30c8\u30ea\u30f3\u30b0\uff08\u6587\u5b57\u5217\u76f4\u66f8\u304d\uff09\u3092\u907f\u3051\u308b\u305f\u3081\u3067\u3059\u3002</p> <p>\u60aa\u3044\u4f8b\uff1a <pre><code>if (var.connectivity_type == \"hub_and_spoke_vnet\") {  # \u2190\u30bf\u30a4\u30dd\u3057\u3084\u3059\u3044\n  ...\n}\n</code></pre></p> <p>\u826f\u3044\u4f8b\uff1a <pre><code>if (var.connectivity_type == local.const.connectivity.hub_and_spoke_vnet) {\n  # \u2190\u88dc\u5b8c\u304c\u52b9\u304f\u3001\u30bf\u30a4\u30dd\u3057\u305f\u3089\u30a8\u30e9\u30fc\u306b\u306a\u308b\n  ...\n}\n</code></pre></p> <p>\u5b9a\u7fa9\u3055\u308c\u3066\u308b\u5b9a\u6570\uff1a - <code>virtual_wan</code>\uff1aVirtual WAN\u4f7f\u3046 - <code>hub_and_spoke_vnet</code>\uff1aHub-and-Spoke\u4f7f\u3046 - <code>none</code>\uff1a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u3089\u306a\u3044</p> <p>\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e<code>enum</code>\u307f\u305f\u3044\u306a\u3082\u3093\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#part-2","title":"Part 2: \u63a5\u7d9a\u30bf\u30a4\u30d7\u306e\u5224\u5b9a","text":"<pre><code>locals {\n  connectivity_enabled                    = var.connectivity_type != local.const.connectivity.none\n  connectivity_virtual_wan_enabled        = var.connectivity_type == local.const.connectivity.virtual_wan\n  connectivity_hub_and_spoke_vnet_enabled = var.connectivity_type == local.const.connectivity.hub_and_spoke_vnet\n}\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f <code>connectivity_type</code>\u306e\u5024\u3092\u898b\u3066\u3001\u30d5\u30e9\u30b0\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#connectivity_enabled","title":"connectivity_enabled","text":"<pre><code>connectivity_enabled = var.connectivity_type != local.const.connectivity.none\n</code></pre> <p>\u610f\u5473\uff1a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u308b\u306e\uff1f</p> <p>\u4f8b\uff1a <pre><code># tfvars\nconnectivity_type = \"hub_and_spoke_vnet\"\n\n# \u7d50\u679c\nlocal.connectivity_enabled = true  # \u2190none\u3058\u3083\u306a\u3044\u304b\u3089true\n</code></pre></p> <pre><code># tfvars\nconnectivity_type = \"none\"\n\n# \u7d50\u679c\nlocal.connectivity_enabled = false  # \u2190none\u3060\u304b\u3089false\n</code></pre> <p>\u4f7f\u3044\u9053\uff1a <pre><code># \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u308b\u6642\u3060\u3051\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\nresource \"azurerm_xxx\" \"example\" {\n  count = local.connectivity_enabled ? 1 : 0\n  ...\n}\n</code></pre></p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#connectivity_virtual_wan_enabled","title":"connectivity_virtual_wan_enabled","text":"<pre><code>connectivity_virtual_wan_enabled = var.connectivity_type == local.const.connectivity.virtual_wan\n</code></pre> <p>\u610f\u5473\uff1aVirtual WAN\u4f7f\u3046\u306e\uff1f</p> <p>\u4f8b\uff1a <pre><code># tfvars\nconnectivity_type = \"virtual_wan\"\n\n# \u7d50\u679c\nlocal.connectivity_virtual_wan_enabled = true\n</code></pre></p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#connectivity_hub_and_spoke_vnet_enabled","title":"connectivity_hub_and_spoke_vnet_enabled","text":"<pre><code>connectivity_hub_and_spoke_vnet_enabled = var.connectivity_type == local.const.connectivity.hub_and_spoke_vnet\n</code></pre> <p>\u610f\u5473\uff1aHub-and-Spoke\u4f7f\u3046\u306e\uff1f</p> <p>\u4f8b\uff1a <pre><code># tfvars\nconnectivity_type = \"hub_and_spoke_vnet\"\n\n# \u7d50\u679c\nlocal.connectivity_hub_and_spoke_vnet_enabled = true\n</code></pre></p> <p>\u306a\u3093\u3067\u3053\u3093\u306a\u3053\u3068\u3059\u308b\u306e\uff1f</p> <p>main.tf\u3067\u6761\u4ef6\u5206\u5c90\u3057\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u3002</p> <pre><code># \u3053\u308c\u3088\u308a\nmodule \"virtual_wan\" {\n  count = var.connectivity_type == \"virtual_wan\" ? 1 : 0\n  ...\n}\n\n# \u3053\u3063\u3061\u306e\u65b9\u304c\u8aad\u307f\u3084\u3059\u3044\nmodule \"virtual_wan\" {\n  count = local.connectivity_virtual_wan_enabled ? 1 : 0\n  ...\n}\n</code></pre>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#part-3","title":"Part 3: \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u4f9d\u5b58\u95a2\u4fc2","text":"<pre><code>locals {\n  resource_groups = {\n    resource_groups = module.resource_groups\n  }\n  hub_and_spoke_networks_settings = merge(module.config.outputs.hub_and_spoke_networks_settings, local.resource_groups)\n  hub_virtual_networks            = (merge({ vnets = module.config.outputs.hub_virtual_networks }, local.resource_groups)).vnets\n  virtual_wan_settings            = merge(module.config.outputs.virtual_wan_settings, local.resource_groups)\n  virtual_hubs                    = (merge({ vhubs = module.config.outputs.virtual_hubs }, local.resource_groups)).vhubs\n}\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u3092\u5148\u306b\u4f5c\u3063\u3066\u304b\u3089\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u308b\u305f\u3081\u306e\u4ed5\u7d44\u307f\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#terraform","title":"Terraform\u306e\u4f9d\u5b58\u95a2\u4fc2","text":"<p>\u554f\u984c\uff1a <pre><code># \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\nresource \"azurerm_resource_group\" \"network\" {\n  name = \"rg-network\"\n}\n\n# VNet\nresource \"azurerm_virtual_network\" \"hub\" {\n  resource_group_name = azurerm_resource_group.network.name\n  # \u2191\u3053\u308c\u3067\u4f9d\u5b58\u95a2\u4fc2\u304c\u3067\u304d\u308b\uff08RG\u2192VNet\uff09\n}\n</code></pre></p> <p>\u3067\u3082\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u4f7f\u3063\u3066\u308b\u5834\u5408\u306f**\u660e\u793a\u7684\u306b\u4f9d\u5b58\u95a2\u4fc2\u3092\u66f8\u304f**\u5fc5\u8981\u304c\u3042\u308b\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#resource_groups","title":"resource_groups","text":"<pre><code>resource_groups = {\n  resource_groups = module.resource_groups\n}\n</code></pre> <p>\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u51fa\u529b\u3092\u4fdd\u5b58\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#merge","title":"merge\u95a2\u6570","text":"<pre><code>hub_and_spoke_networks_settings = merge(\n  module.config.outputs.hub_and_spoke_networks_settings,\n  local.resource_groups\n)\n</code></pre> <p>merge\u95a2\u6570\uff1a2\u3064\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30de\u30fc\u30b8\u3059\u308b</p> <p>\u30a4\u30e1\u30fc\u30b8\uff1a <pre><code># \u5143\u306e\u30c7\u30fc\u30bf\nhub_and_spoke_networks_settings = {\n  location = \"japaneast\"\n  cidr     = \"10.0.0.0/16\"\n}\n\n# \u30de\u30fc\u30b8\u5f8c\nhub_and_spoke_networks_settings = {\n  location = \"japaneast\"\n  cidr     = \"10.0.0.0/16\"\n  resource_groups = module.resource_groups  # \u2190\u8ffd\u52a0\n}\n</code></pre></p> <p>\u52b9\u679c\uff1a - <code>resource_groups</code>\u3092\u542b\u3081\u308b\u3053\u3068\u3067\u3001Terraform\u304c\u81ea\u52d5\u3067\u4f9d\u5b58\u95a2\u4fc2\u3092\u7406\u89e3\u3059\u308b - \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7 \u2192 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u9806\u756a\u3067\u4f5c\u3089\u308c\u308b</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#hub_virtual_networks","title":"hub_virtual_networks","text":"<pre><code>hub_virtual_networks = (merge({ vnets = module.config.outputs.hub_virtual_networks }, local.resource_groups)).vnets\n</code></pre> <p>**\u3061\u3087\u3063\u3068\u8907\u96d1**\u3060\u304b\u3089\u5206\u89e3\u3057\u3088\u3046\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#1-merge","title":"\u30b9\u30c6\u30c3\u30d71: merge\u3059\u308b","text":"<pre><code>merge(\n  { vnets = module.config.outputs.hub_virtual_networks },\n  local.resource_groups\n)\n\n# \u7d50\u679c\n{\n  vnets = { ... }\n  resource_groups = module.resource_groups\n}\n</code></pre>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#2-vnets","title":"\u30b9\u30c6\u30c3\u30d72: .vnets\u3067\u53d6\u308a\u51fa\u3059","text":"<pre><code>(...).vnets\n\n# \u7d50\u679c\n{ ... }  # \u2190vnets\u306e\u4e2d\u8eab\u3060\u3051\n</code></pre> <p>\u306a\u3093\u3067\u3053\u3093\u306a\u3053\u3068\u3059\u308b\u306e\uff1f - <code>resource_groups</code>\u3092\u542b\u3081\u3066\u4f9d\u5b58\u95a2\u4fc2\u3092\u4f5c\u308b - \u3067\u3082\u6700\u7d42\u7684\u306b\u306f<code>vnets</code>\u3060\u3051\u307b\u3057\u3044</p> <p>\u30c8\u30ea\u30c3\u30ad\u30fc\u3060\u3051\u3069\u3001Terraform\u306e\u4f9d\u5b58\u95a2\u4fc2\u30b7\u30b9\u30c6\u30e0\u3092\u6e80\u305f\u3059\u305f\u3081\u306e\u6280\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#part-4","title":"Part 4: \u30dd\u30ea\u30b7\u30fc\u306e\u4f9d\u5b58\u95a2\u4fc2","text":"<pre><code>locals {\n  management_group_dependencies = {\n    policy_assignments = [\n      module.management_resources,\n      module.hub_and_spoke_vnet,\n      module.virtual_wan\n    ]\n    policy_role_assignments = [\n      module.management_resources,\n      module.hub_and_spoke_vnet,\n      module.virtual_wan\n    ]\n  }\n}\n</code></pre> <p>\u3053\u308c\u306f\u4f55\uff1f \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306b\u30dd\u30ea\u30b7\u30fc\u3092\u5272\u308a\u5f53\u3066\u308b\u524d\u306b\u3001**\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5148\u306b\u4f5c\u308b**\u305f\u3081\u306e\u4ed5\u7d44\u307f\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#_2","title":"\u306a\u3093\u3067\u5fc5\u8981\u306a\u306e\uff1f","text":"<p>\u30b7\u30ca\u30ea\u30aa\uff1a 1. Log Analytics\u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u3092\u4f5c\u308b 2. \u30dd\u30ea\u30b7\u30fc\u3067\u300c\u5168\u30ea\u30bd\u30fc\u30b9\u306fLog Analytics\u306b\u30ed\u30b0\u9001\u4fe1\u300d\u3092\u8a2d\u5b9a</p> <p>\u554f\u984c\uff1a \u30dd\u30ea\u30b7\u30fc\u3092\u5148\u306b\u4f5c\u308b\u3068\u3001Log Analytics\u304c\u307e\u3060\u306a\u3044\u304b\u3089\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3002</p> <p>\u89e3\u6c7a\u7b56\uff1a <pre><code>policy_assignments = [\n  module.management_resources,  # \u2190\u3053\u308c\u3089\u3092\u5148\u306b\u4f5c\u308b\n  module.hub_and_spoke_vnet,\n  module.virtual_wan\n]\n</code></pre></p> <p>\u30ea\u30b9\u30c8\u306b\u542b\u3081\u308b\u3053\u3068\u3067\u3001Terraform\u304c\u9806\u756a\u3092\u7406\u89e3\u3059\u308b\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#policy_assignments-vs-policy_role_assignments","title":"policy_assignments vs policy_role_assignments","text":"<p>policy_assignments\uff1a \u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\u3092\u5272\u308a\u5f53\u3066\u308b\uff08\u300c\u30ed\u30b0\u9001\u4fe1\u3057\u306a\u3055\u3044\u300d\uff09</p> <p>policy_role_assignments\uff1a \u30dd\u30ea\u30b7\u30fc\u306e\u30de\u30cd\u30fc\u30b8\u30c9ID\u306b\u6a29\u9650\u3092\u4e0e\u3048\u308b\uff08\u300c\u30ed\u30b0\u9001\u4fe1\u3059\u308b\u6a29\u9650\u3042\u3052\u308b\u3088\u300d\uff09</p> <p>\u3069\u3063\u3061\u3082\u5148\u306b\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#part-5","title":"Part 5: \u6700\u7d42\u7684\u306a\u8a2d\u5b9a\u306e\u30de\u30fc\u30b8","text":""},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#management_group_settings","title":"management_group_settings","text":"<pre><code>locals {\n  management_group_settings = merge(\n    module.config.outputs.management_group_settings,\n    {\n      dependencies = local.management_group_dependencies\n    }\n  )\n}\n</code></pre> <p>\u3084\u3063\u3066\u308b\u3053\u3068\uff1a 1. <code>module.config</code>\u304b\u3089\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\u3092\u53d6\u5f97 2. <code>dependencies</code>\uff08\u4f9d\u5b58\u95a2\u4fc2\uff09\u3092\u8ffd\u52a0 3. \u30de\u30fc\u30b8\u3057\u3066\u6700\u7d42\u8a2d\u5b9a\u3092\u4f5c\u308b</p> <p>\u30a4\u30e1\u30fc\u30b8\uff1a <pre><code># \u5143\u306e\u8a2d\u5b9a\nmanagement_group_settings = {\n  root_name = \"alz\"\n  policies  = [ ... ]\n}\n\n# \u30de\u30fc\u30b8\u5f8c\nmanagement_group_settings = {\n  root_name    = \"alz\"\n  policies     = [ ... ]\n  dependencies = {  # \u2190\u8ffd\u52a0\n    policy_assignments = [ ... ]\n    policy_role_assignments = [ ... ]\n  }\n}\n</code></pre></p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#management_resource_settings","title":"management_resource_settings","text":"<pre><code>locals {\n  management_resource_settings = merge(\n    module.config.outputs.management_resource_settings,\n    {\n      tags = coalesce(module.config.outputs.management_resource_settings.tags, module.config.outputs.tags)\n    }\n  )\n}\n</code></pre> <p>**coalesce\u95a2\u6570**\u3063\u3066\u4f55\uff1f</p> <pre><code>coalesce(\u50241, \u50242, \u50243, ...)\n# \u2190\u6700\u521d\u306enull\u3058\u3083\u306a\u3044\u5024\u3092\u8fd4\u3059\n</code></pre> <p>\u4f8b\uff1a <pre><code>coalesce(null, null, \"hello\")  # \u2190\"hello\"\ncoalesce(\"first\", \"second\")    # \u2190\"first\"\n</code></pre></p> <p>\u3053\u306e\u5834\u5408\uff1a <pre><code>tags = coalesce(\n  module.config.outputs.management_resource_settings.tags,\n  module.config.outputs.tags\n)\n</code></pre></p> <p>\u610f\u5473\uff1a - \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u5c02\u7528\u306e\u30bf\u30b0\u304c\u3042\u308c\u3070\u305d\u308c\u3092\u4f7f\u3046 - \u306a\u3051\u308c\u3070\u5168\u4f53\u306e\u30bf\u30b0\u3092\u4f7f\u3046</p> <p>\u4f7f\u3044\u9053\uff1a <pre><code># \u5168\u4f53\u306e\u30bf\u30b0\ntags = {\n  environment = \"prod\"\n}\n\n# \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u5c02\u7528\u306e\u30bf\u30b0\uff08\u6307\u5b9a\u3057\u3066\u306a\u3044\uff09\nmanagement_resource_settings.tags = null\n\n# \u7d50\u679c\n# \u2193\u5168\u4f53\u306e\u30bf\u30b0\u304c\u4f7f\u308f\u308c\u308b\nmanagement_resource_settings.tags = { environment = \"prod\" }\n</code></pre></p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#localstf","title":"locals.tf\u306e\u30d1\u30bf\u30fc\u30f3\u307e\u3068\u3081","text":""},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#1","title":"\u30d1\u30bf\u30fc\u30f31: \u5b9a\u6570\u5b9a\u7fa9","text":"<pre><code>locals {\n  const = {\n    status = {\n      active   = \"active\"\n      inactive = \"inactive\"\n    }\n  }\n}\n\n# \u4f7f\u3044\u65b9\nstatus = local.const.status.active\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a\u30bf\u30a4\u30dd\u9632\u6b62\u3001\u88dc\u5b8c\u304c\u52b9\u304f</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#2","title":"\u30d1\u30bf\u30fc\u30f32: \u6761\u4ef6\u5206\u5c90","text":"<pre><code>locals {\n  is_production = var.environment == \"prod\"\n  instance_count = local.is_production ? 3 : 1\n}\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a\u8907\u96d1\u306a\u6761\u4ef6\u3092\u308f\u304b\u308a\u3084\u3059\u304f</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#3","title":"\u30d1\u30bf\u30fc\u30f33: \u30c7\u30fc\u30bf\u52a0\u5de5","text":"<pre><code>locals {\n  location_short = {\n    \"japaneast\" = \"jpe\"\n    \"japanwest\" = \"jpw\"\n  }\n\n  resource_name = \"${var.prefix}-${local.location_short[var.location]}\"\n}\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a\u5909\u63db\u30ed\u30b8\u30c3\u30af\u30921\u7b87\u6240\u306b\u96c6\u7d04</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#4","title":"\u30d1\u30bf\u30fc\u30f34: \u4f9d\u5b58\u95a2\u4fc2\u306e\u660e\u793a","text":"<pre><code>locals {\n  config_with_deps = merge(\n    var.config,\n    { dependencies = [module.base_resources] }\n  )\n}\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u9806\u5e8f\u3092\u5236\u5fa1</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#5","title":"\u30d1\u30bf\u30fc\u30f35: \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306e\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af","text":"<pre><code>locals {\n  tags = coalesce(var.custom_tags, var.default_tags)\n}\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a\u67d4\u8edf\u306a\u8a2d\u5b9a\u3001\u7701\u7565\u6642\u306e\u6319\u52d5\u3092\u5236\u5fa1</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#localstf_1","title":"\u5b9f\u8df5\uff1alocals.tf\u3092\u66f8\u3044\u3066\u307f\u3088\u3046","text":""},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#1_1","title":"\u4f8b1: \u74b0\u5883\u5225\u306e\u8a2d\u5b9a","text":"<pre><code># variables.tf\nvariable \"environment\" {\n  type = string\n}\n\n# locals.tf\nlocals {\n  env_config = {\n    dev = {\n      instance_size = \"Standard_B2s\"\n      instance_count = 1\n    }\n    prod = {\n      instance_size = \"Standard_D4s_v3\"\n      instance_count = 3\n    }\n  }\n\n  config = local.env_config[var.environment]\n}\n\n# main.tf\nresource \"azurerm_virtual_machine\" \"example\" {\n  count = local.config.instance_count\n  size  = local.config.instance_size\n  ...\n}\n</code></pre>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#2_1","title":"\u4f8b2: \u547d\u540d\u898f\u5247\u306e\u7d71\u4e00","text":"<pre><code># variables.tf\nvariable \"project\" { type = string }\nvariable \"environment\" { type = string }\nvariable \"location\" { type = string }\n\n# locals.tf\nlocals {\n  location_codes = {\n    \"japaneast\" = \"jpe\"\n    \"japanwest\" = \"jpw\"\n  }\n\n  naming_prefix = \"${var.project}-${var.environment}-${local.location_codes[var.location]}\"\n\n  resource_names = {\n    vnet          = \"${local.naming_prefix}-vnet\"\n    subnet        = \"${local.naming_prefix}-subnet\"\n    nsg           = \"${local.naming_prefix}-nsg\"\n    resource_group = \"rg-${local.naming_prefix}\"\n  }\n}\n\n# main.tf\nresource \"azurerm_resource_group\" \"example\" {\n  name = local.resource_names.resource_group\n}\n\nresource \"azurerm_virtual_network\" \"example\" {\n  name = local.resource_names.vnet\n}\n</code></pre>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#3_1","title":"\u4f8b3: \u6761\u4ef6\u4ed8\u304d\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210","text":"<pre><code># variables.tf\nvariable \"enable_monitoring\" { type = bool }\nvariable \"enable_backup\" { type = bool }\n\n# locals.tf\nlocals {\n  monitoring_enabled = var.enable_monitoring\n  backup_enabled     = var.enable_backup\n\n  # \u4e21\u65b9\u6709\u52b9\u306a\u5834\u5408\u306e\u307f\u9ad8\u5ea6\u306a\u76e3\u8996\u3092\u6709\u52b9\u5316\n  advanced_monitoring_enabled = local.monitoring_enabled &amp;&amp; local.backup_enabled\n}\n\n# main.tf\nresource \"azurerm_log_analytics_workspace\" \"example\" {\n  count = local.monitoring_enabled ? 1 : 0\n  ...\n}\n\nresource \"azurerm_recovery_services_vault\" \"example\" {\n  count = local.backup_enabled ? 1 : 0\n  ...\n}\n\nresource \"azurerm_monitor_diagnostic_setting\" \"advanced\" {\n  count = local.advanced_monitoring_enabled ? 1 : 0\n  ...\n}\n</code></pre>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#locals_1","title":"\u30c7\u30d0\u30c3\u30b0\u6280\uff1alocals \u306e\u5024\u3092\u78ba\u8a8d\u3059\u308b","text":"<p>output\u4f7f\u304a\u3046</p> <pre><code># outputs.tf\noutput \"debug_locals\" {\n  value = {\n    connectivity_enabled = local.connectivity_enabled\n    is_production        = local.is_production\n    resource_names       = local.resource_names\n  }\n}\n</code></pre> <p>\u5b9f\u884c\uff1a <pre><code>terraform plan\n\n# \u51fa\u529b\nOutputs:\n  debug_locals = {\n    connectivity_enabled = true\n    is_production = false\n    resource_names = {\n      vnet = \"myapp-dev-jpe-vnet\"\n      ...\n    }\n  }\n</code></pre></p> <p>\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u306e\u4e2d\u8eab\u304c\u898b\u3048\u308b\u304b\u3089\u3001\u30c7\u30d0\u30c3\u30b0\u304c\u697d\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#_3","title":"\u307e\u3068\u3081","text":"<p>locals.tf\u306e\u5f79\u5272\uff1a 1. \u5b9a\u6570\u5b9a\u7fa9\uff1a\u30de\u30b8\u30c3\u30af\u30b9\u30c8\u30ea\u30f3\u30b0\u3092\u907f\u3051\u308b 2. \u6761\u4ef6\u5224\u5b9a\uff1a\u30d5\u30e9\u30b0\u3092\u4f5c\u3063\u3066\u53ef\u8aad\u6027\u5411\u4e0a 3. \u4f9d\u5b58\u95a2\u4fc2\uff1a\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u9806\u5e8f\u3092\u5236\u5fa1 4. \u30c7\u30fc\u30bf\u52a0\u5de5\uff1a\u5909\u6570\u3092\u8a08\u7b97\u30fb\u5909\u63db 5. \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\uff1a\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u51e6\u7406</p> <p>\u899a\u3048\u3066\u304a\u304f\u3053\u3068\uff1a - \u5b9a\u7fa9\uff1a<code>locals { ... }</code>\uff08\u8907\u6570\u5f62\uff09 - \u53c2\u7167\uff1a<code>local.xxx</code>\uff08\u5358\u6570\u5f62\uff09 - \u5916\u90e8\u304b\u3089\u5024\u3092\u6e21\u305b\u306a\u3044\uff08\u5185\u90e8\u8a08\u7b97\u5c02\u7528\uff09 - <code>merge()</code>\u3001<code>coalesce()</code>\u3092\u4f7f\u3044\u3053\u306a\u305d\u3046</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#_4","title":"\u7df4\u7fd2\u554f\u984c","text":"<p>\u7406\u89e3\u5ea6\u30c1\u30a7\u30c3\u30af\u3067\u3059\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#1_2","title":"\u554f\u984c1","text":"<p>\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3067\u3001<code>local.resource_group_name</code>\u306e\u5024\u306f\u4f55\u306b\u306a\u308a\u307e\u3059\u304b\uff1f</p> <pre><code>variable \"environment\" {\n  default = \"prod\"\n}\n\nvariable \"location\" {\n  default = \"japaneast\"\n}\n\nlocals {\n  resource_group_name = \"rg-${var.environment}-${var.location}\"\n}\n</code></pre>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#2_2","title":"\u554f\u984c2","text":"<p><code>variables</code>\u3068<code>locals</code>\u306e\u9055\u3044\u3092\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \u3069\u3093\u306a\u6642\u306b<code>locals</code>\u3092\u4f7f\u3046\u3079\u304d\u3067\u3059\u304b\uff1f</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#3_2","title":"\u554f\u984c3","text":"<p>\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u306f\u4f55\u3092\u3057\u3066\u3044\u307e\u3059\u304b\uff1f</p> <pre><code>locals {\n  is_production = var.environment == \"prod\" ? true : false\n}\n</code></pre>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#_5","title":"\u7df4\u7fd2\u554f\u984c\u306e\u7b54\u3048","text":""},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#1_3","title":"\u7b54\u30481","text":"<pre><code>rg-prod-japaneast\n</code></pre> <p>\u6587\u5b57\u5217\u88dc\u9593\u3067<code>var.environment</code>\uff08prod\uff09\u3068<code>var.location</code>\uff08japaneast\uff09\u304c\u7d50\u5408\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#2_3","title":"\u7b54\u30482","text":"<p>\u9055\u3044: - <code>variables</code>: \u5916\u90e8\u304b\u3089\u5024\u3092\u53d7\u3051\u53d6\u308b\uff08\u30e6\u30fc\u30b6\u30fc\u304c\u8a2d\u5b9a\uff09 - <code>locals</code>: \u5185\u90e8\u3067\u8a08\u7b97\u3059\u308b\uff08\u81ea\u52d5\u3067\u6c7a\u307e\u308b\uff09</p> <p>locals\u3092\u4f7f\u3046\u3079\u304d\u6642: - \u8907\u6570\u306e\u5909\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u65b0\u3057\u3044\u5024\u3092\u4f5c\u308b\u6642 - \u6761\u4ef6\u5224\u5b9a\u3092\u3057\u3066\u5024\u3092\u6c7a\u3081\u308b\u6642 - \u540c\u3058\u8a08\u7b97\u3092\u7e70\u308a\u8fd4\u3057\u4f7f\u3046\u6642\uff08DRY\u539f\u5247\uff09</p>"},{"location":"05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/#3_3","title":"\u7b54\u30483","text":"<p>**\u4e09\u9805\u6f14\u7b97\u5b50**\u3092\u4f7f\u3063\u3066\u3001\u74b0\u5883\u304c\u672c\u756a\uff08prod\uff09\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002</p> <pre><code>var.environment == \"prod\" ? true : false\n         \u2191                  \u2191      \u2191\n      \u6761\u4ef6\u5f0f             \u771f\u306e\u5834\u5408 \u507d\u306e\u5834\u5408\n</code></pre> <ul> <li><code>environment</code>\u304c<code>\"prod\"</code>\u306a\u3089<code>true</code></li> <li>\u305d\u308c\u4ee5\u5916\u306a\u3089<code>false</code></li> </ul> <p>\u3053\u306e\u5024\u3092\u4f7f\u3063\u3066\u3001\u672c\u756a\u74b0\u5883\u3060\u3051\u7279\u5225\u306a\u8a2d\u5b9a\u3092\u9069\u7528\u3067\u304d\u307e\u3059\u3002</p> <p>**\u6b21\u306eChapter**\u3067\u3001<code>modules/config-templating/</code>\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u5909\u6570\u3092\u5b9f\u969b\u306e\u30ea\u30bd\u30fc\u30b9\u8a2d\u5b9a\u306b\u5909\u63db\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u3069\u3046\u52d5\u3044\u3066\u308b\u304b\u89e3\u8aac\u3059\u308b\u306d\u3002</p> <p>\u6240\u8981\u6642\u9593: 40\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2606\u2606 \u524d: 04_\u5909\u6570\u5b9a\u7fa9.md \u6b21: 06_\u8a2d\u5b9a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8.md</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/","title":"06. \u8a2d\u5b9a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 - config-templating\u30e2\u30b8\u30e5\u30fc\u30eb","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p><code>modules/config-templating/</code>\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3057\u3088\u3046\u3002</p> <p>\u4f8b\u3048\u308b\u306a\u3089\uff1a - Mad Libs\uff08\u7a74\u57cb\u3081\u30b2\u30fc\u30e0\uff09\u307f\u305f\u3044\u306a\u3084\u3064 - \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff1a\u300c\u4eca\u65e5\u306e\u5929\u6c17\u306f<code>{{weather}}</code>\u3060\u3088\u300d - \u5909\u6570\uff1a<code>weather = \"\u6674\u308c\"</code> - \u7d50\u679c\uff1a\u300c\u4eca\u65e5\u306e\u5929\u6c17\u306f\u6674\u308c\u3060\u3088\u300d</p> <p>\u3053\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5185\u306e<code>{{xxx}}</code>\u3092\u5b9f\u969b\u306e\u5024\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u308c\u308b\u3093\u3060\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#_1","title":"\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u69cb\u6210","text":"<pre><code>modules/config-templating/\n  \u251c\u2500\u2500 data.tf           # \u5916\u90e8\u30c7\u30fc\u30bf\u53d6\u5f97\n  \u251c\u2500\u2500 locals.config.tf  # \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\u306e\u30ed\u30b8\u30c3\u30af\n  \u251c\u2500\u2500 outputs.tf        # \u51e6\u7406\u7d50\u679c\u306e\u51fa\u529b\n  \u251c\u2500\u2500 terraform.tf      # \u30d0\u30fc\u30b8\u30e7\u30f3\u8a2d\u5b9a\n  \u2514\u2500\u2500 variables.tf      # \u5165\u529b\u5909\u6570\n</code></pre> <p>\u6d41\u308c\uff1a 1. <code>variables.tf</code>\uff1a\u5165\u529b\u3092\u53d7\u3051\u53d6\u308b 2. <code>data.tf</code>\uff1aAzure\u30ea\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u3092\u53d6\u5f97 3. <code>locals.config.tf</code>\uff1a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u51e6\u7406 4. <code>outputs.tf</code>\uff1a\u7d50\u679c\u3092\u51fa\u529b</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#part-1-variablestf","title":"Part 1: \u5165\u529b\u5909\u6570\uff08variables.tf\uff09","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#starter_locations","title":"starter_locations","text":"<pre><code>variable \"starter_locations\" {\n  type        = list(string)\n  description = \"The default for Azure resources. (e.g 'uksouth')\"\n}\n</code></pre> <p>\u4f8b\uff1a <pre><code>starter_locations = [\"japaneast\", \"japanwest\"]\n</code></pre></p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#subscription_id_xxx","title":"subscription_id_xxx","text":"<pre><code>variable \"subscription_id_connectivity\" {\n  type        = string\n  description = \"value of the subscription id for the Connectivity subscription\"\n}\n</code></pre> <p>4\u3064\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID\u3092\u53d7\u3051\u53d6\u308b\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#custom_replacements","title":"custom_replacements","text":"<pre><code>variable \"custom_replacements\" {\n  type = object({\n    names                      = optional(map(string), {})\n    resource_group_identifiers = optional(map(string), {})\n    resource_identifiers       = optional(map(string), {})\n  })\n}\n</code></pre> <p>Chapter 3\u3067\u898b\u305f<code>custom_replacements</code>\u3092\u305d\u306e\u307e\u307e\u53d7\u3051\u53d6\u308b\u3093\u3060\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#inputs","title":"inputs","text":"<pre><code>variable \"inputs\" {\n  type        = any\n  description = \"A map of input variables\"\n}\n</code></pre> <p>type = any\uff1a\u4f55\u3067\u3082\u53d7\u3051\u53d6\u308c\u308b</p> <p>\u3053\u306e<code>inputs</code>\u306e\u4e2d\u8eab\u304c\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\u3055\u308c\u308b\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#part-2-datatf","title":"Part 2: \u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\uff08data.tf\uff09","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#regions","title":"regions \u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>module \"regions\" {\n  source           = \"Azure/avm-utl-regions/azurerm\"\n  version          = \"0.9.2\"\n  use_cached_data  = false\n  enable_telemetry = var.enable_telemetry\n}\n</code></pre> <p>\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f Azure\u306e\u5168\u30ea\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>\u53d6\u5f97\u3067\u304d\u308b\u60c5\u5831\uff1a - <code>geo_code</code>\uff1a\u5730\u7406\u30b3\u30fc\u30c9\uff08\u4f8b\uff1a<code>jp</code>\u3001<code>us</code>\uff09 - <code>short_name</code>\uff1a\u77ed\u7e2e\u540d\uff08\u4f8b\uff1a<code>jpe</code>\u3001<code>jpw</code>\uff09 - <code>display_name</code>\uff1a\u8868\u793a\u540d\uff08\u4f8b\uff1a<code>Japan East</code>\uff09</p> <p>\u4f7f\u3044\u9053\uff1a <pre><code># japaneast\u306egeo_code\nmodule.regions.regions_by_name[\"japaneast\"].geo_code  # \u2190\"jp\"\n\n# japaneast\u306eshort_name\nmodule.regions.regions_by_name[\"japaneast\"].short_name  # \u2190\"jpe\"\n</code></pre></p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#azurerm_client_config","title":"azurerm_client_config","text":"<pre><code>data \"azurerm_client_config\" \"current\" {}\n</code></pre> <p>\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f \u73fe\u5728\u306eAzure\u63a5\u7d9a\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>\u53d6\u5f97\u3067\u304d\u308b\u60c5\u5831\uff1a - <code>tenant_id</code>\uff1a\u30c6\u30ca\u30f3\u30c8ID - <code>subscription_id</code>\uff1a\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#part-3-localsconfigtf","title":"Part 3: \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\uff08locals.config.tf\uff09","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#1","title":"\u30b9\u30c6\u30c3\u30d71: \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u30de\u30c3\u30d4\u30f3\u30b0","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#starter_locations_1","title":"starter_locations","text":"<pre><code>locals {\n  starter_locations = {\n    for i, location in var.starter_locations :\n    \"starter_location_${format(\"%02d\", i + 1)}\" =&gt; location\n  }\n}\n</code></pre> <p>\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f \u30ea\u30b9\u30c8\u3092\u30de\u30c3\u30d7\u306b\u5909\u63db\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>\u4f8b\uff1a <pre><code># \u5165\u529b\nvar.starter_locations = [\"japaneast\", \"japanwest\"]\n\n# \u51fa\u529b\nlocal.starter_locations = {\n  \"starter_location_01\" = \"japaneast\"\n  \"starter_location_02\" = \"japanwest\"\n}\n</code></pre></p> <p>format(\"%02d\", i + 1)\uff1a - <code>%02d</code>\uff1a2\u6841\u306e\u6570\u5b57\u3001\u8db3\u308a\u306a\u3051\u308c\u30700\u57cb\u3081 - <code>i + 1</code>\uff1a0\u59cb\u307e\u308a\u30921\u59cb\u307e\u308a\u306b\u5909\u63db</p> <pre><code>format(\"%02d\", 1)   # \u2190\"01\"\nformat(\"%02d\", 2)   # \u2190\"02\"\nformat(\"%02d\", 15)  # \u2190\"15\"\n</code></pre>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#starter_locations_short","title":"starter_locations_short","text":"<pre><code>locals {\n  starter_locations_short = {\n    for i, location in var.starter_locations :\n    \"starter_location_${format(\"%02d\", i + 1)}_short\" =&gt; coalesce(\n      # 1. User override\n      try(var.starter_locations_short[\"starter_location_${format(\"%02d\", i + 1)}_short\"], null),\n      # 2. Official geo_code\n      try(module.regions.regions_by_name[location].geo_code, null),\n      # 3. Calculated short_name\n      try(module.regions.regions_by_name[location].short_name, null),\n      # 4. Last resort: full region name\n      location\n    )\n  }\n}\n</code></pre> <p>**\u8907\u96d1\uff01**\u5206\u89e3\u3057\u3066\u898b\u3088\u3046\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#coalesce","title":"coalesce\u3067\u512a\u5148\u9806\u4f4d\u4ed8\u3051","text":"<pre><code>coalesce(\u50241, \u50242, \u50243, \u50244)\n# \u2190\u6700\u521d\u306enull\u3058\u3083\u306a\u3044\u5024\u3092\u8fd4\u3059\n</code></pre> <p>\u512a\u5148\u9806\u4f4d\uff1a 1. \u30e6\u30fc\u30b6\u30fc\u306e\u4e0a\u66f8\u304d\uff1a\u624b\u52d5\u3067\u6307\u5b9a\u3057\u305f\u5024 2. geo_code\uff1a<code>jp</code>\u3001<code>us</code>\u307f\u305f\u3044\u306a\u5730\u7406\u30b3\u30fc\u30c9 3. short_name\uff1a<code>jpe</code>\u3001<code>jpw</code>\u307f\u305f\u3044\u306a\u77ed\u7e2e\u540d 4. \u30d5\u30eb\u30cd\u30fc\u30e0\uff1a<code>japaneast</code>\uff08\u6700\u5f8c\u306e\u624b\u6bb5\uff09</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#try","title":"try\u95a2\u6570","text":"<pre><code>try(\u5f0f, \u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u5024)\n# \u2190\u5f0f\u304c\u30a8\u30e9\u30fc\u306a\u3089\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u5024\u3092\u8fd4\u3059\n</code></pre> <p>\u4f8b\uff1a <pre><code>try(var.xxx[\"key\"], null)\n# \u2191xxx\u304c\u5b58\u5728\u3057\u306a\u3044or key\u304c\u306a\u3044 \u2192 null\n</code></pre></p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#_2","title":"\u5b9f\u969b\u306e\u52d5\u4f5c","text":"<pre><code># \u5165\u529b\nvar.starter_locations = [\"japaneast\", \"japanwest\"]\nvar.starter_locations_short = {}  # \u4f55\u3082\u6307\u5b9a\u3057\u3066\u306a\u3044\n\n# \u51e6\u7406\n# japaneast\u306e\u5834\u5408\uff1a\n# 1. \u30e6\u30fc\u30b6\u30fc\u4e0a\u66f8\u304d: null\uff08\u6307\u5b9a\u3057\u3066\u306a\u3044\uff09\n# 2. geo_code: \"jp\"\uff08\u3053\u308c\u304c\u63a1\u7528\u3055\u308c\u308b\uff09\n\n# \u51fa\u529b\nlocal.starter_locations_short = {\n  \"starter_location_01_short\" = \"jp\"\n  \"starter_location_02_short\" = \"jp\"\n}\n</code></pre> <p>\u624b\u52d5\u3067\u6307\u5b9a\u3059\u308b\u5834\u5408\uff1a <pre><code># \u5165\u529b\nvar.starter_locations_short = {\n  \"starter_location_01_short\" = \"jpe\"\n  \"starter_location_02_short\" = \"jpw\"\n}\n\n# \u51fa\u529b\uff08\u30e6\u30fc\u30b6\u30fc\u6307\u5b9a\u304c\u512a\u5148\uff09\nlocal.starter_locations_short = {\n  \"starter_location_01_short\" = \"jpe\"\n  \"starter_location_02_short\" = \"jpw\"\n}\n</code></pre></p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#built_in_replacements","title":"built_in_replacements","text":"<pre><code>locals {\n  built_in_replacements = merge(\n    local.starter_locations,\n    local.starter_locations_short,\n    {\n      root_parent_management_group_id = var.root_parent_management_group_id == \"\" ? data.azurerm_client_config.current.tenant_id : var.root_parent_management_group_id\n      subscription_id_connectivity    = var.subscription_id_connectivity\n      subscription_id_identity        = var.subscription_id_identity\n      subscription_id_management      = var.subscription_id_management\n      subscription_id_security        = var.subscription_id_security\n  })\n}\n</code></pre> <p>\u3084\u3063\u3066\u308b\u3053\u3068\uff1a \u5168\u3066\u306e\u7d44\u307f\u8fbc\u307f\u7f6e\u63db\u30eb\u30fc\u30eb\u30921\u3064\u306e\u30de\u30c3\u30d7\u306b\u307e\u3068\u3081\u3066\u308b\u3002</p> <p>\u7d50\u679c\uff08\u4f8b\uff09\uff1a <pre><code>local.built_in_replacements = {\n  # \u30ea\u30fc\u30b8\u30e7\u30f3\n  \"starter_location_01\"       = \"japaneast\"\n  \"starter_location_02\"       = \"japanwest\"\n  \"starter_location_01_short\" = \"jp\"\n  \"starter_location_02_short\" = \"jp\"\n\n  # \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\n  \"root_parent_management_group_id\" = \"12345678-1234-1234-1234-123456789012\"\n\n  # \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\n  \"subscription_id_connectivity\" = \"aaaa-bbbb-cccc-dddd\"\n  \"subscription_id_identity\"     = \"1111-2222-3333-4444\"\n  \"subscription_id_management\"   = \"5555-6666-7777-8888\"\n  \"subscription_id_security\"     = \"9999-0000-1111-2222\"\n}\n</code></pre></p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#2","title":"\u30b9\u30c6\u30c3\u30d72: \u30ab\u30b9\u30bf\u30e0\u7f6e\u63db\u306e\u51e6\u7406","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#custom_names","title":"custom_names","text":"<pre><code>locals {\n  custom_names_json           = replace(replace(tostring(jsonencode(var.custom_replacements.names)), \"\\\"true\\\"\", \"{{string_true}}\"), \"\\\"false\\\"\", \"{{string_false}}\")\n  custom_names_json_templated = templatestring(local.custom_names_json, local.built_in_replacements)\n  custom_names_json_final     = replace(replace(replace(replace(local.custom_names_json_templated, \"\\\"true\\\"\", \"true\"), \"\\\"false\\\"\", \"false\"), \"{{string_true}}\", \"\\\"true\\\"\"), \"{{string_false}}\", \"\\\"false\\\"\")\n  custom_names                = jsondecode(local.custom_names_json_final)\n}\n</code></pre> <p>\u4f55\u3053\u308c\uff1f \u3081\u3061\u3083\u304f\u3061\u3083\u8907\u96d1\u3060\u3051\u3069\u3001\u3084\u3063\u3066\u308b\u3053\u3068\u306f\u5358\u7d14\u3002</p> <p>\u554f\u984c\uff1a <code>templatestring()</code>\u95a2\u6570\u306f\u6587\u5b57\u5217\u3057\u304b\u53d7\u3051\u53d6\u308c\u306a\u3044\u3002 \u3067\u3082\u3001<code>var.custom_replacements.names</code>\u306f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002</p> <p>\u89e3\u6c7a\u7b56\uff1a 1. JSON\u5316\uff1a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u2192 JSON\u6587\u5b57\u5217 2. \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\uff1a<code>{{xxx}}</code>\u3092\u7f6e\u63db 3. \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u623b\u3059\uff1aJSON\u6587\u5b57\u5217 \u2192 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#_3","title":"\u8a73\u7d30\u306a\u6d41\u308c","text":"<p>\ud83e\udd14 \u305d\u306e\u524d\u306b: \u306a\u305c jsonencode/jsondecode \u3092\u4f7f\u3046\u306e\u304b\uff1f</p> <p>\u554f\u984c: Terraform\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u305d\u306e\u307e\u307e\u6587\u5b57\u5217\u64cd\u4f5c\u3067\u304d\u306a\u3044</p> <pre><code># \u3053\u3046\u3044\u3046\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u3042\u308b\ncustom_replacements = {\n  firewall_name = \"fw-{{starter_location_01}}\"\n  enabled = true\n}\n\n# \u3053\u308c\u3092\u6587\u5b57\u5217\u64cd\u4f5c\u3057\u3066\u3001{{xxx}}\u3092\u5b9f\u969b\u306e\u5024\u306b\u7f6e\u63db\u3057\u305f\u3044\n# \u3067\u3082\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u307e\u307e templatestring() \u306f\u4f7f\u3048\u306a\u3044\n</code></pre> <p>\u89e3\u6c7a\u7b56: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u2192 JSON\u6587\u5b57\u5217 \u2192 \u6587\u5b57\u5217\u64cd\u4f5c \u2192 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u623b\u3059</p> <pre><code># \u30b9\u30c6\u30c3\u30d71: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u2192 JSON\u6587\u5b57\u5217\u306b\u5909\u63db\njson_string = jsonencode(custom_replacements)\n# \u2192 '{\"firewall_name\":\"fw-{{starter_location_01}}\",\"enabled\":true}'\n\n# \u30b9\u30c6\u30c3\u30d72: JSON\u6587\u5b57\u5217\u3067\u7f6e\u63db\u51e6\u7406\nreplaced = templatestring(json_string, {starter_location_01 = \"japaneast\"})\n# \u2192 '{\"firewall_name\":\"fw-japaneast\",\"enabled\":true}'\n\n# \u30b9\u30c6\u30c3\u30d73: JSON\u6587\u5b57\u5217 \u2192 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u623b\u3059\nresult = jsondecode(replaced)\n# \u2192 {firewall_name = \"fw-japaneast\", enabled = true}\n</code></pre> <p>\u521d\u5fc3\u8005\u5411\u3051\u307e\u3068\u3081: - jsonencode(): \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u2192 JSON\u6587\u5b57\u5217\uff08\u6587\u5b57\u5217\u64cd\u4f5c\u53ef\u80fd\u306b\u3059\u308b\uff09 - jsondecode(): JSON\u6587\u5b57\u5217 \u2192 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff08Terraform\u3067\u4f7f\u3048\u308b\u5f62\u306b\u623b\u3059\uff09 - \u7406\u7531: Terraform\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u76f4\u63a5\u6587\u5b57\u5217\u64cd\u4f5c\u3067\u304d\u306a\u3044\u305f\u3081</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#1-custom_names_json","title":"1. custom_names_json","text":"<pre><code>custom_names_json = replace(replace(tostring(jsonencode(...)), \"\\\"true\\\"\", \"{{string_true}}\"), \"\\\"false\\\"\", \"{{string_false}}\")\n</code></pre> <p>\u3084\u3063\u3066\u308b\u3053\u3068\uff1a <pre><code># \u5165\u529b\nvar.custom_replacements.names = {\n  enable_ddos_protection = true\n  firewall_name = \"fw-{{starter_location_01_short}}\"\n}\n\n# jsonencode()\u3067JSON\u5316\n# \u2193\n# {\"enable_ddos_protection\":true,\"firewall_name\":\"fw-{{starter_location_01_short}}\"}\n\n# replace()\u3067true/false\u3092\u4fdd\u8b77\n# \u2193\n# {\"enable_ddos_protection\":{{string_true}},\"firewall_name\":\"fw-{{starter_location_01_short}}\"}\n</code></pre></p> <p>\u306a\u3093\u3067\u4fdd\u8b77\uff1f <code>templatestring()</code>\u304c<code>true</code>/<code>false</code>\u3092\u6587\u5b57\u5217<code>\"true\"</code>/<code>\"false\"</code>\u306b\u5909\u63db\u3057\u3066\u3057\u307e\u3046\u305f\u3081\u3067\u3059\u3002 \u305d\u308c\u3092\u9632\u3050\u305f\u3081\u306b\u4e00\u6642\u7684\u306b<code>{{string_true}}</code>\u306b\u5909\u3048\u3066\u308b\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#2-custom_names_json_templated","title":"2. custom_names_json_templated","text":"<pre><code>custom_names_json_templated = templatestring(local.custom_names_json, local.built_in_replacements)\n</code></pre> <p>\u3084\u3063\u3066\u308b\u3053\u3068\uff1a <pre><code># \u5165\u529b\n# {\"enable_ddos_protection\":{{string_true}},\"firewall_name\":\"fw-{{starter_location_01_short}}\"}\n\n# starter_location_01_short = \"jp\"\u3067\u7f6e\u63db\n# \u2193\n# {\"enable_ddos_protection\":{{string_true}},\"firewall_name\":\"fw-jp\"}\n</code></pre></p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#3-custom_names_json_final","title":"3. custom_names_json_final","text":"<pre><code>custom_names_json_final = replace(replace(...), ...)\n</code></pre> <p>\u3084\u3063\u3066\u308b\u3053\u3068\uff1a <code>{{string_true}}</code>\u3092<code>true</code>\u306b\u623b\u3059\uff08\u5143\u306e\u30d6\u30fc\u30eb\u5024\u306b\uff09\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#4-custom_names","title":"4. custom_names","text":"<pre><code>custom_names = jsondecode(local.custom_names_json_final)\n</code></pre> <p>\u3084\u3063\u3066\u308b\u3053\u3068\uff1a JSON\u6587\u5b57\u5217\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u623b\u3059\u3002</p> <pre><code># \u7d50\u679c\nlocal.custom_names = {\n  enable_ddos_protection = true\n  firewall_name = \"fw-jp\"\n}\n</code></pre>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#custom_name_replacements","title":"custom_name_replacements","text":"<pre><code>locals {\n  custom_name_replacements = merge(local.built_in_replacements, local.custom_names)\n}\n</code></pre> <p>\u7d44\u307f\u8fbc\u307f\u7f6e\u63db + \u30ab\u30b9\u30bf\u30e0\u540d\u30921\u3064\u306b\u307e\u3068\u3081\u308b\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#3-id","title":"\u30b9\u30c6\u30c3\u30d73: \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u3068\u30ea\u30bd\u30fc\u30b9ID\u306e\u51e6\u7406","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#custom_resource_group_identifiers","title":"custom_resource_group_identifiers","text":"<pre><code>locals {\n  custom_resource_group_identifiers_json           = replace(replace(tostring(jsonencode(var.custom_replacements.resource_group_identifiers)), \"\\\"true\\\"\", \"{{string_true}}\"), \"\\\"false\\\"\", \"{{string_false}}\")\n  custom_resource_group_identifiers_json_templated = templatestring(local.custom_resource_group_identifiers_json, local.custom_name_replacements)\n  custom_resource_group_identifiers_json_final     = replace(replace(replace(replace(local.custom_resource_group_identifiers_json_templated, \"\\\"true\\\"\", \"true\"), \"\\\"false\\\"\", \"false\"), \"{{string_true}}\", \"\\\"true\\\"\"), \"{{string_false}}\", \"\\\"false\\\"\")\n  custom_resource_group_identifiers                = jsondecode(local.custom_resource_group_identifiers_json_final)\n}\n</code></pre> <p>\u3084\u3063\u3066\u308b\u3053\u3068\uff1a <code>custom_names</code>\u3068\u540c\u3058\u51e6\u7406\u3092<code>resource_group_identifiers</code>\u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>\u9055\u3044\uff1a <code>local.custom_name_replacements</code>\u3092\u4f7f\u3063\u3066\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\u3002 \u3064\u307e\u308a\u3001\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7ID\u306e\u4e2d\u3067**\u30ea\u30bd\u30fc\u30b9\u540d\u3092\u53c2\u7167\u3067\u304d\u308b**\u3002</p> <p>\u4f8b\uff1a <pre><code># tfvars\ncustom_replacements = {\n  names = {\n    resource_group_name = \"rg-{{starter_location_01_short}}-hub\"\n  }\n  resource_group_identifiers = {\n    resource_group_id = \"/subscriptions/{{subscription_id_connectivity}}/resourceGroups/{{resource_group_name}}\"\n  }\n}\n\n# \u7d50\u679c\n# \u2193\n# resource_group_id = \"/subscriptions/aaaa-bbbb-cccc-dddd/resourceGroups/rg-jp-hub\"\n</code></pre></p> <p><code>{{resource_group_name}}</code>\u304c<code>rg-jp-hub</code>\u306b\u7f6e\u304d\u63db\u308f\u3063\u3066\u308b\u3002\u308f\u304b\u308b\uff1f</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#custom_resource_identifiers","title":"custom_resource_identifiers","text":"<pre><code>locals {\n  custom_resource_identifiers_json           = replace(replace(tostring(jsonencode(var.custom_replacements.resource_identifiers)), \"\\\"true\\\"\", \"{{string_true}}\"), \"\\\"false\\\"\", \"{{string_false}}\")\n  custom_resource_identifiers_json_templated = templatestring(local.custom_resource_identifiers_json, local.custom_resource_group_replacements)\n  custom_resource_identifiers_json_final     = replace(replace(replace(replace(local.custom_resource_identifiers_json_templated, \"\\\"true\\\"\", \"true\"), \"\\\"false\\\"\", \"false\"), \"{{string_true}}\", \"\\\"true\\\"\"), \"{{string_false}}\", \"\\\"false\\\"\")\n  custom_resource_identifiers                = jsondecode(local.custom_resource_identifiers_json_final)\n}\n</code></pre> <p>\u3084\u3063\u3066\u308b\u3053\u3068\uff1a \u540c\u3058\u51e6\u7406\u3092<code>resource_identifiers</code>\u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3002</p> <p><code>local.custom_resource_group_replacements</code>\u3092\u4f7f\u3046\u304b\u3089\u3001\u30ea\u30bd\u30fc\u30b9ID\u306e\u4e2d\u3067\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7ID\u3092\u53c2\u7167\u3067\u304d\u308b\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#final_replacements","title":"final_replacements","text":"<pre><code>locals {\n  final_replacements = merge(local.custom_resource_group_replacements, local.custom_resource_identifiers)\n}\n</code></pre> <p>\u5168\u3066\u306e\u7f6e\u63db\u30eb\u30fc\u30eb\u30921\u3064\u306b\u307e\u3068\u3081\u308b\u3002</p> <p>\u4e2d\u8eab\uff08\u4f8b\uff09\uff1a <pre><code>local.final_replacements = {\n  # \u7d44\u307f\u8fbc\u307f\n  \"starter_location_01\" = \"japaneast\"\n  \"starter_location_01_short\" = \"jp\"\n  \"subscription_id_connectivity\" = \"aaaa-bbbb-cccc-dddd\"\n\n  # \u30ab\u30b9\u30bf\u30e0\u540d\n  \"resource_group_name\" = \"rg-jp-hub\"\n  \"firewall_name\" = \"fw-jp\"\n\n  # \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7ID\n  \"resource_group_id\" = \"/subscriptions/.../resourceGroups/rg-jp-hub\"\n\n  # \u30ea\u30bd\u30fc\u30b9ID\n  \"log_analytics_workspace_id\" = \"/subscriptions/.../providers/Microsoft.OperationalInsights/workspaces/law-jp\"\n}\n</code></pre></p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#4","title":"\u30b9\u30c6\u30c3\u30d74: \u6700\u7d42\u51fa\u529b\u306e\u751f\u6210","text":"<pre><code>locals {\n  outputs_json           = { for key, value in var.inputs : key =&gt; replace(replace(tostring(jsonencode(value)), \"\\\"true\\\"\", \"{{string_true}}\"), \"\\\"false\\\"\", \"{{string_false}}\") }\n  outputs_json_templated = { for key, value in local.outputs_json : key =&gt; templatestring(value, local.final_replacements) }\n  outputs_json_final     = { for key, value in local.outputs_json_templated : key =&gt; replace(replace(replace(replace(value, \"\\\"true\\\"\", \"true\"), \"\\\"false\\\"\", \"false\"), \"{{string_true}}\", \"\\\"true\\\"\"), \"{{string_false}}\", \"\\\"false\\\"\") }\n  outputs                = { for key, value in local.outputs_json_final : key =&gt; jsondecode(value) }\n}\n</code></pre> <p>\u3084\u3063\u3066\u308b\u3053\u3068\uff1a <code>var.inputs</code>\uff08\u5168\u8a2d\u5b9a\uff09\u306b\u5bfe\u3057\u3066\u3001\u4eca\u307e\u3067\u4f5c\u3063\u305f\u7f6e\u63db\u30eb\u30fc\u30eb\u3092\u9069\u7528\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>for\u5f0f\u3092\u4f7f\u3063\u3066\u308b\uff1a <pre><code>{ for key, value in var.inputs : key =&gt; ... }\n# \u2191var.inputs\u306e\u5404\u8981\u7d20\u306b\u5bfe\u3057\u3066\u51e6\u7406\n</code></pre></p> <p>\u6d41\u308c\uff1a 1. JSON\u5316\uff1a\u5404\u8a2d\u5b9a\u3092JSON\u6587\u5b57\u5217\u306b 2. \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\uff1a<code>{{xxx}}</code>\u3092\u7f6e\u63db 3. \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u623b\u3059\uff1aJSON \u2192 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8</p> <p>\u7d50\u679c\uff1a <pre><code># \u5165\u529b\uff08var.inputs\uff09\n{\n  hub_virtual_networks = {\n    primary = {\n      name = \"vnet-{{starter_location_01_short}}-hub\"\n      resource_group_name = \"{{resource_group_name}}\"\n    }\n  }\n}\n\n# \u51fa\u529b\uff08local.outputs\uff09\n{\n  hub_virtual_networks = {\n    primary = {\n      name = \"vnet-jp-hub\"\n      resource_group_name = \"rg-jp-hub\"\n    }\n  }\n}\n</code></pre></p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#_4","title":"\u307e\u3068\u3081\uff1a\u51e6\u7406\u306e\u5168\u4f53\u50cf","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#1_1","title":"1. \u7d44\u307f\u8fbc\u307f\u7f6e\u63db\u306e\u4f5c\u6210","text":"<pre><code>starter_locations \u2192 starter_locations_short \u2192 built_in_replacements\n</code></pre> <p>\u7d50\u679c\uff1a - <code>starter_location_01</code>\u3001<code>starter_location_01_short</code> - <code>subscription_id_xxx</code> - <code>root_parent_management_group_id</code></p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#2_1","title":"2. \u30ab\u30b9\u30bf\u30e0\u7f6e\u63db\u306e\u6bb5\u968e\u7684\u51e6\u7406","text":"<pre><code>custom_replacements.names\n  \u2193 (built_in_replacements\u3067\u7f6e\u63db)\ncustom_names \u2192 custom_name_replacements\n\ncustom_replacements.resource_group_identifiers\n  \u2193 (custom_name_replacements\u3067\u7f6e\u63db)\ncustom_resource_group_identifiers \u2192 custom_resource_group_replacements\n\ncustom_replacements.resource_identifiers\n  \u2193 (custom_resource_group_replacements\u3067\u7f6e\u63db)\ncustom_resource_identifiers \u2192 final_replacements\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8\uff1a - \u6bb5\u968e\u7684\u306b\u51e6\u7406\uff1a\u540d\u524d \u2192 \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7ID \u2192 \u30ea\u30bd\u30fc\u30b9ID - \u524d\u306e\u30b9\u30c6\u30c3\u30d7\u306e\u7d50\u679c\u3092\u6b21\u3067\u4f7f\u3046\uff1a\u540d\u524d\u304cRG ID\u306e\u4e2d\u3067\u4f7f\u3048\u308b</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#3","title":"3. \u6700\u7d42\u51fa\u529b","text":"<pre><code>var.inputs\n  \u2193 (final_replacements\u3067\u7f6e\u63db)\nlocal.outputs \u2192 module.config.outputs\n</code></pre> <p>\u52b9\u679c\uff1a \u5168\u3066\u306e<code>{{xxx}}</code>\u304c\u5b9f\u969b\u306e\u5024\u306b\u7f6e\u304d\u63db\u308f\u308b\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#_5","title":"\u5b9f\u8df5\uff1a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u8a66\u3057\u3066\u307f\u3088\u3046","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#1_2","title":"\u4f8b1: \u5358\u7d14\u306a\u7f6e\u63db","text":"<pre><code># tfvars\nstarter_locations = [\"japaneast\"]\n\ncustom_replacements = {\n  names = {\n    vnet_name = \"vnet-{{starter_location_01_short}}-hub\"\n  }\n}\n\n# \u7d50\u679c\n# vnet_name = \"vnet-jp-hub\"\n</code></pre>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#2_2","title":"\u4f8b2: \u8907\u6570\u6bb5\u968e\u306e\u7f6e\u63db","text":"<pre><code># tfvars\nstarter_locations = [\"japaneast\"]\n\ncustom_replacements = {\n  names = {\n    rg_name = \"rg-{{starter_location_01_short}}-network\"\n  }\n  resource_group_identifiers = {\n    rg_id = \"/subscriptions/{{subscription_id_connectivity}}/resourceGroups/{{rg_name}}\"\n  }\n  resource_identifiers = {\n    vnet_id = \"{{rg_id}}/providers/Microsoft.Network/virtualNetworks/vnet-hub\"\n  }\n}\n\n# \u7d50\u679c\n# rg_name = \"rg-jp-network\"\n# rg_id = \"/subscriptions/aaaa-bbbb-cccc-dddd/resourceGroups/rg-jp-network\"\n# vnet_id = \"/subscriptions/aaaa-bbbb-cccc-dddd/resourceGroups/rg-jp-network/providers/Microsoft.Network/virtualNetworks/vnet-hub\"\n</code></pre> <p>\u4fbf\u5229\u3067\u3057\u3087\uff1f</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#3_1","title":"\u4f8b3: \u6761\u4ef6\u5206\u5c90\uff08\u30d6\u30fc\u30eb\u5024\uff09","text":"<pre><code># tfvars\ncustom_replacements = {\n  names = {\n    enable_firewall = true  # \u2190\u30d6\u30fc\u30eb\u5024\n  }\n}\n\n# \u30d6\u30fc\u30eb\u5024\u304c\u305d\u306e\u307e\u307e\u4fdd\u6301\u3055\u308c\u308b\n# enable_firewall = true\uff08\u6587\u5b57\u5217\u306e\"true\"\u3058\u3083\u306a\u3044\uff09\n</code></pre> <p><code>{{string_true}}</code>\u306e\u30c8\u30ea\u30c3\u30af\u3067\u3001\u30d6\u30fc\u30eb\u5024\u304c\u4fdd\u8b77\u3055\u308c\u3066\u308b\u3093\u3060\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#_6","title":"\u30c7\u30d0\u30c3\u30b0\u6280\uff1a\u7f6e\u63db\u306e\u78ba\u8a8d","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#output","title":"output\u3067\u4e2d\u9593\u7d50\u679c\u3092\u898b\u308b","text":"<pre><code># modules/config-templating/outputs.tf\noutput \"debug_replacements\" {\n  value = {\n    built_in         = local.built_in_replacements\n    custom_names     = local.custom_names\n    final            = local.final_replacements\n  }\n}\n</code></pre> <pre><code>terraform plan\n\n# \u2193\u7f6e\u63db\u30eb\u30fc\u30eb\u304c\u5168\u90e8\u898b\u3048\u308b\nOutputs:\n  debug_replacements = {\n    built_in = { ... }\n    custom_names = { ... }\n    final = { ... }\n  }\n</code></pre>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#_7","title":"\u7279\u5b9a\u306e\u5024\u3060\u3051\u78ba\u8a8d","text":"<pre><code>output \"debug_vnet_name\" {\n  value = local.outputs.hub_virtual_networks.primary.name\n}\n</code></pre>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#_8","title":"\u3053\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5229\u70b9","text":""},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#1-drydont-repeat-yourself","title":"1. DRY\u539f\u5247\uff08Don't Repeat Yourself\uff09","text":"<p>\u60aa\u3044\u4f8b\uff1a <pre><code>resource_group_name = \"rg-jp-hub\"\nvnet_name = \"vnet-jp-hub\"\nfirewall_name = \"fw-jp-hub\"\n# \u2191\"jp\"\u3092\u4f55\u5ea6\u3082\u66f8\u304f\n</code></pre></p> <p>\u826f\u3044\u4f8b\uff1a <pre><code>resource_group_name = \"rg-{{starter_location_01_short}}-hub\"\nvnet_name = \"vnet-{{starter_location_01_short}}-hub\"\nfirewall_name = \"fw-{{starter_location_01_short}}-hub\"\n# \u21911\u7b87\u6240\u3060\u3051\u7ba1\u7406\uff08starter_locations\uff09\n</code></pre></p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#2_3","title":"2. \u8907\u6570\u30ea\u30fc\u30b8\u30e7\u30f3\u5bfe\u5fdc\u304c\u7c21\u5358","text":"<pre><code># \u30ea\u30fc\u30b8\u30e7\u30f3\u8ffd\u52a0\nstarter_locations = [\"japaneast\", \"japanwest\", \"eastus\"]\n\n# \u5168\u3066\u306e\u8a2d\u5b9a\u304c\u81ea\u52d5\u30673\u30ea\u30fc\u30b8\u30e7\u30f3\u5206\u306b\u306a\u308b\n</code></pre>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#3_2","title":"3. \u4f9d\u5b58\u95a2\u4fc2\u306e\u8868\u73fe","text":"<pre><code>rg_name = \"rg-hub\"\nrg_id = \"/subscriptions/.../resourceGroups/{{rg_name}}\"\nvnet_id = \"{{rg_id}}/providers/.../virtualNetworks/vnet\"\n</code></pre> <p>\u5f8c\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u524d\u306e\u30b9\u30c6\u30c3\u30d7\u306e\u7d50\u679c\u3092\u4f7f\u3048\u308b\u3002</p>"},{"location":"06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/#_9","title":"\u307e\u3068\u3081","text":"<p>config-templating\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5f79\u5272\uff1a 1. \u30ea\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u6b63\u898f\u5316\uff1a<code>japaneast</code> \u2192 <code>jp</code> 2. \u7d44\u307f\u8fbc\u307f\u7f6e\u63db\u306e\u4f5c\u6210\uff1a\u30ea\u30fc\u30b8\u30e7\u30f3\u3001\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3ID 3. \u30ab\u30b9\u30bf\u30e0\u7f6e\u63db\u306e\u6bb5\u968e\u7684\u51e6\u7406\uff1a\u540d\u524d \u2192 RG ID \u2192 \u30ea\u30bd\u30fc\u30b9ID 4. \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\uff1a<code>{{xxx}}</code>\u3092\u5b9f\u969b\u306e\u5024\u306b\u7f6e\u63db 5. \u30d6\u30fc\u30eb\u5024\u306e\u4fdd\u8b77\uff1a<code>true</code>/<code>false</code>\u304c\u6587\u5b57\u5217\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b</p> <p>\u899a\u3048\u3066\u304a\u304f\u3053\u3068\uff1a - <code>templatestring()</code>\uff1a<code>{{xxx}}</code>\u3092\u7f6e\u63db - <code>jsonencode()</code>/<code>jsondecode()</code>\uff1a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u21d4 JSON\u6587\u5b57\u5217 - <code>coalesce()</code>\uff1a\u6700\u521d\u306enull\u3058\u3083\u306a\u3044\u5024 - <code>try()</code>\uff1a\u30a8\u30e9\u30fc\u3092\u30ad\u30e3\u30c3\u30c1</p> <p>\u6b21\u306eChapter\u3067\u306f\u3001\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u5b9f\u969b\u306bAzure\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u308b\u6700\u521d\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u3059\u3002</p> <p>\u6240\u8981\u6642\u9593: 50\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2605 \u524d: 05_\u30ed\u30fc\u30ab\u30eb\u5909\u6570.md \u6b21: 07_\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7.md</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/","title":"07. \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7 - \u6700\u521d\u306eAzure\u30ea\u30bd\u30fc\u30b9","text":""},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u3092\u7406\u89e3\u3057\u3088\u3046\u3002</p> <p>\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u3063\u3066\u4f55\uff1f Azure\u30ea\u30bd\u30fc\u30b9\u3092\u5165\u308c\u308b\u300c\u7bb1\u300d\u307f\u305f\u3044\u306a\u3082\u3093\u3002 VM\u3068\u304bVNet\u3068\u304b\u3001\u5168\u3066\u306e\u30ea\u30bd\u30fc\u30b9\u306f\u5fc5\u305a\u3069\u3053\u304b\u306e\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3059\u308b\u3002</p> <p>\u4f8b\u3048\u308b\u306a\u3089\uff1a - \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\uff1a\u672c\u68da - \u30ea\u30bd\u30fc\u30b9\uff1a\u672c - \u672c\u68da\u304c\u306a\u3044\u3068\u672c\u3092\u7f6e\u3051\u306a\u3044\u3067\u3057\u3087\uff1f</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_1","title":"\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u57fa\u672c","text":""},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_2","title":"\u69cb\u9020","text":"<pre><code>\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\n  \u251c\u2500\u2500 \u5834\u6240\uff08location\uff09\n  \u251c\u2500\u2500 \u540d\u524d\uff08name\uff09\n  \u251c\u2500\u2500 \u30bf\u30b0\uff08tags\uff09\n  \u2514\u2500\u2500 \u4e2d\u8eab\u306e\u30ea\u30bd\u30fc\u30b9\n      \u251c\u2500\u2500 VNet\n      \u251c\u2500\u2500 VM\n      \u2514\u2500\u2500 Storage Account\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_3","title":"\u30eb\u30fc\u30eb","text":"<p>1\u3064\u306e\u30ea\u30bd\u30fc\u30b9\u306f1\u3064\u306e\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306b\u3057\u304b\u5c5e\u305b\u306a\u3044</p> <pre><code>OK:\nrg-hub\n  \u251c\u2500\u2500 vnet-hub\n  \u2514\u2500\u2500 firewall\n\nNG:\nvnet-hub\u304c2\u3064\u306eRG\u306b\u5c5e\u3059\u308b\uff08\u3067\u304d\u306a\u3044\uff09\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_4","title":"\u524a\u9664\u306e\u6319\u52d5","text":"<p>\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u3092\u524a\u9664 \u2192 \u4e2d\u8eab\u306e\u30ea\u30bd\u30fc\u30b9\u3082\u5168\u90e8\u524a\u9664</p> <pre><code># \u3053\u308c\u3084\u308b\u3068...\naz group delete --name rg-hub\n\n# \u2193\u4e2d\u8eab\u3082\u5168\u90e8\u6d88\u3048\u308b\n# - vnet-hub\n# - firewall\n# - bastion\n# \u5168\u90e8\u6d88\u3048\u3061\u3083\u3046\uff01\n</code></pre> <p>\u3081\u3063\u3061\u3083\u4fbf\u5229\u3060\u3051\u3069\u3001\u9593\u9055\u3048\u308b\u3068\u6016\u3044\u3002</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#part-1-tfvars","title":"Part 1: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08tfvars\uff09","text":""},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#connectivity_resource_groups","title":"connectivity_resource_groups","text":"<p>Chapter 3\u3067\u898b\u305f\u3053\u308c\uff1a</p> <pre><code>connectivity_resource_groups = {\n  primary = {\n    name     = \"rg-{{starter_location_01_short}}-connectivity\"\n    location = \"{{starter_location_01}}\"\n  }\n  secondary = {\n    name     = \"rg-{{starter_location_02_short}}-connectivity\"\n    location = \"{{starter_location_02}}\"\n  }\n}\n</code></pre> <p>\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\u5f8c\uff1a <pre><code>connectivity_resource_groups = {\n  primary = {\n    name     = \"rg-jp-connectivity\"\n    location = \"japaneast\"\n  }\n  secondary = {\n    name     = \"rg-jp-connectivity\"\n    location = \"japanwest\"\n  }\n}\n</code></pre></p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_5","title":"\u30bf\u30b0\u306e\u8ffd\u52a0","text":"<pre><code>connectivity_resource_groups = {\n  primary = {\n    name     = \"rg-{{starter_location_01_short}}-connectivity\"\n    location = \"{{starter_location_01}}\"\n    tags = {\n      region = \"primary\"\n      tier   = \"network\"\n    }\n  }\n}\n</code></pre> <p>\u30bf\u30b0\u3063\u3066\u4f55\uff1f \u30e1\u30bf\u30c7\u30fc\u30bf\u3002\u30b3\u30b9\u30c8\u7ba1\u7406\u3068\u304b\u691c\u7d22\u306b\u4f7f\u3046\u3002</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#enabled","title":"enabled\u8a2d\u5b9a","text":"<pre><code>connectivity_resource_groups = {\n  primary = {\n    name     = \"rg-jp-connectivity\"\n    location = \"japaneast\"\n    settings = {\n      enabled = true  # \u2190\u4f5c\u308b\n    }\n  }\n  secondary = {\n    name     = \"rg-jp-connectivity\"\n    location = \"japanwest\"\n    settings = {\n      enabled = false  # \u2190\u4f5c\u3089\u306a\u3044\n    }\n  }\n}\n</code></pre> <p>\u4f7f\u3044\u9053\uff1a \u4e00\u6642\u7684\u306b\u7121\u52b9\u5316\u3057\u305f\u3044\u6642\u3068\u304b\u3001\u6bb5\u968e\u7684\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u6642\u306b\u4fbf\u5229\u3002</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#part-2-variablesconnectivitytf","title":"Part 2: \u5909\u6570\u5b9a\u7fa9\uff08variables.connectivity.tf\uff09","text":"<pre><code>variable \"connectivity_resource_groups\" {\n  type = map(object({\n    name     = string\n    location = string\n    tags     = optional(map(string))\n    settings = optional(any)\n  }))\n  default     = {}\n  description = \"A map of resource groups to create\"\n}\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_6","title":"\u578b\u306e\u89e3\u8aac","text":""},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#mapobject","title":"map(object({...}))","text":"<pre><code>map(object({...}))\n# \u2191\u30ad\u30fc\u4ed8\u304d\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30de\u30c3\u30d7\n</code></pre> <p>\u30a4\u30e1\u30fc\u30b8\uff1a <pre><code>{\n  \"primary\" = {\n    name     = \"...\"\n    location = \"...\"\n  }\n  \"secondary\" = {\n    name     = \"...\"\n    location = \"...\"\n  }\n}\n</code></pre></p> <p>\u30ad\u30fc\uff08<code>primary</code>\u3001<code>secondary</code>\uff09\u3067\u8b58\u5225\u3067\u304d\u308b\u3002</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#optional","title":"optional","text":"<pre><code>tags     = optional(map(string))\nsettings = optional(any)\n</code></pre> <p>\u610f\u5473\uff1a\u7701\u7565\u3057\u3066\u3082OK</p> <pre><code># \u30bf\u30b0\u7701\u7565\nprimary = {\n  name     = \"rg-hub\"\n  location = \"japaneast\"\n  # tags\u7701\u7565 \u2192 null\n}\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_7","title":"\u30c7\u30d5\u30a9\u30eb\u30c8\u5024","text":"<pre><code>default = {}\n</code></pre> <p>\u610f\u5473\uff1a\u4f55\u3082\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070\u7a7a\u30de\u30c3\u30d7</p> <pre><code># tfvars\u3067\u4f55\u3082\u66f8\u304b\u306a\u3044\n# \u2193\nconnectivity_resource_groups = {}\n# \u2193\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u4f5c\u3089\u308c\u306a\u3044\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#part-3-mainresourcegroupstf","title":"Part 3: \u30e2\u30b8\u30e5\u30fc\u30eb\u547c\u3073\u51fa\u3057\uff08main.resource.groups.tf\uff09","text":"<pre><code>module \"resource_groups\" {\n  source  = \"Azure/avm-res-resources-resourcegroup/azurerm\"\n  version = \"0.2.1\"\n\n  for_each = { for key, value in module.config.outputs.connectivity_resource_groups : key =&gt; value if try(value.settings.enabled, true) }\n\n  name             = each.value.name\n  location         = each.value.location\n  enable_telemetry = var.enable_telemetry\n  tags             = try(each.value.tags, null) == null ? module.config.outputs.tags : each.value.tags\n\n  providers = {\n    azurerm = azurerm.connectivity\n  }\n}\n</code></pre> <p>1\u884c\u305a\u3064\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#source-version","title":"source / version","text":"<pre><code>source  = \"Azure/avm-res-resources-resourcegroup/azurerm\"\nversion = \"0.2.1\"\n</code></pre> <p>\u4f55\u3057\u3066\u308b\uff1f Terraform Registry\u304b\u3089\u516c\u5f0f\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3002</p> <p>URL\uff1a https://registry.terraform.io/modules/Azure/avm-res-resources-resourcegroup/azurerm</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#for_each","title":"for_each","text":"<pre><code>for_each = { for key, value in module.config.outputs.connectivity_resource_groups : key =&gt; value if try(value.settings.enabled, true) }\n</code></pre> <p>**\u8907\u96d1\uff01**\u5206\u89e3\u3057\u3088\u3046\u3002</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_8","title":"\u57fa\u672c\u69cb\u9020","text":"<pre><code>for_each = \u30de\u30c3\u30d7\n</code></pre> <p>\u30de\u30c3\u30d7\u306e\u5404\u8981\u7d20\u306b\u5bfe\u3057\u3066\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u308b\u3002</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#for","title":"for\u5f0f","text":"<pre><code>{ for key, value in \u5143\u306e\u30de\u30c3\u30d7 : key =&gt; value if \u6761\u4ef6 }\n</code></pre> <p>\u3084\u3063\u3066\u308b\u3053\u3068\uff1a 1. <code>module.config.outputs.connectivity_resource_groups</code>\u304b\u3089\u5404\u8981\u7d20\u3092\u53d6\u5f97 2. \u6761\u4ef6\uff08<code>if</code>\uff09\u306b\u5408\u3046\u3082\u306e\u3060\u3051\u6b8b\u3059 3. \u65b0\u3057\u3044\u30de\u30c3\u30d7\u3092\u4f5c\u308b</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#tryvaluesettingsenabled-true","title":"\u6761\u4ef6: try(value.settings.enabled, true)","text":"<pre><code>try(value.settings.enabled, true)\n</code></pre> <p>\u610f\u5473\uff1a - <code>value.settings.enabled</code>\u304c\u5b58\u5728\u3059\u308c\u3070\u305d\u306e\u5024 - \u5b58\u5728\u3057\u306a\u3051\u308c\u3070<code>true</code></p> <p>\u52d5\u4f5c\uff1a <pre><code># enabled\u6307\u5b9a\u3042\u308a\nsettings = { enabled = false }\n# \u2193\ntry(value.settings.enabled, true) \u2192 false \u2192 \u4f5c\u3089\u306a\u3044\n\n# enabled\u6307\u5b9a\u306a\u3057\nsettings = {}\n# \u2193\ntry(value.settings.enabled, true) \u2192 true \u2192 \u4f5c\u308b\n\n# settings\u81ea\u4f53\u304c\u306a\u3044\n# \u2193\ntry(value.settings.enabled, true) \u2192 true \u2192 \u4f5c\u308b\n</code></pre></p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_9","title":"\u5177\u4f53\u4f8b","text":"<pre><code># \u5165\u529b\nconnectivity_resource_groups = {\n  primary = {\n    name = \"rg-primary\"\n    location = \"japaneast\"\n  }\n  secondary = {\n    name = \"rg-secondary\"\n    location = \"japanwest\"\n    settings = { enabled = false }\n  }\n  tertiary = {\n    name = \"rg-tertiary\"\n    location = \"eastus\"\n    settings = { enabled = true }\n  }\n}\n\n# for_each\u5f8c\n{\n  \"primary\" = { name = \"rg-primary\", location = \"japaneast\" }\n  # secondary\u306f\u9664\u5916\uff08enabled = false\uff09\n  \"tertiary\" = { name = \"rg-tertiary\", location = \"eastus\" }\n}\n\n# \u7d50\u679c\uff1aprimary\u3068tertiary\u3060\u3051\u4f5c\u3089\u308c\u308b\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#name-location","title":"name / location","text":"<pre><code>name     = each.value.name\nlocation = each.value.location\n</code></pre> <p>each.value\uff1a\u73fe\u5728\u51e6\u7406\u4e2d\u306e\u8981\u7d20</p> <pre><code># primary\u51e6\u7406\u4e2d\neach.value = {\n  name = \"rg-jp-connectivity\"\n  location = \"japaneast\"\n}\n\n# \u2193\nname = \"rg-jp-connectivity\"\nlocation = \"japaneast\"\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#tags","title":"tags","text":"<pre><code>tags = try(each.value.tags, null) == null ? module.config.outputs.tags : each.value.tags\n</code></pre> <p>\u4e09\u9805\u6f14\u7b97\u5b50\uff1a <pre><code>\u6761\u4ef6 ? \u771f\u306e\u5834\u5408 : \u507d\u306e\u5834\u5408\n</code></pre></p> <p>\u30ed\u30b8\u30c3\u30af\uff1a <pre><code>try(each.value.tags, null) == null\n  ? module.config.outputs.tags      # \u2190\u500b\u5225\u30bf\u30b0\u306a\u3057 \u2192 \u5168\u4f53\u30bf\u30b0\u4f7f\u3046\n  : each.value.tags                 # \u2190\u500b\u5225\u30bf\u30b0\u3042\u308a \u2192 \u305d\u308c\u4f7f\u3046\n</code></pre></p> <p>\u52d5\u4f5c\uff1a <pre><code># \u30b1\u30fc\u30b91: \u500b\u5225\u30bf\u30b0\u306a\u3057\nprimary = {\n  name = \"rg-hub\"\n  # tags\u306a\u3057\n}\n# \u2193\u5168\u4f53\u30bf\u30b0\u4f7f\u3046\ntags = { deployed_by = \"terraform\", source = \"alz-mgmt\" }\n\n# \u30b1\u30fc\u30b92: \u500b\u5225\u30bf\u30b0\u3042\u308a\nprimary = {\n  name = \"rg-hub\"\n  tags = { tier = \"network\" }\n}\n# \u2193\u500b\u5225\u30bf\u30b0\u4f7f\u3046\ntags = { tier = \"network\" }\n</code></pre></p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#providers","title":"providers","text":"<pre><code>providers = {\n  azurerm = azurerm.connectivity\n}\n</code></pre> <p>\u4f55\u3057\u3066\u308b\uff1f Connectivity\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306b\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u3002</p> <p>provider alias\uff1a <pre><code># terraform.tf\nprovider \"azurerm\" {\n  alias           = \"connectivity\"\n  subscription_id = var.subscription_ids[\"connectivity\"]\n  ...\n}\n</code></pre></p> <p>\u7279\u5b9a\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#part-4","title":"Part 4: \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u51fa\u529b","text":""},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_10","title":"\u4f55\u304c\u51fa\u529b\u3055\u308c\u308b\uff1f","text":"<pre><code># \u4f7f\u3044\u65b9\nmodule.resource_groups[\"primary\"].resource_group_id\n</code></pre> <p>\u51fa\u529b\u3055\u308c\u308b\u60c5\u5831\uff1a - <code>resource_group_id</code>\uff1a\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306eID - <code>name</code>\uff1a\u540d\u524d - <code>location</code>\uff1a\u5834\u6240</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_11","title":"\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u53c2\u7167","text":"<pre><code># VNet\u3092\u4f5c\u308b\u6642\nresource \"azurerm_virtual_network\" \"hub\" {\n  resource_group_name = module.resource_groups[\"primary\"].name\n  ...\n}\n</code></pre> <p>\u52b9\u679c\uff1a - \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7 \u2192 VNet\u306e\u9806\u756a\u3067\u4f5c\u3089\u308c\u308b\uff08\u4f9d\u5b58\u95a2\u4fc2\uff09</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_12","title":"\u5b9f\u8df5\uff1a\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u3092\u8ffd\u52a0\u3057\u3066\u307f\u3088\u3046","text":""},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#1-rg","title":"\u4f8b1: \u958b\u767a\u74b0\u5883\u7528RG","text":"<pre><code># platform-landing-zone.auto.tfvars\nconnectivity_resource_groups = {\n  primary = {\n    name     = \"rg-{{starter_location_01_short}}-connectivity\"\n    location = \"{{starter_location_01}}\"\n  }\n  dev = {\n    name     = \"rg-{{starter_location_01_short}}-dev\"\n    location = \"{{starter_location_01}}\"\n    tags = {\n      environment = \"development\"\n      tier        = \"network\"\n    }\n  }\n}\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#2","title":"\u4f8b2: \u8907\u6570\u30ea\u30fc\u30b8\u30e7\u30f3","text":"<pre><code>connectivity_resource_groups = {\n  japaneast = {\n    name     = \"rg-jpe-connectivity\"\n    location = \"japaneast\"\n    tags = { region = \"primary\" }\n  }\n  japanwest = {\n    name     = \"rg-jpw-connectivity\"\n    location = \"japanwest\"\n    tags = { region = \"secondary\" }\n  }\n  eastus = {\n    name     = \"rg-eus-connectivity\"\n    location = \"eastus\"\n    tags = { region = \"dr\" }\n  }\n}\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#3","title":"\u4f8b3: \u4e00\u6642\u7684\u306b\u7121\u52b9\u5316","text":"<pre><code>connectivity_resource_groups = {\n  primary = {\n    name     = \"rg-jp-connectivity\"\n    location = \"japaneast\"\n  }\n  secondary = {\n    name     = \"rg-jp-connectivity-sec\"\n    location = \"japanwest\"\n    settings = {\n      enabled = false  # \u2190\u4e00\u6642\u7684\u306b\u4f5c\u3089\u306a\u3044\n    }\n  }\n}\n</code></pre> <pre><code># \u5f8c\u3067\u6709\u52b9\u5316\nterraform apply  # \u2190secondary\u306f\u4f5c\u3089\u308c\u306a\u3044\n\n# enabled = true\u306b\u5909\u66f4\nterraform apply  # \u2190secondary\u304c\u4f5c\u3089\u308c\u308b\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_13","title":"\u30c7\u30d0\u30c3\u30b0\u6280","text":""},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_14","title":"\u51fa\u529b\u3067\u78ba\u8a8d","text":"<pre><code># outputs.tf\noutput \"debug_resource_groups\" {\n  value = {\n    for key, rg in module.resource_groups : key =&gt; {\n      id       = rg.resource_group_id\n      name     = rg.name\n      location = rg.location\n    }\n  }\n}\n</code></pre> <pre><code>terraform apply\n\n# \u2193\u51fa\u529b\nOutputs:\n  debug_resource_groups = {\n    \"primary\" = {\n      id       = \"/subscriptions/.../resourceGroups/rg-jp-connectivity\"\n      name     = \"rg-jp-connectivity\"\n      location = \"japaneast\"\n    }\n  }\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#azure","title":"Azure\u3067\u78ba\u8a8d","text":"<pre><code># \u4f5c\u6210\u3055\u308c\u305f\u304b\u78ba\u8a8d\naz group list --output table\n\n# \u7279\u5b9a\u306eRG\u306e\u8a73\u7d30\naz group show --name rg-jp-connectivity\n</code></pre>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_15","title":"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc","text":""},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#1","title":"\u30a8\u30e9\u30fc1: \u540d\u524d\u306e\u91cd\u8907","text":"<pre><code>Error: A resource with the ID \"/subscriptions/.../resourceGroups/rg-hub\" already exists\n</code></pre> <p>\u539f\u56e0\uff1a\u540c\u3058\u540d\u524d\u306e\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u304c\u65e2\u306b\u5b58\u5728</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># \u540d\u524d\u3092\u5909\u3048\u308b\nname = \"rg-jp-connectivity-v2\"\n\n# \u307e\u305f\u306f\u65e2\u5b58\u3092\u524a\u9664\naz group delete --name rg-jp-connectivity\n</code></pre></p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#2-location","title":"\u30a8\u30e9\u30fc2: \u7121\u52b9\u306alocation","text":"<pre><code>Error: Invalid value for location\n</code></pre> <p>\u539f\u56e0\uff1alocation\u306e\u7db4\u308a\u30df\u30b9</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># NG\nlocation = \"japan-east\"  # \u30cf\u30a4\u30d5\u30f3\u5165\u3063\u3066\u308b\n\n# OK\nlocation = \"japaneast\"  # \u30cf\u30a4\u30d5\u30f3\u306a\u3057\n</code></pre></p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#3-for_each","title":"\u30a8\u30e9\u30fc3: for_each\u306e\u30a8\u30e9\u30fc","text":"<pre><code>Error: The for_each value does not have any elements\n</code></pre> <p>\u539f\u56e0\uff1a<code>connectivity_resource_groups</code>\u304c\u7a7a</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># tfvars\u3067\u6700\u4f4e1\u500b\u5b9a\u7fa9\nconnectivity_resource_groups = {\n  primary = {\n    name     = \"rg-hub\"\n    location = \"japaneast\"\n  }\n}\n</code></pre></p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_16","title":"\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#1_1","title":"\u30d1\u30bf\u30fc\u30f31: \u6a5f\u80fd\u5225","text":"<pre><code>connectivity_resource_groups = {\n  network = {\n    name     = \"rg-network\"\n    location = \"japaneast\"\n  }\n  security = {\n    name     = \"rg-security\"\n    location = \"japaneast\"\n  }\n  management = {\n    name     = \"rg-management\"\n    location = \"japaneast\"\n  }\n}\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a\u5f79\u5272\u304c\u660e\u78ba \u30c7\u30e1\u30ea\u30c3\u30c8\uff1a\u30ea\u30bd\u30fc\u30b9\u6570\u304c\u591a\u3044\u3068\u7ba1\u7406\u304c\u5927\u5909</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#2_1","title":"\u30d1\u30bf\u30fc\u30f32: \u30ea\u30fc\u30b8\u30e7\u30f3\u5225","text":"<pre><code>connectivity_resource_groups = {\n  japaneast = {\n    name     = \"rg-jpe-connectivity\"\n    location = \"japaneast\"\n  }\n  japanwest = {\n    name     = \"rg-jpw-connectivity\"\n    location = \"japanwest\"\n  }\n}\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a\u30de\u30eb\u30c1\u30ea\u30fc\u30b8\u30e7\u30f3\u69cb\u6210\u304c\u308f\u304b\u308a\u3084\u3059\u3044 \u30c7\u30e1\u30ea\u30c3\u30c8\uff1a\u540c\u3058\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u8907\u6570RG\u3042\u308b\u3068\u6df7\u4e71</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#3_1","title":"\u30d1\u30bf\u30fc\u30f33: \u74b0\u5883\u5225","text":"<pre><code>connectivity_resource_groups = {\n  prod = {\n    name     = \"rg-prod-connectivity\"\n    location = \"japaneast\"\n  }\n  dev = {\n    name     = \"rg-dev-connectivity\"\n    location = \"japaneast\"\n  }\n}\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a\u74b0\u5883\u5206\u96e2\u304c\u7c21\u5358 \u30c7\u30e1\u30ea\u30c3\u30c8\uff1aLanding Zones\u306e\u601d\u60f3\u3068\u5408\u308f\u306a\u3044\uff08\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3067\u5206\u96e2\u3059\u3079\u304d\uff09</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_17","title":"\u304a\u3059\u3059\u3081\uff1a\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9","text":"<pre><code>connectivity_resource_groups = {\n  primary_network = {\n    name     = \"rg-jpe-network\"\n    location = \"japaneast\"\n    tags = { tier = \"network\", region = \"primary\" }\n  }\n  secondary_network = {\n    name     = \"rg-jpw-network\"\n    location = \"japanwest\"\n    tags = { tier = \"network\", region = \"secondary\" }\n  }\n}\n</code></pre> <p>**\u30ea\u30fc\u30b8\u30e7\u30f3 \u00d7 \u6a5f\u80fd**\u3067\u5206\u3051\u308b\u3002\u308f\u304b\u308a\u3084\u3059\u3044\u3002</p>"},{"location":"07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/#_18","title":"\u307e\u3068\u3081","text":"<p>\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u5f79\u5272\uff1a 1. \u30ea\u30bd\u30fc\u30b9\u306e\u7bb1\uff1a\u5168\u3066\u306e\u30ea\u30bd\u30fc\u30b9\u306fRG\u306b\u5c5e\u3059\u308b 2. \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\uff1aRG\u524a\u9664\u3067\u4e2d\u8eab\u3082\u5168\u90e8\u524a\u9664 3. \u30a2\u30af\u30bb\u30b9\u5236\u5fa1\uff1aRG\u5358\u4f4d\u3067\u6a29\u9650\u7ba1\u7406 4. \u30bf\u30b0\u4ed8\u3051\uff1a\u30b3\u30b9\u30c8\u7ba1\u7406\u3001\u691c\u7d22</p> <p>\u899a\u3048\u3066\u304a\u304f\u3053\u3068\uff1a - <code>for_each</code>\u3067\u30de\u30c3\u30d7\u3092\u5c55\u958b - <code>try(value.settings.enabled, true)</code>\u3067\u6709\u52b9/\u7121\u52b9\u5236\u5fa1 - \u30bf\u30b0\u306f\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\uff08\u500b\u5225 \u2192 \u5168\u4f53\uff09 - <code>providers</code>\u3067\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u6307\u5b9a</p> <p>\u6b21\u306eChapter\u3067\u306f\u3001\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u30ac\u30d0\u30ca\u30f3\u30b9\u306e\u8981\u3068\u306a\u308b\u90e8\u5206\u3067\u3059\u3002</p> <p>\u6240\u8981\u6642\u9593: 40\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2606\u2606 \u524d: 06_\u8a2d\u5b9a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8.md \u6b21: 08_\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc.md</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/","title":"08. \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc - \u30ac\u30d0\u30ca\u30f3\u30b9\u306e\u8981","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#8","title":"8\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3068\u306e\u5bfe\u5fdc","text":"<p>\u3053\u306eChapter\u306f\u4ee5\u4e0b\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a - \u2705 2. Identity and Access Management\uff08ID\u30fb\u30a2\u30af\u30bb\u30b9\u7ba1\u7406 - RBAC\u3001\u6a29\u9650\u7ba1\u7406\uff09 - \u2705 3. Resource Organization\uff08\u30ea\u30bd\u30fc\u30b9\u6574\u7406 - \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u968e\u5c64\uff09 - \u2705 5. Security\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3 - \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30dd\u30ea\u30b7\u30fc\uff09 - \u2705 7. Governance\uff08\u30ac\u30d0\u30ca\u30f3\u30b9 - \u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\u3068\u9069\u7528\uff09</p> <p>\u2192 Chapter 01\u3067\u5b66\u3093\u30608\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5fa9\u7fd2\u3057\u305f\u3044\u65b9\u306f01_\u57fa\u790e\u77e5\u8b58.md\u3078</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc\u306e\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3057\u3088\u3046\u3002</p> <p>\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3063\u3066\u4f55\uff1f \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u675f\u306d\u308b\u300c\u30d5\u30a9\u30eb\u30c0\u300d\u307f\u305f\u3044\u306a\u3082\u3093\u3002</p> <p>\u30dd\u30ea\u30b7\u30fc\u3063\u3066\u4f55\uff1f \u300c\u3053\u308c\u3084\u3063\u3061\u3083\u30c0\u30e1\u300d\u300c\u3053\u308c\u3084\u3089\u306a\u3044\u3068\u30c0\u30e1\u300d\u307f\u305f\u3044\u306a\u30eb\u30fc\u30eb\u3002</p> <p>\u4f8b\u3048\u308b\u306a\u3089\uff1a - \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\uff1a\u4f1a\u793e\u306e\u90e8\u7f72\uff08\u55b6\u696d\u90e8\u3001\u958b\u767a\u90e8\u3001\u7dcf\u52d9\u90e8\uff09 - \u30dd\u30ea\u30b7\u30fc\uff1a\u793e\u5185\u898f\u5b9a\uff08\u300c\u7d4c\u8cbb\u306f1\u4e07\u5186\u307e\u3067\u300d\u300c\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7814\u4fee\u5fc5\u9808\u300d\uff09 - \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\uff1a\u5404\u30c1\u30fc\u30e0</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_1","title":"\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u57fa\u672c","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_2","title":"\u968e\u5c64\u69cb\u9020","text":"<p>\ud83d\udcca \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u968e\u5c64\uff08\u5b8c\u5168\u7248\uff09</p> <pre><code>Tenant Root Group\uff08\u6700\u4e0a\u4f4d\uff09\n\u2502\n\u2514\u2500\u2500 alz\uff08Azure Landing Zones\uff09\n    \u2502\n    \u251c\u2500\u2500 platform\uff08\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5c64\uff09\u2500 \u30a4\u30f3\u30d5\u30e9\u57fa\u76e4\u30c1\u30fc\u30e0\n    \u2502   \u251c\u2500\u2500 management\uff08\u7ba1\u7406\uff09\u2500 \u30ed\u30b0\u30fb\u76e3\u8996\u30b7\u30b9\u30c6\u30e0\n    \u2502   \u2502   \u2514\u2500\u2500 [Subscription: Management]\n    \u2502   \u2502       \u251c\u2500\u2500 Log Analytics Workspace\n    \u2502   \u2502       \u251c\u2500\u2500 Automation Account\n    \u2502   \u2502       \u2514\u2500\u2500 Data Collection Rules\n    \u2502   \u2502\n    \u2502   \u251c\u2500\u2500 connectivity\uff08\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09\u2500 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u57fa\u76e4\n    \u2502   \u2502   \u2514\u2500\u2500 [Subscription: Connectivity]\n    \u2502   \u2502       \u251c\u2500\u2500 Hub VNet\uff08\u6771\u65e5\u672c\u30fb\u897f\u65e5\u672c\uff09\n    \u2502   \u2502       \u251c\u2500\u2500 Firewall\n    \u2502   \u2502       \u251c\u2500\u2500 Bastion\n    \u2502   \u2502       \u2514\u2500\u2500 VPN/ExpressRoute Gateway\n    \u2502   \u2502\n    \u2502   \u251c\u2500\u2500 identity\uff08ID\u7ba1\u7406\uff09\u2500 \u8a8d\u8a3c\u30fb\u8a8d\u53ef\u30b7\u30b9\u30c6\u30e0\n    \u2502   \u2502   \u2514\u2500\u2500 [Subscription: Identity]\n    \u2502   \u2502       \u2514\u2500\u2500 Azure AD Domain Services\u7b49\n    \u2502   \u2502\n    \u2502   \u2514\u2500\u2500 security\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\uff09\u2500 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u76e3\u8996\n    \u2502       \u2514\u2500\u2500 [Subscription: Security]\n    \u2502           \u2514\u2500\u2500 Defender for Cloud\u7b49\n    \u2502\n    \u251c\u2500\u2500 landingzones\uff08\u30e9\u30f3\u30c7\u30a3\u30f3\u30b0\u30be\u30fc\u30f3\u5c64\uff09\u2500 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\n    \u2502   \u251c\u2500\u2500 corp\uff08\u793e\u5185\u30a2\u30d7\u30ea\uff09\u2500 \u793e\u5185\u30b7\u30b9\u30c6\u30e0\u7528\n    \u2502   \u2502   \u2514\u2500\u2500 [Subscription: Corp-App]\n    \u2502   \u2502       \u2514\u2500\u2500 \u4f1a\u8a08\u30b7\u30b9\u30c6\u30e0\u3001\u4eba\u4e8b\u30b7\u30b9\u30c6\u30e0\u7b49\n    \u2502   \u2502\n    \u2502   \u2514\u2500\u2500 online\uff08\u516c\u958b\u30a2\u30d7\u30ea\uff09\u2500 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u516c\u958b\u7528\n    \u2502       \u2514\u2500\u2500 [Subscription: Online-App]\n    \u2502           \u2514\u2500\u2500 Web\u30b5\u30fc\u30d3\u30b9\u3001API\u7b49\n    \u2502\n    \u251c\u2500\u2500 sandbox\uff08\u5b9f\u9a13\u74b0\u5883\uff09\u2500 \u691c\u8a3c\u30fb\u30c6\u30b9\u30c8\u7528\n    \u2502   \u2514\u2500\u2500 [Subscription: Sandbox]\n    \u2502       \u2514\u2500\u2500 \u958b\u767a\u8005\u304c\u81ea\u7531\u306b\u4f7f\u3048\u308b\n    \u2502\n    \u2514\u2500\u2500 decommissioned\uff08\u5ec3\u6b62\u4e88\u5b9a\uff09\u2500 \u524a\u9664\u524d\u306e\u4e00\u6642\u4fdd\u7ba1\n        \u2514\u2500\u2500 [Subscription: Old-System]\n            \u2514\u2500\u2500 \u524a\u9664\u4e88\u5b9a\u306e\u30ea\u30bd\u30fc\u30b9\n</code></pre> <p>\ud83c\udfaf \u5404\u5c64\u306e\u5f79\u5272\u307e\u3068\u3081</p> \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7 \u5f79\u5272 \u8ab0\u304c\u4f7f\u3046 \u30dd\u30ea\u30b7\u30fc platform \u30a4\u30f3\u30d5\u30e9\u57fa\u76e4 \u30a4\u30f3\u30d5\u30e9\u30c1\u30fc\u30e0 \u53b3\u3057\u3044\uff08\u5909\u66f4\u5236\u9650\uff09 - management \u30ed\u30b0\u30fb\u76e3\u8996 \u30a4\u30f3\u30d5\u30e9\u30c1\u30fc\u30e0 \u524a\u9664\u7981\u6b62 - connectivity \u30cd\u30c3\u30c8\u30ef\u30fc\u30af \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c1\u30fc\u30e0 \u5909\u66f4\u8981\u627f\u8a8d - identity \u8a8d\u8a3c\u30fb\u8a8d\u53ef \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c1\u30fc\u30e0 \u6700\u9ad8\u30ec\u30d9\u30eb - security \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u76e3\u8996 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c1\u30fc\u30e0 \u6700\u9ad8\u30ec\u30d9\u30eb landingzones \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u958b\u767a\u30c1\u30fc\u30e0 \u6a19\u6e96 - corp \u793e\u5185\u30a2\u30d7\u30ea \u958b\u767a\u30c1\u30fc\u30e0 \u6a19\u6e96+\u793e\u5185\u63a5\u7d9a\u306e\u307f - online \u516c\u958b\u30a2\u30d7\u30ea \u958b\u767a\u30c1\u30fc\u30e0 \u6a19\u6e96+\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u8a31\u53ef sandbox \u5b9f\u9a13\u74b0\u5883 \u5168\u54e1 \u7de9\u3044\uff08\u81ea\u7531\u306b\u5b9f\u9a13\uff09 decommissioned \u5ec3\u6b62\u4e88\u5b9a \u524a\u9664\u62c5\u5f53\u8005 \u8aad\u307f\u53d6\u308a\u5c02\u7528 <pre><code>Tenant Root Group\uff08\u30c6\u30ca\u30f3\u30c8\u30eb\u30fc\u30c8\uff09\n  \u2514\u2500\u2500 alz\uff08Azure Landing Zones\uff09\n      \u251c\u2500\u2500 platform\uff08\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\uff09\n      \u2502   \u251c\u2500\u2500 management\uff08\u7ba1\u7406\uff09\n      \u2502   \u251c\u2500\u2500 connectivity\uff08\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09\n      \u2502   \u251c\u2500\u2500 identity\uff08ID\u7ba1\u7406\uff09\n      \u2502   \u2514\u2500\u2500 security\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\uff09\n      \u251c\u2500\u2500 landingzones\uff08\u30e9\u30f3\u30c7\u30a3\u30f3\u30b0\u30be\u30fc\u30f3\uff09\n      \u2502   \u251c\u2500\u2500 corp\uff08\u793e\u5185\u30a2\u30d7\u30ea\uff09\n      \u2502   \u2514\u2500\u2500 online\uff08\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u516c\u958b\uff09\n      \u251c\u2500\u2500 sandbox\uff08\u691c\u8a3c\u74b0\u5883\uff09\n      \u2514\u2500\u2500 decommissioned\uff08\u5ec3\u6b62\u4e88\u5b9a\uff09\n</code></pre> <p>\u968e\u5c64\u306e\u30eb\u30fc\u30eb\uff1a - \u6700\u59276\u968e\u5c64\u307e\u3067 - 1\u3064\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306f1\u3064\u306e\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306b\u306e\u307f\u6240\u5c5e - \u30dd\u30ea\u30b7\u30fc\u306f\u5b50\u306b\u7d99\u627f\u3055\u308c\u308b</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_3","title":"\u306a\u3093\u3067\u968e\u5c64\u5316\u3059\u308b\u306e\uff1f","text":"<p>\u7406\u75311\uff1a\u30ac\u30d0\u30ca\u30f3\u30b9 <pre><code>platform\u914d\u4e0b\uff1a\u53b3\u3057\u3044\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30dd\u30ea\u30b7\u30fc\nsandbox\u914d\u4e0b\uff1a\u7de9\u3044\u30dd\u30ea\u30b7\u30fc\uff08\u5b9f\u9a13\u7528\uff09\n</code></pre></p> <p>\u7406\u75312\uff1a\u6a29\u9650\u7ba1\u7406 <pre><code>platform\u306e\u7ba1\u7406\u8005\uff1aplatform\u914d\u4e0b\u3060\u3051\u89e6\u308c\u308b\nlandingzones\u306e\u7ba1\u7406\u8005\uff1alandingzones\u914d\u4e0b\u3060\u3051\u89e6\u308c\u308b\n</code></pre></p> <p>\u7406\u75313\uff1a\u30b3\u30b9\u30c8\u7ba1\u7406 <pre><code>platform\uff1a\u30a4\u30f3\u30d5\u30e9\u30b3\u30b9\u30c8\nlandingzones\uff1a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30b9\u30c8\n\u2192 \u5206\u3051\u3066\u96c6\u8a08\u3067\u304d\u308b\n</code></pre></p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#part-1-alz_customalz_architecture_definitionyaml","title":"Part 1: \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5b9a\u7fa9\uff08alz_custom.alz_architecture_definition.yaml\uff09","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_4","title":"\u30d5\u30a1\u30a4\u30eb\u69cb\u9020","text":"<pre><code>lib/\n  \u2514\u2500\u2500 architecture_definitions/\n      \u2514\u2500\u2500 alz_custom.alz_architecture_definition.yaml  # \u2190\u3053\u308c\n</code></pre>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_5","title":"\u5185\u5bb9\u3092\u898b\u3066\u307f\u3088\u3046","text":"<pre><code>name: alz_custom\nmanagement_groups:\n  - id: alz\n    display_name: Azure Landing Zones\n    archetypes:\n      - root_custom\n    exists: false\n    parent_id: null\n</code></pre> <p>\u30d5\u30a3\u30fc\u30eb\u30c9\u89e3\u8aac\uff1a</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#id","title":"id","text":"<pre><code>id: alz\n</code></pre> <p>\u4f55\uff1f\uff1a\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306eID\uff08\u30d7\u30ed\u30b0\u30e9\u30e0\u5185\u3067\u4f7f\u3046\u540d\u524d\uff09</p> <p>\u30eb\u30fc\u30eb\uff1a - \u5c0f\u6587\u5b57\u82f1\u6570\u5b57\u3068\u30cf\u30a4\u30d5\u30f3\u306e\u307f - \u4e00\u610f\uff08\u91cd\u8907\u4e0d\u53ef\uff09</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#display_name","title":"display_name","text":"<pre><code>display_name: Azure Landing Zones\n</code></pre> <p>\u4f55\uff1f\uff1a\u8868\u793a\u540d\uff08\u4eba\u9593\u304c\u898b\u308b\u540d\u524d\uff09</p> <p>Azure\u30dd\u30fc\u30bf\u30eb\u3067\u3053\u306e\u540d\u524d\u304c\u8868\u793a\u3055\u308c\u308b\u3002</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#archetypes","title":"archetypes","text":"<pre><code>archetypes:\n  - root_custom\n</code></pre> <p>\u4f55\uff1f\uff1a\u9069\u7528\u3059\u308b\u30dd\u30ea\u30b7\u30fc\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8</p> <p><code>lib/archetype_definitions/root_custom.alz_archetype_override.yaml</code>\u3092\u53c2\u7167\u3002</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#exists","title":"exists","text":"<pre><code>exists: false\n</code></pre> <p>\u4f55\uff1f\uff1a\u65e2\u306b\u5b58\u5728\u3059\u308b\u304b\uff1f</p> <ul> <li><code>false</code>\uff1aTerraform\u3067\u4f5c\u6210</li> <li><code>true</code>\uff1a\u65e2\u5b58\uff08\u53c2\u7167\u306e\u307f\uff09</li> </ul>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#parent_id","title":"parent_id","text":"<pre><code>parent_id: null\n</code></pre> <p>\u4f55\uff1f\uff1a\u89aa\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306eID</p> <ul> <li><code>null</code>\uff1a\u30c6\u30ca\u30f3\u30c8\u30eb\u30fc\u30c8\u306e\u76f4\u4e0b</li> <li><code>alz</code>\uff1aalz\u306e\u914d\u4e0b</li> </ul>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_6","title":"\u968e\u5c64\u306e\u5168\u4f53\u50cf","text":"<pre><code># \u30eb\u30fc\u30c8\n- id: alz\n  parent_id: null  # \u2190\u30c6\u30ca\u30f3\u30c8\u30eb\u30fc\u30c8\u76f4\u4e0b\n\n# \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\n- id: platform\n  parent_id: alz  # \u2190alz\u306e\u914d\u4e0b\n\n# \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\uff08\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u914d\u4e0b\uff09\n- id: management\n  parent_id: platform  # \u2190platform\u306e\u914d\u4e0b\n\n- id: connectivity\n  parent_id: platform\n\n- id: identity\n  parent_id: platform\n\n- id: security\n  parent_id: platform\n\n# \u30e9\u30f3\u30c7\u30a3\u30f3\u30b0\u30be\u30fc\u30f3\n- id: landingzones\n  parent_id: alz\n\n- id: corp\n  parent_id: landingzones  # \u2190landingzones\u306e\u914d\u4e0b\n\n- id: online\n  parent_id: landingzones\n\n# \u305d\u306e\u4ed6\n- id: sandbox\n  parent_id: alz\n\n- id: decommissioned\n  parent_id: alz\n</code></pre> <p>\u56f3\u306b\u3059\u308b\u3068\u3053\u3046\uff1a <pre><code>alz\n\u251c\u2500\u2500 platform\n\u2502   \u251c\u2500\u2500 management\n\u2502   \u251c\u2500\u2500 connectivity\n\u2502   \u251c\u2500\u2500 identity\n\u2502   \u2514\u2500\u2500 security\n\u251c\u2500\u2500 landingzones\n\u2502   \u251c\u2500\u2500 corp\n\u2502   \u2514\u2500\u2500 online\n\u251c\u2500\u2500 sandbox\n\u2514\u2500\u2500 decommissioned\n</code></pre></p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#part-2-archetype_definitions","title":"Part 2: \u30a2\u30fc\u30ad\u30bf\u30a4\u30d7\u5b9a\u7fa9\uff08archetype_definitions/\uff09","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_7","title":"\u30a2\u30fc\u30ad\u30bf\u30a4\u30d7\u3063\u3066\u4f55\uff1f","text":"<p>**\u30dd\u30ea\u30b7\u30fc\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8**\u307f\u305f\u3044\u306a\u3082\u3093\u3002</p> <p>\u4f8b\uff1a - <code>root_custom</code>\uff1a\u30eb\u30fc\u30c8\u7528\u306e\u30dd\u30ea\u30b7\u30fc\u30bb\u30c3\u30c8 - <code>platform_custom</code>\uff1a\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u7528 - <code>landing_zones_custom</code>\uff1a\u30e9\u30f3\u30c7\u30a3\u30f3\u30b0\u30be\u30fc\u30f3\u7528</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_8","title":"\u30d5\u30a1\u30a4\u30eb\u69cb\u9020","text":"<pre><code>lib/\n  \u2514\u2500\u2500 archetype_definitions/\n      \u251c\u2500\u2500 root_custom.alz_archetype_override.yaml\n      \u251c\u2500\u2500 platform_custom.alz_archetype_override.yaml\n      \u251c\u2500\u2500 management_custom.alz_archetype_override.yaml\n      \u251c\u2500\u2500 connectivity_custom.alz_archetype_override.yaml\n      \u251c\u2500\u2500 identity_custom.alz_archetype_override.yaml\n      \u251c\u2500\u2500 security_custom.alz_archetype_override.yaml\n      \u251c\u2500\u2500 landing_zones_custom.alz_archetype_override.yaml\n      \u251c\u2500\u2500 corp_custom.alz_archetype_override.yaml\n      \u251c\u2500\u2500 online_custom.alz_archetype_override.yaml\n      \u251c\u2500\u2500 sandbox_custom.alz_archetype_override.yaml\n      \u2514\u2500\u2500 decommissioned_custom.alz_archetype_override.yaml\n</code></pre>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#root_customalz_archetype_overrideyaml","title":"root_custom.alz_archetype_override.yaml","text":"<pre><code>base_archetype: root\nname: root_custom\npolicy_assignments_to_add: []\npolicy_assignments_to_remove: []\npolicy_definitions_to_add: []\npolicy_definitions_to_remove: []\npolicy_set_definitions_to_add: []\npolicy_set_definitions_to_remove: []\nrole_definitions_to_add: []\nrole_definitions_to_remove: []\n</code></pre> <p>\u30d5\u30a3\u30fc\u30eb\u30c9\u89e3\u8aac\uff1a</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#base_archetype","title":"base_archetype","text":"<pre><code>base_archetype: root\n</code></pre> <p>\u4f55\uff1f\uff1a\u30d9\u30fc\u30b9\u3068\u306a\u308b\u30a2\u30fc\u30ad\u30bf\u30a4\u30d7</p> <p>ALZ\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u7d44\u307f\u8fbc\u307e\u308c\u3066\u308b<code>root</code>\u30a2\u30fc\u30ad\u30bf\u30a4\u30d7\u3092\u7d99\u627f\u3002</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#policy_assignments_to_add","title":"policy_assignments_to_add","text":"<pre><code>policy_assignments_to_add: []\n</code></pre> <p>\u4f55\uff1f\uff1a\u8ffd\u52a0\u3059\u308b\u30dd\u30ea\u30b7\u30fc\u5272\u308a\u5f53\u3066</p> <p>\u4f8b\uff08\u30ab\u30b9\u30bf\u30e0\u30dd\u30ea\u30b7\u30fc\u3092\u8ffd\u52a0\u3057\u305f\u3044\u5834\u5408\uff09\uff1a <pre><code>policy_assignments_to_add:\n  - name: custom-tagging-policy\n    policy_definition_id: /providers/Microsoft.Management/managementGroups/alz/providers/Microsoft.Authorization/policyDefinitions/custom-tags\n    parameters:\n      requiredTags:\n        value: [\"environment\", \"owner\"]\n</code></pre></p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#policy_assignments_to_remove","title":"policy_assignments_to_remove","text":"<pre><code>policy_assignments_to_remove: []\n</code></pre> <p>\u4f55\uff1f\uff1a\u524a\u9664\u3059\u308b\u30dd\u30ea\u30b7\u30fc\u5272\u308a\u5f53\u3066</p> <p>\u4f8b\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u7121\u52b9\u5316\u3057\u305f\u3044\u5834\u5408\uff09\uff1a <pre><code>policy_assignments_to_remove:\n  - Deploy-MDFC-DefenderSQL-AMA\n</code></pre></p> <p>Chapter 3\u3067\u898b\u305f\u8a2d\u5b9a\u3067\u3059\u3002</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#part-3-tfvars","title":"Part 3: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08tfvars\uff09","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#management_group_settings","title":"management_group_settings","text":"<p>Chapter 3\u3067\u898b\u305f\u3053\u308c\uff1a</p> <pre><code>management_group_settings = {\n  architecture_name = \"alz\"\n  location          = \"{{starter_location_01}}\"\n\n  policy_default_values = {\n    ama_change_tracking_data_collection_rule_id = \"{{ama_change_tracking_data_collection_rule_id}}\"\n    ama_mdfc_data_collection_rule_id            = \"{{ama_mdfc_data_collection_rule_id}}\"\n    ama_user_assigned_managed_identity_id       = \"{{ama_user_assigned_managed_identity_id}}\"\n    ama_user_assigned_managed_identity_name     = \"{{ama_user_assigned_managed_identity_name}}\"\n    log_analytics_workspace_id                  = \"{{log_analytics_workspace_id}}\"\n    ddos_protection_plan_id                     = \"{{ddos_protection_plan_id}}\"\n    private_dns_zone_subscription_id            = \"{{subscription_id_connectivity}}\"\n  }\n\n  subscription_placement = {\n    management   = [\"{{subscription_id_management}}\"]\n    connectivity = [\"{{subscription_id_connectivity}}\"]\n    identity     = [\"{{subscription_id_identity}}\"]\n  }\n}\n</code></pre>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#architecture_name","title":"architecture_name","text":"<pre><code>architecture_name = \"alz\"\n</code></pre> <p>\u4f55\uff1f\uff1a\u4f7f\u7528\u3059\u308b\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5b9a\u7fa9\u306e\u540d\u524d</p> <p><code>lib/architecture_definitions/alz_custom.alz_architecture_definition.yaml</code>\u306e<code>name</code>\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u4e00\u81f4\u3055\u305b\u308b\u3002</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#location","title":"location","text":"<pre><code>location = \"{{starter_location_01}}\"\n</code></pre> <p>\u4f55\uff1f\uff1a\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u5834\u6240</p> <p>\u5b9f\u306f\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u81ea\u4f53\u306f\u5834\u6240\u3092\u6301\u305f\u306a\u3044\u3093\u3060\u3051\u3069\u3001\u30dd\u30ea\u30b7\u30fc\u5272\u308a\u5f53\u3066\u306e\u30c7\u30d7\u30ed\u30a4\u30e1\u30f3\u30c8\u7528\u3002</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#policy_default_values","title":"policy_default_values","text":"<pre><code>policy_default_values = {\n  log_analytics_workspace_id = \"{{log_analytics_workspace_id}}\"\n  ...\n}\n</code></pre> <p>\u4f55\uff1f\uff1a\u30dd\u30ea\u30b7\u30fc\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf</p> <p>\u591a\u304f\u306e\u30dd\u30ea\u30b7\u30fc\u304c\u300cLog Analytics\u306b\u30ed\u30b0\u9001\u4fe1\u300d\u3092\u8981\u6c42\u3059\u308b\u304b\u3089\u3001\u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9ID\u3092\u3053\u3053\u3067\u4e00\u5143\u7ba1\u7406\u3002</p> <p>\u30e1\u30ea\u30c3\u30c8\uff1a <pre><code># \u3053\u308c\u3084\u3089\u306a\u304f\u3066\u3044\u3044\uff08\u81ea\u52d5\u3067\u8a2d\u5b9a\u3055\u308c\u308b\uff09\npolicy_assignment \"logging\" {\n  parameters = {\n    log_analytics_workspace_id = \"/subscriptions/.../workspaces/law-jp\"\n  }\n}\n</code></pre></p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#subscription_placement","title":"subscription_placement","text":"<pre><code>subscription_placement = {\n  management   = [\"{{subscription_id_management}}\"]\n  connectivity = [\"{{subscription_id_connectivity}}\"]\n  identity     = [\"{{subscription_id_identity}}\"]\n}\n</code></pre> <p>\u4f55\uff1f\uff1a\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u3069\u306e\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306b\u914d\u7f6e\u3059\u308b\u304b</p> <p>\u4f8b\uff1a <pre><code>subscription_placement = {\n  management   = [\"12345678-1234-1234-1234-123456789012\"]\n  connectivity = [\"87654321-4321-4321-4321-210987654321\"]\n  corp         = [\"aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee\", \"ffffffff-gggg-hhhh-iiii-jjjjjjjjjjjj\"]\n}\n</code></pre></p> <p>\u7d50\u679c\uff1a <pre><code>management \u30b0\u30eb\u30fc\u30d7\n  \u2514\u2500\u2500 \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3 12345678-...\n\nconnectivity \u30b0\u30eb\u30fc\u30d7\n  \u2514\u2500\u2500 \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3 87654321-...\n\ncorp \u30b0\u30eb\u30fc\u30d7\n  \u251c\u2500\u2500 \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3 aaaaaaaa-...\n  \u2514\u2500\u2500 \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3 ffffffff-...\n</code></pre></p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#part-4-mainmanagementtf","title":"Part 4: \u30e2\u30b8\u30e5\u30fc\u30eb\u547c\u3073\u51fa\u3057\uff08main.management.tf\uff09","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#management_groups","title":"management_groups \u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>module \"management_groups\" {\n  source = \"./modules/management_groups\"\n\n  count = var.management_groups_enabled ? 1 : 0\n\n  enable_telemetry          = var.enable_telemetry\n  management_group_settings = local.management_group_settings\n}\n</code></pre>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#count","title":"count","text":"<pre><code>count = var.management_groups_enabled ? 1 : 0\n</code></pre> <p>\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u4f5c\u6210\u306e\u6709\u52b9/\u7121\u52b9\u3092\u5207\u308a\u66ff\u3048\u3002</p> <p>\u4f7f\u3044\u9053\uff1a <pre><code># tfvars\nmanagement_groups_enabled = false  # \u2190\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u4f5c\u3089\u306a\u3044\uff08\u65e2\u5b58\u4f7f\u3046\uff09\n\n# \u307e\u305f\u306f\nmanagement_groups_enabled = true  # \u2190\u4f5c\u308b\n</code></pre></p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#management_group_settings_1","title":"management_group_settings","text":"<pre><code>management_group_settings = local.management_group_settings\n</code></pre> <p>Chapter 5\u3067\u898b\u305f<code>locals.tf</code>\u3067\u51e6\u7406\u3055\u308c\u305f\u8a2d\u5b9a\u304c\u6e21\u3055\u308c\u308b\u3002</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#modulesmanagement_groupsmaintf","title":"modules/management_groups/main.tf","text":"<pre><code>module \"management_groups\" {\n  source  = \"Azure/avm-ptn-alz/azurerm\"\n  version = \"0.14.1\"\n\n  architecture_name                     = var.management_group_settings.architecture_name\n  parent_resource_id                    = var.management_group_settings.parent_resource_id\n  location                              = var.management_group_settings.location\n  policy_default_values                 = local.policy_default_values\n  policy_assignments_to_modify          = local.policy_assignments_to_modify\n  subscription_placement                = var.management_group_settings.subscription_placement\n  dependencies                          = var.management_group_settings.dependencies\n  ...\n}\n</code></pre> <p>**Azure\u516c\u5f0f\u30e2\u30b8\u30e5\u30fc\u30eb**\u3092\u4f7f\u3063\u3066\u308b\u3002</p> <p>URL\uff1a https://registry.terraform.io/modules/Azure/avm-ptn-alz/azurerm</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_9","title":"\u30dd\u30ea\u30b7\u30fc\u306e\u4ed5\u7d44\u307f","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_10","title":"\u30dd\u30ea\u30b7\u30fc\u306e\u7a2e\u985e","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#1-audit","title":"1. Audit\uff08\u76e3\u67fb\uff09","text":"<pre><code>\u300c\u3053\u308c\u3084\u3063\u3061\u3083\u30c0\u30e1\u3060\u3051\u3069\u3001\u3084\u3063\u3066\u3082\u30a8\u30e9\u30fc\u306b\u306f\u3057\u306a\u3044\u300d\n\u2192 \u30dd\u30ea\u30b7\u30fc\u9055\u53cd\u3068\u3057\u3066\u8a18\u9332\n</code></pre> <p>\u4f8b\uff1a - \u30d1\u30d6\u30ea\u30c3\u30afIP\u3092\u4f5c\u6210\u3057\u305f\u3089\u8b66\u544a - NSG\u304c\u306a\u3044VM\u3092\u4f5c\u6210\u3057\u305f\u3089\u8b66\u544a</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#2-deny","title":"2. Deny\uff08\u62d2\u5426\uff09","text":"<pre><code>\u300c\u3053\u308c\u3084\u3063\u3061\u3083\u30c0\u30e1\u3002\u3084\u308d\u3046\u3068\u3057\u305f\u3089\u30a8\u30e9\u30fc\u300d\n\u2192 \u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u3092\u62d2\u5426\n</code></pre> <p>\u4f8b\uff1a - \u7279\u5b9a\u30ea\u30fc\u30b8\u30e7\u30f3\u4ee5\u5916\u3067\u306e\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u3092\u62d2\u5426 - \u6697\u53f7\u5316\u306a\u3057\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u4f5c\u6210\u3092\u62d2\u5426</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#3-deployifnotexists","title":"3. DeployIfNotExists\uff08\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\uff09","text":"<pre><code>\u300c\u3053\u308c\u304c\u306a\u304b\u3063\u305f\u3089\u81ea\u52d5\u3067\u4f5c\u308b\u300d\n\u2192 \u4e0d\u8db3\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u81ea\u52d5\u4f5c\u6210\u3057\u307e\u3059\n</code></pre> <p>\u4f8b\uff1a - VM\u3092\u4f5c\u3063\u305f\u3089\u81ea\u52d5\u3067Monitoring Agent\u8ffd\u52a0 - Diagnostic Settings\u81ea\u52d5\u8a2d\u5b9a</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#4-modify","title":"4. Modify\uff08\u5909\u66f4\uff09","text":"<pre><code>\u300c\u30bf\u30b0\u3068\u304b\u8a2d\u5b9a\u3092\u81ea\u52d5\u3067\u5909\u66f4\u300d\n\u2192 \u30ea\u30bd\u30fc\u30b9\u306e\u5c5e\u6027\u3092\u5909\u66f4\n</code></pre> <p>\u4f8b\uff1a - \u30bf\u30b0\u3092\u81ea\u52d5\u8ffd\u52a0 - NSG\u30eb\u30fc\u30eb\u3092\u81ea\u52d5\u8ffd\u52a0</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_11","title":"\u30dd\u30ea\u30b7\u30fc\u306e\u5272\u308a\u5f53\u3066","text":"<pre><code>\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306b\u30dd\u30ea\u30b7\u30fc\u5272\u308a\u5f53\u3066\n  \u2193\n\u5b50\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306b\u7d99\u627f\n  \u2193\n\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306b\u7d99\u627f\n  \u2193\n\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306b\u9069\u7528\n  \u2193\n\u30ea\u30bd\u30fc\u30b9\u306b\u9069\u7528\n</code></pre> <p>\u4f8b\uff1a <pre><code>alz\uff08\u30eb\u30fc\u30c8\uff09\n  \u2514\u2500\u2500 \u30dd\u30ea\u30b7\u30fc\uff1a\u300cjapaneast\u4ee5\u5916\u7981\u6b62\u300d\n      \u2193\nplatform\n  \u2514\u2500\u2500 \u7d99\u627f\uff1a\u300cjapaneast\u4ee5\u5916\u7981\u6b62\u300d\n      \u2193\nconnectivity\n  \u2514\u2500\u2500 \u7d99\u627f\uff1a\u300cjapaneast\u4ee5\u5916\u7981\u6b62\u300d\n      \u2193\n\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\n  \u2514\u2500\u2500 \u7d99\u627f\uff1a\u300cjapaneast\u4ee5\u5916\u7981\u6b62\u300d\n      \u2193\n\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u6642\u306b\u30c1\u30a7\u30c3\u30af\n</code></pre></p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_12","title":"\u5b9f\u8df5\uff1a\u30ab\u30b9\u30bf\u30e0\u30dd\u30ea\u30b7\u30fc\u3092\u8ffd\u52a0\u3057\u3066\u307f\u3088\u3046","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#1","title":"\u4f8b1: \u30bf\u30b0\u5fc5\u9808\u5316","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#1_1","title":"1. \u30a2\u30fc\u30ad\u30bf\u30a4\u30d7\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6","text":"<pre><code># lib/archetype_definitions/root_custom.alz_archetype_override.yaml\nbase_archetype: root\nname: root_custom\npolicy_assignments_to_add:\n  - name: Require-Tags\n    display_name: \"Require specific tags on resources\"\n    policy_definition_id: /providers/Microsoft.Authorization/policyDefinitions/96670d01-0a4d-4649-9c89-2d3abc0a5025\n    parameters:\n      tagNames:\n        value:\n          - environment\n          - owner\n          - cost_center\n</code></pre>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#2-terraform","title":"2. Terraform\u5b9f\u884c","text":"<pre><code>terraform plan\n# \u2193\u30dd\u30ea\u30b7\u30fc\u5272\u308a\u5f53\u3066\u304c\u8ffd\u52a0\u3055\u308c\u308b\n\nterraform apply\n</code></pre>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#3","title":"3. \u7d50\u679c","text":"<pre><code>\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u6642\uff1a\n\u274c \u30bf\u30b0\u306a\u3057 \u2192 \u30a8\u30e9\u30fc\n\u274c environment \u3060\u3051 \u2192 \u30a8\u30e9\u30fc\uff08owner\u3001cost_center\u304c\u306a\u3044\uff09\n\u2705 3\u3064\u5168\u90e8\u3042\u308b \u2192 OK\n</code></pre>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#2","title":"\u4f8b2: \u65e2\u5b58\u30dd\u30ea\u30b7\u30fc\u306e\u524a\u9664","text":"<p>Chapter 3\u3067\u898b\u305fDefender for SQL\u3092\u7121\u52b9\u5316\u3059\u308b\u4f8b\u3002</p> <pre><code># lib/archetype_definitions/root_custom.alz_archetype_override.yaml\npolicy_assignments_to_remove:\n  - Deploy-MDFC-DefenderSQL-AMA\n</code></pre> <p>\u7406\u7531\uff1a - \u30b3\u30b9\u30c8\u304c\u304b\u304b\u308b - \u4f7f\u3063\u3066\u306a\u3044\u304b\u3089\u7121\u52b9\u5316\u3057\u305f\u3044</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_13","title":"\u30c7\u30d0\u30c3\u30b0\u6280","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_14","title":"\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u78ba\u8a8d","text":"<pre><code># \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u4e00\u89a7\naz account management-group list --output table\n\n# \u7279\u5b9a\u306e\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u8a73\u7d30\naz account management-group show --name alz\n\n# \u968e\u5c64\u69cb\u9020\u3092\u8868\u793a\naz account management-group show --name alz --expand --recurse\n</code></pre>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_15","title":"\u30dd\u30ea\u30b7\u30fc\u5272\u308a\u5f53\u3066\u306e\u78ba\u8a8d","text":"<pre><code># \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u30dd\u30ea\u30b7\u30fc\u5272\u308a\u5f53\u3066\u4e00\u89a7\naz policy assignment list --scope /providers/Microsoft.Management/managementGroups/alz\n\n# \u7279\u5b9a\u306e\u30dd\u30ea\u30b7\u30fc\u5272\u308a\u5f53\u3066\u306e\u8a73\u7d30\naz policy assignment show --name \"Require-Tags\" --scope /providers/Microsoft.Management/managementGroups/alz\n</code></pre>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_16","title":"\u30dd\u30ea\u30b7\u30fc\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u306e\u78ba\u8a8d","text":"<pre><code># \u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u72b6\u614b\naz policy state list --resource /providers/Microsoft.Management/managementGroups/alz\n</code></pre> <p>Azure\u30dd\u30fc\u30bf\u30eb\uff1a <pre><code>Policy \u2192 Compliance\n\u2193\n\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3054\u3068\u306b\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u7387\u304c\u898b\u3048\u308b\n</code></pre></p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_17","title":"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#1_2","title":"\u30a8\u30e9\u30fc1: \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u540d\u306e\u91cd\u8907","text":"<pre><code>Error: Management group with id \"alz\" already exists\n</code></pre> <p>\u539f\u56e0\uff1a\u65e2\u306b\u540c\u3058ID\u306e\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u304c\u5b58\u5728</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># alz_custom.alz_architecture_definition.yaml\n- id: alz\n  exists: true  # \u2190\u65e2\u5b58\u4f7f\u3046\n</code></pre></p> <p>\u307e\u305f\u306f\uff1a</p> <pre><code># \u65e2\u5b58\u524a\u9664\naz account management-group delete --name alz\n</code></pre>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#2_1","title":"\u30a8\u30e9\u30fc2: \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306e\u79fb\u52d5\u30a8\u30e9\u30fc","text":"<pre><code>Error: Cannot move subscription to management group\n</code></pre> <p>\u539f\u56e0\uff1a\u6a29\u9650\u4e0d\u8db3</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># \u5fc5\u8981\u306a\u6a29\u9650\n# - Management Group Contributor\n# - \u307e\u305f\u306f Owner\n\n# \u6a29\u9650\u4ed8\u4e0e\naz role assignment create \\\n  --role \"Management Group Contributor\" \\\n  --assignee your@email.com \\\n  --scope /providers/Microsoft.Management/managementGroups/alz\n</code></pre></p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#3_1","title":"\u30a8\u30e9\u30fc3: \u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\u304c\u898b\u3064\u304b\u3089\u306a\u3044","text":"<pre><code>Error: Policy definition not found\n</code></pre> <p>\u539f\u56e0\uff1apolicy_definition_id\u304c\u9593\u9055\u3063\u3066\u308b</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># \u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\u3092\u691c\u7d22\naz policy definition list --query \"[?displayName=='Require a tag'].id\"\n\n# \u6b63\u3057\u3044ID\u3092\u30b3\u30d4\u30fc\u3057\u3066\u4f7f\u3046\n</code></pre></p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_18","title":"\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#1-alz","title":"\u30d1\u30bf\u30fc\u30f31: \u6a19\u6e96ALZ\uff08\u63a8\u5968\uff09","text":"<pre><code>alz\n\u251c\u2500\u2500 platform\n\u2502   \u251c\u2500\u2500 management\n\u2502   \u251c\u2500\u2500 connectivity\n\u2502   \u251c\u2500\u2500 identity\n\u2502   \u2514\u2500\u2500 security\n\u251c\u2500\u2500 landingzones\n\u2502   \u251c\u2500\u2500 corp\n\u2502   \u2514\u2500\u2500 online\n\u2514\u2500\u2500 sandbox\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1aMicrosoft\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9 \u30c7\u30e1\u30ea\u30c3\u30c8\uff1a\u8907\u96d1</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#2_2","title":"\u30d1\u30bf\u30fc\u30f32: \u30b7\u30f3\u30d7\u30eb\u69cb\u6210","text":"<pre><code>company\n\u251c\u2500\u2500 production\n\u251c\u2500\u2500 development\n\u2514\u2500\u2500 sandbox\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a\u308f\u304b\u308a\u3084\u3059\u3044 \u30c7\u30e1\u30ea\u30c3\u30c8\uff1a\u30b9\u30b1\u30fc\u30eb\u3057\u306b\u304f\u3044</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#3_2","title":"\u30d1\u30bf\u30fc\u30f33: \u74b0\u5883 \u00d7 \u6a5f\u80fd","text":"<pre><code>company\n\u251c\u2500\u2500 prod\n\u2502   \u251c\u2500\u2500 apps\n\u2502   \u251c\u2500\u2500 data\n\u2502   \u2514\u2500\u2500 infrastructure\n\u251c\u2500\u2500 dev\n\u2502   \u251c\u2500\u2500 apps\n\u2502   \u251c\u2500\u2500 data\n\u2502   \u2514\u2500\u2500 infrastructure\n\u2514\u2500\u2500 sandbox\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8\uff1a\u67d4\u8edf \u30c7\u30e1\u30ea\u30c3\u30c8\uff1a\u7ba1\u7406\u304c\u8907\u96d1</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#alz","title":"\u304a\u3059\u3059\u3081\uff1a\u6a19\u6e96ALZ + \u30ab\u30b9\u30bf\u30de\u30a4\u30ba","text":"<pre><code>alz\n\u251c\u2500\u2500 platform\uff08\u305d\u306e\u307e\u307e\uff09\n\u251c\u2500\u2500 landingzones\n\u2502   \u251c\u2500\u2500 corp\n\u2502   \u251c\u2500\u2500 online\n\u2502   \u2514\u2500\u2500 app-specific\uff08\u30a2\u30d7\u30ea\u5c02\u7528\u8ffd\u52a0\uff09\n\u2514\u2500\u2500 sandbox\n</code></pre> <p>\u6a19\u6e96\u69cb\u9020\u3092\u7dad\u6301\u3057\u3064\u3064\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u8ffd\u52a0\u3002</p>"},{"location":"08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/#_19","title":"\u307e\u3068\u3081","text":"<p>\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u5f79\u5272\uff1a 1. \u968e\u5c64\u5316\uff1a\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0 2. \u30ac\u30d0\u30ca\u30f3\u30b9\uff1a\u30dd\u30ea\u30b7\u30fc\u306e\u4e00\u5143\u7ba1\u7406 3. \u6a29\u9650\u7ba1\u7406\uff1aRBAC\u306e\u7d99\u627f 4. \u30b3\u30b9\u30c8\u7ba1\u7406\uff1a\u968e\u5c64\u3054\u3068\u306b\u96c6\u8a08</p> <p>\u30dd\u30ea\u30b7\u30fc\u306e\u5f79\u5272\uff1a 1. Audit\uff1a\u76e3\u67fb\uff08\u8b66\u544a\uff09 2. Deny\uff1a\u62d2\u5426\uff08\u30a8\u30e9\u30fc\uff09 3. DeployIfNotExists\uff1a\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4 4. Modify\uff1a\u81ea\u52d5\u5909\u66f4</p> <p>\u899a\u3048\u3066\u304a\u304f\u3053\u3068\uff1a - \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5b9a\u7fa9\uff08YAML\uff09\u3067\u968e\u5c64\u69cb\u9020\u3092\u5b9a\u7fa9 - \u30a2\u30fc\u30ad\u30bf\u30a4\u30d7\uff08YAML\uff09\u3067\u30dd\u30ea\u30b7\u30fc\u30bb\u30c3\u30c8\u3092\u5b9a\u7fa9 - \u30dd\u30ea\u30b7\u30fc\u306f\u89aa\u304b\u3089\u5b50\u306b\u7d99\u627f\u3055\u308c\u308b - <code>policy_assignments_to_remove</code>\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u30dd\u30ea\u30b7\u30fc\u3092\u7121\u52b9\u5316\u3067\u304d\u308b</p> <p>\u6b21\u306eChapter\u3067\u306f\u3001\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\uff08Log Analytics\u3001DCR\u3001Managed Identity\uff09\u306e\u4f5c\u6210\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u76e3\u8996\u3068\u30ed\u30b0\u53ce\u96c6\u306e\u57fa\u76e4\u3067\u3059\u3002</p> <p>\u6240\u8981\u6642\u9593: 50\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2606 \u524d: 07_\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7.md \u6b21: 09_\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9.md</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/","title":"09. \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9 - \u76e3\u8996\u3068\u30ed\u30b0\u306e\u57fa\u76e4","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#8","title":"8\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3068\u306e\u5bfe\u5fdc","text":"<p>\u3053\u306eChapter\u306f\u4ee5\u4e0b\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a - \u2705 6. Management and Monitoring\uff08\u7ba1\u7406\u3068\u76e3\u8996 - Log Analytics\u3001DCR\uff09 - \u2705 5. Security\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3 - \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u76e3\u8996\uff09 - \u2705 2. Identity and Access Management\uff08ID\u7ba1\u7406 - Managed Identity\uff09</p> <p>\u2192 Chapter 01\u3067\u5b66\u3093\u30608\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5fa9\u7fd2\u3057\u305f\u3044\u65b9\u306f01_\u57fa\u790e\u77e5\u8b58.md\u3078</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u3092\u7406\u89e3\u3057\u3088\u3046\u3002</p> <p>\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u3063\u3066\u4f55\uff1f \u76e3\u8996\u3001\u30ed\u30b0\u53ce\u96c6\u3001\u81ea\u52d5\u5316\u306e\u305f\u3081\u306e\u30ea\u30bd\u30fc\u30b9\u3002</p> <p>\u4e3b\u306a\u69cb\u6210\u8981\u7d20\uff1a 1. Log Analytics Workspace\uff1a\u30ed\u30b0\u306e\u4fdd\u7ba1\u5eab 2. Data Collection Rule\uff08DCR\uff09\uff1a\u30ed\u30b0\u53ce\u96c6\u306e\u30eb\u30fc\u30eb 3. Managed Identity\uff1a\u81ea\u52d5\u5316\u7528\u306eID</p> <p>\u4f8b\u3048\u308b\u306a\u3089\uff1a - Log Analytics\uff1a\u56f3\u66f8\u9928\uff08\u672c\u3092\u4fdd\u7ba1\uff09 - DCR\uff1a\u53f8\u66f8\uff08\u3069\u306e\u672c\u3092\u3069\u3046\u6574\u7406\u3059\u308b\u304b\uff09 - Managed Identity\uff1a\u56f3\u66f8\u9928\u30ab\u30fc\u30c9\uff08\u672c\u3092\u501f\u308a\u308b\u6a29\u9650\uff09</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_1","title":"\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u306e\u5f79\u5272","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_2","title":"\u306a\u3093\u3067\u5fc5\u8981\u306a\u306e\uff1f","text":"<p>\u30b7\u30ca\u30ea\u30aa1\uff1a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u76e3\u8996 <pre><code>VM\u4f5c\u6210\n  \u2193\nDefender for Cloud\u304c\u300c\u3053\u306eVM\u306b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u5165\u308c\u3066\u300d\n  \u2193\n\u3067\u3082\u3069\u3053\u306b\u30ed\u30b0\u9001\u308b\u306e\uff1f \u2190 Log Analytics\u5fc5\u8981\n  \u2193\n\u3069\u3046\u3084\u3063\u3066\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u5165\u308c\u308b\u306e\uff1f \u2190 Managed Identity\u5fc5\u8981\n</code></pre></p> <p>\u30b7\u30ca\u30ea\u30aa2\uff1a\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9 <pre><code>\u30dd\u30ea\u30b7\u30fc\uff1a\u300c\u5168VM\u306f\u30ed\u30b0\u3092Log Analytics\u306b\u9001\u4fe1\u300d\n  \u2193\n\u3067\u3082\u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u304c\u306a\u3044 \u2190 \u4f5c\u3063\u3068\u304b\u306a\u3044\u3068\u30c0\u30e1\n</code></pre></p> <p>\u30b7\u30ca\u30ea\u30aa3\uff1a\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 <pre><code>VM\u304c\u9045\u3044\n  \u2193\n\u30ed\u30b0\u3092\u898b\u305f\u3044\n  \u2193\nLog Analytics\u3067\u30af\u30a8\u30ea\u5b9f\u884c\n  \u2193\n\u539f\u56e0\u7279\u5b9a\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#part-1-tfvars","title":"Part 1: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08tfvars\uff09","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#management_resource_settings","title":"management_resource_settings","text":"<p>Chapter 3\u3067\u898b\u305f\u3053\u308c\uff1a</p> <pre><code>management_resource_settings = {\n  enabled                      = true\n  location                     = \"$${starter_location_01}\"\n  log_analytics_workspace_name = \"$${log_analytics_workspace_name}\"\n  resource_group_name          = \"$${management_resource_group_name}\"\n\n  user_assigned_managed_identities = {\n    ama = {\n      name = \"$${ama_user_assigned_managed_identity_name}\"\n    }\n  }\n\n  data_collection_rules = {\n    change_tracking = {\n      name = \"$${dcr_change_tracking_name}\"\n    }\n    defender_sql = {\n      name = \"$${dcr_defender_sql_name}\"\n    }\n    vm_insights = {\n      name = \"$${dcr_vm_insights_name}\"\n    }\n  }\n}\n</code></pre> <p>\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406\u5f8c\uff1a <pre><code>management_resource_settings = {\n  enabled                      = true\n  location                     = \"japaneast\"\n  log_analytics_workspace_name = \"law-management-japaneast\"\n  resource_group_name          = \"rg-management\"\n\n  user_assigned_managed_identities = {\n    ama = {\n      name = \"id-ama-japaneast\"\n    }\n  }\n\n  data_collection_rules = {\n    change_tracking = {\n      name = \"dcr-change-tracking\"\n    }\n    defender_sql = {\n      name = \"dcr-defender-sql\"\n    }\n    vm_insights = {\n      name = \"dcr-vm-insights\"\n    }\n  }\n}\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_3","title":"\u30d5\u30a3\u30fc\u30eb\u30c9\u89e3\u8aac","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#enabled","title":"enabled","text":"<pre><code>enabled = true\n</code></pre> <p>\u4f55\uff1f\uff1a\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u306e\u6709\u52b9/\u7121\u52b9</p> <ul> <li><code>true</code>\uff1a\u4f5c\u308b</li> <li><code>false</code>\uff1a\u4f5c\u3089\u306a\u3044\uff08\u65e2\u5b58\u4f7f\u3046\uff09</li> </ul>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#location","title":"location","text":"<pre><code>location = \"japaneast\"\n</code></pre> <p>\u4f55\uff1f\uff1a\u30ea\u30bd\u30fc\u30b9\u306e\u5834\u6240</p> <p>Log Analytics\u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u306e\u5834\u6240\u3002</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#log_analytics_workspace_name","title":"log_analytics_workspace_name","text":"<pre><code>log_analytics_workspace_name = \"law-management-japaneast\"\n</code></pre> <p>\u4f55\uff1f\uff1aLog Analytics\u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u306e\u540d\u524d</p> <p>\u547d\u540d\u898f\u5247\uff1a - <code>law-</code>\uff1aLog Analytics Workspace\u306e\u7565 - <code>management</code>\uff1a\u7528\u9014 - <code>japaneast</code>\uff1a\u5834\u6240</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#resource_group_name","title":"resource_group_name","text":"<pre><code>resource_group_name = \"rg-management\"\n</code></pre> <p>\u4f55\uff1f\uff1a\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u7528\u306e\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u540d</p> <p>\u3053\u306eRG\u306e\u4e2d\u306b\u5168\u90e8\u5165\u308c\u308b\uff1a - Log Analytics Workspace - Data Collection Rules - Managed Identity</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#user_assigned_managed_identities","title":"user_assigned_managed_identities","text":"<pre><code>user_assigned_managed_identities = {\n  ama = {\n    name = \"id-ama-japaneast\"\n  }\n}\n</code></pre> <p>\u4f55\uff1f\uff1aAzure Monitor Agent\uff08AMA\uff09\u7528\u306eManaged Identity</p> <p>AMA\u3063\u3066\u4f55\uff1f VM\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3002\u30ed\u30b0\u3068\u304b\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53ce\u96c6\u3057\u3066Log Analytics\u306b\u9001\u308b\u3002</p> <p>Managed Identity\u306e\u5f79\u5272\uff1a <pre><code>VM\n  \u2193 AMA\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nVM\uff08AMA\u4ed8\u304d\uff09\n  \u2193 Managed Identity\u4f7f\u3063\u3066\u8a8d\u8a3c\nLog Analytics Workspace\n  \u2193 \u30ed\u30b0\u9001\u4fe1\n\u30ed\u30b0\u304c\u4fdd\u5b58\u3055\u308c\u308b\n</code></pre></p> <p>\u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\u3067\u8a8d\u8a3c\u3067\u304d\u308b\u306e\u304c\u4fbf\u5229\u3002</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#data_collection_rules","title":"data_collection_rules","text":"<pre><code>data_collection_rules = {\n  change_tracking = { name = \"dcr-change-tracking\" }\n  defender_sql    = { name = \"dcr-defender-sql\" }\n  vm_insights     = { name = \"dcr-vm-insights\" }\n}\n</code></pre> <p>\u4f55\uff1f\uff1a\u30c7\u30fc\u30bf\u53ce\u96c6\u30eb\u30fc\u30eb\uff08DCR\uff09</p> <p>3\u7a2e\u985e\u306eDCR\uff1a</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#1-change_tracking","title":"1. change_tracking","text":"<pre><code>\u300c\u30d5\u30a1\u30a4\u30eb\u3084\u30ec\u30b8\u30b9\u30c8\u30ea\u306e\u5909\u66f4\u3092\u8ffd\u8de1\u300d\n</code></pre> <p>\u4f7f\u3044\u9053\uff1a - \u8ab0\u304b\u304c\u30d5\u30a1\u30a4\u30eb\u524a\u9664\u3057\u305f\uff1f - \u8a2d\u5b9a\u5909\u66f4\u3055\u308c\u305f\uff1f - \u4e0d\u5be9\u306a\u30d7\u30ed\u30b0\u30e9\u30e0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\uff1f</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#2-defender_sql","title":"2. defender_sql","text":"<pre><code>\u300cSQL Server\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ed\u30b0\u53ce\u96c6\u300d\n</code></pre> <p>\u4f7f\u3044\u9053\uff1a - \u4e0d\u6b63\u30a2\u30af\u30bb\u30b9\u691c\u77e5 - \u8106\u5f31\u6027\u30b9\u30ad\u30e3\u30f3 - \u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u76e3\u67fb</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#3-vm_insights","title":"3. vm_insights","text":"<pre><code>\u300cVM\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3068\u30d8\u30eb\u30b9\u76e3\u8996\u300d\n</code></pre> <p>\u4f7f\u3044\u9053\uff1a - CPU\u4f7f\u7528\u7387 - \u30e1\u30e2\u30ea\u4f7f\u7528\u7387 - \u30c7\u30a3\u30b9\u30afI/O - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5e2f\u57df</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#part-2-mainmanagementtf","title":"Part 2: \u30e2\u30b8\u30e5\u30fc\u30eb\u547c\u3073\u51fa\u3057\uff08main.management.tf\uff09","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#management_resources","title":"management_resources \u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>module \"management_resources\" {\n  source = \"./modules/management_resources\"\n\n  count = var.management_resources_enabled ? 1 : 0\n\n  enable_telemetry             = var.enable_telemetry\n  management_resource_settings = local.management_resource_settings\n\n  providers = {\n    azurerm = azurerm.management\n  }\n}\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#count","title":"count","text":"<pre><code>count = var.management_resources_enabled ? 1 : 0\n</code></pre> <p>\u4f55\u3057\u3066\u308b\uff1f \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u306e\u6709\u52b9/\u7121\u52b9\u3092\u5207\u308a\u66ff\u3048\u3002</p> <p>\u4f7f\u3044\u9053\uff1a <pre><code># tfvars\nmanagement_resources_enabled = false  # \u2190\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u4f5c\u3089\u306a\u3044\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#providers","title":"providers","text":"<pre><code>providers = {\n  azurerm = azurerm.management\n}\n</code></pre> <p>\u4f55\u3057\u3066\u308b\uff1f Management\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306b\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u3002</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#modulesmanagement_resourcesmaintf","title":"modules/management_resources/main.tf","text":"<pre><code>module \"management_resources\" {\n  source  = \"Azure/avm-ptn-alz-management/azurerm\"\n  version = \"0.9.0\"\n\n  location                     = var.management_resource_settings.location\n  log_analytics_workspace_name = coalesce(var.management_resource_settings.log_analytics_workspace_name, \"law-management-${var.management_resource_settings.location}\")\n  resource_group_name          = coalesce(var.management_resource_settings.resource_group_name, \"rg-management-${var.management_resource_settings.location}\")\n\n  data_collection_rules                = var.management_resource_settings.data_collection_rules\n  user_assigned_managed_identities     = var.management_resource_settings.user_assigned_managed_identities\n\n  resource_group_creation_enabled      = true\n  linked_automation_account_creation_enabled = false\n  ...\n}\n</code></pre> <p>**Azure\u516c\u5f0f\u30e2\u30b8\u30e5\u30fc\u30eb**\u3092\u4f7f\u3063\u3066\u308b\u3002</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#coalesce","title":"coalesce","text":"<pre><code>log_analytics_workspace_name = coalesce(\n  var.management_resource_settings.log_analytics_workspace_name,\n  \"law-management-${var.management_resource_settings.location}\"\n)\n</code></pre> <p>\u4f55\u3057\u3066\u308b\uff1f - \u540d\u524d\u304c\u6307\u5b9a\u3055\u308c\u3066\u308c\u3070\u305d\u308c\u3092\u4f7f\u3046 - \u6307\u5b9a\u3055\u308c\u3066\u306a\u3051\u308c\u3070\u30c7\u30d5\u30a9\u30eb\u30c8\u540d\u3092\u4f7f\u3046</p> <p>\u4f8b\uff1a <pre><code># \u6307\u5b9a\u3042\u308a\nlog_analytics_workspace_name = \"my-custom-law\"\n# \u2193\n\u7d50\u679c\uff1amy-custom-law\n\n# \u6307\u5b9a\u306a\u3057\nlog_analytics_workspace_name = null\n# \u2193\n\u7d50\u679c\uff1alaw-management-japaneast\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#resource_group_creation_enabled","title":"resource_group_creation_enabled","text":"<pre><code>resource_group_creation_enabled = true\n</code></pre> <p>\u4f55\u3057\u3066\u308b\uff1f \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u3082\u81ea\u52d5\u3067\u4f5c\u308b\u3002</p> <pre><code>\u30e2\u30b8\u30e5\u30fc\u30eb\u5b9f\u884c\n  \u2193\n1. rg-management\u4f5c\u6210\n  \u2193\n2. Log Analytics Workspace\u4f5c\u6210\n  \u2193\n3. DCR\u4f5c\u6210\n  \u2193\n4. Managed Identity\u4f5c\u6210\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#linked_automation_account_creation_enabled","title":"linked_automation_account_creation_enabled","text":"<pre><code>linked_automation_account_creation_enabled = false\n</code></pre> <p>\u4f55\u3057\u3066\u308b\uff1f Automation Account\u3092\u4f5c\u3089\u306a\u3044\u3002</p> <p>Automation Account\u3063\u3066\u4f55\uff1f VM\u306e\u81ea\u52d5\u30d1\u30c3\u30c1\u9069\u7528\u3068\u304b\u81ea\u52d5\u5316\u30bf\u30b9\u30af\u7528\u3002</p> <p>\u4eca\u56de\u306f\u4e0d\u8981\u3060\u304b\u3089<code>false</code>\u3002</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#part-3","title":"Part 3: \u5404\u30ea\u30bd\u30fc\u30b9\u306e\u8a73\u7d30","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#log-analytics-workspace","title":"Log Analytics Workspace","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_4","title":"\u4f55\u304c\u3067\u304d\u308b\uff1f","text":"<p>1. \u30ed\u30b0\u306e\u4fdd\u7ba1 <pre><code>\u5168\u3066\u306e\u30ed\u30b0\u3092\u3053\u3053\u306b\u96c6\u7d04\n- VM\u306e\u30ed\u30b0\n- Firewall\u306e\u30ed\u30b0\n- NSG\u306e\u30d5\u30ed\u30fc\u30ed\u30b0\n- Azure AD\u306e\u30b5\u30a4\u30f3\u30a4\u30f3\u30ed\u30b0\n</code></pre></p> <p>2. \u30af\u30a8\u30ea\u5b9f\u884c <pre><code>// \u904e\u53bb24\u6642\u9593\u306e\u30a8\u30e9\u30fc\u30ed\u30b0\nAzureDiagnostics\n| where TimeGenerated &gt; ago(24h)\n| where Level == \"Error\"\n| summarize count() by Resource\n</code></pre></p> <p>**KQL\uff08Kusto Query Language\uff09**\u3067\u30af\u30a8\u30ea\u66f8\u3051\u308b\u3002\u3081\u3063\u3061\u3083\u5f37\u529b\u3002</p> <p>3. \u30a2\u30e9\u30fc\u30c8\u4f5c\u6210 <pre><code>\u300c\u30a8\u30e9\u30fc\u304c10\u4ef6/\u5206\u3092\u8d85\u3048\u305f\u3089\u901a\u77e5\u300d\n\u300cCPU\u4f7f\u7528\u7387\u304c80%\u8d85\u3048\u305f\u3089\u901a\u77e5\u300d\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_5","title":"\u8a2d\u5b9a\u9805\u76ee","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#retention_in_days","title":"retention_in_days","text":"<pre><code>log_analytics_workspace_retention_in_days = 30\n</code></pre> <p>\u4f55\uff1f\uff1a\u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593</p> <ul> <li>30\u65e5\uff1a\u30c7\u30d5\u30a9\u30eb\u30c8\uff08\u7121\u6599\uff09</li> <li>31\u65e5\u4ee5\u4e0a\uff1a\u8ab2\u91d1\u3042\u308a</li> </ul> <p>\u30b3\u30b9\u30c8\u524a\u6e1b\u6280\uff1a <pre><code># \u958b\u767a\u74b0\u5883\nretention_in_days = 30  # \u6700\u5c0f\n\n# \u672c\u756a\u74b0\u5883\uff08\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u8981\u4ef6\uff09\nretention_in_days = 365  # 1\u5e74\u4fdd\u7ba1\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#daily_quota_gb","title":"daily_quota_gb","text":"<pre><code>log_analytics_workspace_daily_quota_gb = 10\n</code></pre> <p>\u4f55\uff1f\uff1a1\u65e5\u306e\u30ed\u30b0\u53d6\u308a\u8fbc\u307f\u4e0a\u9650</p> <p>\u4f7f\u3044\u9053\uff1a <pre><code>\u30ed\u30b0\u304c\u7206\u767a\u7684\u306b\u5897\u3048\u305f\u6642\u306e\u9632\u5fa1\u7b56\n\u2192 \u30af\u30a9\u30fc\u30bf\u306b\u9054\u3057\u305f\u3089\u305d\u308c\u4ee5\u4e0a\u53d6\u308a\u8fbc\u307e\u306a\u3044\n\u2192 \u8ab2\u91d1\u306e\u66b4\u8d70\u3092\u9632\u3050\n</code></pre></p> <p>\u6ce8\u610f\uff1a \u30af\u30a9\u30fc\u30bf\u306b\u9054\u3059\u308b\u3068**\u30ed\u30b0\u304c\u53d6\u308a\u8fbc\u307e\u308c\u306a\u3044**\u304b\u3089\u3001\u91cd\u8981\u306a\u30ed\u30b0\u304c\u6b20\u640d\u3059\u308b\u53ef\u80fd\u6027\u3042\u308a\u3002</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#sku","title":"sku","text":"<pre><code>log_analytics_workspace_sku = \"PerGB2018\"\n</code></pre> <p>\u4f55\uff1f\uff1a\u6599\u91d1\u30d7\u30e9\u30f3</p> <ul> <li><code>PerGB2018</code>\uff1a\u5f93\u91cf\u8ab2\u91d1\uff08\u4e00\u822c\u7684\uff09</li> <li><code>CapacityReservation</code>\uff1a\u30b3\u30df\u30c3\u30c8\u30e1\u30f3\u30c8\uff08\u5927\u91cf\u5229\u7528\u3067\u5272\u5f15\uff09</li> </ul> <p>\u6599\u91d1\uff1a <pre><code>PerGB2018\uff1a\u7d04500\u5186/GB\nCapacityReservation\uff1a100GB/\u65e5\u304b\u3089\uff08\u5272\u5f15\u7387\u3042\u308a\uff09\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#data-collection-ruledcr","title":"Data Collection Rule\uff08DCR\uff09","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_6","title":"\u4f55\u3057\u3066\u308b\uff1f","text":"<p>\u300c\u3069\u306e\u30c7\u30fc\u30bf\u3092\u3069\u3046\u96c6\u3081\u308b\u304b\u300d\u306e\u30eb\u30fc\u30eb</p> <p>\u69cb\u6210\u8981\u7d20\uff1a 1. Data Sources\uff1a\u4f55\u3092\u96c6\u3081\u308b\u304b 2. Destinations\uff1a\u3069\u3053\u306b\u9001\u308b\u304b 3. Data Flows\uff1a\u3069\u3046\u51e6\u7406\u3059\u308b\u304b</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#change_tracking-dcr","title":"change_tracking DCR","text":"<pre><code>\u53ce\u96c6\u3059\u308b\u30c7\u30fc\u30bf\uff1a\n- \u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\n- \u30ec\u30b8\u30b9\u30c8\u30ea\u306e\u5909\u66f4\n- Windows\u30b5\u30fc\u30d3\u30b9\u306e\u5909\u66f4\n- Linux\u30c7\u30fc\u30e2\u30f3\u306e\u5909\u66f4\n</code></pre> <p>\u4f7f\u7528\u4f8b\uff1a <pre><code>// \u904e\u53bb24\u6642\u9593\u306b\u5909\u66f4\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\nConfigurationChange\n| where TimeGenerated &gt; ago(24h)\n| where ConfigChangeType == \"Files\"\n| project Computer, FileName, FileSystemPath, TimeGenerated\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#defender_sql-dcr","title":"defender_sql DCR","text":"<pre><code>\u53ce\u96c6\u3059\u308b\u30c7\u30fc\u30bf\uff1a\n- SQL Server\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\n- \u8106\u5f31\u6027\u30b9\u30ad\u30e3\u30f3\u7d50\u679c\n- \u8105\u5a01\u691c\u51fa\u30a2\u30e9\u30fc\u30c8\n</code></pre> <p>\u4f7f\u7528\u4f8b\uff1a <pre><code>// SQL\u306e\u4e0d\u5be9\u306a\u30a2\u30af\u30bb\u30b9\nSecurityAlert\n| where TimeGenerated &gt; ago(24h)\n| where AlertType contains \"SQL\"\n| project AlertName, Severity, Entities, TimeGenerated\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#vm_insights-dcr","title":"vm_insights DCR","text":"<pre><code>\u53ce\u96c6\u3059\u308b\u30c7\u30fc\u30bf\uff1a\n- \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30ab\u30a6\u30f3\u30bf\u30fc\uff08CPU\u3001\u30e1\u30e2\u30ea\u3001\u30c7\u30a3\u30b9\u30af\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09\n- \u30d7\u30ed\u30bb\u30b9\u60c5\u5831\n- \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a5\u7d9a\n</code></pre> <p>\u4f7f\u7528\u4f8b\uff1a <pre><code>// CPU\u4f7f\u7528\u7387\u304c\u9ad8\u3044VM\nPerf\n| where TimeGenerated &gt; ago(1h)\n| where ObjectName == \"Processor\" and CounterName == \"% Processor Time\"\n| where CounterValue &gt; 80\n| summarize avg(CounterValue) by Computer\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#managed-identity","title":"Managed Identity","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_7","title":"\u4f55\u304c\u3067\u304d\u308b\uff1f","text":"<p>\u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\u306e\u8a8d\u8a3c</p> <p>\u5f93\u6765\u306e\u65b9\u6cd5\uff1a <pre><code>VM\u306b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n  \u2193\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304f\uff1a\n  username: admin\n  password: P@ssw0rd123\n  \u2193\n\u554f\u984c\uff1a\n- \u30d1\u30b9\u30ef\u30fc\u30c9\u6f0f\u6d29\u30ea\u30b9\u30af\n- \u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u9762\u5012\n- \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u5e73\u6587\u3067\u66f8\u304f\u306e\u306f\u5371\u967a\n</code></pre></p> <p>Managed Identity\u306e\u65b9\u6cd5\uff1a <pre><code>VM\u306bManaged Identity\u5272\u308a\u5f53\u3066\n  \u2193\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306fManaged Identity\u3067\u8a8d\u8a3c\n  \u2193\nAzure\u304c\u81ea\u52d5\u3067\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u767a\u884c\n  \u2193\n\u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\uff01\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_8","title":"\u7a2e\u985e","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#system-assigned","title":"System-assigned\uff08\u30b7\u30b9\u30c6\u30e0\u5272\u308a\u5f53\u3066\uff09","text":"<pre><code>VM\u306b1\u5bfe1\u3067\u7d10\u4ed8\u304f\nVM\u3092\u524a\u9664 \u2192 Managed Identity\u3082\u524a\u9664\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#user-assigned","title":"User-assigned\uff08\u30e6\u30fc\u30b6\u30fc\u5272\u308a\u5f53\u3066\uff09","text":"<pre><code>\u72ec\u7acb\u3057\u3066\u5b58\u5728\n\u8907\u6570\u306eVM\u3067\u5171\u6709\u3067\u304d\u308b\nVM\u3092\u524a\u9664\u3057\u3066\u3082Managed Identity\u306f\u6b8b\u308b\n</code></pre> <p>**\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306fUser-assigned**\u3092\u4f7f\u3063\u3066\u308b\u3002</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_9","title":"\u4f7f\u308f\u308c\u65b9","text":"<pre><code>1. Managed Identity\u4f5c\u6210\n   id-ama-japaneast\n\n2. VM\u306bManaged Identity\u5272\u308a\u5f53\u3066\n   VM \u2192 id-ama-japaneast\u3092\u4f7f\u3046\n\n3. Managed Identity\u306bLog Analytics\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u4ed8\u4e0e\n   id-ama-japaneast \u2192 Log Analytics Contributor\n\n4. VM\u306eAMA\u304cManaged Identity\u3067\u8a8d\u8a3c\n   AMA \u2192 id-ama-japaneast\u306e\u30c8\u30fc\u30af\u30f3\u53d6\u5f97\n        \u2192 Log Analytics\u306b\u30ed\u30b0\u9001\u4fe1\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#part-4","title":"Part 4: \u30dd\u30ea\u30b7\u30fc\u3068\u306e\u9023\u643a","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#policy_default_values","title":"policy_default_values","text":"<p>Chapter 8\u3067\u898b\u305f\u3053\u308c\uff1a</p> <pre><code>policy_default_values = {\n  ama_change_tracking_data_collection_rule_id = \"$${ama_change_tracking_data_collection_rule_id}\"\n  ama_user_assigned_managed_identity_id       = \"$${ama_user_assigned_managed_identity_id}\"\n  log_analytics_workspace_id                  = \"$${log_analytics_workspace_id}\"\n}\n</code></pre> <p>\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u306eID\u3092\u30dd\u30ea\u30b7\u30fc\u306b\u6e21\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_10","title":"\u3069\u3046\u4f7f\u308f\u308c\u308b\uff1f","text":"<p>\u30b7\u30ca\u30ea\u30aa\uff1aVM\u306bAMA\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u30dd\u30ea\u30b7\u30fc</p> <pre><code>1. \u30dd\u30ea\u30b7\u30fc\u300cVM\u3092\u4f5c\u3063\u305f\u3089AMA\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u300d\u304c\u767a\u52d5\n\n2. \u30dd\u30ea\u30b7\u30fc\u304cManaged Identity\u306eID\u3092\u53d6\u5f97\n   \u2192 policy_default_values.ama_user_assigned_managed_identity_id\n\n3. \u30dd\u30ea\u30b7\u30fc\u304cDCR\u306eID\u3092\u53d6\u5f97\n   \u2192 policy_default_values.ama_change_tracking_data_collection_rule_id\n\n4. VM\u306bAMA\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb + Managed Identity\u5272\u308a\u5f53\u3066 + DCR\u95a2\u9023\u4ed8\u3051\n\n5. \u5b8c\u4e86\uff1aVM\u304c\u81ea\u52d5\u3067\u30ed\u30b0\u9001\u4fe1\u958b\u59cb\n</code></pre> <p>\u81ea\u52d5\u5316\u3055\u308c\u3066\u308b\u306e\u304c\u4fbf\u5229\u3002</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_11","title":"\u5b9f\u8df5\uff1a\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u307f\u3088\u3046","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#1","title":"\u4f8b1: \u4fdd\u6301\u671f\u9593\u306e\u5909\u66f4","text":"<pre><code># platform-landing-zone.auto.tfvars\nmanagement_resource_settings = {\n  ...\n  log_analytics_workspace_retention_in_days = 90  # 90\u65e5\u4fdd\u7ba1\n}\n</code></pre> <p>\u30b3\u30b9\u30c8\u8a66\u7b97\uff1a <pre><code>30\u65e5\uff1a\u7121\u6599\n90\u65e5\uff1a\u7d0430\u5186/GB\uff08\u8ffd\u52a060\u65e5\u5206\uff09\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#2-managed-identity","title":"\u4f8b2: \u8907\u6570\u306eManaged Identity","text":"<pre><code>user_assigned_managed_identities = {\n  ama = {\n    name = \"id-ama-japaneast\"\n  }\n  automation = {\n    name = \"id-automation-japaneast\"\n  }\n  backup = {\n    name = \"id-backup-japaneast\"\n  }\n}\n</code></pre> <p>\u4f7f\u3044\u5206\u3051\uff1a - <code>ama</code>\uff1aAzure Monitor Agent\u7528 - <code>automation</code>\uff1a\u81ea\u52d5\u5316\u30b9\u30af\u30ea\u30d7\u30c8\u7528 - <code>backup</code>\uff1a\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u51e6\u7406\u7528</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#3-dcr","title":"\u4f8b3: \u30ab\u30b9\u30bf\u30e0DCR","text":"<pre><code>data_collection_rules = {\n  change_tracking = {\n    name = \"dcr-change-tracking\"\n  }\n  custom_app_logs = {\n    name = \"dcr-custom-app\"\n    # \u30ab\u30b9\u30bf\u30e0\u30a2\u30d7\u30ea\u306e\u30ed\u30b0\u53ce\u96c6\u30eb\u30fc\u30eb\n  }\n}\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_12","title":"\u30c7\u30d0\u30c3\u30b0\u6280","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#log-analytics","title":"Log Analytics\u306e\u78ba\u8a8d","text":"<pre><code># \u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u4e00\u89a7\naz monitor log-analytics workspace list --output table\n\n# \u7279\u5b9a\u306e\u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u306e\u8a73\u7d30\naz monitor log-analytics workspace show \\\n  --resource-group rg-management \\\n  --workspace-name law-management-japaneast\n</code></pre> <p>Azure\u30dd\u30fc\u30bf\u30eb\uff1a <pre><code>Log Analytics workspaces \u2192 law-management-japaneast\n  \u2193\nLogs \u2192 KQL\u30af\u30a8\u30ea\u5b9f\u884c\n  \u2193\n\u7d50\u679c\u8868\u793a\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#dcr","title":"DCR\u306e\u78ba\u8a8d","text":"<pre><code># DCR\u4e00\u89a7\naz monitor data-collection rule list --output table\n\n# \u7279\u5b9a\u306eDCR\u306e\u8a73\u7d30\naz monitor data-collection rule show \\\n  --resource-group rg-management \\\n  --name dcr-change-tracking\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#managed-identity_1","title":"Managed Identity\u306e\u78ba\u8a8d","text":"<pre><code># Managed Identity\u4e00\u89a7\naz identity list --output table\n\n# \u7279\u5b9a\u306eManaged Identity\u306e\u8a73\u7d30\naz identity show \\\n  --resource-group rg-management \\\n  --name id-ama-japaneast\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_13","title":"\u30ed\u30b0\u306e\u78ba\u8a8d","text":"<pre><code>// Heartbeat\uff08VM\u751f\u5b58\u78ba\u8a8d\uff09\nHeartbeat\n| where TimeGenerated &gt; ago(1h)\n| summarize count() by Computer\n\n// \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30c7\u30fc\u30bf\nPerf\n| where TimeGenerated &gt; ago(1h)\n| where ObjectName == \"Processor\"\n| summarize avg(CounterValue) by Computer\n\n// \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30a4\u30d9\u30f3\u30c8\nSecurityEvent\n| where TimeGenerated &gt; ago(24h)\n| where EventID == 4625  // \u30ed\u30b0\u30a4\u30f3\u5931\u6557\n| summarize count() by Account\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_14","title":"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#1_1","title":"\u30a8\u30e9\u30fc1: \u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u540d\u306e\u91cd\u8907","text":"<pre><code>Error: A workspace with the name 'law-management-japaneast' already exists\n</code></pre> <p>\u539f\u56e0\uff1a\u540c\u3058\u540d\u524d\u306e\u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u304c\u65e2\u306b\u5b58\u5728</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># \u540d\u524d\u3092\u5909\u3048\u308b\nlog_analytics_workspace_name = \"law-management-japaneast-v2\"\n\n# \u307e\u305f\u306f\u65e2\u5b58\u3092\u524a\u9664\naz monitor log-analytics workspace delete \\\n  --resource-group rg-management \\\n  --workspace-name law-management-japaneast\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#2","title":"\u30a8\u30e9\u30fc2: \u30af\u30a9\u30fc\u30bf\u8d85\u904e","text":"<pre><code>Warning: Daily cap of 10 GB reached\n</code></pre> <p>\u539f\u56e0\uff1a1\u65e5\u306e\u30ed\u30b0\u53d6\u308a\u8fbc\u307f\u91cf\u304c\u30af\u30a9\u30fc\u30bf\u306b\u9054\u3057\u305f</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># \u30af\u30a9\u30fc\u30bf\u5f15\u304d\u4e0a\u3052\nlog_analytics_workspace_daily_quota_gb = 50\n\n# \u307e\u305f\u306f\u30ed\u30b0\u91cf\u3092\u524a\u6e1b\uff08\u4e0d\u8981\u306a\u30ed\u30b0\u3092\u7121\u52b9\u5316\uff09\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#3-managed-identity","title":"\u30a8\u30e9\u30fc3: Managed Identity\u306e\u6a29\u9650\u4e0d\u8db3","text":"<pre><code>Error: Managed Identity does not have permission to write to Log Analytics\n</code></pre> <p>\u539f\u56e0\uff1aManaged Identity\u306b\u6a29\u9650\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u306a\u3044</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># Log Analytics Contributor\u6a29\u9650\u4ed8\u4e0e\naz role assignment create \\\n  --assignee &lt;managed-identity-principal-id&gt; \\\n  --role \"Log Analytics Contributor\" \\\n  --scope &lt;log-analytics-workspace-id&gt;\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_15","title":"\u30b3\u30b9\u30c8\u6700\u9069\u5316","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_16","title":"\u30b3\u30b9\u30c8\u69cb\u9020","text":"<p>Log Analytics\uff1a <pre><code>\u53d6\u308a\u8fbc\u307f\uff1a\u7d04500\u5186/GB\n\u4fdd\u6301\uff0831\u65e5\u4ee5\u964d\uff09\uff1a\u7d0415\u5186/GB/\u6708\n\u30af\u30a8\u30ea\uff1a\u57fa\u672c\u7121\u6599\uff08\u5927\u91cf\u5b9f\u884c\u306f\u8ab2\u91d1\uff09\n</code></pre></p> <p>DCR\uff1a <pre><code>\u7121\u6599\uff08\u30c7\u30fc\u30bf\u51e6\u7406\u91cf\u306b\u5fdc\u3058\u305f\u8ab2\u91d1\u306a\u3057\uff09\n</code></pre></p> <p>Managed Identity\uff1a <pre><code>\u7121\u6599\n</code></pre></p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_17","title":"\u30b3\u30b9\u30c8\u524a\u6e1b\u6280","text":""},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#1_2","title":"1. \u4e0d\u8981\u306a\u30ed\u30b0\u3092\u7121\u52b9\u5316","text":"<pre><code># Defender for SQL\u304c\u4e0d\u8981\u306a\u3089\u7121\u52b9\u5316\ndata_collection_rules = {\n  change_tracking = { ... }\n  # defender_sql = { ... }  # \u2190\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n  vm_insights = { ... }\n}\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#2_1","title":"2. \u30b5\u30f3\u30d7\u30ea\u30f3\u30b0","text":"<pre><code>\u5168\u30ed\u30b0\u3092\u53d6\u308a\u8fbc\u307e\u306a\u3044\n\u2192 1%\u3060\u3051\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\n\u2192 \u30b3\u30b9\u30c81/100\n</code></pre> <p>\u6ce8\u610f\uff1a\u8a73\u7d30\u306a\u5206\u6790\u306f\u3067\u304d\u306a\u304f\u306a\u308b\u3002</p>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#3","title":"3. \u4fdd\u6301\u671f\u9593\u306e\u6700\u9069\u5316","text":"<pre><code># \u958b\u767a\u74b0\u5883\uff1a30\u65e5\uff08\u7121\u6599\uff09\nlog_analytics_workspace_retention_in_days = 30\n\n# \u672c\u756a\u74b0\u5883\uff1a\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u8981\u4ef6\u306b\u5fdc\u3058\u3066\nlog_analytics_workspace_retention_in_days = 90\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#4","title":"4. \u30af\u30a9\u30fc\u30bf\u8a2d\u5b9a","text":"<pre><code># \u66b4\u8d70\u9632\u6b62\nlog_analytics_workspace_daily_quota_gb = 10\n</code></pre>"},{"location":"09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/#_18","title":"\u307e\u3068\u3081","text":"<p>\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\u306e\u5f79\u5272\uff1a 1. Log Analytics Workspace\uff1a\u30ed\u30b0\u306e\u4e2d\u592e\u96c6\u7d04 2. Data Collection Rule\uff1a\u30ed\u30b0\u53ce\u96c6\u306e\u30eb\u30fc\u30eb\u5b9a\u7fa9 3. Managed Identity\uff1a\u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\u306e\u8a8d\u8a3c</p> <p>\u899a\u3048\u3066\u304a\u304f\u3053\u3068\uff1a - Log Analytics\u306f\u5168\u3066\u306e\u76e3\u8996\u306e\u57fa\u76e4 - DCR\u3067\u30ed\u30b0\u53ce\u96c6\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba - Managed Identity\u3067\u30bb\u30ad\u30e5\u30a2\u306a\u8a8d\u8a3c - \u30dd\u30ea\u30b7\u30fc\u3068\u9023\u643a\u3057\u3066\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4 - KQL\u3067\u30ed\u30b0\u3092\u30af\u30a8\u30ea</p> <p>\u6b21\u306eChapter\u3067\u306f\u3001Hub-and-Spoke\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u69cb\u7bc9\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u5b9f\u969b\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30ea\u30bd\u30fc\u30b9\uff08VNet\u3001Firewall\u3001Bastion\uff09\u3092\u4f5c\u308b\u3088\u3002</p> <p>\u6240\u8981\u6642\u9593: 45\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2606 \u524d: 08_\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc.md \u6b21: 10_Hub-and-Spoke.md</p>"},{"location":"10_Hub-and-Spoke/","title":"10. Hub-and-Spoke - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4e2d\u6838","text":""},{"location":"10_Hub-and-Spoke/#8","title":"8\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3068\u306e\u5bfe\u5fdc","text":"<p>\u3053\u306eChapter\u306f\u4ee5\u4e0b\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a - \u2705 4. Network Topology and Connectivity\uff08\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\uff09 - \u2705 5. Security\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3 - Firewall\u306b\u3088\u308b\u901a\u4fe1\u5236\u5fa1\uff09</p> <p>\u2192 Chapter 01\u3067\u5b66\u3093\u30608\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5fa9\u7fd2\u3057\u305f\u3044\u65b9\u306f01_\u57fa\u790e\u77e5\u8b58.md\u3078</p>"},{"location":"10_Hub-and-Spoke/#_1","title":"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u9078\u629e","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f**Hub-and-Spoke**\u3092\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3082\u30461\u3064\u306e\u9078\u629e\u80a2\u3068\u3057\u3066**Virtual WAN**\u3082\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"10_Hub-and-Spoke/#2","title":"2\u3064\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6bd4\u8f03","text":"\u89b3\u70b9 Hub-and-Spoke Virtual WAN \u63a8\u5968\u898f\u6a21 \u4e2d\u5c0f\u4f01\u696d\uff08\u301c1000\u4eba\uff09 \u5927\u4f01\u696d\uff081000\u4eba\u4ee5\u4e0a\uff09 \u30ea\u30fc\u30b8\u30e7\u30f3\u6570 1\u301c3\u30ea\u30fc\u30b8\u30e7\u30f3 4\u30ea\u30fc\u30b8\u30e7\u30f3\u4ee5\u4e0a \u521d\u671f\u30b3\u30b9\u30c8 \u4f4e\uff08\u00a550\u4e07/\u6708\u301c\uff09 \u9ad8\uff08\u00a5100\u4e07/\u6708\u301c\uff09 \u7ba1\u7406\u306e\u67d4\u8edf\u6027 \u9ad8\uff08\u5168\u3066\u81ea\u5206\u3067\u8a2d\u5b9a\uff09 \u4f4e\uff08Microsoft\u304c\u81ea\u52d5\u7ba1\u7406\uff09 \u5b66\u7fd2\u96e3\u6613\u5ea6 \u6613\uff08VNet\u306e\u77e5\u8b58\u304c\u3042\u308c\u3070OK\uff09 \u96e3\uff08Virtual WAN\u56fa\u6709\u306e\u6982\u5ff5\uff09 \u30b0\u30ed\u30fc\u30d0\u30eb\u63a5\u7d9a \u624b\u52d5\u8a2d\u5b9a\u304c\u5fc5\u8981 \u81ea\u52d5\u3067\u6700\u9069\u5316 \u5b9f\u88c5\u6642\u9593 2\u301c4\u6642\u9593 1\u301c2\u6642\u9593 \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u81ea\u5206\u3067\u5168\u90e8\u78ba\u8a8d Microsoft\u304c\u5927\u90e8\u5206\u3092\u7ba1\u7406"},{"location":"10_Hub-and-Spoke/#_2","title":"\u3069\u3063\u3061\u3092\u9078\u3076\u3079\u304d\uff1f","text":"<p>Hub-and-Spoke\u3092\u9078\u3076\u3079\u304d\u30b1\u30fc\u30b9\uff1a - \u2705 \u6700\u521d\u306eLanding Zones\u69cb\u7bc9\uff08\u5b66\u7fd2\u3057\u3084\u3059\u3044\uff09 - \u2705 \u65e5\u672c\u56fd\u5185\u306e\u307f\u3001\u307e\u305f\u306f\u30a2\u30b8\u30a2\u570f\u306e\u307f - \u2705 \u7d30\u304b\u304f\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305f\u3044 - \u2705 \u30b3\u30b9\u30c8\u3092\u6291\u3048\u305f\u3044 - \u2705 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3057\u305f\u3044</p> <p>Virtual WAN\u3092\u9078\u3076\u3079\u304d\u30b1\u30fc\u30b9\uff1a - \u2705 \u30b0\u30ed\u30fc\u30d0\u30eb\u5c55\u958b\uff08\u30a2\u30e1\u30ea\u30ab\u3001\u30e8\u30fc\u30ed\u30c3\u30d1\u3001\u30a2\u30b8\u30a2\u5168\u3066\uff09 - \u2705 \u8907\u6570\u306e\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u62e0\u70b9\u304c\u3042\u308b - \u2705 SD-WAN\u3092\u4f7f\u3063\u3066\u3044\u308b - \u2705 Microsoft\u306b\u4efb\u305b\u3066\u904b\u7528\u3092\u697d\u306b\u3057\u305f\u3044 - \u2705 \u65e2\u306bVirtual WAN\u306e\u7d4c\u9a13\u304c\u3042\u308b</p> <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u9078\u629e\uff1a \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306fHub-and-Spoke\u3092\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u7406\u7531\u306f\uff1a 1. \u521d\u5fc3\u8005\u306b\u3082\u7406\u89e3\u3057\u3084\u3059\u3044 2. \u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u306e\u81ea\u7531\u5ea6\u304c\u9ad8\u3044 3. \u30b3\u30b9\u30c8\u304c\u4e88\u6e2c\u3057\u3084\u3059\u3044 4. \u65e5\u672c\u306e\u4e2d\u5c0f\u4f01\u696d\u306b\u6700\u9069</p> <p>Virtual WAN\u306b\u3064\u3044\u3066\u306fChapter 11\u3067\u8a73\u3057\u304f\u89e3\u8aac\u3057\u307e\u3059\u3002</p>"},{"location":"10_Hub-and-Spoke/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>Hub-and-Spoke\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3057\u3088\u3046\u3002</p> <p>Hub-and-Spoke\u3063\u3066\u4f55\uff1f \u4e2d\u592e\u306b1\u3064\u306eHub\uff08\u30cf\u30d6\uff09VNet\u3001\u5468\u308a\u306b\u8907\u6570\u306eSpoke\uff08\u30b9\u30dd\u30fc\u30af\uff09VNet\u3092\u914d\u7f6e\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u3002</p> <p>\u4f8b\u3048\u308b\u306a\u3089\uff1a - Hub\uff1a\u7a7a\u6e2f\u306e\u30cf\u30d6\uff08\u6210\u7530\u3001\u7fbd\u7530\uff09 - Spoke\uff1a\u5730\u65b9\u7a7a\u6e2f - \u5730\u65b9\u304b\u3089\u6d77\u5916\u884c\u304f\u306b\u306f\u3001\u4e00\u5ea6\u30cf\u30d6\u3092\u7d4c\u7531\u3059\u308b</p> <p>\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3082\u540c\u3058\uff1a - Hub\uff1a\u4e2d\u592e\u306eVNet\uff08Firewall\u3001VPN Gateway\u304c\u3042\u308b\uff09 - Spoke\uff1a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528VNet - Spoke\u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3084\u30aa\u30f3\u30d7\u30ec\u306b\u884c\u304f\u306b\u306f\u3001Hub\u3092\u7d4c\u7531</p> <p>\ud83d\udcca Hub-and-Spoke\u69cb\u6210\u56f3\uff08\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\uff09</p> <pre><code>                    \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\n                         \u2195\n                   Azure Firewall\n                         |\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502         Hub VNet              \u2502\n         \u2502    (10.0.0.0/16)             \u2502\n         \u2502                               \u2502\n         \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n         \u2502  \u2502Firewall \u2502  \u2502  Bastion \u2502   \u2502\n         \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n         \u2502                               \u2502\n         \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n         \u2502  \u2502VPN GW    \u2502  \u2502ER Gateway \u2502 \u2502\n         \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n         \u2502       \u2193             \u2193         \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2193             \u2193\n         \u30aa\u30f3\u30d7\u30ec\u30df\u30b9      ExpressRoute\n           (VPN)           (\u5c02\u7528\u7dda)\n\n      VNet Peering \u2193      \u2193      \u2193\n\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Spoke 1  \u2502  \u2502 Spoke 2  \u2502  \u2502 Spoke 3  \u2502\n    \u2502 (Corp)   \u2502  \u2502 (Online) \u2502  \u2502  (Dev)   \u2502\n    \u250210.1.0.0  \u2502  \u250210.2.0.0  \u2502  \u250210.3.0.0  \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        Web          API         Database\n       Server      Server        Server\n</code></pre> <p>\ud83c\udfaf \u901a\u4fe1\u306e\u6d41\u308c\uff08\u4f8b\uff09</p> <pre><code>Spoke 1 (Web\u30b5\u30fc\u30d0\u30fc) \u2192 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8 \u3078\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3044\n  \u2193\n1. User Defined Route (UDR) \u3067 Hub \u3078\n  \u2193\n2. Hub \u306e Firewall \u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c1\u30a7\u30c3\u30af\n  \u2193\n3. \u8a31\u53ef\u3055\u308c\u305f\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\n  \u2193\n4. \u623b\u308a\u3082 Firewall \u7d4c\u7531\n  \u2193\n5. Spoke 1 \u3078\u5230\u7740\n</code></pre> <p>\ud83d\udd10 \u3053\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u7279\u5fb4</p> \u8981\u7d20 \u914d\u7f6e\u5834\u6240 \u5f79\u5272 \u5171\u6709/\u500b\u5225 Firewall Hub \u5168\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u306e\u691c\u67fb \u5168Spoke\u3067\u5171\u6709 Bastion Hub VM \u3078\u306e\u5b89\u5168\u306a\u30ed\u30b0\u30a4\u30f3 \u5168Spoke\u3067\u5171\u6709 VPN Gateway Hub \u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u63a5\u7d9a \u5168Spoke\u3067\u5171\u6709 ExpressRoute GW Hub \u5c02\u7528\u7dda\u63a5\u7d9a \u5168Spoke\u3067\u5171\u6709 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 Spoke \u5b9f\u969b\u306e\u30ef\u30fc\u30af\u30ed\u30fc\u30c9 \u500b\u5225"},{"location":"10_Hub-and-Spoke/#hub-and-spoke","title":"Hub-and-Spoke\u306e\u30e1\u30ea\u30c3\u30c8","text":""},{"location":"10_Hub-and-Spoke/#1","title":"1. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u96c6\u7d04","text":"<pre><code>\u5168\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u304cHub\u3092\u7d4c\u7531\n  \u2193\nFirewall\u3067\u4e00\u5143\u7ba1\u7406\n  \u2193\n\u300cSpoke\u3054\u3068\u306b\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u8cb7\u3046\u300d\u4e0d\u8981\n</code></pre>"},{"location":"10_Hub-and-Spoke/#2_1","title":"2. \u30b3\u30b9\u30c8\u524a\u6e1b","text":"<pre><code>VPN Gateway\uff1a1\u53f0\u7d044\u4e07\u5186/\u6708\n  \u2193\nHub\u306b1\u53f0\u3060\u3051\u7f6e\u304f\n  \u2193\n\u5168Spoke\u3067\u5171\u6709\n  \u2193\nSpoke\u3054\u3068\u306b\u8cb7\u308f\u306a\u304f\u3066\u3044\u3044\n</code></pre>"},{"location":"10_Hub-and-Spoke/#3","title":"3. \u7ba1\u7406\u304c\u697d","text":"<pre><code>DNS\u30b5\u30fc\u30d0\u30fc\uff1aHub\u306b1\u53f0\nFirewall\u30eb\u30fc\u30eb\uff1aHub\u3067\u4e00\u5143\u7ba1\u7406\nVPN\u63a5\u7d9a\uff1aHub\u3060\u3051\u8a2d\u5b9a\n</code></pre>"},{"location":"10_Hub-and-Spoke/#4","title":"4. \u67d4\u8edf\u6027","text":"<pre><code>\u65b0\u3057\u3044\u30a2\u30d7\u30ea\u8ffd\u52a0\n  \u2193\n\u65b0\u3057\u3044Spoke VNet\u4f5c\u308b\n  \u2193\nHub\u306b\u30d4\u30a2\u30ea\u30f3\u30b0\n  \u2193\n\u3059\u3050\u4f7f\u3048\u308b\n</code></pre>"},{"location":"10_Hub-and-Spoke/#part-1-tfvars","title":"Part 1: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08tfvars\uff09","text":""},{"location":"10_Hub-and-Spoke/#connectivity_type","title":"connectivity_type","text":"<pre><code>connectivity_type = \"hub_and_spoke_vnet\"\n</code></pre> <p>\u4f55\uff1f\uff1a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u7a2e\u985e</p> <ul> <li><code>hub_and_spoke_vnet</code>\uff1aHub-and-Spoke\u69cb\u6210</li> <li><code>virtual_wan</code>\uff1aVirtual WAN\u69cb\u6210\uff08Chapter 11\u3067\u89e3\u8aac\uff09</li> <li><code>none</code>\uff1a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u3089\u306a\u3044</li> </ul>"},{"location":"10_Hub-and-Spoke/#hub_and_spoke_networks_settings","title":"hub_and_spoke_networks_settings","text":"<pre><code>hub_and_spoke_networks_settings = {\n  enabled_resources = {\n    ddos_protection_plan = true\n  }\n  ddos_protection_plan = {\n    name                = \"ddos-alz\"\n    resource_group_name = \"rg-ddos\"\n    location            = \"japaneast\"\n  }\n}\n</code></pre>"},{"location":"10_Hub-and-Spoke/#ddos_protection_plan","title":"ddos_protection_plan","text":"<p>DDoS Protection\u3063\u3066\u4f55\uff1f DDoS\u653b\u6483\uff08\u5927\u91cf\u30a2\u30af\u30bb\u30b9\u3067\u30b5\u30fc\u30d0\u30fc\u30c0\u30a6\u30f3\u3055\u305b\u308b\u653b\u6483\uff09\u304b\u3089\u5b88\u308b\u4ed5\u7d44\u307f\u3002</p> <p>\u6599\u91d1\uff1a <pre><code>Standard\uff1a\u7d0440\u4e07\u5186/\u6708\uff08\u9ad8\u3044\uff01\uff09\nBasic\uff1a\u7121\u6599\uff08\u81ea\u52d5\u3067\u6709\u52b9\uff09\n</code></pre></p> <p>\u6ce8\u610f\uff1a <pre><code># \u958b\u767a\u74b0\u5883\u3067\u306ffalse\u306b\u3057\u3068\u3053\u3046\nenabled_resources = {\n  ddos_protection_plan = false  # \u2190\u30b3\u30b9\u30c8\u524a\u6e1b\n}\n</code></pre></p> <p>Chapter 3\u3067\u898b\u305f\u8a2d\u5b9a\u3067\u3059\u306d\u3002</p>"},{"location":"10_Hub-and-Spoke/#hub_virtual_networks","title":"hub_virtual_networks","text":"<pre><code>hub_virtual_networks = {\n  primary = {\n    location          = \"japaneast\"\n    default_parent_id = \"/subscriptions/.../resourceGroups/rg-jpe-connectivity\"\n\n    enabled_resources = {\n      firewall                              = true\n      bastion                               = true\n      virtual_network_gateway_express_route = false\n      virtual_network_gateway_vpn           = true\n      private_dns_zones                     = true\n      private_dns_resolver                  = false\n    }\n\n    hub_virtual_network = {\n      name          = \"vnet-jpe-hub\"\n      address_space = [\"10.0.0.0/16\"]\n    }\n\n    firewall = {\n      subnet_address_prefix = \"10.0.0.0/26\"\n      name                  = \"fw-jpe-hub\"\n    }\n\n    ...\n  }\n}\n</code></pre> <p>**primary**\u3063\u3066\u30ad\u30fc\u306f\u4f55\u3067\u3082\u3044\u3044\u3002\u8907\u6570\u306eHub\u3092\u4f5c\u308b\u6642\u306b\u8b58\u5225\u3059\u308b\u305f\u3081\u3002</p>"},{"location":"10_Hub-and-Spoke/#part-2-hub-vnet","title":"Part 2: Hub VNet\u306e\u69cb\u6210\u8981\u7d20","text":""},{"location":"10_Hub-and-Spoke/#1-hub-virtual-networkvnet","title":"1. Hub Virtual Network\uff08VNet\uff09","text":"<pre><code>hub_virtual_network = {\n  name          = \"vnet-jpe-hub\"\n  address_space = [\"10.0.0.0/16\"]\n}\n</code></pre> <p>\u4f55\uff1f\uff1a\u4e2d\u592e\u306eVNet</p> <p>address_space\uff1a <pre><code>10.0.0.0/16\n  \u2193\n10.0.0.0 \u301c 10.0.255.255\n  \u2193\n\u7d0465,000\u500b\u306eIP\u30a2\u30c9\u30ec\u30b9\n</code></pre></p> <p>\u30b5\u30d6\u30cd\u30c3\u30c8\u5206\u5272\uff1a <pre><code>10.0.0.0/26   \u2192 Firewall\uff0864\u500b\uff09\n10.0.0.64/26  \u2192 Firewall Management\uff0864\u500b\uff09\n10.0.1.0/26   \u2192 Gateway\uff0864\u500b\uff09\n10.0.2.0/27   \u2192 Bastion\uff0832\u500b\uff09\n10.0.3.0/24   \u2192 \u30a2\u30d7\u30ea\u7528\uff08256\u500b\uff09\n...\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#2-azure-firewall","title":"2. Azure Firewall","text":"<pre><code>firewall = {\n  subnet_address_prefix            = \"10.0.0.0/26\"\n  management_subnet_address_prefix = \"10.0.0.64/26\"\n  name                             = \"fw-jpe-hub\"\n\n  default_ip_configuration = {\n    public_ip_config = {\n      name = \"pip-fw-jpe-hub\"\n    }\n  }\n\n  management_ip_enabled = true\n  management_ip_configuration = {\n    public_ip_config = {\n      name = \"pip-fw-jpe-hub-mgmt\"\n    }\n  }\n}\n</code></pre>"},{"location":"10_Hub-and-Spoke/#azure-firewall","title":"Azure Firewall\u3063\u3066\u4f55\uff1f","text":"<p>\u6b21\u4e16\u4ee3\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\uff1a - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30ec\u30d9\u30eb\uff08L3/L4\uff09\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 - \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ec\u30d9\u30eb\uff08L7\uff09\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 - \u8105\u5a01\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30b9 - DNS Proxy</p> <p>\u6599\u91d1\uff1a <pre><code>Basic\uff1a\u7d048\u4e07\u5186/\u6708\uff08\u6700\u5c0f\u69cb\u6210\uff09\nStandard\uff1a\u7d0417\u4e07\u5186/\u6708\nPremium\uff1a\u7d0425\u4e07\u5186/\u6708\n</code></pre></p> <p>\u3081\u3063\u3061\u3083\u9ad8\u3044\uff01</p>"},{"location":"10_Hub-and-Spoke/#2_2","title":"2\u3064\u306e\u30b5\u30d6\u30cd\u30c3\u30c8","text":""},{"location":"10_Hub-and-Spoke/#azurefirewallsubnet","title":"AzureFirewallSubnet\uff08\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\uff09","text":"<pre><code>subnet_address_prefix = \"10.0.0.0/26\"\n</code></pre> <p>\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\uff1a\u5b9f\u969b\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u51e6\u7406</p> <pre><code>Spoke VNet \u2192 Hub Firewall \u2192 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\n\u30aa\u30f3\u30d7\u30ec \u2192 Hub Firewall \u2192 Spoke VNet\n</code></pre>"},{"location":"10_Hub-and-Spoke/#azurefirewallmanagementsubnet","title":"AzureFirewallManagementSubnet\uff08\u7ba1\u7406\u30d7\u30ec\u30fc\u30f3\uff09","text":"<pre><code>management_subnet_address_prefix = \"10.0.0.64/26\"\n</code></pre> <p>\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\uff1aFirewall\u306e\u7ba1\u7406\u30fb\u8a2d\u5b9a</p> <p>\u306a\u3093\u3067\u5206\u3051\u308b\uff1f - \u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u304c\u30d3\u30b8\u30fc\u72b6\u614b\u3067\u3082\u7ba1\u7406\u3067\u304d\u308b - \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5206\u96e2\uff08\u7ba1\u7406\u64cd\u4f5c\u3068\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u51e6\u7406\u3092\u5206\u96e2\uff09</p>"},{"location":"10_Hub-and-Spoke/#management_ip_enabled","title":"management_ip_enabled","text":"<pre><code>management_ip_enabled = true\n</code></pre> <p>\u4f55\uff1f\uff1a\u7ba1\u7406\u7528Public IP\u3092\u6709\u52b9\u5316</p> <p>true\uff1a <pre><code>Public IP 2\u500b\u5fc5\u8981\n- \u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u7528\n- \u7ba1\u7406\u30d7\u30ec\u30fc\u30f3\u7528\n\u2192 \u30b3\u30b9\u30c8\u9ad8\u3044\n</code></pre></p> <p>false\uff1a <pre><code>Public IP 1\u500b\u3060\u3051\n\u2192 \u30b3\u30b9\u30c8\u524a\u6e1b\n\u2192 \u3067\u3082\u7ba1\u7406\u6a5f\u80fd\u304c\u5236\u9650\u3055\u308c\u308b\n</code></pre></p> <p>\u304a\u3059\u3059\u3081\uff1a <pre><code># \u672c\u756a\u74b0\u5883\nmanagement_ip_enabled = true  # \u2190\u5b89\u5b9a\u6027\u91cd\u8996\n\n# \u958b\u767a\u74b0\u5883\nmanagement_ip_enabled = false  # \u2190\u30b3\u30b9\u30c8\u91cd\u8996\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#firewall_policy","title":"firewall_policy","text":"<pre><code>firewall_policy = {\n  name = \"fwp-jpe-hub\"\n}\n</code></pre> <p>\u4f55\uff1f\uff1aFirewall\u306e\u30eb\u30fc\u30eb\u96c6</p> <p>\u30dd\u30ea\u30b7\u30fc\u306e\u5185\u5bb9\uff1a - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30eb\u30fc\u30eb\uff08IP\u30a2\u30c9\u30ec\u30b9\u3001\u30dd\u30fc\u30c8\uff09 - \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\uff08FQDN\u3001URL\uff09 - NAT\u30eb\u30fc\u30eb\uff08\u30dd\u30fc\u30c8\u8ee2\u9001\uff09</p> <p>\u4f8b\uff1a <pre><code>\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30eb\u30fc\u30eb\uff1a\n- Spoke VNet\u304b\u308980/443\u30dd\u30fc\u30c8\u3092\u8a31\u53ef\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\uff1a\n- *.microsoft.com\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\n- *.google.com\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u62d2\u5426\n\nNAT\u30eb\u30fc\u30eb\uff1a\n- Public IP:8080 \u2192 VM:80\u306b\u30dd\u30fc\u30c8\u8ee2\u9001\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#3-vpn-gateway","title":"3. VPN Gateway","text":"<pre><code>virtual_network_gateways = {\n  subnet_address_prefix = \"10.0.1.0/26\"\n\n  vpn = {\n    name = \"vpngw-jpe-hub\"\n\n    ip_configurations = {\n      default = {\n        public_ip = {\n          name = \"pip-vpngw-jpe-hub\"\n        }\n      }\n      second = {\n        public_ip = {\n          name = \"pip-vpngw-jpe-hub-second\"\n        }\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"10_Hub-and-Spoke/#vpn-gateway","title":"VPN Gateway\u3063\u3066\u4f55\uff1f","text":"<p>\u30aa\u30f3\u30d7\u30ec\u3068Azure\u3092\u7e4b\u3050\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\uff1a <pre><code>\u30aa\u30f3\u30d7\u30ec\u306e\u30aa\u30d5\u30a3\u30b9\n  \u2193 VPN\u63a5\u7d9a\uff08\u6697\u53f7\u5316\uff09\nAzure VPN Gateway\n  \u2193\nHub VNet\n  \u2193 \u30d4\u30a2\u30ea\u30f3\u30b0\nSpoke VNet\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#active-active","title":"Active-Active\u69cb\u6210","text":"<pre><code>ip_configurations = {\n  default = { ... }  # \u21901\u500b\u76ee\u306ePublic IP\n  second = { ... }   # \u21902\u500b\u76ee\u306ePublic IP\n}\n</code></pre> <p>\u4f55\uff1f\uff1a\u5197\u9577\u5316\u69cb\u6210</p> <pre><code>2\u3064\u306ePublic IP\n  \u2193\n2\u3064\u306eVPN\u30c8\u30f3\u30cd\u30eb\n  \u2193\n\u7247\u65b9\u304c\u843d\u3061\u3066\u3082\u5927\u4e08\u592b\n</code></pre> <p>\u6599\u91d1\uff1a <pre><code>VpnGw1\uff1a\u7d044\u4e07\u5186/\u6708\nVpnGw2\uff1a\u7d049\u4e07\u5186/\u6708\nVpnGw3\uff1a\u7d0420\u4e07\u5186/\u6708\n</code></pre></p> <p>\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\uff1a <pre><code>VpnGw1\uff1a650 Mbps\nVpnGw2\uff1a1 Gbps\nVpnGw3\uff1a1.25 Gbps\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#gatewaysubnet","title":"GatewaySubnet","text":"<pre><code>subnet_address_prefix = \"10.0.1.0/26\"\n</code></pre> <p>\u30b5\u30d6\u30cd\u30c3\u30c8\u540d\u306f\u56fa\u5b9a\uff1a<code>GatewaySubnet</code></p> <p>\u5909\u3048\u3061\u3083\u30c0\u30e1\u3002Azure\u304c\u81ea\u52d5\u3067\u8a8d\u8b58\u3059\u308b\u3002</p>"},{"location":"10_Hub-and-Spoke/#4-expressroute-gateway","title":"4. ExpressRoute Gateway","text":"<pre><code>express_route = {\n  name = \"ergw-jpe-hub\"\n  ip_configurations = {\n    default = {\n      public_ip = {\n        name = \"pip-ergw-jpe-hub\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"10_Hub-and-Spoke/#expressroute","title":"ExpressRoute\u3063\u3066\u4f55\uff1f","text":"<p>\u5c02\u7528\u7dda\u63a5\u7d9a\uff1a <pre><code>\u30aa\u30f3\u30d7\u30ec\n  \u2193 \u7269\u7406\u5c02\u7528\u7dda\uff08\u901a\u4fe1\u30ad\u30e3\u30ea\u30a2\u7d4c\u7531\uff09\nAzure ExpressRoute Gateway\n  \u2193\nHub VNet\n</code></pre></p> <p>VPN\u3068\u306e\u9055\u3044\uff1a <pre><code>VPN\uff1a\n- \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u7d4c\u7531\n- \u6697\u53f7\u5316\u3042\u308a\n- \u5b89\u3044\n- \u901f\u5ea6\u9045\u3044\uff08\u6700\u59271.25Gbps\uff09\n\nExpressRoute\uff1a\n- \u5c02\u7528\u7dda\n- \u3088\u308a\u9ad8\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\n- \u8d85\u9ad8\u3044\uff08\u6570\u5341\u4e07\u5186/\u6708\u301c\uff09\n- \u901f\u3044\uff08\u6700\u5927100Gbps\uff09\n</code></pre></p> <p>\u666e\u901a\u306fVPN\u3067OK\u3002</p>"},{"location":"10_Hub-and-Spoke/#5-azure-bastion","title":"5. Azure Bastion","text":"<pre><code>bastion = {\n  subnet_address_prefix = \"10.0.2.0/27\"\n  name                  = \"bas-jpe-hub\"\n\n  public_ip = {\n    name  = \"pip-bas-jpe-hub\"\n    zones = []  # \u2190Japan region\u306f\u7a7a\u30ea\u30b9\u30c8\n  }\n}\n</code></pre>"},{"location":"10_Hub-and-Spoke/#azure-bastion","title":"Azure Bastion\u3063\u3066\u4f55\uff1f","text":"<p>\u5b89\u5168\u306aRDP/SSH\u63a5\u7d9a\uff1a <pre><code>\u5f93\u6765\uff1a\nPC \u2192 Public IP \u2192 VM\n  \u2193\n\u554f\u984c\uff1a\n- VM\u306bPublic IP\u5fc5\u8981\n- \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ea\u30b9\u30af\n- \u653b\u6483\u3055\u308c\u3084\u3059\u3044\n\nBastion\uff1a\nPC \u2192 Azure\u30dd\u30fc\u30bf\u30eb \u2192 Bastion \u2192 VM\uff08Private IP\u3060\u3051\uff09\n  \u2193\n\u30e1\u30ea\u30c3\u30c8\uff1a\n- VM\u306bPublic IP\u4e0d\u8981\n- \u30bb\u30ad\u30e5\u30a2\n- NSG\u3067\u4fdd\u8b77\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#zones","title":"zones = []","text":"<p>Chapter 3\u3067\u898b\u305f\u91cd\u8981\u306a\u8a2d\u5b9a\uff1a</p> <pre><code>zones = []  # \u2190Japan region\u306fAvailability Zones\u975e\u5bfe\u5fdc\n</code></pre> <p>Japan East/West\u306e\u5834\u5408\u306f\u5fc5\u9808\uff1a <pre><code># OK\nzones = []\n\n# NG\uff08\u30a8\u30e9\u30fc\u306b\u306a\u308b\uff09\nzones = [\"1\", \"2\", \"3\"]\n</code></pre></p> <p>\u6599\u91d1\uff1a <pre><code>Basic\uff1a\u7d042.7\u4e07\u5186/\u6708\nStandard\uff1a\u7d0421\u4e07\u5186/\u6708\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#azurebastionsubnet","title":"AzureBastionSubnet","text":"<pre><code>subnet_address_prefix = \"10.0.2.0/27\"\n</code></pre> <p>\u30b5\u30d6\u30cd\u30c3\u30c8\u540d\u306f\u56fa\u5b9a\uff1a<code>AzureBastionSubnet</code></p> <p>\u3053\u308c\u3082\u5909\u3048\u3061\u3083\u30c0\u30e1\u3002</p>"},{"location":"10_Hub-and-Spoke/#6-private-dns-zones","title":"6. Private DNS Zones","text":"<pre><code>enabled_resources = {\n  private_dns_zones = true\n}\n</code></pre> <p>\u4f55\uff1f\uff1a\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8DNS</p> <p>\u4f7f\u3044\u9053\uff1a <pre><code>Azure PaaS\uff08Storage\u3001SQL\uff09\u3092\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u63a5\u7d9a\n  \u2193\nPrivate Endpoint\u4f5c\u6210\n  \u2193\nPrivate DNS Zone\u3067\u540d\u524d\u89e3\u6c7a\n  \u2193\nstorage.blob.core.windows.net \u2192 10.0.3.4\uff08Private IP\uff09\n</code></pre></p> <p>\u81ea\u52d5\u4f5c\u6210\u3055\u308c\u308b\u30be\u30fc\u30f3\uff1a <pre><code>privatelink.blob.core.windows.net\nprivatelink.database.windows.net\nprivatelink.azurewebsites.net\n...\n</code></pre></p> <p>\u7d0450\u500b\u306e\u30be\u30fc\u30f3\u304c\u81ea\u52d5\u4f5c\u6210\u3055\u308c\u308b\u3002</p>"},{"location":"10_Hub-and-Spoke/#part-3","title":"Part 3: \u30de\u30eb\u30c1\u30ea\u30fc\u30b8\u30e7\u30f3\u69cb\u6210","text":""},{"location":"10_Hub-and-Spoke/#primary-secondary","title":"primary / secondary","text":"<pre><code>hub_virtual_networks = {\n  primary = {\n    location = \"japaneast\"\n    ...\n  }\n  secondary = {\n    location = \"japanwest\"\n    ...\n  }\n}\n</code></pre> <p>\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\uff1a2\u3064\u306eHub\u3092\u4f5c\u308a\u307e\u3059</p> <p>\u69cb\u6210\uff1a <pre><code>Japan East Hub\n  \u251c\u2500\u2500 Firewall\n  \u251c\u2500\u2500 VPN Gateway\n  \u2514\u2500\u2500 Bastion\n\nJapan West Hub\n  \u251c\u2500\u2500 Firewall\n  \u251c\u2500\u2500 VPN Gateway\n  \u2514\u2500\u2500 Bastion\n\n2\u3064\u306eHub\u3092VNet\u30d4\u30a2\u30ea\u30f3\u30b0\u3067\u63a5\u7d9a\n</code></pre></p> <p>\u30e1\u30ea\u30c3\u30c8\uff1a - \u5197\u9577\u5316\uff08\u7247\u65b9\u304c\u843d\u3061\u3066\u3082\u5927\u4e08\u592b\uff09 - \u5730\u7406\u7684\u5206\u6563\uff08\u707d\u5bb3\u5bfe\u7b56\uff09 - \u30ec\u30a4\u30c6\u30f3\u30b7\u524a\u6e1b\uff08\u8fd1\u3044Hub\u3092\u4f7f\u3046\uff09</p> <p>\u30c7\u30e1\u30ea\u30c3\u30c8\uff1a - \u30b3\u30b9\u30c82\u500d - \u7ba1\u7406\u304c\u8907\u96d1</p> <p>\u304a\u3059\u3059\u3081\uff1a <pre><code># \u958b\u767a\u74b0\u5883\uff1aprimary\u3060\u3051\nhub_virtual_networks = {\n  primary = { ... }\n  # secondary\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n}\n\n# \u672c\u756a\u74b0\u5883\uff1a\u4e21\u65b9\nhub_virtual_networks = {\n  primary = { ... }\n  secondary = { ... }\n}\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#part-4","title":"Part 4: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0","text":""},{"location":"10_Hub-and-Spoke/#user-defined-routeudr","title":"User Defined Route\uff08UDR\uff09","text":"<pre><code>hub_virtual_network = {\n  route_table_name_firewall     = \"rt-fw-jpe\"\n  route_table_name_user_subnets = \"rt-user-jpe\"\n}\n</code></pre> <p>\u4f55\uff1f\uff1a\u30ab\u30b9\u30bf\u30e0\u30eb\u30fc\u30c8</p>"},{"location":"10_Hub-and-Spoke/#route_table_name_firewall","title":"route_table_name_firewall","text":"<pre><code>Firewall\u30b5\u30d6\u30cd\u30c3\u30c8\u7528\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\n</code></pre> <p>\u30eb\u30fc\u30eb\u4f8b\uff1a <pre><code>\u9001\u4fe1\u5148\uff1a0.0.0.0/0\uff08\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\uff09\n\u6b21\u30db\u30c3\u30d7\uff1aInternet\n  \u2193\nFirewall\u304b\u3089\u76f4\u63a5\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u51fa\u308b\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#route_table_name_user_subnets","title":"route_table_name_user_subnets","text":"<pre><code>\u30a2\u30d7\u30ea\u7528\u30b5\u30d6\u30cd\u30c3\u30c8\uff08Spoke\uff09\u7528\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\n</code></pre> <p>\u30eb\u30fc\u30eb\u4f8b\uff1a <pre><code>\u9001\u4fe1\u5148\uff1a0.0.0.0/0\uff08\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\uff09\n\u6b21\u30db\u30c3\u30d7\uff1a10.0.0.4\uff08Firewall\u306e\u5185\u90e8IP\uff09\n  \u2193\n\u5168\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092Firewall\u7d4c\u7531\u306b\u3059\u308b\n</code></pre></p> <p>\u52b9\u679c\uff1a <pre><code>Spoke VM \u2192 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\n  \u2193\n1. VM\u304b\u3089\u51fa\u308b\uff08\u9001\u4fe1\u5148\uff1a8.8.8.8\uff09\n2. UDR\u3067Firewall\u306b\u8ee2\u9001\n3. Firewall\u3067\u691c\u67fb\n4. Firewall\u304b\u3089\u51fa\u308b\n5. \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u5230\u9054\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#_3","title":"\u5b9f\u8df5\uff1a\u30b3\u30b9\u30c8\u524a\u6e1b\u7248\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046","text":""},{"location":"10_Hub-and-Spoke/#_4","title":"\u6700\u5c0f\u69cb\u6210","text":"<pre><code>hub_virtual_networks = {\n  primary = {\n    location = \"japaneast\"\n\n    enabled_resources = {\n      firewall                              = false  # \u2190\u7121\u52b9\u5316\n      bastion                               = false  # \u2190\u7121\u52b9\u5316\n      virtual_network_gateway_express_route = false\n      virtual_network_gateway_vpn           = false  # \u2190\u7121\u52b9\u5316\n      private_dns_zones                     = true\n      private_dns_resolver                  = false\n    }\n\n    hub_virtual_network = {\n      name          = \"vnet-jpe-hub\"\n      address_space = [\"10.0.0.0/16\"]\n    }\n  }\n}\n\nhub_and_spoke_networks_settings = {\n  enabled_resources = {\n    ddos_protection_plan = false  # \u2190\u7121\u52b9\u5316\n  }\n}\n</code></pre> <p>\u30b3\u30b9\u30c8\uff1a <pre><code>\u901a\u5e38\u69cb\u6210\uff1a\nFirewall\uff1a17\u4e07\u5186/\u6708\nVPN Gateway\uff1a4\u4e07\u5186/\u6708\nBastion\uff1a2.7\u4e07\u5186/\u6708\nDDoS\uff1a40\u4e07\u5186/\u6708\n-----------------\n\u5408\u8a08\uff1a\u7d0464\u4e07\u5186/\u6708\n\n\u6700\u5c0f\u69cb\u6210\uff1a\nVNet\uff1a\u7121\u6599\nPrivate DNS\uff1a\u7121\u6599\n-----------------\n\u5408\u8a08\uff1a\u7d040\u5186/\u6708\uff08\u307b\u307c\u7121\u6599\uff09\n</code></pre></p> <p>\u30c7\u30e1\u30ea\u30c3\u30c8\uff1a - \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u306a\u3057 - \u30aa\u30f3\u30d7\u30ec\u63a5\u7d9a\u306a\u3057 - RDP/SSH\u63a5\u7d9a\u4e0d\u4fbf</p> <p>\u4f7f\u3044\u9053\uff1a - \u958b\u767a\u74b0\u5883\u306e\u521d\u671f\u69cb\u7bc9 - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u8a08\u306e\u691c\u8a3c - \u30b3\u30b9\u30c8\u524a\u6e1b\u304c\u6700\u512a\u5148</p>"},{"location":"10_Hub-and-Spoke/#_5","title":"\u30c7\u30d0\u30c3\u30b0\u6280","text":""},{"location":"10_Hub-and-Spoke/#vnet","title":"VNet\u306e\u78ba\u8a8d","text":"<pre><code># VNet\u4e00\u89a7\naz network vnet list --output table\n\n# \u7279\u5b9a\u306eVNet\u306e\u8a73\u7d30\naz network vnet show \\\n  --resource-group rg-jpe-connectivity \\\n  --name vnet-jpe-hub\n</code></pre>"},{"location":"10_Hub-and-Spoke/#firewall","title":"Firewall\u306e\u78ba\u8a8d","text":"<pre><code># Firewall\u4e00\u89a7\naz network firewall list --output table\n\n# Firewall\u306e\u30ed\u30b0\u78ba\u8a8d\naz monitor log-analytics query \\\n  --workspace &lt;workspace-id&gt; \\\n  --analytics-query \"AzureDiagnostics | where Category == 'AzureFirewallApplicationRule' | take 10\"\n</code></pre>"},{"location":"10_Hub-and-Spoke/#_6","title":"\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u78ba\u8a8d","text":"<pre><code># \u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u4e00\u89a7\naz network route-table list --output table\n\n# \u7279\u5b9a\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u8a73\u7d30\naz network route-table show \\\n  --resource-group rg-jpe-connectivity \\\n  --name rt-user-jpe\n</code></pre>"},{"location":"10_Hub-and-Spoke/#bastion","title":"Bastion\u306e\u63a5\u7d9a","text":"<p>Azure\u30dd\u30fc\u30bf\u30eb\uff1a <pre><code>VM \u2192 Connect \u2192 Bastion\n  \u2193\n\u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\n  \u2193\n\u30d6\u30e9\u30a6\u30b6\u3067RDP/SSH\u63a5\u7d9a\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#_7","title":"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc","text":""},{"location":"10_Hub-and-Spoke/#1_1","title":"\u30a8\u30e9\u30fc1: \u30b5\u30d6\u30cd\u30c3\u30c8\u540d\u304c\u9055\u3046","text":"<pre><code>Error: subnet name must be 'AzureFirewallSubnet'\n</code></pre> <p>\u539f\u56e0\uff1aFirewall\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u540d\u304c\u9593\u9055\u3063\u3066\u308b</p> <p>\u5bfe\u51e6\u6cd5\uff1a \u30b5\u30d6\u30cd\u30c3\u30c8\u540d\u306f\u81ea\u52d5\u751f\u6210\u3055\u308c\u308b\u304b\u3089\u3001\u624b\u52d5\u3067\u4f5c\u3089\u306a\u3044\u3002</p>"},{"location":"10_Hub-and-Spoke/#2-zonesjapan-region","title":"\u30a8\u30e9\u30fc2: zones\u30a8\u30e9\u30fc\uff08Japan region\uff09","text":"<pre><code>Error: availability zones are not supported in this region\n</code></pre> <p>\u539f\u56e0\uff1aJapan East/West\u3067<code>zones</code>\u3092\u6307\u5b9a\u3057\u3066\u308b</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>zones = []  # \u2190\u7a7a\u30ea\u30b9\u30c8\n</code></pre></p> <p>Chapter 3\u3067\u8a73\u3057\u304f\u89e3\u8aac\u3057\u305f\u3084\u3064\u3002</p>"},{"location":"10_Hub-and-Spoke/#3_1","title":"\u30a8\u30e9\u30fc3: \u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\u306e\u91cd\u8907","text":"<pre><code>Error: address space overlaps with existing VNet\n</code></pre> <p>\u539f\u56e0\uff1aVNet\u306e\u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\u304c\u4ed6\u3068\u91cd\u8907</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># NG\nprimary:   10.0.0.0/16\nsecondary: 10.0.0.0/16  # \u2190\u91cd\u8907\n\n# OK\nprimary:   10.0.0.0/16\nsecondary: 10.1.0.0/16  # \u2190\u5206\u3051\u308b\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#4-firewall","title":"\u30a8\u30e9\u30fc4: Firewall\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8","text":"<pre><code>Error: timeout waiting for firewall to be ready\n</code></pre> <p>\u539f\u56e0\uff1aFirewall\u306e\u4f5c\u6210\u306b\u6642\u9593\u304c\u304b\u304b\u308b\uff0830\u5206\u301c1\u6642\u9593\uff09</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># \u3082\u3046\u4e00\u5ea6apply\nterraform apply\n\n# \u307e\u305f\u306f\u5f85\u3064\n</code></pre></p>"},{"location":"10_Hub-and-Spoke/#_8","title":"\u307e\u3068\u3081","text":"<p>Hub-and-Spoke\u306e\u69cb\u6210\u8981\u7d20\uff1a 1. Hub VNet\uff1a\u4e2d\u592e\u306eVNet 2. Firewall\uff1a\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u5236\u5fa1 3. VPN Gateway\uff1a\u30aa\u30f3\u30d7\u30ec\u63a5\u7d9a 4. ExpressRoute Gateway\uff1a\u5c02\u7528\u7dda\u63a5\u7d9a 5. Bastion\uff1a\u5b89\u5168\u306aRDP/SSH 6. Private DNS\uff1a\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u540d\u524d\u89e3\u6c7a</p> <p>\u899a\u3048\u3066\u304a\u304f\u3053\u3068\uff1a - Hub\u7d4c\u7531\u3067\u5168\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u5236\u5fa1 - Firewall\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u96c6\u7d04 - VPN Gateway\u3067\u30aa\u30f3\u30d7\u30ec\u63a5\u7d9a - Bastion\u3067\u5b89\u5168\u306aVM\u63a5\u7d9a - Japan region\u306f<code>zones = []</code>\u5fc5\u9808 - \u30b3\u30b9\u30c8\u524a\u6e1b\uff1a\u4e0d\u8981\u306a\u30ea\u30bd\u30fc\u30b9\u306f\u7121\u52b9\u5316</p> <p>\u6b21\u306eChapter\u3067\u306f\u3001Virtual WAN\u69cb\u6210\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 Hub-and-Spoke\u306e\u30de\u30cd\u30fc\u30b8\u30c9\u7248\u3067\u3001\u3088\u308a\u5927\u898f\u6a21\u306a\u74b0\u5883\u5411\u3051\u3067\u3059\u3002</p> <p>\u6240\u8981\u6642\u9593: 50\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2605 \u524d: 09_\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9.md \u6b21: 11_Virtual_WAN.md</p>"},{"location":"11_Virtual_WAN/","title":"11. Virtual WAN - \u6b21\u4e16\u4ee3\u306e\u30b0\u30ed\u30fc\u30d0\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af","text":""},{"location":"11_Virtual_WAN/#8","title":"8\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3068\u306e\u5bfe\u5fdc","text":"<p>\u3053\u306eChapter\u306f\u4ee5\u4e0b\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a - \u2705 4. Network Topology and Connectivity\uff08\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210 - \u9ad8\u5ea6\u306a\u5b9f\u88c5\uff09 - \u2705 8. Platform Automation and DevOps\uff08\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u81ea\u52d5\u5316\uff09</p> <p>\u2192 Chapter 01\u3067\u5b66\u3093\u30608\u3064\u306e\u8a2d\u8a08\u9818\u57df\u3092\u5fa9\u7fd2\u3057\u305f\u3044\u65b9\u306f01_\u57fa\u790e\u77e5\u8b58.md\u3078</p>"},{"location":"11_Virtual_WAN/#hub-and-spoke","title":"Hub-and-Spoke\u304b\u3089\u6765\u305f\u65b9\u3078","text":"<p>Chapter 10\u3067Hub-and-Spoke\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5b66\u3073\u307e\u3057\u305f\u3088\u306d\u3002 Virtual WAN\u306f\u305d\u306e\u300c\u30de\u30cd\u30fc\u30b8\u30c9\u7248\u300d\u3067\u3059\u3002\u6bd4\u8f03\u306e\u8a73\u7d30\u306fChapter 10\u3067\u89e3\u8aac\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3053\u3067\u306fVirtual WAN\u306e\u5b9f\u88c5\u306b\u96c6\u4e2d\u3057\u307e\u3059\u3002</p> <p>\u3053\u306eChapter\u3092\u8aad\u3080\u3079\u304d\u4eba\uff1a - \u2705 \u30b0\u30ed\u30fc\u30d0\u30eb\u5c55\u958b\u3092\u8003\u3048\u3066\u3044\u308b - \u2705 Virtual WAN\u306b\u8208\u5473\u304c\u3042\u308b - \u2705 Hub-and-Spoke\u3068\u306e\u9055\u3044\u3092\u77e5\u308a\u305f\u3044 - \u2705 \u5c06\u6765\u306e\u79fb\u884c\u3092\u691c\u8a0e\u3057\u3066\u3044\u308b</p> <p>\u30b9\u30ad\u30c3\u30d7\u3057\u3066\u3082OK\u306a\u4eba\uff1a - \u65e5\u672c\u56fd\u5185\u306e\u307f\u306e\u5c55\u958b - \u5f53\u9762Hub-and-Spoke\u3067\u5341\u5206 - \u3059\u3050\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044 \u2192 Chapter 13\u3078</p>"},{"location":"11_Virtual_WAN/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>Virtual WAN\u3092\u7406\u89e3\u3057\u3088\u3046\u3002</p> <p>Virtual WAN\u3063\u3066\u4f55\uff1f Microsoft\u304c\u30de\u30cd\u30fc\u30b8\u30c9\u3067\u63d0\u4f9b\u3059\u308b\u30b0\u30ed\u30fc\u30d0\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b5\u30fc\u30d3\u30b9\u3002</p> <p>Hub-and-Spoke\u3068\u306e\u9055\u3044\uff1a <pre><code>Hub-and-Spoke\uff1a\n- \u81ea\u5206\u3067VNet\u4f5c\u308b\n- \u81ea\u5206\u3067Firewall\u8a2d\u5b9a\n- \u81ea\u5206\u3067\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u8a2d\u5b9a\n- \u5c0f\u301c\u4e2d\u898f\u6a21\u5411\u3051\n\nVirtual WAN\uff1a\n- Microsoft\u304c\u7ba1\u7406\n- \u8a2d\u5b9a\u304c\u30b7\u30f3\u30d7\u30eb\n- \u30b0\u30ed\u30fc\u30d0\u30eb\u898f\u6a21\n- \u5927\u898f\u6a21\u5411\u3051\n</code></pre></p> <p>\u4f8b\u3048\u308b\u306a\u3089\uff1a - Hub-and-Spoke\uff1a\u81ea\u5bb6\u7528\u8eca\uff08\u81ea\u5206\u3067\u904b\u8ee2\uff09 - Virtual WAN\uff1a\u30bf\u30af\u30b7\u30fc\uff08\u30d7\u30ed\u306b\u4efb\u305b\u308b\uff09</p>"},{"location":"11_Virtual_WAN/#virtual-wan","title":"Virtual WAN\u306e\u30e1\u30ea\u30c3\u30c8","text":""},{"location":"11_Virtual_WAN/#1","title":"1. \u30de\u30cd\u30fc\u30b8\u30c9","text":"<pre><code>Hub-and-Spoke\uff1a\nVNet\u4f5c\u6210 \u2192 \u30b5\u30d6\u30cd\u30c3\u30c8\u8a2d\u8a08 \u2192 Firewall\u8a2d\u5b9a \u2192 \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u8a2d\u5b9a\n  \u2193\n\u5168\u90e8\u81ea\u5206\u3067\u3084\u308b\n\nVirtual WAN\uff1a\nVirtual Hub\u4f5c\u6210 \u2192 VNet\u63a5\u7d9a\n  \u2193\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u81ea\u52d5\n</code></pre>"},{"location":"11_Virtual_WAN/#2","title":"2. \u30b0\u30ed\u30fc\u30d0\u30eb\u30c8\u30e9\u30f3\u30b8\u30c3\u30c8","text":"<p>\ud83d\udcca Virtual WAN\u306e\u30b0\u30ed\u30fc\u30d0\u30eb\u63a5\u7d9a\u56f3</p> <pre><code>                  \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\n                       \u2195\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502  Microsoft Backbone  \u2502\n            \u2502   (\u81ea\u52d5\u3067\u6700\u9069\u5316)      \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2195\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502              \u2502             \u2502              \u2502\n\u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n\u2502Tokyo   \u2502    \u2502Singapore\u2502   \u2502London  \u2502    \u2502 New York\u2502\n\u2502vHub    \u2502\u2500\u2500\u2500\u2500\u2502vHub     \u2502\u2500\u2500\u2500\u2502vHub    \u2502\u2500\u2500\u2500\u2500\u2502vHub    \u2502\n\u2502(\u6771\u65e5\u672c) \u2502    \u2502(\u6771\u5357\u30a2) \u2502   \u2502(\u6b27\u5dde)  \u2502    \u2502(\u7c73\u56fd)  \u2502\n\u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n    \u2502              \u2502             \u2502              \u2502\n    \u2193              \u2193             \u2193              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Spoke  \u2502      \u2502Spoke  \u2502     \u2502Spoke  \u2502     \u2502Spoke  \u2502\n\u2502VNet   \u2502      \u2502VNet   \u2502     \u2502VNet   \u2502     \u2502VNet   \u2502\n\u2502(\u65e5\u672c  \u2502      \u2502(ASEAN \u2502     \u2502(\u6b27\u5dde  \u2502     \u2502(\u5317\u7c73  \u2502\n\u2502 \u30a2\u30d7\u30ea)\u2502      \u2502 \u30a2\u30d7\u30ea)\u2502     \u2502 \u30a2\u30d7\u30ea)\u2502     \u2502 \u30a2\u30d7\u30ea)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u3010\u7279\u5fb4\u3011\n\u2705 \u5168vHub\u9593\u304c\u81ea\u52d5\u3067\u30e1\u30c3\u30b7\u30e5\u63a5\u7d9a\n\u2705 Microsoft Backbone\u3067\u6700\u9069\u5316\u3055\u308c\u305f\u901a\u4fe1\n\u2705 \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u81ea\u52d5\u8a2d\u5b9a\n\u2705 \u3069\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u304b\u3089\u3067\u3082\u76f8\u4e92\u901a\u4fe1\u53ef\u80fd\n</code></pre> <p>\ud83d\udd04 \u901a\u4fe1\u4f8b\uff1a\u6771\u4eac\u306e\u30a2\u30d7\u30ea \u2192 \u30ed\u30f3\u30c9\u30f3\u306eDB</p> <pre><code>Tokyo Spoke VNet (\u30a2\u30d7\u30ea)\n  \u2193\nTokyo vHub\n  \u2193\nMicrosoft Backbone (\u6700\u9069\u7d4c\u8def\u3092\u81ea\u52d5\u9078\u629e)\n  \u2193\nLondon vHub\n  \u2193\nLondon Spoke VNet (DB)\n\n\u3010\u6240\u8981\u6642\u9593\u3011\u7d04150ms\uff08\u81ea\u52d5\u6700\u9069\u5316\uff09\n</code></pre> <p>Hub-and-Spoke\u3060\u3068\uff1a <pre><code>VNet\u30d4\u30a2\u30ea\u30f3\u30b0\u3092\u624b\u52d5\u3067\u8a2d\u5b9a\n  \u2193\n\u3081\u3061\u3083\u304f\u3061\u3083\u8907\u96d1\n</code></pre></p>"},{"location":"11_Virtual_WAN/#3","title":"3. \u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3","text":"<pre><code>Hub-and-Spoke\uff1a\nVPN Gateway\uff1a\u6700\u592730\u63a5\u7d9a\n\nVirtual WAN\uff1a\nVPN Gateway\uff1a\u6700\u592710,000\u63a5\u7d9a\n  \u2193\n\u8d85\u5927\u898f\u6a21\u5bfe\u5fdc\n</code></pre>"},{"location":"11_Virtual_WAN/#4","title":"4. \u7d71\u5408\u3055\u308c\u305f\u7ba1\u7406","text":"<pre><code>Virtual WAN Hub\u5185\u3067\u5168\u90e8\u7ba1\u7406\uff1a\n- VPN\u63a5\u7d9a\n- ExpressRoute\u63a5\u7d9a\n- Firewall\n- \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\n- SD-WAN\u7d71\u5408\n</code></pre>"},{"location":"11_Virtual_WAN/#_1","title":"\u30c7\u30e1\u30ea\u30c3\u30c8","text":""},{"location":"11_Virtual_WAN/#1_1","title":"1. \u30b3\u30b9\u30c8\u304c\u9ad8\u3044","text":"<pre><code>Virtual Hub\uff1a\u7d045.5\u4e07\u5186/\u6708\n+ \u30c7\u30fc\u30bf\u8ee2\u9001\u6599\u91d1\n+ \u63a5\u7d9a\u6599\u91d1\n\nHub-and-Spoke\u3088\u308a\u9ad8\u3044\n</code></pre>"},{"location":"11_Virtual_WAN/#2_1","title":"2. \u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u306b\u5236\u9650","text":"<pre><code>Hub-and-Spoke\uff1a\n- \u7d30\u304b\u3044\u8a2d\u5b9a\u5909\u66f4\u53ef\u80fd\n- \u81ea\u7531\u5ea6\u9ad8\u3044\n\nVirtual WAN\uff1a\n- \u30de\u30cd\u30fc\u30b8\u30c9\u306a\u306e\u3067\u5236\u9650\u3042\u308a\n- Microsoft\u306e\u8a2d\u8a08\u306b\u5f93\u3046\n</code></pre>"},{"location":"11_Virtual_WAN/#3_1","title":"3. \u5b66\u7fd2\u30b3\u30b9\u30c8","text":"<pre><code>\u65b0\u3057\u3044\u6982\u5ff5\uff1a\n- Virtual Hub\n- Virtual Network Connection\n- Routing Intent\n- Route Table\uff08Hub\u7528\uff09\n\n\u6163\u308c\u308b\u307e\u3067\u5927\u5909\n</code></pre>"},{"location":"11_Virtual_WAN/#part-1-tfvars","title":"Part 1: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08tfvars\uff09","text":""},{"location":"11_Virtual_WAN/#connectivity_type","title":"connectivity_type","text":"<pre><code>connectivity_type = \"virtual_wan\"\n</code></pre> <p>Chapter 10\u3068\u306e\u9055\u3044\uff1a <pre><code># Hub-and-Spoke\nconnectivity_type = \"hub_and_spoke_vnet\"\n\n# Virtual WAN\nconnectivity_type = \"virtual_wan\"\n</code></pre></p> <p>\u3069\u3063\u3061\u304b\u7247\u65b9\u3060\u3051\u4f7f\u3046\u3002\u4e21\u65b9\u306f\u4f7f\u3048\u306a\u3044\u3002</p>"},{"location":"11_Virtual_WAN/#virtual_wan_settings","title":"virtual_wan_settings","text":"<pre><code>virtual_wan_settings = {\n  enabled_resources = {\n    resource_group = true\n  }\n  resource_group = {\n    name     = \"rg-vwan\"\n    location = \"japaneast\"\n  }\n  virtual_wan = {\n    name = \"vwan-alz\"\n  }\n}\n</code></pre>"},{"location":"11_Virtual_WAN/#resource_group","title":"resource_group","text":"<p>\u4f55\uff1f\uff1aVirtual WAN\u7528\u306e\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7</p> <p>\u72ec\u7acb\u3057\u3066\u3044\u308b\u7406\u7531\uff1a <pre><code>Virtual WAN\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u30ea\u30bd\u30fc\u30b9\n  \u2193\n\u7279\u5b9a\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u7e1b\u3089\u308c\u306a\u3044\n  \u2193\n\u5c02\u7528\u306e\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306b\u5165\u308c\u308b\n</code></pre></p>"},{"location":"11_Virtual_WAN/#virtual_wan","title":"virtual_wan","text":"<pre><code>virtual_wan = {\n  name = \"vwan-alz\"\n}\n</code></pre> <p>Virtual WAN\u30ea\u30bd\u30fc\u30b9\uff1a\u6700\u4e0a\u4f4d\u306e\u30b3\u30f3\u30c6\u30ca</p> <p>\u968e\u5c64\u69cb\u9020\uff1a <pre><code>Virtual WAN\uff08\u6700\u4e0a\u4f4d\uff09\n  \u2514\u2500\u2500 Virtual Hub\uff08\u30ea\u30fc\u30b8\u30e7\u30f3\u3054\u3068\uff09\n       \u251c\u2500\u2500 VPN Gateway\n       \u251c\u2500\u2500 ExpressRoute Gateway\n       \u251c\u2500\u2500 Firewall\n       \u2514\u2500\u2500 VNet\u63a5\u7d9a\n</code></pre></p>"},{"location":"11_Virtual_WAN/#part-2-virtual-hub","title":"Part 2: Virtual Hub","text":""},{"location":"11_Virtual_WAN/#virtual_hubs","title":"virtual_hubs","text":"<pre><code>virtual_hubs = {\n  primary = {\n    location = \"japaneast\"\n\n    enabled_resources = {\n      firewall                              = true\n      bastion                               = false\n      virtual_network_gateway_express_route = false\n      virtual_network_gateway_vpn           = true\n      private_dns_zones                     = true\n      private_dns_resolver                  = false\n      sidecar_virtual_network               = false\n    }\n\n    default_hub_address_space = \"10.0.0.0/16\"\n    default_parent_id         = \"/subscriptions/.../resourceGroups/rg-vwan\"\n\n    hub = {\n      name                                   = \"vhub-jpe\"\n      address_prefix                         = \"10.0.0.0/23\"\n      hub_routing_preference                 = \"ExpressRoute\"\n      virtual_router_auto_scale_min_capacity = 2\n    }\n\n    ...\n  }\n}\n</code></pre> <p>primary\u3063\u3066\u30ad\u30fc\uff1a\u4f55\u3067\u3082\u3044\u3044\u3002\u8907\u6570\u306eHub\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u3002</p>"},{"location":"11_Virtual_WAN/#hubaddress_prefix","title":"hub.address_prefix","text":"<pre><code>address_prefix = \"10.0.0.0/23\"\n</code></pre> <p>\u4f55\uff1f\uff1aVirtual Hub\u81ea\u4f53\u306e\u30a2\u30c9\u30ec\u30b9\u7a7a\u9593</p> <p>\u30b5\u30a4\u30ba\uff1a <pre><code>/23 \u2192 512\u500b\u306eIP\u30a2\u30c9\u30ec\u30b9\n/24 \u2192 256\u500b\n/22 \u2192 1024\u500b\n</code></pre></p> <p>\u63a8\u5968\uff1a<code>/23</code>\uff08512\u500b\uff09</p> <p>\u4f7f\u3044\u9053\uff1a <pre><code>Hub\u5185\u90e8\u306e\u4eee\u60f3\u30eb\u30fc\u30bf\u30fc\u7528\n  \u2193\n\u30e6\u30fc\u30b6\u30fc\u306f\u4f7f\u308f\u306a\u3044\n  \u2193\nMicrosoft\u304c\u7ba1\u7406\n</code></pre></p>"},{"location":"11_Virtual_WAN/#hub_routing_preference","title":"hub_routing_preference","text":"<pre><code>hub_routing_preference = \"ExpressRoute\"\n</code></pre> <p>\u4f55\uff1f\uff1a\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u512a\u5148\u9806\u4f4d</p> <p>\u9078\u629e\u80a2\uff1a <pre><code>ExpressRoute\uff1a\n- ExpressRoute\u7d4c\u7531\u3092\u512a\u5148\n- VPN\u306f\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n\nVpnGateway\uff1a\n- VPN\u7d4c\u7531\u3092\u512a\u5148\n- ExpressRoute\u306f\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n\nASPath\uff1a\n- BGP AS Path\u3067\u5224\u65ad\n- \u7d30\u304b\u3044\u5236\u5fa1\n</code></pre></p> <p>\u666e\u901a\u306f\uff1a<code>ExpressRoute</code></p>"},{"location":"11_Virtual_WAN/#virtual_router_auto_scale_min_capacity","title":"virtual_router_auto_scale_min_capacity","text":"<pre><code>virtual_router_auto_scale_min_capacity = 2\n</code></pre> <p>\u4f55\uff1f\uff1aVirtual Hub\u306e\u30b9\u30b1\u30fc\u30eb\u30e6\u30cb\u30c3\u30c8</p> <p>\u30b9\u30b1\u30fc\u30eb\u30e6\u30cb\u30c3\u30c8\uff1a <pre><code>1\u30e6\u30cb\u30c3\u30c8 = \u7d04500Mbps\n2\u30e6\u30cb\u30c3\u30c8 = \u7d041Gbps\n3\u30e6\u30cb\u30c3\u30c8 = \u7d041.5Gbps\n...\n</code></pre></p> <p>\u6599\u91d1\uff1a <pre><code>1\u30e6\u30cb\u30c3\u30c8\uff1a\u7d042.7\u4e07\u5186/\u6708\n2\u30e6\u30cb\u30c3\u30c8\uff1a\u7d045.5\u4e07\u5186/\u6708\n3\u30e6\u30cb\u30c3\u30c8\uff1a\u7d048.2\u4e07\u5186/\u6708\n</code></pre></p> <p>\u6700\u5c0f\u5024\uff1a2\uff08\u63a8\u5968\uff09</p>"},{"location":"11_Virtual_WAN/#part-3-firewallvirtual-wan","title":"Part 3: Firewall\uff08Virtual WAN\u7248\uff09","text":""},{"location":"11_Virtual_WAN/#firewall","title":"firewall","text":"<pre><code>firewall = {\n  name                         = \"fw-vhub-jpe\"\n  threat_intelligence_mode     = \"Alert\"\n  virtual_hub_key              = \"primary\"\n  dns_servers                  = []\n  public_ip_count              = 1\n  sku_tier                     = \"Standard\"\n  threat_intelligence_allowlist = {}\n}\n</code></pre>"},{"location":"11_Virtual_WAN/#hub-and-spokefirewall","title":"Hub-and-Spoke\u306eFirewall\u3068\u306e\u9055\u3044","text":"<pre><code>Hub-and-Spoke\uff1a\n- \u81ea\u5206\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u4f5c\u308b\n- \u81ea\u5206\u3067Public IP\u7ba1\u7406\n- VNet\u306b\u30c7\u30d7\u30ed\u30a4\n\nVirtual WAN\uff1a\n- \u30b5\u30d6\u30cd\u30c3\u30c8\u4e0d\u8981\n- Public IP\u81ea\u52d5\u4f5c\u6210\n- Virtual Hub\u306b\u30c7\u30d7\u30ed\u30a4\n- \u8a2d\u5b9a\u304c\u30b7\u30f3\u30d7\u30eb\n</code></pre>"},{"location":"11_Virtual_WAN/#threat_intelligence_mode","title":"threat_intelligence_mode","text":"<pre><code>threat_intelligence_mode = \"Alert\"\n</code></pre> <p>\u4f55\uff1f\uff1a\u8105\u5a01\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30b9</p> <p>\u9078\u629e\u80a2\uff1a <pre><code>Off\uff1a\n- \u7121\u52b9\n- \u8105\u5a01\u691c\u77e5\u3057\u306a\u3044\n\nAlert\uff1a\n- \u8b66\u544a\u3060\u3051\n- \u30d6\u30ed\u30c3\u30af\u3057\u306a\u3044\n- \u30ed\u30b0\u306b\u8a18\u9332\n\nDeny\uff1a\n- \u8b66\u544a + \u30d6\u30ed\u30c3\u30af\n- \u60aa\u610f\u3042\u308b\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u906e\u65ad\n</code></pre></p> <p>\u304a\u3059\u3059\u3081\uff1a <pre><code># \u958b\u767a\u74b0\u5883\nthreat_intelligence_mode = \"Alert\"  # \u2190\u5f71\u97ff\u78ba\u8a8d\n\n# \u672c\u756a\u74b0\u5883\nthreat_intelligence_mode = \"Deny\"   # \u2190\u672c\u6c17\u3067\u30d6\u30ed\u30c3\u30af\n</code></pre></p>"},{"location":"11_Virtual_WAN/#sku_tier","title":"sku_tier","text":"<pre><code>sku_tier = \"Standard\"\n</code></pre> <p>\u9078\u629e\u80a2\uff1a <pre><code>Basic\uff1a\n- \u7d048\u4e07\u5186/\u6708\n- \u57fa\u672c\u6a5f\u80fd\u306e\u307f\n\nStandard\uff1a\n- \u7d0417\u4e07\u5186/\u6708\n- \u8105\u5a01\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30b9\n- \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\n\nPremium\uff1a\n- \u7d0425\u4e07\u5186/\u6708\n- TLS\u691c\u67fb\n- IDPS\uff08\u4fb5\u5165\u691c\u77e5/\u9632\u6b62\uff09\n- Web\u30ab\u30c6\u30b4\u30ea\n</code></pre></p> <p>Chapter 10\u3068\u540c\u3058\u3084\u3064\u3002</p>"},{"location":"11_Virtual_WAN/#firewall_policy","title":"firewall_policy","text":"<pre><code>firewall_policy = {\n  name     = \"fwp-vhub-jpe\"\n  base_policy = {\n    parent_firewall_policy_id = null\n  }\n}\n</code></pre> <p>Virtual WAN\u72ec\u81ea\uff1a<code>base_policy</code></p> <p>\u4f55\uff1f\uff1a\u89aa\u30dd\u30ea\u30b7\u30fc\u306e\u7d99\u627f</p> <pre><code>\u89aa\u30dd\u30ea\u30b7\u30fc\uff08\u672c\u793e\u306e\u5171\u901a\u30eb\u30fc\u30eb\uff09\n  \u2193 \u7d99\u627f\n\u5b50\u30dd\u30ea\u30b7\u30fc\uff08\u62e0\u70b9\u3054\u3068\u306e\u30eb\u30fc\u30eb\uff09\n  \u2193\n\u62e0\u70b9\u3054\u3068\u306b\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3064\u3064\u3001\u5171\u901a\u30eb\u30fc\u30eb\u3082\u9069\u7528\n</code></pre> <p>\u4f7f\u3044\u65b9\uff1a <pre><code># \u89aa\u30dd\u30ea\u30b7\u30fc\nbase_policy = {\n  parent_firewall_policy_id = null  # \u2190\u89aa\u306a\u3057\n}\n\n# \u5b50\u30dd\u30ea\u30b7\u30fc\nbase_policy = {\n  parent_firewall_policy_id = \"/subscriptions/.../firewallPolicies/fwp-parent\"\n}\n</code></pre></p>"},{"location":"11_Virtual_WAN/#part-4-vpn-gatewayvirtual-wan","title":"Part 4: VPN Gateway\uff08Virtual WAN\u7248\uff09","text":""},{"location":"11_Virtual_WAN/#virtual_network_gateway_vpn","title":"virtual_network_gateway_vpn","text":"<pre><code>virtual_network_gateway_vpn = {\n  name       = \"vpngw-vhub-jpe\"\n  scale_unit = 1\n\n  vpn_sites = {\n    site1 = {\n      name          = \"vpnsite-onprem-tokyo\"\n      address_cidrs = [\"192.168.0.0/16\"]\n      device_vendor = \"Cisco\"\n\n      link = {\n        name       = \"link1\"\n        ip_address = \"203.0.113.10\"\n        bgp = {\n          asn             = 65001\n          peering_address = \"192.168.1.1\"\n        }\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"11_Virtual_WAN/#hub-and-spokevpn-gateway","title":"Hub-and-Spoke\u306eVPN Gateway\u3068\u306e\u9055\u3044","text":"<pre><code>Hub-and-Spoke\uff1a\n- VPN Gateway\u3060\u3051\u4f5c\u308b\n- \u63a5\u7d9a\u306f\u5225\u9014\u8a2d\u5b9a\uff08Local Network Gateway\uff09\n\nVirtual WAN\uff1a\n- VPN Gateway + VPN Site\uff08\u63a5\u7d9a\u5148\u60c5\u5831\uff09\u3092\u307e\u3068\u3081\u3066\u8a2d\u5b9a\n- \u8a2d\u5b9a\u304c\u30b7\u30f3\u30d7\u30eb\n</code></pre>"},{"location":"11_Virtual_WAN/#scale_unit","title":"scale_unit","text":"<pre><code>scale_unit = 1\n</code></pre> <p>\u4f55\uff1f\uff1a\u30b9\u30b1\u30fc\u30eb\u30e6\u30cb\u30c3\u30c8\uff08\u6027\u80fd\uff09</p> <p>\u30b9\u30b1\u30fc\u30eb\uff1a <pre><code>1\u30e6\u30cb\u30c3\u30c8\uff1a500Mbps\u3001\u7d042.7\u4e07\u5186/\u6708\n2\u30e6\u30cb\u30c3\u30c8\uff1a1Gbps\u3001\u7d045.5\u4e07\u5186/\u6708\n3\u30e6\u30cb\u30c3\u30c8\uff1a1.5Gbps\u3001\u7d048.2\u4e07\u5186/\u6708\n...\n20\u30e6\u30cb\u30c3\u30c8\uff1a10Gbps\u3001\u7d0454\u4e07\u5186/\u6708\n</code></pre></p> <p>Hub-and-Spoke\u3068\u306e\u9055\u3044\uff1a <pre><code>Hub-and-Spoke\uff1a\n- VpnGw1\u3001VpnGw2\u3001VpnGw3\uff08\u56fa\u5b9aSKU\uff09\n\nVirtual WAN\uff1a\n- 1\u301c20\u30e6\u30cb\u30c3\u30c8\uff08\u67d4\u8edf\u306b\u30b9\u30b1\u30fc\u30eb\uff09\n</code></pre></p>"},{"location":"11_Virtual_WAN/#vpn_sites","title":"vpn_sites","text":"<pre><code>vpn_sites = {\n  site1 = {\n    name          = \"vpnsite-onprem-tokyo\"\n    address_cidrs = [\"192.168.0.0/16\"]\n    device_vendor = \"Cisco\"\n\n    link = {\n      name       = \"link1\"\n      ip_address = \"203.0.113.10\"  # \u2190\u30aa\u30f3\u30d7\u30ec\u306ePublic IP\n      bgp = {\n        asn             = 65001      # \u2190\u30aa\u30f3\u30d7\u30ec\u306eAS\u756a\u53f7\n        peering_address = \"192.168.1.1\"\n      }\n    }\n  }\n}\n</code></pre> <p>\u4f55\uff1f\uff1aVPN\u63a5\u7d9a\u5148\u306e\u60c5\u5831</p> <p>\u69cb\u6210\uff1a <pre><code>\u30aa\u30f3\u30d7\u30ec\uff08Tokyo\uff09\n  Public IP: 203.0.113.10\n  Private Net: 192.168.0.0/16\n  BGP ASN: 65001\n  \u2193 VPN\u63a5\u7d9a\nAzure Virtual WAN Hub\n</code></pre></p> <p>device_vendor\uff1a\u30ed\u30b0\u306b\u8868\u793a\u3055\u308c\u308b\uff08\u4efb\u610f\uff09</p>"},{"location":"11_Virtual_WAN/#part-5-vnet","title":"Part 5: VNet\u63a5\u7d9a","text":""},{"location":"11_Virtual_WAN/#virtual_network_connections","title":"virtual_network_connections","text":"<pre><code>virtual_network_connections = {\n  spoke1 = {\n    name                      = \"conn-spoke1\"\n    remote_virtual_network_id = \"/subscriptions/.../virtualNetworks/vnet-spoke1\"\n    internet_security_enabled = true\n\n    routing = {\n      associated_route_table_key = \"defaultRouteTable\"\n      propagated_route_table = {\n        labels = [\"default\"]\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"11_Virtual_WAN/#hub-and-spokevnet","title":"Hub-and-Spoke\u306eVNet\u30d4\u30a2\u30ea\u30f3\u30b0\u3068\u306e\u9055\u3044","text":"<pre><code>Hub-and-Spoke\uff1a\n- VNet Peering\u4f5c\u6210\n- \u53cc\u65b9\u5411\u3067\u8a2d\u5b9a\n- \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u624b\u52d5\u8a2d\u5b9a\n\nVirtual WAN\uff1a\n- Virtual Network Connection\u4f5c\u6210\n- \u7247\u65b9\u5411\u3067OK\n- \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u81ea\u52d5\u8a2d\u5b9a\n</code></pre>"},{"location":"11_Virtual_WAN/#internet_security_enabled","title":"internet_security_enabled","text":"<pre><code>internet_security_enabled = true\n</code></pre> <p>\u4f55\uff1f\uff1a\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5411\u3051\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092Firewall\u7d4c\u7531\u306b\u3059\u308b</p> <p>true\uff1a <pre><code>Spoke VM \u2192 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\n  \u2193\nVirtual Hub Firewall\u7d4c\u7531\n  \u2193\n\u691c\u67fb\u3057\u3066\u304b\u3089\u51fa\u308b\n</code></pre></p> <p>false\uff1a <pre><code>Spoke VM \u2192 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\n  \u2193\n\u76f4\u63a5\u51fa\u308b\uff08Firewall\u7d4c\u7531\u3057\u306a\u3044\uff09\n</code></pre></p> <p>\u666e\u901a\u306f\uff1a<code>true</code>\uff08\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u91cd\u8996\uff09</p>"},{"location":"11_Virtual_WAN/#routing","title":"routing","text":"<pre><code>routing = {\n  associated_route_table_key = \"defaultRouteTable\"\n  propagated_route_table = {\n    labels = [\"default\"]\n  }\n}\n</code></pre> <p>\u4f55\uff1f\uff1aVirtual WAN\u72ec\u81ea\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6a5f\u69cb</p> <p>associated_route_table\uff1a <pre><code>\u3053\u306eVNet\u304c\u4f7f\u3046\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\n</code></pre></p> <p>propagated_route_table\uff1a <pre><code>\u3053\u306eVNet\u306e\u30eb\u30fc\u30c8\u3092\u4ed6\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u4f1d\u64ad\n</code></pre></p> <p>\u3088\u304f\u308f\u304b\u3089\u3093\uff1f \u6b21\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u8a73\u3057\u304f\u89e3\u8aac\u3059\u308b\u306d\u3002</p>"},{"location":"11_Virtual_WAN/#part-6-virtual-wan","title":"Part 6: Virtual WAN\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0","text":""},{"location":"11_Virtual_WAN/#_2","title":"\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u6982\u5ff5","text":"<p>Hub-and-Spoke\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\uff1a <pre><code>\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u7d10\u4ed8\u304f\n  \u2193\n\u9001\u4fe1\u5148\uff1a0.0.0.0/0\n\u6b21\u30db\u30c3\u30d7\uff1a10.0.0.4\uff08Firewall\uff09\n</code></pre></p> <p>Virtual WAN\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\uff1a <pre><code>Virtual Hub\u5185\u306e\u8ad6\u7406\u7684\u306a\u30c6\u30fc\u30d6\u30eb\n  \u2193\nVNet\u63a5\u7d9a\u306b\u7d10\u4ed8\u304f\n  \u2193\n\u81ea\u52d5\u3067\u30eb\u30fc\u30c8\u5b66\u7fd2\u30fb\u4f1d\u64ad\n</code></pre></p>"},{"location":"11_Virtual_WAN/#defaultroutetable","title":"defaultRouteTable","text":"<pre><code>Virtual Hub\u3092\u4f5c\u308b\u3068\u81ea\u52d5\u3067\u4f5c\u3089\u308c\u308b\n  \u2193\n\u5168VNet\u63a5\u7d9a\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\n</code></pre> <p>\u52d5\u304d\uff1a <pre><code>1. Spoke1\u3092\u63a5\u7d9a\n   \u2192 defaultRouteTable\u306b\u7d10\u4ed8\u304f\n   \u2192 Spoke1\u306e\u30eb\u30fc\u30c8\uff0810.1.0.0/16\uff09\u3092\u5b66\u7fd2\n\n2. Spoke2\u3092\u63a5\u7d9a\n   \u2192 defaultRouteTable\u306b\u7d10\u4ed8\u304f\n   \u2192 Spoke2\u306e\u30eb\u30fc\u30c8\uff0810.2.0.0/16\uff09\u3092\u5b66\u7fd2\n\n3. \u30eb\u30fc\u30c8\u4f1d\u64ad\n   \u2192 Spoke1\u304b\u3089Spoke2\u3078\u901a\u4fe1\u53ef\u80fd\n   \u2192 Spoke2\u304b\u3089Spoke1\u3078\u901a\u4fe1\u53ef\u80fd\n</code></pre></p>"},{"location":"11_Virtual_WAN/#_3","title":"\u30ab\u30b9\u30bf\u30e0\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb","text":"<pre><code>route_tables = {\n  production = {\n    name   = \"rt-production\"\n    labels = [\"prod\"]\n  }\n  development = {\n    name   = \"rt-development\"\n    labels = [\"dev\"]\n  }\n}\n</code></pre> <p>\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\uff1a\u74b0\u5883\u5206\u96e2</p> <pre><code>\u672c\u756aVNet\n  \u2193\nrt-production\u306b\u7d10\u4ed8\u3051\n  \u2193\n\u672c\u756a\u540c\u58eb\u306e\u307f\u901a\u4fe1\u53ef\u80fd\n\n\u958b\u767aVNet\n  \u2193\nrt-development\u306b\u7d10\u4ed8\u3051\n  \u2193\n\u958b\u767a\u540c\u58eb\u306e\u307f\u901a\u4fe1\u53ef\u80fd\n\n\u672c\u756a \u2194\ufe0e \u958b\u767a\u306f\u901a\u4fe1\u3067\u304d\u306a\u3044\n</code></pre>"},{"location":"11_Virtual_WAN/#routing-intent","title":"Routing Intent","text":"<pre><code>routing_intents = {\n  default = {\n    name = \"routing-intent-default\"\n    routing_policies = [\n      {\n        name                  = \"InternetTraffic\"\n        destinations          = [\"Internet\"]\n        next_hop_firewall_key = \"primary\"\n      },\n      {\n        name                  = \"PrivateTraffic\"\n        destinations          = [\"PrivateTraffic\"]\n        next_hop_firewall_key = \"primary\"\n      }\n    ]\n  }\n}\n</code></pre> <p>\u4f55\uff1f\uff1a\u5168\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092Firewall\u7d4c\u7531\u306b\u3059\u308b\u8a2d\u5b9a</p> <p>InternetTraffic\uff1a <pre><code>\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5411\u3051\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\n  \u2193\nFirewall\u7d4c\u7531\n</code></pre></p> <p>PrivateTraffic\uff1a <pre><code>VNet\u9593\u3001\u30aa\u30f3\u30d7\u30ec\u5411\u3051\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\n  \u2193\nFirewall\u7d4c\u7531\n</code></pre></p> <p>\u52b9\u679c\uff1a <pre><code>internet_security_enabled = true \u3068\u4f3c\u3066\u308b\n  \u2193\n\u3067\u3082\u3053\u3063\u3061\u306e\u65b9\u304c\u5f37\u529b\n  \u2193\n\u5168\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\uff08\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u542b\u3080\uff09\u3092Firewall\u7d4c\u7531\n</code></pre></p>"},{"location":"11_Virtual_WAN/#part-7-sidecar-vnet","title":"Part 7: Sidecar VNet","text":"<pre><code>enabled_resources = {\n  sidecar_virtual_network = true\n}\n\nsidecar_virtual_network = {\n  name          = \"vnet-sidecar-jpe\"\n  address_space = [\"10.100.0.0/16\"]\n  subnets = {\n    bastion = {\n      name             = \"AzureBastionSubnet\"\n      address_prefixes = [\"10.100.0.0/26\"]\n    }\n  }\n}\n\nbastion = {\n  name = \"bas-vhub-jpe\"\n  public_ip = {\n    name  = \"pip-bas-vhub-jpe\"\n    zones = []\n  }\n}\n</code></pre>"},{"location":"11_Virtual_WAN/#sidecar-vnet","title":"Sidecar VNet\u3063\u3066\u4f55\uff1f","text":"<p>\u554f\u984c\uff1a <pre><code>Virtual Hub\n  \u2193\nBastion\u304c\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u306a\u3044\n  \u2193\nHub\u306f\u4eee\u60f3\u30eb\u30fc\u30bf\u30fc\uff08\u30b5\u30d6\u30cd\u30c3\u30c8\u4f5c\u308c\u306a\u3044\uff09\n</code></pre></p> <p>\u89e3\u6c7a\u7b56\uff1a <pre><code>Virtual Hub\u306e\u6a2a\u306b\u666e\u901a\u306eVNet\u3092\u4f5c\u308b\n  \u2193\n\u305d\u3053\u306bBastion\u3092\u30c7\u30d7\u30ed\u30a4\n  \u2193\nHub\u306b\u63a5\u7d9a\n  \u2193\nSpoke VM\u306b\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\n</code></pre></p> <p>Sidecar\uff08\u30b5\u30a4\u30c9\u30ab\u30fc\uff09\uff1a\u30d0\u30a4\u30af\u306e\u6a2a\u306b\u4ed8\u3051\u308b\u6905\u5b50</p> <p>\u69cb\u6210\uff1a <pre><code>Virtual Hub\uff08\u30e1\u30a4\u30f3\uff09\n  \u2193 \u6a2a\u306b\nSidecar VNet\n  \u2514\u2500\u2500 Bastion\n</code></pre></p> <p>zones = []\uff1aChapter 3\u3067\u898b\u305f\u3084\u3064\u3002Japan region\u306f\u5fc5\u9808\u3002</p>"},{"location":"11_Virtual_WAN/#virtual-wan_1","title":"\u5b9f\u8df5\uff1aVirtual WAN\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046","text":""},{"location":"11_Virtual_WAN/#_4","title":"\u6700\u5c0f\u69cb\u6210","text":"<pre><code>connectivity_type = \"virtual_wan\"\n\nvirtual_wan_settings = {\n  enabled_resources = {\n    resource_group = true\n  }\n  resource_group = {\n    name     = \"rg-vwan\"\n    location = \"japaneast\"\n  }\n  virtual_wan = {\n    name = \"vwan-alz\"\n  }\n}\n\nvirtual_hubs = {\n  primary = {\n    location                  = \"japaneast\"\n    default_hub_address_space = \"10.0.0.0/16\"\n\n    enabled_resources = {\n      firewall                              = false  # \u2190\u7121\u52b9\u5316\n      bastion                               = false\n      virtual_network_gateway_express_route = false\n      virtual_network_gateway_vpn           = false  # \u2190\u7121\u52b9\u5316\n      private_dns_zones                     = false\n      private_dns_resolver                  = false\n      sidecar_virtual_network               = false\n    }\n\n    hub = {\n      name                                   = \"vhub-jpe\"\n      address_prefix                         = \"10.0.0.0/23\"\n      virtual_router_auto_scale_min_capacity = 2\n    }\n  }\n}\n</code></pre> <p>\u30b3\u30b9\u30c8\uff1a <pre><code>Virtual Hub\uff1a\u7d045.5\u4e07\u5186/\u6708\uff082\u30e6\u30cb\u30c3\u30c8\uff09\n  \u2193\n\u3053\u308c\u3060\u3051\n</code></pre></p> <p>Firewall\u7121\u52b9\u5316\u3067\u30b3\u30b9\u30c8\u524a\u6e1b\u3002</p>"},{"location":"11_Virtual_WAN/#hub-and-spoke-vs-virtual-wan","title":"Hub-and-Spoke vs Virtual WAN\uff1a\u3069\u3063\u3061\u4f7f\u3046\uff1f","text":""},{"location":"11_Virtual_WAN/#hub-and-spoke_1","title":"Hub-and-Spoke\u304c\u304a\u3059\u3059\u3081","text":"<pre><code>\u2713 \u5c0f\u301c\u4e2d\u898f\u6a21\uff08VNet 10\u500b\u4ee5\u4e0b\uff09\n\u2713 \u5358\u4e00\u30ea\u30fc\u30b8\u30e7\u30f3\u3001\u307e\u305f\u306f2\u301c3\u30ea\u30fc\u30b8\u30e7\u30f3\n\u2713 \u7d30\u304b\u3044\u5236\u5fa1\u304c\u5fc5\u8981\n\u2713 \u30b3\u30b9\u30c8\u91cd\u8996\n\u2713 \u30b7\u30f3\u30d7\u30eb\u306a\u69cb\u6210\n</code></pre> <p>\u4f8b\uff1a <pre><code>\u65e5\u672c\u56fd\u5185\u306e\u696d\u52d9\u30b7\u30b9\u30c6\u30e0\n- Japan East/West\uff082\u30ea\u30fc\u30b8\u30e7\u30f3\uff09\n- Spoke VNet 5\u500b\n- VPN\u63a5\u7d9a 1\u672c\n</code></pre></p>"},{"location":"11_Virtual_WAN/#virtual-wan_2","title":"Virtual WAN\u304c\u304a\u3059\u3059\u3081","text":"<pre><code>\u2713 \u5927\u898f\u6a21\uff08VNet 10\u500b\u4ee5\u4e0a\uff09\n\u2713 \u591a\u6570\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\uff085\u30ea\u30fc\u30b8\u30e7\u30f3\u4ee5\u4e0a\uff09\n\u2713 \u591a\u6570\u306eVPN\u63a5\u7d9a\uff0810\u672c\u4ee5\u4e0a\uff09\n\u2713 \u30b0\u30ed\u30fc\u30d0\u30eb\u5c55\u958b\n\u2713 \u7ba1\u7406\u306e\u7c21\u7d20\u5316\u91cd\u8996\n</code></pre> <p>\u4f8b\uff1a <pre><code>\u30b0\u30ed\u30fc\u30d0\u30eb\u4f01\u696d\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n- \u4e16\u754c10\u30ea\u30fc\u30b8\u30e7\u30f3\n- Spoke VNet 50\u500b\n- \u62e0\u70b9VPN\u63a5\u7d9a 100\u672c\n- SD-WAN\u7d71\u5408\n</code></pre></p>"},{"location":"11_Virtual_WAN/#_5","title":"\u30c7\u30d0\u30c3\u30b0\u6280","text":""},{"location":"11_Virtual_WAN/#virtual-wan_3","title":"Virtual WAN\u306e\u78ba\u8a8d","text":"<pre><code># Virtual WAN\u4e00\u89a7\naz network vwan list --output table\n\n# \u8a73\u7d30\naz network vwan show \\\n  --resource-group rg-vwan \\\n  --name vwan-alz\n</code></pre>"},{"location":"11_Virtual_WAN/#virtual-hub","title":"Virtual Hub\u306e\u78ba\u8a8d","text":"<pre><code># Virtual Hub\u4e00\u89a7\naz network vhub list --output table\n\n# \u8a73\u7d30\naz network vhub show \\\n  --resource-group rg-vwan \\\n  --name vhub-jpe\n\n# \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u78ba\u8a8d\naz network vhub route-table list \\\n  --resource-group rg-vwan \\\n  --vhub-name vhub-jpe\n</code></pre>"},{"location":"11_Virtual_WAN/#vnet","title":"VNet\u63a5\u7d9a\u306e\u78ba\u8a8d","text":"<pre><code># \u63a5\u7d9a\u4e00\u89a7\naz network vhub connection list \\\n  --resource-group rg-vwan \\\n  --vhub-name vhub-jpe \\\n  --output table\n\n# Effective Routes\uff08\u5b9f\u52b9\u30eb\u30fc\u30c8\uff09\naz network vhub get-effective-routes \\\n  --resource-group rg-vwan \\\n  --name vhub-jpe \\\n  --resource-type VirtualNetworkConnection \\\n  --resource-id /subscriptions/.../virtualNetworks/vnet-spoke1\n</code></pre> <p>Effective Routes\uff1a\u8d85\u91cd\u8981</p> <pre><code>\u8a2d\u5b9a\u3057\u305f\u30eb\u30fc\u30c8\u3058\u3083\u306a\u304f\u3001\u5b9f\u969b\u306b\u4f7f\u308f\u308c\u308b\u30eb\u30fc\u30c8\n  \u2193\n\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u9375\n</code></pre>"},{"location":"11_Virtual_WAN/#_6","title":"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc","text":""},{"location":"11_Virtual_WAN/#1_2","title":"\u30a8\u30e9\u30fc1: \u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\u306e\u91cd\u8907","text":"<pre><code>Error: address space overlaps\n</code></pre> <p>\u539f\u56e0\uff1aVirtual Hub\u3068VNet\u306e\u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\u304c\u91cd\u8907</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># NG\nhub.address_prefix: 10.0.0.0/23\nspoke VNet: 10.0.0.0/24  # \u2190\u91cd\u8907\n\n# OK\nhub.address_prefix: 10.0.0.0/23\nspoke VNet: 10.1.0.0/16  # \u2190\u5206\u3051\u308b\n</code></pre></p>"},{"location":"11_Virtual_WAN/#2_2","title":"\u30a8\u30e9\u30fc2: \u30b9\u30b1\u30fc\u30eb\u30e6\u30cb\u30c3\u30c8\u4e0d\u8db3","text":"<pre><code>Error: insufficient scale units\n</code></pre> <p>\u539f\u56e0\uff1aVNet\u63a5\u7d9a\u6570\u306b\u5bfe\u3057\u3066\u30b9\u30b1\u30fc\u30eb\u30e6\u30cb\u30c3\u30c8\u304c\u5c11\u306a\u3044</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># \u76ee\u5b89\n1\u301c5 VNet\uff1a2\u30e6\u30cb\u30c3\u30c8\n6\u301c10 VNet\uff1a3\u30e6\u30cb\u30c3\u30c8\n11\u301c20 VNet\uff1a4\u30e6\u30cb\u30c3\u30c8\n...\n</code></pre></p>"},{"location":"11_Virtual_WAN/#3-routing-intent","title":"\u30a8\u30e9\u30fc3: Routing Intent\u7af6\u5408","text":"<pre><code>Error: routing intent already exists\n</code></pre> <p>\u539f\u56e0\uff1aRouting Intent\u306f1\u3064\u306eHub\u306b1\u3064\u3060\u3051</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># NG\uff082\u500b\u4f5c\u308d\u3046\u3068\u3057\u3066\u3044\u307e\u3059\uff09\nrouting_intents = {\n  intent1 = { ... }\n  intent2 = { ... }\n}\n\n# OK\uff081\u500b\u3060\u3051\uff09\nrouting_intents = {\n  default = { ... }\n}\n</code></pre></p>"},{"location":"11_Virtual_WAN/#4-sidecar-vnet","title":"\u30a8\u30e9\u30fc4: Sidecar VNet\u4f5c\u6210\u5931\u6557","text":"<pre><code>Error: bastion requires sidecar virtual network\n</code></pre> <p>\u539f\u56e0\uff1aBastion\u3092\u6709\u52b9\u5316\u3057\u305f\u3051\u3069Sidecar VNet\u304c\u306a\u3044</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>enabled_resources = {\n  bastion                 = true\n  sidecar_virtual_network = true  # \u2190\u3053\u308c\u3082\u6709\u52b9\u5316\n}\n\nsidecar_virtual_network = { ... }\n</code></pre></p>"},{"location":"11_Virtual_WAN/#_7","title":"\u307e\u3068\u3081","text":"<p>Virtual WAN\u306e\u7279\u5fb4\uff1a 1. \u30de\u30cd\u30fc\u30b8\u30c9\uff1aMicrosoft\u304c\u7ba1\u7406 2. \u30b0\u30ed\u30fc\u30d0\u30eb\uff1a\u8907\u6570\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u81ea\u52d5\u30e1\u30c3\u30b7\u30e5 3. \u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\uff1a\u5927\u898f\u6a21\u5bfe\u5fdc 4. \u30b7\u30f3\u30d7\u30eb\uff1a\u8a2d\u5b9a\u304c\u7c21\u5358 5. \u9ad8\u30b3\u30b9\u30c8\uff1aHub-and-Spoke\u3088\u308a\u9ad8\u3044</p> <p>\u4f7f\u3044\u5206\u3051\uff1a <pre><code>\u5c0f\u301c\u4e2d\u898f\u6a21 \u2192 Hub-and-Spoke\n\u5927\u898f\u6a21 \u2192 Virtual WAN\n</code></pre></p> <p>\u91cd\u8981\u306a\u8a2d\u5b9a\uff1a - <code>virtual_router_auto_scale_min_capacity</code>\uff1a\u6027\u80fd\u3068\u30b3\u30b9\u30c8 - <code>internet_security_enabled</code>\uff1aFirewall\u7d4c\u7531 - <code>routing_intents</code>\uff1a\u5168\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u5236\u5fa1 - <code>sidecar_virtual_network</code>\uff1aBastion\u7528</p> <p>\u6b21\u306eChapter\u3067\u306f\u3001GitHub Actions\u3092\u4f7f\u3063\u305f\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 Terraform\u5b9f\u884c\u3092\u81ea\u52d5\u5316\u3059\u308b\u3084\u3064\u3002</p> <p>\u6240\u8981\u6642\u9593: 55\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2605 \u524d: 10_Hub-and-Spoke.md \u6b21: 12_GitHub_Actions.md</p>"},{"location":"12_GitHub_Actions/","title":"12. GitHub Actions - \u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\u306e\u4ed5\u7d44\u307f","text":""},{"location":"12_GitHub_Actions/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>GitHub Actions\u3067\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\u3092\u7406\u89e3\u3057\u3088\u3046\u3002</p> <p>GitHub Actions\u3063\u3066\u4f55\uff1f GitHub\u4e0a\u3067\u52d5\u304fCI/CD\uff08\u7d99\u7d9a\u7684\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3/\u30c7\u30ea\u30d0\u30ea\u30fc\uff09\u30b5\u30fc\u30d3\u30b9\u3002</p> <p>CI/CD\u3063\u3066\u4f55\uff1f <pre><code>CI\uff08Continuous Integration\uff09\uff1a\n\u30b3\u30fc\u30c9\u3092\u30d7\u30c3\u30b7\u30e5\n  \u2193\n\u81ea\u52d5\u3067\u30c6\u30b9\u30c8\u30fb\u691c\u8a3c\n  \u2193\n\u554f\u984c\u304c\u3042\u308c\u3070\u6559\u3048\u3066\u304f\u308c\u308b\n\nCD\uff08Continuous Delivery\uff09\uff1a\nmain\u30d6\u30e9\u30f3\u30c1\u306b\u30de\u30fc\u30b8\n  \u2193\n\u81ea\u52d5\u3067\u30c7\u30d7\u30ed\u30a4\n  \u2193\n\u672c\u756a\u74b0\u5883\u306b\u53cd\u6620\n</code></pre></p> <p>\u4f8b\u3048\u308b\u306a\u3089\uff1a - \u624b\u52d5\u30c7\u30d7\u30ed\u30a4\uff1a\u6599\u7406\u3092\u5168\u90e8\u81ea\u5206\u3067\u4f5c\u308b - GitHub Actions\uff1a\u30aa\u30fc\u30c8\u30e1\u30fc\u30b7\u30e7\u30f3\u30ad\u30c3\u30c1\u30f3\uff08\u81ea\u52d5\u3067\u8abf\u7406\uff09</p> <p>\ud83d\udcca CI/CD\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5168\u4f53\u56f3</p> <pre><code>\u3010\u958b\u767a\u306e\u6d41\u308c\u3011\n\n1. \u30b3\u30fc\u30c9\u5909\u66f4\n   \u2193\n   \u958b\u767a\u8005\u304c feature \u30d6\u30e9\u30f3\u30c1\u3067\u4f5c\u696d\n   variables.tf \u3092\u7de8\u96c6\n   \u2193\n\n2. Pull Request\u4f5c\u6210\n   \u2193\n   feature \u2192 main \u3078\u306e PR\n   \u2193\n\n3. \u81ea\u52d5\u691c\u8a3c\uff08terraform plan\uff09\n   \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n   \u2502 GitHub Actions \u8d77\u52d5       \u2502\n   \u2502   \u2193                      \u2502\n   \u2502 terraform init            \u2502\n   \u2502   \u2193                      \u2502\n   \u2502 terraform fmt -check      \u2502\n   \u2502   \u2193                      \u2502\n   \u2502 terraform validate        \u2502\n   \u2502   \u2193                      \u2502\n   \u2502 terraform plan           \u2502\n   \u2502   \u2193                      \u2502\n   \u2502 \u5909\u66f4\u5185\u5bb9\u3092PR\u306b\u30b3\u30e1\u30f3\u30c8    \u2502\n   \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n   \u2193\n\n4. \u30ec\u30d3\u30e5\u30fc\u30fb\u627f\u8a8d\n   \u2193\n   \u30c1\u30fc\u30e0\u30e1\u30f3\u30d0\u30fc\u304c\u78ba\u8a8d\n   \u300cOK\u3001\u627f\u8a8d\uff01\u300d\n   \u2193\n\n5. \u30de\u30fc\u30b8\n   \u2193\n   main \u30d6\u30e9\u30f3\u30c1\u306b\u30de\u30fc\u30b8\n   \u2193\n\n6. \u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\uff08terraform apply\uff09\n   \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n   \u2502 GitHub Actions \u8d77\u52d5       \u2502\n   \u2502   \u2193                      \u2502\n   \u2502 terraform init            \u2502\n   \u2502   \u2193                      \u2502\n   \u2502 terraform apply -auto-approve \u2502\n   \u2502   \u2193                      \u2502\n   \u2502 Azure \u306b\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210      \u2502\n   \u2502   \u2193                      \u2502\n   \u2502 \u7d50\u679c\u3092 Slack \u306b\u901a\u77e5      \u2502\n   \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n   \u2193\n\n7. \u672c\u756a\u74b0\u5883\u306b\u53cd\u6620 \u2705\n</code></pre> <p>\ud83d\udd04 \u8a73\u7d30\u306a\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u56f3</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u958b\u767a\u8005PC   \u2502\n\u2502             \u2502\n\u2502 git push    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        GitHub Repository         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 Pull Request               \u2502  \u2502\n\u2502  \u2502   feature \u2192 main           \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502           \u2193                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  GitHub Actions            \u2502  \u2502\n\u2502  \u2502  (Workflow\u5b9f\u884c)            \u2502  \u2502\n\u2502  \u2502                            \u2502  \u2502\n\u2502  \u2502  Step 1: Checkout          \u2502  \u2502\n\u2502  \u2502  Step 2: Setup Terraform   \u2502  \u2502\n\u2502  \u2502  Step 3: terraform plan    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502\n            \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502    Azure      \u2502\n    \u2502  (\u8a8d\u8a3c\u30fb\u63a5\u7d9a) \u2502\n    \u2502               \u2502\n    \u2502  OIDC\u8a8d\u8a3c     \u2502\n    \u2502  \u2193            \u2502\n    \u2502  State\u53d6\u5f97    \u2502\n    \u2502  \u2193            \u2502\n    \u2502  Plan\u5b9f\u884c     \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2193\n    \u7d50\u679c\u3092PR\u306b\u30b3\u30e1\u30f3\u30c8\n</code></pre>"},{"location":"12_GitHub_Actions/#github-actions","title":"\u306a\u305cGitHub Actions\u3092\u4f7f\u3046\uff1f","text":""},{"location":"12_GitHub_Actions/#1","title":"1. \u30d2\u30e5\u30fc\u30de\u30f3\u30a8\u30e9\u30fc\u9632\u6b62","text":"<pre><code>\u624b\u52d5\u30c7\u30d7\u30ed\u30a4\uff1a\nterraform plan \u2192 \u78ba\u8a8d \u2192 terraform apply\n  \u2193\n\u30b3\u30de\u30f3\u30c9\u6253\u3061\u9593\u9055\u3044\n\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\u3057\u5fd8\u308c\n\u627f\u8a8d\u306a\u3057\u3067\u30c7\u30d7\u30ed\u30a4\n  \u2193\n\u4e8b\u6545\u308b\n</code></pre> <pre><code>GitHub Actions\uff1a\nPR\u3092\u4f5c\u308b \u2192 \u81ea\u52d5\u3067plan \u2192 \u30ec\u30d3\u30e5\u30fc \u2192 \u30de\u30fc\u30b8\u3067\u81ea\u52d5apply\n  \u2193\n\u624b\u9806\u304c\u81ea\u52d5\u5316\n  \u2193\n\u9593\u9055\u3044\u304c\u6e1b\u308b\n</code></pre>"},{"location":"12_GitHub_Actions/#2","title":"2. \u5c65\u6b74\u304c\u6b8b\u308b","text":"<pre><code>\u624b\u52d5\u30c7\u30d7\u30ed\u30a4\uff1a\n\u8ab0\u304c\u3044\u3064\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u304b\u308f\u304b\u3089\u306a\u3044\n\nGitHub Actions\uff1a\n\u5168\u90e8GitHub\u306b\u8a18\u9332\n- \u3044\u3064\n- \u8ab0\u304c\n- \u4f55\u3092\n- \u3069\u3046\u306a\u3063\u305f\u304b\n  \u2193\n\u5b8c\u5168\u306b\u30c8\u30ec\u30fc\u30b9\u53ef\u80fd\n</code></pre>"},{"location":"12_GitHub_Actions/#3","title":"3. \u627f\u8a8d\u30d5\u30ed\u30fc","text":"<pre><code>GitHub Actions\uff1a\nPR\u3067plan\u7d50\u679c\u3092\u78ba\u8a8d\n  \u2193\n\u30ec\u30d3\u30e5\u30fc\u30fb\u627f\u8a8d\n  \u2193\n\u30de\u30fc\u30b8\u5f8c\u306bapply\n  \u2193\n\u52dd\u624b\u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u306a\u3044\n</code></pre>"},{"location":"12_GitHub_Actions/#4","title":"4. \u4e26\u884c\u5b9f\u884c\u306e\u9632\u6b62","text":"<pre><code>\u624b\u52d5\u30c7\u30d7\u30ed\u30a4\uff1a\n2\u4eba\u304c\u540c\u6642\u306bapply\u5b9f\u884c\n  \u2193\n\u30b9\u30c6\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u7834\u640d\n  \u2193\n\u3084\u3070\u3044\n\nGitHub Actions\uff1a\n\u540c\u6642\u5b9f\u884c\u3092\u5236\u5fa1\n  \u2193\n\u5b89\u5168\n</code></pre>"},{"location":"12_GitHub_Actions/#part-1","title":"Part 1: \u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u306e\u69cb\u6210","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u306f2\u3064\u306e\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u304c\u3042\u308b\uff1a</p>"},{"location":"12_GitHub_Actions/#1-cicontinuous-integration","title":"1. CI\uff08Continuous Integration\uff09","text":"<p>\u30d5\u30a1\u30a4\u30eb\uff1a<code>.github/workflows/ci.yaml</code></p> <pre><code>name: 01 Azure Landing Zones Continuous Integration\non:\n  pull_request:\n    branches:\n      - main\n  workflow_dispatch:\n    inputs:\n      terraform_cli_version:\n        description: 'Terraform CLI Version'\n        required: true\n        default: 'latest'\n        type: string\n\njobs:\n  validate_and_plan:\n    uses: shuhei0720org01/alz-mgmt-templates/.github/workflows/ci-template.yaml@main\n    name: 'CI'\n    permissions:\n      id-token: write\n      contents: read\n      pull-requests: write\n    with:\n      root_module_folder_relative_path: '.'\n      terraform_cli_version: ${{ inputs.terraform_cli_version }}\n</code></pre> <p>\u4f55\u3057\u3066\u308b\uff1f\uff1a <pre><code>1. PR\u304c\u4f5c\u3089\u308c\u308b\n2. \u81ea\u52d5\u3067terraform plan\u5b9f\u884c\n3. PR\u4e0a\u306bplan\u7d50\u679c\u3092\u8868\u793a\n4. \u30ec\u30d3\u30e5\u30a2\u30fc\u304c\u78ba\u8a8d\n</code></pre></p>"},{"location":"12_GitHub_Actions/#2-cdcontinuous-delivery","title":"2. CD\uff08Continuous Delivery\uff09","text":"<p>\u30d5\u30a1\u30a4\u30eb\uff1a<code>.github/workflows/cd.yaml</code></p> <pre><code>name: 02 Azure Landing Zones Continuous Delivery\non:\n  push:\n    branches:\n      - main\n  workflow_dispatch:\n    inputs:\n      terraform_action:\n        description: 'Terraform Action to perform'\n        required: true\n        default: 'apply'\n        type: choice\n        options:\n          - 'apply'\n          - 'destroy'\n      terraform_cli_version:\n        description: 'Terraform CLI Version'\n        required: true\n        default: 'latest'\n        type: string\n\njobs:\n  plan_and_apply:\n    uses: shuhei0720org01/alz-mgmt-templates/.github/workflows/cd-template.yaml@main\n    name: 'CD'\n    permissions:\n      id-token: write\n      contents: read\n    with:\n      terraform_action: ${{ inputs.terraform_action }}\n      root_module_folder_relative_path: '.'\n      terraform_cli_version: ${{ inputs.terraform_cli_version }}\n</code></pre> <p>\u4f55\u3057\u3066\u308b\uff1f\uff1a <pre><code>1. main\u30d6\u30e9\u30f3\u30c1\u306bpush\uff08\u30de\u30fc\u30b8\uff09\u3055\u308c\u308b\n2. \u81ea\u52d5\u3067terraform apply\u5b9f\u884c\n3. Azure\u306b\u53cd\u6620\n</code></pre></p>"},{"location":"12_GitHub_Actions/#part-2","title":"Part 2: \u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u306e\u8a73\u7d30\u89e3\u8aac","text":""},{"location":"12_GitHub_Actions/#on","title":"on\uff08\u30c8\u30ea\u30ac\u30fc\uff09","text":""},{"location":"12_GitHub_Actions/#ci-pull_request","title":"CI: pull_request","text":"<pre><code>on:\n  pull_request:\n    branches:\n      - main\n</code></pre> <p>\u4f55\uff1f\uff1aPR\u304c\u4f5c\u3089\u308c\u305f\u3089\u5b9f\u884c</p> <pre><code>feature/add-vnet \u30d6\u30e9\u30f3\u30c1\n  \u2193 PR\u4f5c\u6210\nmain \u30d6\u30e9\u30f3\u30c1\n  \u2193 \u30c8\u30ea\u30ac\u30fc\nCI\u5b9f\u884c\n</code></pre>"},{"location":"12_GitHub_Actions/#cd-push","title":"CD: push","text":"<pre><code>on:\n  push:\n    branches:\n      - main\n</code></pre> <p>\u4f55\uff1f\uff1amain\u30d6\u30e9\u30f3\u30c1\u306bpush\u3055\u308c\u305f\u3089\u5b9f\u884c</p> <pre><code>PR\u627f\u8a8d\n  \u2193 \u30de\u30fc\u30b8\nmain \u30d6\u30e9\u30f3\u30c1\n  \u2193 \u30c8\u30ea\u30ac\u30fc\nCD\u5b9f\u884c\n</code></pre>"},{"location":"12_GitHub_Actions/#workflow_dispatch","title":"workflow_dispatch","text":"<pre><code>on:\n  workflow_dispatch:\n    inputs:\n      terraform_action:\n        description: 'Terraform Action to perform'\n        required: true\n        default: 'apply'\n        type: choice\n        options:\n          - 'apply'\n          - 'destroy'\n</code></pre> <p>\u4f55\uff1f\uff1a\u624b\u52d5\u5b9f\u884c</p> <p>\u4f7f\u3044\u9053\uff1a <pre><code>GitHub UI \u2192 Actions \u2192 \u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u9078\u629e \u2192 Run workflow\n  \u2193\nterraform_action\u3092\u9078\u629e\n  - apply\uff1a\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\n  - destroy\uff1a\u30ea\u30bd\u30fc\u30b9\u524a\u9664\n  \u2193\n\u624b\u52d5\u3067\u5b9f\u884c\n</code></pre></p> <p>\u4fbf\u5229\uff1a <pre><code>\u7dca\u6025\u6642\uff1a\n- destroy\u5b9f\u884c\uff08\u5168\u524a\u9664\uff09\n- \u7279\u5b9a\u30d0\u30fc\u30b8\u30e7\u30f3\u306eTerraform\u3067apply\n</code></pre></p>"},{"location":"12_GitHub_Actions/#permissions","title":"permissions","text":"<pre><code>permissions:\n  id-token: write\n  contents: read\n  pull-requests: write\n</code></pre> <p>\u4f55\uff1f\uff1aGitHub\u30c8\u30fc\u30af\u30f3\u306e\u6a29\u9650</p>"},{"location":"12_GitHub_Actions/#id-token-write","title":"id-token: write","text":"<pre><code>OIDC\uff08OpenID Connect\uff09\u3067Azure\u306b\u30ed\u30b0\u30a4\u30f3\n  \u2193\n\u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\n  \u2193\n\u30bb\u30ad\u30e5\u30a2\n</code></pre> <p>\u5f8c\u3067\u8a73\u3057\u304f\u89e3\u8aac\u3059\u308b\u306d\u3002</p>"},{"location":"12_GitHub_Actions/#contents-read","title":"contents: read","text":"<pre><code>\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30b3\u30fc\u30c9\u3092\u8aad\u3080\n  \u2193\nTerraform\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u5f97\n</code></pre>"},{"location":"12_GitHub_Actions/#pull-requests-write","title":"pull-requests: write","text":"<pre><code>PR\u306b\u30b3\u30e1\u30f3\u30c8\u6295\u7a3f\n  \u2193\nplan\u7d50\u679c\u3092\u8868\u793a\n</code></pre>"},{"location":"12_GitHub_Actions/#jobs","title":"jobs","text":"<pre><code>jobs:\n  validate_and_plan:\n    uses: shuhei0720org01/alz-mgmt-templates/.github/workflows/ci-template.yaml@main\n    with:\n      root_module_folder_relative_path: '.'\n      terraform_cli_version: ${{ inputs.terraform_cli_version }}\n</code></pre> <p>\u4f55\u3057\u3066\u308b\uff1f\uff1a\u518d\u5229\u7528\u53ef\u80fd\u306a\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3092\u547c\u3073\u51fa\u3057</p> <p>\u69cb\u9020\uff1a <pre><code>alz-mgmt\uff08\u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\uff09\n  \u251c\u2500\u2500 .github/workflows/ci.yaml\uff08\u30c8\u30ea\u30ac\u30fc\u5b9a\u7fa9\u3060\u3051\uff09\n  \u2514\u2500\u2500 \u5b9f\u969b\u306e\u51e6\u7406\u306f\u5225\u30ea\u30dd\u30b8\u30c8\u30ea\n        \u2193\nalz-mgmt-templates\n  \u2514\u2500\u2500 .github/workflows/ci-template.yaml\uff08\u5b9f\u969b\u306e\u51e6\u7406\uff09\n</code></pre></p> <p>\u30e1\u30ea\u30c3\u30c8\uff1a <pre><code>\u8907\u6570\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u540c\u3058\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u4f7f\u3048\u308b\n  \u2193\n1\u7b87\u6240\u4fee\u6b63\u3059\u308c\u3070\u5168\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u53cd\u6620\n  \u2193\nDRY\uff08Don't Repeat Yourself\uff09\n</code></pre></p>"},{"location":"12_GitHub_Actions/#part-3-reusable-workflow","title":"Part 3: Reusable Workflow\uff08\u518d\u5229\u7528\u53ef\u80fd\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\uff09","text":""},{"location":"12_GitHub_Actions/#ci-templateyaml","title":"ci-template.yaml\uff08\u60f3\u5b9a\u3055\u308c\u308b\u5185\u5bb9\uff09","text":"<p>\u5b9f\u969b\u306e\u30d5\u30a1\u30a4\u30eb\u306f<code>alz-mgmt-templates</code>\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308a\u307e\u3059\u304c\u3001\u5178\u578b\u7684\u306a\u5185\u5bb9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\uff1a</p> <pre><code>name: CI Template\non:\n  workflow_call:\n    inputs:\n      root_module_folder_relative_path:\n        required: true\n        type: string\n      terraform_cli_version:\n        required: true\n        type: string\n\njobs:\n  terraform_plan:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n\n      - name: Setup Terraform\n        uses: hashicorp/setup-terraform@v3\n        with:\n          terraform_version: ${{ inputs.terraform_cli_version }}\n\n      - name: Azure Login (OIDC)\n        uses: azure/login@v2\n        with:\n          client-id: ${{ secrets.AZURE_CLIENT_ID }}\n          tenant-id: ${{ secrets.AZURE_TENANT_ID }}\n          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}\n\n      - name: Terraform Init\n        run: terraform init\n        working-directory: ${{ inputs.root_module_folder_relative_path }}\n\n      - name: Terraform Validate\n        run: terraform validate\n        working-directory: ${{ inputs.root_module_folder_relative_path }}\n\n      - name: Terraform Plan\n        run: terraform plan -out=tfplan\n        working-directory: ${{ inputs.root_module_folder_relative_path }}\n\n      - name: Comment PR\n        uses: actions/github-script@v7\n        with:\n          script: |\n            // plan\u7d50\u679c\u3092PR\u306b\u30b3\u30e1\u30f3\u30c8\n</code></pre>"},{"location":"12_GitHub_Actions/#_1","title":"\u30b9\u30c6\u30c3\u30d7\u89e3\u8aac","text":""},{"location":"12_GitHub_Actions/#1-checkout","title":"1. Checkout","text":"<pre><code>- name: Checkout\n  uses: actions/checkout@v4\n</code></pre> <p>\u4f55\uff1f\uff1a\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30b3\u30fc\u30c9\u3092\u30af\u30ed\u30fc\u30f3</p> <pre><code>GitHub Actions Runner\uff08\u5b9f\u884c\u74b0\u5883\uff09\n  \u2193\ngit clone\n  \u2193\n\u30b3\u30fc\u30c9\u3092\u53d6\u5f97\n</code></pre>"},{"location":"12_GitHub_Actions/#2-setup-terraform","title":"2. Setup Terraform","text":"<pre><code>- name: Setup Terraform\n  uses: hashicorp/setup-terraform@v3\n  with:\n    terraform_version: ${{ inputs.terraform_cli_version }}\n</code></pre> <p>\u4f55\uff1f\uff1aTerraform\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb</p> <pre><code>\u6307\u5b9a\u3055\u308c\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u306eTerraform\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n  \u2193\nPATH\u306b\u8ffd\u52a0\n  \u2193\nterraform \u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u308b\n</code></pre>"},{"location":"12_GitHub_Actions/#3-azure-login-oidc","title":"3. Azure Login (OIDC)","text":"<pre><code>- name: Azure Login (OIDC)\n  uses: azure/login@v2\n  with:\n    client-id: ${{ secrets.AZURE_CLIENT_ID }}\n    tenant-id: ${{ secrets.AZURE_TENANT_ID }}\n    subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}\n</code></pre> <p>\u4f55\uff1f\uff1aAzure\u306b\u30ed\u30b0\u30a4\u30f3\uff08OIDC\uff09</p> <p>OIDC\uff08OpenID Connect\uff09\uff1a <pre><code>\u5f93\u6765\uff1a\n- Service Principal\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306b\u4fdd\u5b58\n- \u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u6f0f\u6d29\u3059\u308b\u30ea\u30b9\u30af\n- \u5b9a\u671f\u7684\u306a\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u5fc5\u8981\n\nOIDC\uff1a\n- \u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\n- \u4e00\u6642\u7684\u306a\u30c8\u30fc\u30af\u30f3\u3067\u8a8d\u8a3c\n- \u3088\u308a\u5b89\u5168\n</code></pre></p> <p>\u4ed5\u7d44\u307f\uff1a <pre><code>1. GitHub Actions \u2192 Azure AD\u306b\u300c\u79c1\u306fGitHub\u3067\u3059\u300d\u3068\u8a3c\u660e\n2. Azure AD \u2192 GitHub\u3092\u4fe1\u983c\uff08\u4e8b\u524d\u8a2d\u5b9a\uff09\n3. Azure AD \u2192 \u4e00\u6642\u30c8\u30fc\u30af\u30f3\u767a\u884c\n4. GitHub Actions \u2192 \u30c8\u30fc\u30af\u30f3\u3067Azure\u306b\u30a2\u30af\u30bb\u30b9\n</code></pre></p>"},{"location":"12_GitHub_Actions/#4-terraform-init","title":"4. Terraform Init","text":"<pre><code>- name: Terraform Init\n  run: terraform init\n  working-directory: ${{ inputs.root_module_folder_relative_path }}\n</code></pre> <p>\u4f55\uff1f\uff1aTerraform\u306e\u521d\u671f\u5316</p> <pre><code>terraform init\n  \u2193\n- Provider\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n- Backend\u8a2d\u5b9a\u8aad\u307f\u8fbc\u307f\n- State\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\n</code></pre> <p>Backend\u8a2d\u5b9a\uff1a <pre><code># terraform.tf\nbackend \"azurerm\" {}\n</code></pre></p> <p>\u74b0\u5883\u5909\u6570\u3067\u8a2d\u5b9a\uff1a <pre><code>export ARM_STORAGE_ACCOUNT_NAME=\"stterraform12345\"\nexport ARM_CONTAINER_NAME=\"tfstate\"\nexport ARM_KEY=\"alz-mgmt.tfstate\"\nexport ARM_RESOURCE_GROUP_NAME=\"rg-terraform-state\"\n</code></pre></p> <p>GitHub Actions\u306eSecrets\u306b\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3002</p>"},{"location":"12_GitHub_Actions/#5-terraform-validate","title":"5. Terraform Validate","text":"<pre><code>- name: Terraform Validate\n  run: terraform validate\n</code></pre> <p>\u4f55\uff1f\uff1a\u69cb\u6587\u30c1\u30a7\u30c3\u30af</p> <pre><code>terraform validate\n  \u2193\n- .tf\u30d5\u30a1\u30a4\u30eb\u306e\u69cb\u6587\u78ba\u8a8d\n- \u5909\u6570\u306e\u53c2\u7167\u78ba\u8a8d\n- \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u6574\u5408\u6027\u30c1\u30a7\u30c3\u30af\n</code></pre> <p>\u30a8\u30e9\u30fc\u4f8b\uff1a <pre><code>Error: Missing required argument\n  on main.tf line 10:\n  10: resource \"azurerm_resource_group\" \"example\" {\n</code></pre></p>"},{"location":"12_GitHub_Actions/#6-terraform-plan","title":"6. Terraform Plan","text":"<pre><code>- name: Terraform Plan\n  run: terraform plan -out=tfplan\n</code></pre> <p>\u4f55\uff1f\uff1a\u5909\u66f4\u5185\u5bb9\u306e\u78ba\u8a8d</p> <pre><code>terraform plan\n  \u2193\n- \u73fe\u5728\u306eState\n- \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n- \u5b9f\u969b\u306eAzure\n\u3092\u6bd4\u8f03\n  \u2193\n\u4f55\u304c\u5909\u308f\u308b\u304b\u8868\u793a\n</code></pre> <p>-out=tfplan\uff1a <pre><code>plan\u7d50\u679c\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\n  \u2193\napply\u6642\u306b\u4f7f\u3046\n  \u2193\nplan\u3068apply\u3067\u5dee\u7570\u304c\u306a\u3044\n</code></pre></p>"},{"location":"12_GitHub_Actions/#7-comment-pr","title":"7. Comment PR","text":"<pre><code>- name: Comment PR\n  uses: actions/github-script@v7\n  with:\n    script: |\n      // plan\u7d50\u679c\u3092PR\u306b\u30b3\u30e1\u30f3\u30c8\n</code></pre> <p>\u4f55\uff1f\uff1aplan\u7d50\u679c\u3092PR\u306b\u6295\u7a3f</p> <p>\u4f8b\uff1a <pre><code>## Terraform Plan\n</code></pre> Terraform will perform the following actions:</p>"},{"location":"12_GitHub_Actions/#azurerm_resource_groupexample-will-be-created","title":"azurerm_resource_group.example will be created","text":"<ul> <li>resource \"azurerm_resource_group\" \"example\" {<ul> <li>name     = \"rg-example\"</li> <li>location = \"japaneast\"   }</li> </ul> </li> </ul> <p>Plan: 1 to add, 0 to change, 0 to destroy. </p> <p>\u4fbf\u5229\uff1a \u30ec\u30d3\u30e5\u30a2\u30fc\u304cPR\u753b\u9762\u3067\u5909\u66f4\u5185\u5bb9\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002</p>"},{"location":"12_GitHub_Actions/#part-4-cd-workflowapply","title":"Part 4: CD Workflow\uff08Apply\uff09","text":""},{"location":"12_GitHub_Actions/#cd-templateyaml","title":"cd-template.yaml\uff08\u60f3\u5b9a\u3055\u308c\u308b\u5185\u5bb9\uff09","text":"<pre><code>name: CD Template\non:\n  workflow_call:\n    inputs:\n      terraform_action:\n        required: true\n        type: string\n      root_module_folder_relative_path:\n        required: true\n        type: string\n      terraform_cli_version:\n        required: true\n        type: string\n\njobs:\n  terraform_apply:\n    runs-on: ubuntu-latest\n    environment: production  # \u2190\u74b0\u5883\u8a2d\u5b9a\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n\n      - name: Setup Terraform\n        uses: hashicorp/setup-terraform@v3\n        with:\n          terraform_version: ${{ inputs.terraform_cli_version }}\n\n      - name: Azure Login (OIDC)\n        uses: azure/login@v2\n        with:\n          client-id: ${{ secrets.AZURE_CLIENT_ID }}\n          tenant-id: ${{ secrets.AZURE_TENANT_ID }}\n          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}\n\n      - name: Terraform Init\n        run: terraform init\n        working-directory: ${{ inputs.root_module_folder_relative_path }}\n\n      - name: Terraform Apply\n        if: ${{ inputs.terraform_action == 'apply' }}\n        run: terraform apply -auto-approve\n        working-directory: ${{ inputs.root_module_folder_relative_path }}\n\n      - name: Terraform Destroy\n        if: ${{ inputs.terraform_action == 'destroy' }}\n        run: terraform destroy -auto-approve\n        working-directory: ${{ inputs.root_module_folder_relative_path }}\n</code></pre>"},{"location":"12_GitHub_Actions/#ci","title":"CI \u3068\u306e\u9055\u3044","text":""},{"location":"12_GitHub_Actions/#1-environment-production","title":"1. environment: production","text":"<pre><code>environment: production\n</code></pre> <p>\u4f55\uff1f\uff1a\u74b0\u5883\u8a2d\u5b9a</p> <p>\u4f7f\u3044\u9053\uff1a <pre><code>GitHub\u8a2d\u5b9a \u2192 Environments \u2192 production\n  \u2193\n- \u627f\u8a8d\u8005\u3092\u8a2d\u5b9a\uff08required reviewers\uff09\n- \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u8a2d\u5b9a\n- Environment Secrets\n</code></pre></p> <p>\u52b9\u679c\uff1a <pre><code>CD\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u5b9f\u884c\n  \u2193\n\u627f\u8a8d\u5f85\u3061\n  \u2193\n\u627f\u8a8d\u8005\u304c\u627f\u8a8d\n  \u2193\napply\u5b9f\u884c\n</code></pre></p> <p>\u5b89\u5168\uff1a <pre><code>main\u306b\u30de\u30fc\u30b8\u3055\u308c\u3066\u3082\u5373\u5ea7\u306bapply\u3055\u308c\u306a\u3044\n  \u2193\n\u4e00\u5ea6\u6b62\u307e\u308b\n  \u2193\n\u627f\u8a8d\u5f8c\u306bapply\n</code></pre></p>"},{"location":"12_GitHub_Actions/#2-auto-approve","title":"2. -auto-approve","text":"<pre><code>run: terraform apply -auto-approve\n</code></pre> <p>\u4f55\uff1f\uff1a\u78ba\u8a8d\u30b9\u30ad\u30c3\u30d7</p> <pre><code>\u901a\u5e38\uff1a\nterraform apply\n  \u2193\nDo you want to perform these actions? (yes/no): \u2190\u624b\u52d5\u5165\u529b\n\nCI/CD\uff1a\nterraform apply -auto-approve\n  \u2193\n\u78ba\u8a8d\u30b9\u30ad\u30c3\u30d7\u3067\u81ea\u52d5\u5b9f\u884c\n</code></pre> <p>\u5b89\u5168\u6027\uff1a <pre><code>plan\u3067\u78ba\u8a8d\u6e08\u307f\n  \u2193\nPR\u627f\u8a8d\u6e08\u307f\n  \u2193\nEnvironment\u627f\u8a8d\u6e08\u307f\n  \u2193\n-auto-approve\u3067OK\n</code></pre></p>"},{"location":"12_GitHub_Actions/#3-terraform_action","title":"3. terraform_action\u5206\u5c90","text":"<pre><code>- name: Terraform Apply\n  if: ${{ inputs.terraform_action == 'apply' }}\n  run: terraform apply -auto-approve\n\n- name: Terraform Destroy\n  if: ${{ inputs.terraform_action == 'destroy' }}\n  run: terraform destroy -auto-approve\n</code></pre> <p>\u4f55\uff1f\uff1aapply\u304bdestroy\u3092\u9078\u3079\u308b</p> <pre><code>workflow_dispatch\uff08\u624b\u52d5\u5b9f\u884c\uff09\n  \u2193\nterraform_action\u9078\u629e\n  - apply \u2192 \u30ea\u30bd\u30fc\u30b9\u4f5c\u6210/\u66f4\u65b0\n  - destroy \u2192 \u30ea\u30bd\u30fc\u30b9\u524a\u9664\n</code></pre>"},{"location":"12_GitHub_Actions/#part-5-secrets","title":"Part 5: Secrets\u8a2d\u5b9a","text":""},{"location":"12_GitHub_Actions/#secrets","title":"\u5fc5\u8981\u306aSecrets","text":"<pre><code>AZURE_CLIENT_ID\uff1aAzure AD\u30a2\u30d7\u30ea\u306eClient ID\nAZURE_TENANT_ID\uff1aAzure AD\u306eTenant ID\nAZURE_SUBSCRIPTION_ID\uff1aSubscription ID\nARM_STORAGE_ACCOUNT_NAME\uff1aState\u30d5\u30a1\u30a4\u30eb\u306eStorage Account\nARM_CONTAINER_NAME\uff1aState\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30f3\u30c6\u30ca\nARM_KEY\uff1aState\u30d5\u30a1\u30a4\u30eb\u540d\nARM_RESOURCE_GROUP_NAME\uff1aState\u30d5\u30a1\u30a4\u30eb\u306eResource Group\n</code></pre>"},{"location":"12_GitHub_Actions/#_2","title":"\u8a2d\u5b9a\u5834\u6240","text":"<pre><code>GitHub \u2192 Settings \u2192 Secrets and variables \u2192 Actions\n  \u2193\n- Repository secrets\uff08\u30ea\u30dd\u30b8\u30c8\u30ea\u5168\u4f53\uff09\n- Environment secrets\uff08\u74b0\u5883\u3054\u3068\uff09\n</code></pre> <p>\u4f7f\u3044\u5206\u3051\uff1a <pre><code>Repository secrets\uff1a\n- Tenant ID\n- Storage Account\u60c5\u5831\n\u2192 \u74b0\u5883\u554f\u308f\u305a\u5171\u901a\n\nEnvironment secrets\uff1a\n- Client ID\uff08\u672c\u756a\u7528\u3001\u958b\u767a\u7528\uff09\n- Subscription ID\uff08\u672c\u756a\u7528\u3001\u958b\u767a\u7528\uff09\n\u2192 \u74b0\u5883\u3054\u3068\u306b\u9055\u3046\n</code></pre></p>"},{"location":"12_GitHub_Actions/#part-6-oidcazure","title":"Part 6: OIDC\u8a2d\u5b9a\uff08Azure\u5074\uff09","text":""},{"location":"12_GitHub_Actions/#1-azure-ad","title":"1. Azure AD\u30a2\u30d7\u30ea\u4f5c\u6210","text":"<pre><code>az ad app create --display-name \"GitHub Actions OIDC\"\n</code></pre>"},{"location":"12_GitHub_Actions/#2-service-principal","title":"2. Service Principal\u4f5c\u6210","text":"<pre><code>APP_ID=\"...\"  # \u2191\u3067\u53d6\u5f97\u3057\u305fApp ID\n\naz ad sp create --id $APP_ID\n</code></pre>"},{"location":"12_GitHub_Actions/#3-federated-credential","title":"3. Federated Credential\u8a2d\u5b9a","text":"<pre><code>az ad app federated-credential create \\\n  --id $APP_ID \\\n  --parameters @federated-credential.json\n</code></pre> <p>federated-credential.json\uff1a <pre><code>{\n  \"name\": \"github-actions-oidc\",\n  \"issuer\": \"https://token.actions.githubusercontent.com\",\n  \"subject\": \"repo:shuhei0720org01/alz-mgmt:ref:refs/heads/main\",\n  \"audiences\": [\n    \"api://AzureADTokenExchange\"\n  ]\n}\n</code></pre></p> <p>subject\uff1a <pre><code>repo:&lt;owner&gt;/&lt;repo&gt;:ref:refs/heads/&lt;branch&gt;\n  \u2193\n\u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u3053\u306e\u30d6\u30e9\u30f3\u30c1\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3060\u3051\u8a31\u53ef\n</code></pre></p>"},{"location":"12_GitHub_Actions/#4_1","title":"4. \u6a29\u9650\u4ed8\u4e0e","text":"<pre><code>SUBSCRIPTION_ID=\"...\"\n\naz role assignment create \\\n  --assignee $APP_ID \\\n  --role \"Owner\" \\\n  --scope \"/subscriptions/$SUBSCRIPTION_ID\"\n</code></pre> <p>Owner\uff1a\u5f37\u529b</p> <p>\u672c\u756a\u3067\u306f\uff1a <pre><code>- Contributor\u306b\u3059\u308b\n- \u30ab\u30b9\u30bf\u30e0\u30ed\u30fc\u30eb\u3067\u6700\u5c0f\u6a29\u9650\n</code></pre></p>"},{"location":"12_GitHub_Actions/#_3","title":"\u5b9f\u8df5\uff1a\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3092\u52d5\u304b\u3057\u3066\u307f\u3088\u3046","text":""},{"location":"12_GitHub_Actions/#1_1","title":"1. \u30d6\u30e9\u30f3\u30c1\u4f5c\u6210","text":"<pre><code>git checkout -b feature/add-resource-group\n</code></pre>"},{"location":"12_GitHub_Actions/#2_1","title":"2. \u30b3\u30fc\u30c9\u5909\u66f4","text":"<pre><code># main.tf\nresource \"azurerm_resource_group\" \"test\" {\n  name     = \"rg-test\"\n  location = \"japaneast\"\n}\n</code></pre>"},{"location":"12_GitHub_Actions/#3-commit-push","title":"3. Commit &amp; Push","text":"<pre><code>git add main.tf\ngit commit -m \"Add test resource group\"\ngit push origin feature/add-resource-group\n</code></pre>"},{"location":"12_GitHub_Actions/#4-pr","title":"4. PR\u4f5c\u6210","text":"<pre><code>GitHub \u2192 Pull requests \u2192 New pull request\n  \u2193\nbase: main \u2190 compare: feature/add-resource-group\n  \u2193\nCreate pull request\n</code></pre>"},{"location":"12_GitHub_Actions/#5-ci","title":"5. CI\u5b9f\u884c\u78ba\u8a8d","text":"<pre><code>PR\u753b\u9762 \u2192 Checks \u30bf\u30d6\n  \u2193\n01 Azure Landing Zones Continuous Integration\n  \u2193\n\u5b9f\u884c\u4e2d...\n  \u2193\n\u5b8c\u4e86\n</code></pre> <p>\u7d50\u679c\uff1a <pre><code>\u2713 Checkout\n\u2713 Setup Terraform\n\u2713 Azure Login\n\u2713 Terraform Init\n\u2713 Terraform Validate\n\u2713 Terraform Plan\n\u2713 Comment PR\n</code></pre></p> <p>PR\u753b\u9762\u306b\u30b3\u30e1\u30f3\u30c8\uff1a <pre><code>## Terraform Plan\n...\nPlan: 1 to add, 0 to change, 0 to destroy.\n</code></pre></p>"},{"location":"12_GitHub_Actions/#6","title":"6. \u30ec\u30d3\u30e5\u30fc &amp; \u627f\u8a8d","text":"<pre><code>PR\u753b\u9762 \u2192 Files changed\n  \u2193\n\u5909\u66f4\u5185\u5bb9\u78ba\u8a8d\n  \u2193\nReview changes \u2192 Approve\n</code></pre>"},{"location":"12_GitHub_Actions/#7","title":"7. \u30de\u30fc\u30b8","text":"<pre><code>PR\u753b\u9762 \u2192 Merge pull request\n  \u2193\nConfirm merge\n</code></pre>"},{"location":"12_GitHub_Actions/#8-cd","title":"8. CD\u5b9f\u884c\u78ba\u8a8d","text":"<pre><code>Actions \u30bf\u30d6\n  \u2193\n02 Azure Landing Zones Continuous Delivery\n  \u2193\n\u5b9f\u884c\u4e2d...\n  \u2193\nEnvironment\u627f\u8a8d\u5f85\u3061\uff08\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\uff09\n  \u2193\n\u627f\u8a8d\n  \u2193\n\u5b8c\u4e86\n</code></pre>"},{"location":"12_GitHub_Actions/#9-azure","title":"9. Azure\u78ba\u8a8d","text":"<pre><code>az group show --name rg-test\n</code></pre> <p>\u4f5c\u3089\u308c\u3066\u308b\uff01</p>"},{"location":"12_GitHub_Actions/#_4","title":"\u30c7\u30d0\u30c3\u30b0\u6280","text":""},{"location":"12_GitHub_Actions/#_5","title":"\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u5b9f\u884c\u30ed\u30b0","text":"<pre><code>Actions \u30bf\u30d6 \u2192 \u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u9078\u629e \u2192 \u5b9f\u884c\u9078\u629e\n  \u2193\n\u5404\u30b9\u30c6\u30c3\u30d7\u306e\u30ed\u30b0\u304c\u898b\u3048\u308b\n</code></pre> <p>\u30a8\u30e9\u30fc\u6642\uff1a <pre><code>\u2713 Checkout\n\u2713 Setup Terraform\n\u2713 Azure Login\n\u2717 Terraform Init  \u2190\u3053\u3053\u3067\u5931\u6557\n</code></pre></p> <p>\u30ed\u30b0\u5c55\u958b\uff1a <pre><code>Error: Failed to get existing workspaces: storage account not found\n</code></pre></p> <p>\u539f\u56e0\uff1aStorage Account\u306e\u8a2d\u5b9a\u9593\u9055\u3044</p>"},{"location":"12_GitHub_Actions/#terraform-debug","title":"Terraform Debug","text":"<pre><code>- name: Terraform Plan\n  run: terraform plan -out=tfplan\n  env:\n    TF_LOG: DEBUG  # \u2190\u30c7\u30d0\u30c3\u30b0\u30ed\u30b0\u6709\u52b9\u5316\n</code></pre> <p>\u8a73\u7d30\u30ed\u30b0\uff1a <pre><code>\u5168API\u30ea\u30af\u30a8\u30b9\u30c8\u30fb\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u898b\u3048\u308b\n  \u2193\n\u554f\u984c\u306e\u7279\u5b9a\u304c\u697d\n</code></pre></p>"},{"location":"12_GitHub_Actions/#re-run-jobs","title":"Re-run Jobs","text":"<pre><code>Actions \u2192 \u5931\u6557\u3057\u305f\u30ef\u30fc\u30af\u30d5\u30ed\u30fc \u2192 Re-run jobs\n  \u2193\n\u3082\u3046\u4e00\u5ea6\u5b9f\u884c\n</code></pre> <p>\u4e00\u6642\u7684\u306a\u30a8\u30e9\u30fc\uff08\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7b49\uff09\u306f\u518d\u5b9f\u884c\u3067\u76f4\u308b\u3053\u3068\u3042\u308b\u3002</p>"},{"location":"12_GitHub_Actions/#_6","title":"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc","text":""},{"location":"12_GitHub_Actions/#1-oidc","title":"\u30a8\u30e9\u30fc1: OIDC\u8a8d\u8a3c\u5931\u6557","text":"<pre><code>Error: Unable to get ACTIONS_ID_TOKEN_REQUEST_URL env variable\n</code></pre> <p>\u539f\u56e0\uff1a <pre><code>permissions:\n  id-token: write  # \u2190\u3053\u308c\u304c\u306a\u3044\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1apermissions\u8ffd\u52a0</p>"},{"location":"12_GitHub_Actions/#2-backend","title":"\u30a8\u30e9\u30fc2: Backend\u8a2d\u5b9a\u30a8\u30e9\u30fc","text":"<pre><code>Error: Failed to get existing workspaces\n</code></pre> <p>\u539f\u56e0\uff1a\u74b0\u5883\u5909\u6570\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u306a\u3044</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>GitHub Secrets\u78ba\u8a8d\uff1a\n- ARM_STORAGE_ACCOUNT_NAME\n- ARM_CONTAINER_NAME\n- ARM_KEY\n- ARM_RESOURCE_GROUP_NAME\n</code></pre></p>"},{"location":"12_GitHub_Actions/#3-terraform-lock","title":"\u30a8\u30e9\u30fc3: Terraform Lock","text":"<pre><code>Error: Error acquiring the state lock\n</code></pre> <p>\u539f\u56e0\uff1a <pre><code>\u524d\u56de\u306e\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u304c\u5931\u6557\n  \u2193\nLock\u304c\u6b8b\u3063\u3066\u308b\n  \u2193\n\u6b21\u306e\u5b9f\u884c\u304c\u30d6\u30ed\u30c3\u30af\u3055\u308c\u308b\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># Azure Portal \u2192 Storage Account \u2192 tfstate \u30b3\u30f3\u30c6\u30ca \u2192 .terraform.lock.info\n# \u524a\u9664\n\n# \u307e\u305f\u306f\nterraform force-unlock &lt;LOCK_ID&gt;\n</code></pre></p>"},{"location":"12_GitHub_Actions/#4_2","title":"\u30a8\u30e9\u30fc4: \u6a29\u9650\u4e0d\u8db3","text":"<pre><code>Error: insufficient privileges to complete the operation\n</code></pre> <p>\u539f\u56e0\uff1aService Principal\u306e\u6a29\u9650\u304c\u8db3\u308a\u306a\u3044</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># \u6a29\u9650\u78ba\u8a8d\naz role assignment list --assignee &lt;CLIENT_ID&gt;\n\n# \u6a29\u9650\u8ffd\u52a0\naz role assignment create \\\n  --assignee &lt;CLIENT_ID&gt; \\\n  --role \"Contributor\" \\\n  --scope \"/subscriptions/&lt;SUBSCRIPTION_ID&gt;\"\n</code></pre></p>"},{"location":"12_GitHub_Actions/#_7","title":"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"12_GitHub_Actions/#1-branch-protection","title":"1. Branch Protection","text":"<pre><code>GitHub \u2192 Settings \u2192 Branches \u2192 Branch protection rules\n  \u2193\nmain \u30d6\u30e9\u30f3\u30c1\u306b\u8a2d\u5b9a\uff1a\n- Require pull request reviews before merging\n- Require status checks to pass before merging\n  - CI\uff08terraform plan\uff09\n- Require branches to be up to date before merging\n</code></pre> <p>\u52b9\u679c\uff1a <pre><code>main\u306b\u76f4\u63a5push\u3067\u304d\u306a\u3044\n  \u2193\n\u5fc5\u305aPR\u7d4c\u7531\n  \u2193\nCI\u901a\u904e\u3057\u306a\u3044\u3068\u30de\u30fc\u30b8\u3067\u304d\u306a\u3044\n</code></pre></p>"},{"location":"12_GitHub_Actions/#2-environment-protection","title":"2. Environment Protection","text":"<pre><code>GitHub \u2192 Settings \u2192 Environments \u2192 production\n  \u2193\n- Required reviewers\uff08\u627f\u8a8d\u8005\uff09\n- Wait timer\uff08\u5f85\u6a5f\u6642\u9593\uff09\n</code></pre> <p>\u52b9\u679c\uff1a <pre><code>main\u306b\u30de\u30fc\u30b8\n  \u2193\n\u81ea\u52d5\u3067\u5373apply\u3055\u308c\u306a\u3044\n  \u2193\n\u627f\u8a8d\u8005\u304c\u627f\u8a8d\n  \u2193\napply\u5b9f\u884c\n</code></pre></p>"},{"location":"12_GitHub_Actions/#3-concurrency","title":"3. Concurrency\u5236\u5fa1","text":"<pre><code>concurrency:\n  group: terraform-${{ github.ref }}\n  cancel-in-progress: false\n</code></pre> <p>\u4f55\uff1f\uff1a\u540c\u6642\u5b9f\u884c\u306e\u5236\u5fa1</p> <pre><code>2\u3064\u306ePR\u304c\u540c\u6642\u306b\u30de\u30fc\u30b8\n  \u2193\n2\u3064\u306eCD\u304c\u540c\u6642\u5b9f\u884c\n  \u2193\nState Lock\u7af6\u5408\n  \u2193\n\u30a8\u30e9\u30fc\n\nconcurrency\u8a2d\u5b9a\uff1a\n1\u3064\u76ee\u306eCD\u304c\u5b9f\u884c\u4e2d\n  \u2193\n2\u3064\u76ee\u306eCD\u306f\u5f85\u6a5f\n  \u2193\n1\u3064\u76ee\u304c\u5b8c\u4e86\n  \u2193\n2\u3064\u76ee\u304c\u5b9f\u884c\n</code></pre>"},{"location":"12_GitHub_Actions/#4-terraform-version","title":"4. Terraform Version\u56fa\u5b9a","text":"<pre><code>terraform_cli_version: '1.12.0'  # \u2190\u30d0\u30fc\u30b8\u30e7\u30f3\u56fa\u5b9a\n</code></pre> <p>\u306a\u305c\uff1f <pre><code>'latest'\u3060\u3068\uff1a\n- \u7a81\u7136\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u4f7f\u308f\u308c\u308b\n- \u4e92\u63db\u6027\u554f\u984c\u3067\u30a8\u30e9\u30fc\n\n\u56fa\u5b9a\u3059\u308b\u3068\uff1a\n- \u5b89\u5b9a\n- \u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u306f\u8a08\u753b\u7684\u306b\n</code></pre></p>"},{"location":"12_GitHub_Actions/#_8","title":"\u307e\u3068\u3081","text":"<p>GitHub Actions \u306e\u6d41\u308c\uff1a <pre><code>1. \u30d6\u30e9\u30f3\u30c1\u4f5c\u6210\u30fb\u30b3\u30fc\u30c9\u5909\u66f4\n2. PR\u4f5c\u6210\n3. CI\u5b9f\u884c\uff08terraform plan\uff09\n4. PR\u4e0a\u3067\u78ba\u8a8d\n5. \u30ec\u30d3\u30e5\u30fc\u30fb\u627f\u8a8d\n6. \u30de\u30fc\u30b8\n7. CD\u5b9f\u884c\uff08terraform apply\uff09\n8. Environment\u627f\u8a8d\uff08\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\uff09\n9. Azure\u306b\u53cd\u6620\n</code></pre></p> <p>\u30e1\u30ea\u30c3\u30c8\uff1a - \u81ea\u52d5\u5316\uff08\u30d2\u30e5\u30fc\u30de\u30f3\u30a8\u30e9\u30fc\u524a\u6e1b\uff09 - \u5c65\u6b74\u304c\u6b8b\u308b - \u627f\u8a8d\u30d5\u30ed\u30fc - \u4e26\u884c\u5b9f\u884c\u9632\u6b62</p> <p>\u91cd\u8981\u306a\u8a2d\u5b9a\uff1a - OIDC\uff1a\u30d1\u30b9\u30ef\u30fc\u30c9\u30ec\u30b9\u8a8d\u8a3c - Secrets\uff1a\u6a5f\u5bc6\u60c5\u5831\u306e\u7ba1\u7406 - Environment\uff1a\u627f\u8a8d\u30d5\u30ed\u30fc - Branch Protection\uff1amain\u30d6\u30e9\u30f3\u30c1\u4fdd\u8b77</p> <p>\u6b21\u306eChapter\u3067\u306f\u3001\u5b9f\u969b\u306e\u30c7\u30d7\u30ed\u30a4\u624b\u9806\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u30bc\u30ed\u304b\u3089\u74b0\u5883\u3092\u4f5c\u308b\u6642\u306e\u30b9\u30c6\u30c3\u30d7\u30d0\u30a4\u30b9\u30c6\u30c3\u30d7\u30ac\u30a4\u30c9\u3002</p> <p>\u6240\u8981\u6642\u9593: 60\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2606 \u524d: 11_Virtual_WAN.md \u6b21: 13_\u30c7\u30d7\u30ed\u30a4\u624b\u9806.md</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/","title":"13. \u30c7\u30d7\u30ed\u30a4\u624b\u9806 - \u30bc\u30ed\u304b\u3089\u74b0\u5883\u3092\u4f5c\u308b","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>Azure Landing Zones\u3092\u5b9f\u969b\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u3088\u3046\u3002</p> <p>\u30bc\u30ed\u304b\u3089\u30b9\u30bf\u30fc\u30c8\uff1a <pre><code>\u4f55\u3082\u306a\u3044\u72b6\u614b\n  \u2193\nAzure\u6e96\u5099\n  \u2193\nGitHub\u6e96\u5099\n  \u2193\n\u30c7\u30d7\u30ed\u30a4\n  \u2193\n\u5b8c\u6210\n</code></pre></p> <p>\u6240\u8981\u6642\u9593\uff1a\u7d042\u301c3\u6642\u9593</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#_1","title":"\u524d\u63d0\u6761\u4ef6","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#_2","title":"\u5fc5\u8981\u306a\u3082\u306e","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#1-azure","title":"1. Azure\u30a2\u30ab\u30a6\u30f3\u30c8","text":"<pre><code>- Azure Subscription\uff08Owner\u6a29\u9650\uff09\n- Azure AD\u30c6\u30ca\u30f3\u30c8\n</code></pre> <p>\u78ba\u8a8d\uff1a <pre><code>az login\naz account show\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#2","title":"2. \u30c4\u30fc\u30eb","text":"<pre><code>- Azure CLI\uff1a\u6700\u65b0\u7248\n- Terraform\uff1av1.12\u4ee5\u4e0a\n- Git\uff1a\u6700\u65b0\u7248\n- \u30a8\u30c7\u30a3\u30bf\uff1aVS Code\u63a8\u5968\n</code></pre> <p>\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d\uff1a <pre><code>az --version\nterraform --version\ngit --version\ncode --version\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#3-github","title":"3. GitHub\u30a2\u30ab\u30a6\u30f3\u30c8","text":"<pre><code>- GitHub\u30a2\u30ab\u30a6\u30f3\u30c8\n- \u30ea\u30dd\u30b8\u30c8\u30ea\u4f5c\u6210\u6a29\u9650\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#phase-1-azure","title":"Phase 1: Azure\u6e96\u5099","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-1-1-subscription","title":"Step 1-1: Subscription\u306e\u78ba\u8a8d","text":"<pre><code># \u30ed\u30b0\u30a4\u30f3\naz login\n\n# Subscription\u4e00\u89a7\naz account list --output table\n\n# \u4f7f\u3046Subscription\u3092\u9078\u629e\naz account set --subscription \"&lt;SUBSCRIPTION_ID&gt;\"\n\n# \u78ba\u8a8d\naz account show\n</code></pre> <p>\u91cd\u8981\uff1a <pre><code>\u3053\u306eSubscription\u306b\u5bfe\u3057\u3066Owner\u6a29\u9650\u304c\u5fc5\u8981\n  \u2193\nManagement Group\u4f5c\u6210\n\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\nRBAC\u30ed\u30fc\u30eb\u4ed8\u4e0e\n  \u2193\n\u5168\u90e8\u3084\u308b\u304b\u3089\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-1-2-service-principaloidc","title":"Step 1-2: Service Principal\u4f5c\u6210\uff08OIDC\u7528\uff09","text":"<p>\ud83d\udd10 OIDC\u8a8d\u8a3c\u3068\u306f\uff1f\uff08\u521d\u5fc3\u8005\u5411\u3051\u8aac\u660e\uff09</p> <p>\u5f93\u6765\u306e\u65b9\u6cd5\uff08\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\uff09: <pre><code>GitHub \u2192 Azure\n\u300c\u30d1\u30b9\u30ef\u30fc\u30c9\u306f \"abc123\" \u3067\u3059\u300d\n</code></pre></p> <p>\u554f\u984c\u70b9: - \u274c \u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u6f0f\u308c\u305f\u3089\u5371\u967a - \u274c \u5b9a\u671f\u7684\u306a\u66f4\u65b0\u304c\u5fc5\u8981 - \u274c GitHub\u306b\u4fdd\u5b58\u3059\u308b\u306e\u304c\u4e0d\u5b89</p> <p>\u65b0\u3057\u3044\u65b9\u6cd5\uff08OIDC\u8a8d\u8a3c\uff09: <pre><code>GitHub \u2192 Azure\n\u300c\u79c1\u306fGitHub\u306e\u516c\u5f0f\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u3059\u3088\uff08\u8a3c\u660e\u66f8\u63d0\u793a\uff09\u300d\nAzure \u2192 GitHub\n\u300c\u672c\u5f53\u3060\u3002\u3058\u3083\u3042\u4fe1\u3058\u308b\u300d\n</code></pre></p> <p>\u30e1\u30ea\u30c3\u30c8: - \u2705 \u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\uff08\u8a3c\u660e\u66f8\u30d9\u30fc\u30b9\uff09 - \u2705 \u81ea\u52d5\u66f4\u65b0 - \u2705 \u6f0f\u6d29\u30ea\u30b9\u30af\u304c\u4f4e\u3044</p> <p>Federated Credential\uff08\u30d5\u30a7\u30c7\u30ec\u30fc\u30c6\u30c3\u30c9\u8cc7\u683c\u60c5\u5831\uff09\u3068\u306f\uff1f: \u300c\u3053\u306eGitHub\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4fe1\u983c\u3059\u308b\u300d\u3068\u3044\u3046\u8a2d\u5b9a\u3002 \u7279\u5b9a\u306eGitHub\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3060\u3051\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002</p> <pre><code>Federated Credential = \u300c\u4fe1\u983c\u3059\u308b\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30ea\u30b9\u30c8\u300d\n</code></pre> <p>\u5177\u4f53\u4f8b: <pre><code>repo:shuhei0720org01/alz-mgmt:ref:refs/heads/main\n \u2191         \u2191             \u2191          \u2191\n |         |             |          main\u30d6\u30e9\u30f3\u30c1\n |         |             \u30ea\u30dd\u30b8\u30c8\u30ea\n |         \u30aa\u30fc\u30ca\u30fc\n \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0(GitHub)\n</code></pre></p> <p>\u3053\u308c\u3067\u3001<code>shuhei0720org01/alz-mgmt</code> \u306e <code>main</code> \u30d6\u30e9\u30f3\u30c1\u304b\u3089\u3060\u3051\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u3067\u306f\u3001\u5b9f\u969b\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046:</p> <pre><code># \u5909\u6570\u8a2d\u5b9a\nAPP_NAME=\"github-actions-alz-mgmt\"\nREPO_OWNER=\"your-github-username\"\nREPO_NAME=\"alz-mgmt\"\nSUBSCRIPTION_ID=$(az account show --query id -o tsv)\n\n# Azure AD\u30a2\u30d7\u30ea\u4f5c\u6210\naz ad app create --display-name \"$APP_NAME\"\n\n# App ID\u3092\u53d6\u5f97\nAPP_ID=$(az ad app list --display-name \"$APP_NAME\" --query \"[0].appId\" -o tsv)\necho \"APP_ID: $APP_ID\"\n\n# Service Principal\u4f5c\u6210\naz ad sp create --id $APP_ID\n\n# Owner\u6a29\u9650\u4ed8\u4e0e\uff08Subscription\u5168\u4f53\uff09\naz role assignment create \\\n  --assignee $APP_ID \\\n  --role \"Owner\" \\\n  --scope \"/subscriptions/$SUBSCRIPTION_ID\"\n\n# Federated Credential\u4f5c\u6210\uff08main\u30d6\u30e9\u30f3\u30c1\u7528\uff09\naz ad app federated-credential create \\\n  --id $APP_ID \\\n  --parameters \"{\n    \\\"name\\\": \\\"github-actions-main\\\",\n    \\\"issuer\\\": \\\"https://token.actions.githubusercontent.com\\\",\n    \\\"subject\\\": \\\"repo:${REPO_OWNER}/${REPO_NAME}:ref:refs/heads/main\\\",\n    \\\"audiences\\\": [\\\"api://AzureADTokenExchange\\\"]\n  }\"\n\n# Federated Credential\u4f5c\u6210\uff08PR\u7528\uff09\naz ad app federated-credential create \\\n  --id $APP_ID \\\n  --parameters \"{\n    \\\"name\\\": \\\"github-actions-pr\\\",\n    \\\"issuer\\\": \\\"https://token.actions.githubusercontent.com\\\",\n    \\\"subject\\\": \\\"repo:${REPO_OWNER}/${REPO_NAME}:pull_request\\\",\n    \\\"audiences\\\": [\\\"api://AzureADTokenExchange\\\"]\n  }\"\n</code></pre> <p>\u4fdd\u5b58\u3057\u3066\u304a\u304f\u5024\uff1a <pre><code>echo \"AZURE_CLIENT_ID: $APP_ID\"\necho \"AZURE_TENANT_ID: $(az account show --query tenantId -o tsv)\"\necho \"AZURE_SUBSCRIPTION_ID: $SUBSCRIPTION_ID\"\n</code></pre></p> <p>\u30e1\u30e2\u3063\u3066\u304a\u3053\u3046\uff01 \u3042\u3068\u3067\u4f7f\u3046\u3002</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-1-3-storage-accountterraform-state","title":"Step 1-3: Storage Account\u4f5c\u6210\uff08Terraform State\u7528\uff09","text":"<pre><code># \u5909\u6570\u8a2d\u5b9a\nLOCATION=\"japaneast\"\nRG_NAME=\"rg-terraform-state\"\nSTORAGE_ACCOUNT_NAME=\"stterraform$(openssl rand -hex 4)\"  # \u30e9\u30f3\u30c0\u30e0\u306a\u540d\u524d\nCONTAINER_NAME=\"tfstate\"\n\n# Resource Group\u4f5c\u6210\naz group create \\\n  --name $RG_NAME \\\n  --location $LOCATION\n\n# Storage Account\u4f5c\u6210\naz storage account create \\\n  --name $STORAGE_ACCOUNT_NAME \\\n  --resource-group $RG_NAME \\\n  --location $LOCATION \\\n  --sku Standard_LRS \\\n  --kind StorageV2 \\\n  --allow-blob-public-access false \\\n  --min-tls-version TLS1_2\n\n# \u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\naz storage container create \\\n  --name $CONTAINER_NAME \\\n  --account-name $STORAGE_ACCOUNT_NAME \\\n  --auth-mode login\n\n# Service Principal\u306b\u6a29\u9650\u4ed8\u4e0e\nSTORAGE_ACCOUNT_ID=$(az storage account show \\\n  --name $STORAGE_ACCOUNT_NAME \\\n  --resource-group $RG_NAME \\\n  --query id -o tsv)\n\naz role assignment create \\\n  --assignee $APP_ID \\\n  --role \"Storage Blob Data Contributor\" \\\n  --scope $STORAGE_ACCOUNT_ID\n</code></pre> <p>\u4fdd\u5b58\u3057\u3066\u304a\u304f\u5024\uff1a <pre><code>echo \"ARM_STORAGE_ACCOUNT_NAME: $STORAGE_ACCOUNT_NAME\"\necho \"ARM_CONTAINER_NAME: $CONTAINER_NAME\"\necho \"ARM_KEY: alz-mgmt.tfstate\"\necho \"ARM_RESOURCE_GROUP_NAME: $RG_NAME\"\n</code></pre></p> <p>\u3053\u308c\u3082\u30e1\u30e2\u3063\u3066\u304a\u3053\u3046\uff01</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#phase-2-github","title":"Phase 2: GitHub\u6e96\u5099","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-2-1","title":"Step 2-1: \u30ea\u30dd\u30b8\u30c8\u30ea\u4f5c\u6210","text":"<pre><code># \u30ed\u30fc\u30ab\u30eb\u306bclone\u6e08\u307f\u306e\u524d\u63d0\ncd ~/projects\ngit clone https://github.com/$REPO_OWNER/$REPO_NAME.git\ncd $REPO_NAME\n\n# \u307e\u305f\u306f\u65b0\u898f\u4f5c\u6210\nmkdir alz-mgmt\ncd alz-mgmt\ngit init\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-2-2","title":"Step 2-2: \u30b3\u30fc\u30c9\u3092\u30b3\u30d4\u30fc","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5168\u90e8\u30b3\u30d4\u30fc\uff1a</p> <pre><code># \u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\n\u251c\u2500\u2500 .github/\n\u2502   \u2514\u2500\u2500 workflows/\n\u2502       \u251c\u2500\u2500 ci.yaml\n\u2502       \u2514\u2500\u2500 cd.yaml\n\u251c\u2500\u2500 lib/\n\u2502   \u251c\u2500\u2500 archetype_definitions/\n\u2502   \u2514\u2500\u2500 architecture_definitions/\n\u251c\u2500\u2500 modules/\n\u2502   \u251c\u2500\u2500 config-templating/\n\u2502   \u251c\u2500\u2500 management_groups/\n\u2502   \u2514\u2500\u2500 management_resources/\n\u251c\u2500\u2500 locals.tf\n\u251c\u2500\u2500 main.*.tf\n\u251c\u2500\u2500 outputs.tf\n\u251c\u2500\u2500 platform-landing-zone.auto.tfvars\n\u251c\u2500\u2500 terraform.tf\n\u251c\u2500\u2500 terraform.tfvars.json\n\u2514\u2500\u2500 variables.*.tf\n</code></pre> <p>\u6ce8\u610f\uff1a <pre><code>.gitignore \u3092\u4f5c\u308b\uff1a\n</code></pre> <pre><code># Terraform\n.terraform/\n*.tfstate\n*.tfstate.*\n*.tfvars\n!platform-landing-zone.auto.tfvars\nterraform.tfvars.json\n.terraform.lock.hcl\n\n# IDE\n.vscode/\n.idea/\n\n# OS\n.DS_Store\nThumbs.db\n</code></pre> <pre><code>### Step 2-3: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\n\n**platform-landing-zone.auto.tfvars** \u3092\u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u7de8\u96c6\uff1a\n\n```hcl\n# \u6700\u5c0f\u9650\u306e\u8a2d\u5b9a\u4f8b\nstarter_location_01 = \"japaneast\"\nstarter_location_02 = \"japanwest\"\n\nroot_id                     = \"myorg\"\nroot_name                   = \"My Organization\"\ndefault_location            = \"japaneast\"\ndefault_postfix             = \"001\"\nsubscription_id_management  = \"&lt;YOUR_MANAGEMENT_SUBSCRIPTION_ID&gt;\"\nsubscription_id_identity    = \"&lt;YOUR_IDENTITY_SUBSCRIPTION_ID&gt;\"\nsubscription_id_connectivity = \"&lt;YOUR_CONNECTIVITY_SUBSCRIPTION_ID&gt;\"\n\n# \u6700\u5c0f\u69cb\u6210\uff08\u30b3\u30b9\u30c8\u524a\u6e1b\uff09\nconnectivity_type = \"hub_and_spoke_vnet\"\n\nhub_and_spoke_networks_settings = {\n  enabled_resources = {\n    ddos_protection_plan = false  # \u2190\u7121\u52b9\u5316\n  }\n}\n\nhub_virtual_networks = {\n  primary = {\n    location = \"japaneast\"\n\n    enabled_resources = {\n      firewall                              = false  # \u2190\u7121\u52b9\u5316\n      bastion                               = false  # \u2190\u7121\u52b9\u5316\n      virtual_network_gateway_express_route = false\n      virtual_network_gateway_vpn           = false  # \u2190\u7121\u52b9\u5316\n      private_dns_zones                     = true\n      private_dns_resolver                  = false\n    }\n\n    hub_virtual_network = {\n      name          = \"vnet-myorg-jpe-hub\"\n      address_space = [\"10.0.0.0/16\"]\n    }\n  }\n}\n</code></pre></p> <p>Subscription ID\u78ba\u8a8d\uff1a <pre><code>az account list --output table\n</code></pre></p> <p>3\u3064\u306eSubscription\u304c\u5fc5\u8981\uff08\u540c\u3058\u3067\u3082OK\uff09\uff1a - Management\uff1a\u7ba1\u7406\u7528 - Identity\uff1aID\u7ba1\u7406\u7528\uff08AD DS\u7b49\uff09 - Connectivity\uff1a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7528</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-2-4-commit-push","title":"Step 2-4: Commit &amp; Push","text":"<pre><code>git add .\ngit commit -m \"Initial commit\"\ngit push origin main\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-2-5-github-secrets","title":"Step 2-5: GitHub Secrets\u8a2d\u5b9a","text":"<pre><code>GitHub \u2192 Settings \u2192 Secrets and variables \u2192 Actions \u2192 New repository secret\n</code></pre> <p>\u8a2d\u5b9a\u3059\u308bSecrets\uff1a</p> <pre><code>AZURE_CLIENT_ID: &lt;Step 1-2\u3067\u4fdd\u5b58\u3057\u305f\u5024&gt;\nAZURE_TENANT_ID: &lt;Step 1-2\u3067\u4fdd\u5b58\u3057\u305f\u5024&gt;\nAZURE_SUBSCRIPTION_ID: &lt;Step 1-2\u3067\u4fdd\u5b58\u3057\u305f\u5024&gt;\nARM_STORAGE_ACCOUNT_NAME: &lt;Step 1-3\u3067\u4fdd\u5b58\u3057\u305f\u5024&gt;\nARM_CONTAINER_NAME: tfstate\nARM_KEY: alz-mgmt.tfstate\nARM_RESOURCE_GROUP_NAME: rg-terraform-state\n</code></pre> <p>\u78ba\u8a8d\uff1a <pre><code>GitHub \u2192 Settings \u2192 Secrets and variables \u2192 Actions\n  \u2193\n7\u500b\u306eSecrets\u304c\u8868\u793a\u3055\u308c\u3066\u308b\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-2-6-environment","title":"Step 2-6: Environment\u8a2d\u5b9a\uff08\u63a8\u5968\uff09","text":"<pre><code>GitHub \u2192 Settings \u2192 Environments \u2192 New environment\n  \u2193\nName: production\n  \u2193\nConfigure environment\n</code></pre> <p>\u8a2d\u5b9a\uff1a <pre><code>Environment protection rules:\n- Required reviewers: \u81ea\u5206\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u8ffd\u52a0\n- Wait timer: 0 minutes\uff08\u3059\u3050\u627f\u8a8d\uff09\n</code></pre></p> <p>\u52b9\u679c\uff1a <pre><code>main\u306b\u30de\u30fc\u30b8\n  \u2193\n\u81ea\u52d5\u3067apply\u3055\u308c\u306a\u3044\n  \u2193\n\u627f\u8a8d\u5f85\u3061\n  \u2193\n\u627f\u8a8d\n  \u2193\napply\u5b9f\u884c\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#phase-3","title":"Phase 3: \u30ed\u30fc\u30ab\u30eb\u3067\u306e\u521d\u56de\u30c7\u30d7\u30ed\u30a4","text":"<p>\u306a\u305c\u30ed\u30fc\u30ab\u30eb\u3067\uff1f <pre><code>GitHub Actions\u3067\u3044\u304d\u306a\u308a\u3084\u308b\u3068\uff1a\n- \u30a8\u30e9\u30fc\u6642\u306e\u30c7\u30d0\u30c3\u30b0\u304c\u5927\u5909\n- \u30ed\u30b0\u898b\u308b\u306e\u304c\u9762\u5012\n\n\u30ed\u30fc\u30ab\u30eb\u3067\uff1a\n- \u3059\u3050\u30a8\u30e9\u30fc\u308f\u304b\u308b\n- \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u8abf\u6574\u3057\u3084\u3059\u3044\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-3-1-terraform","title":"Step 3-1: Terraform\u521d\u671f\u5316","text":"<pre><code># \u74b0\u5883\u5909\u6570\u8a2d\u5b9a\nexport ARM_STORAGE_ACCOUNT_NAME=\"&lt;Step 1-3\u306e\u5024&gt;\"\nexport ARM_CONTAINER_NAME=\"tfstate\"\nexport ARM_KEY=\"alz-mgmt.tfstate\"\nexport ARM_RESOURCE_GROUP_NAME=\"rg-terraform-state\"\n\n# Azure\u30ed\u30b0\u30a4\u30f3\uff08Owner\u6a29\u9650\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\uff09\naz login\n\n# \u4f7f\u3046Subscription\u3092\u9078\u629e\naz account set --subscription \"&lt;SUBSCRIPTION_ID&gt;\"\n\n# Terraform\u521d\u671f\u5316\nterraform init\n\n# Backend\u8a2d\u5b9a\u306e\u78ba\u8a8d\nterraform init \\\n  -backend-config=\"storage_account_name=$ARM_STORAGE_ACCOUNT_NAME\" \\\n  -backend-config=\"container_name=$ARM_CONTAINER_NAME\" \\\n  -backend-config=\"key=$ARM_KEY\" \\\n  -backend-config=\"resource_group_name=$ARM_RESOURCE_GROUP_NAME\"\n</code></pre> <p>\u6210\u529f\u3059\u308b\u3068\uff1a <pre><code>Terraform has been successfully initialized!\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-3-2-terraform-validate","title":"Step 3-2: Terraform Validate","text":"<pre><code>terraform validate\n</code></pre> <p>\u6210\u529f\u3059\u308b\u3068\uff1a <pre><code>Success! The configuration is valid.\n</code></pre></p> <p>\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u3089\uff1a <pre><code>Error: Missing required argument\n  on main.tf line 10:\n  10: resource \"azurerm_resource_group\" \"example\" {\n</code></pre></p> <p>\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u3066\u518d\u5ea6validate\u3002</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-3-3-terraform-plan","title":"Step 3-3: Terraform Plan","text":"<pre><code>terraform plan -out=tfplan\n</code></pre> <p>\u521d\u56de\u306f\u6642\u9593\u304b\u304b\u308b\uff1a5\u301c10\u5206</p> <p>\u51fa\u529b\u4f8b\uff1a <pre><code>Plan: 45 to add, 0 to change, 0 to destroy.\n</code></pre></p> <p>\u78ba\u8a8d\u30dd\u30a4\u30f3\u30c8\uff1a <pre><code>- Management Group\u69cb\u9020\n- Resource Group\n- Log Analytics Workspace\n- VNet\uff08\u7121\u52b9\u5316\u3057\u3066\u308c\u3070\u4f5c\u3089\u308c\u306a\u3044\uff09\n- Policy Assignments\n</code></pre></p> <p>\u554f\u984c\u306a\u3051\u308c\u3070\u6b21\u3078\u3002</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-3-4-terraform-apply","title":"Step 3-4: Terraform Apply","text":"<pre><code>terraform apply tfplan\n</code></pre> <p>\u6240\u8981\u6642\u9593\uff1a20\u301c40\u5206\uff08\u521d\u56de\uff09</p> <p>\u9032\u884c\u72b6\u6cc1\uff1a <pre><code>module.management_groups[0].azurerm_management_group.level_1[\"landing-zones\"]: Creating...\nmodule.management_groups[0].azurerm_management_group.level_1[\"landing-zones\"]: Creation complete after 15s\n...\n</code></pre></p> <p>\u5b8c\u6210\uff01 <pre><code>Apply complete! Resources: 45 added, 0 changed, 0 destroyed.\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-3-5","title":"Step 3-5: \u78ba\u8a8d","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#management-group","title":"Management Group\u78ba\u8a8d","text":"<pre><code># Azure Portal\nhttps://portal.azure.com/#view/Microsoft_Azure_ManagementGroups/ManagementGroupBrowseBlade/~/MGBrowse_overview\n\n# CLI\naz account management-group list --output table\n</code></pre> <p>\u69cb\u9020\uff1a <pre><code>myorg\uff08Root\uff09\n\u251c\u2500\u2500 platform\n\u2502   \u251c\u2500\u2500 management\n\u2502   \u251c\u2500\u2500 identity\n\u2502   \u2514\u2500\u2500 connectivity\n\u251c\u2500\u2500 landing-zones\n\u2502   \u251c\u2500\u2500 corp\n\u2502   \u2514\u2500\u2500 online\n\u2514\u2500\u2500 decommissioned\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#resource-group","title":"Resource Group\u78ba\u8a8d","text":"<pre><code>az group list --output table\n</code></pre> <p>\u4f5c\u3089\u308c\u3066\u308b\u306f\u305a\uff1a <pre><code>rg-myorg-management-001\nrg-myorg-connectivity-001\nrg-myorg-identity-001\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#log-analytics","title":"Log Analytics\u78ba\u8a8d","text":"<pre><code>az monitor log-analytics workspace list --output table\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#phase-4-github-actions","title":"Phase 4: GitHub Actions\u3067\u306e\u30c7\u30d7\u30ed\u30a4","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-4-1","title":"Step 4-1: \u30c6\u30b9\u30c8\u7528\u306e\u5909\u66f4","text":"<pre><code># \u65b0\u3057\u3044\u30d6\u30e9\u30f3\u30c1\ngit checkout -b feature/test-github-actions\n\n# \u30c6\u30b9\u30c8\u7528Resource Group\u8ffd\u52a0\ncat &gt;&gt; test.tf &lt;&lt;EOF\nresource \"azurerm_resource_group\" \"test_github_actions\" {\n  name     = \"rg-test-github-actions\"\n  location = \"japaneast\"\n}\nEOF\n\n# Commit &amp; Push\ngit add test.tf\ngit commit -m \"Test GitHub Actions\"\ngit push origin feature/test-github-actions\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-4-2-pull-request","title":"Step 4-2: Pull Request\u4f5c\u6210","text":"<pre><code>GitHub \u2192 Pull requests \u2192 New pull request\n  \u2193\nbase: main \u2190 compare: feature/test-github-actions\n  \u2193\nCreate pull request\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-4-3-ci","title":"Step 4-3: CI\u78ba\u8a8d","text":"<pre><code>PR\u753b\u9762 \u2192 Checks \u30bf\u30d6\n  \u2193\n01 Azure Landing Zones Continuous Integration\n  \u2193\n\u5b9f\u884c\u4e2d...\n</code></pre> <p>\u30ed\u30b0\u78ba\u8a8d\uff1a <pre><code>Actions \u2192 CI\u5b9f\u884c \u2192 Details\n  \u2193\n\u5404\u30b9\u30c6\u30c3\u30d7\u306e\u9032\u884c\u72b6\u6cc1\n</code></pre></p> <p>\u6210\u529f\u3059\u308b\u3068\uff1a <pre><code>\u2713 Checkout\n\u2713 Setup Terraform\n\u2713 Azure Login\n\u2713 Terraform Init\n\u2713 Terraform Validate\n\u2713 Terraform Plan\n\u2713 Comment PR\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n</code></pre></p> <p>PR\u753b\u9762\u306b\u30b3\u30e1\u30f3\u30c8\uff1a <pre><code>## Terraform Plan\n...\n+ azurerm_resource_group.test_github_actions\n    name     = \"rg-test-github-actions\"\n    location = \"japaneast\"\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-4-4","title":"Step 4-4: \u627f\u8a8d &amp; \u30de\u30fc\u30b8","text":"<pre><code>PR\u753b\u9762 \u2192 Files changed \u2192 Review changes \u2192 Approve\n  \u2193\nMerge pull request\n  \u2193\nConfirm merge\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-4-5-cd","title":"Step 4-5: CD\u78ba\u8a8d","text":"<pre><code>Actions \u2192 02 Azure Landing Zones Continuous Delivery\n  \u2193\n\u5b9f\u884c\u4e2d...\n</code></pre> <p>Environment\u627f\u8a8d\u8a2d\u5b9a\u3057\u3066\u308b\u5834\u5408\uff1a <pre><code>\u5b9f\u884c\u4e2d \u2192 Waiting for approval\n  \u2193\nReview deployments \u2192 Approve\n  \u2193\n\u5b9f\u884c\u518d\u958b\n</code></pre></p> <p>\u5b8c\u4e86\uff1a <pre><code>\u2713 Checkout\n\u2713 Setup Terraform\n\u2713 Azure Login\n\u2713 Terraform Init\n\u2713 Terraform Apply\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-4-6-azure","title":"Step 4-6: Azure\u78ba\u8a8d","text":"<pre><code>az group show --name rg-test-github-actions\n</code></pre> <p>\u4f5c\u3089\u308c\u3066\u308b\uff01</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-4-7","title":"Step 4-7: \u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7","text":"<pre><code># \u30d6\u30e9\u30f3\u30c1\u4f5c\u6210\ngit checkout main\ngit pull\ngit checkout -b feature/cleanup-test\n\n# test.tf\u524a\u9664\ngit rm test.tf\ngit commit -m \"Cleanup test resource group\"\ngit push origin feature/cleanup-test\n\n# PR\u4f5c\u6210 \u2192 CI \u2192 \u627f\u8a8d \u2192 \u30de\u30fc\u30b8 \u2192 CD\n# rg-test-github-actions \u304c\u524a\u9664\u3055\u308c\u308b\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#phase-5","title":"Phase 5: \u672c\u683c\u7684\u306a\u30c7\u30d7\u30ed\u30a4","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-5-1","title":"Step 5-1: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u672c\u756a\u4ed5\u69d8\u306b","text":"<pre><code>git checkout -b feature/enable-production-resources\n</code></pre> <p>platform-landing-zone.auto.tfvars \u7de8\u96c6\uff1a</p> <pre><code># Firewall\u6709\u52b9\u5316\nhub_virtual_networks = {\n  primary = {\n    location = \"japaneast\"\n\n    enabled_resources = {\n      firewall                              = true   # \u2190\u6709\u52b9\u5316\n      bastion                               = true   # \u2190\u6709\u52b9\u5316\n      virtual_network_gateway_express_route = false\n      virtual_network_gateway_vpn           = false  # \u2190\u5fc5\u8981\u306a\u3089\u6709\u52b9\u5316\n      private_dns_zones                     = true\n      private_dns_resolver                  = false\n    }\n\n    hub_virtual_network = {\n      name          = \"vnet-myorg-jpe-hub\"\n      address_space = [\"10.0.0.0/16\"]\n      routing_address_space         = [\"10.0.0.0/22\"]\n      route_table_name_firewall     = \"rt-myorg-jpe-firewall\"\n      route_table_name_user_subnets = \"rt-myorg-jpe-user\"\n    }\n\n    firewall = {\n      subnet_address_prefix            = \"10.0.0.0/26\"\n      management_subnet_address_prefix = \"10.0.0.64/26\"\n      name                             = \"fw-myorg-jpe-hub\"\n\n      default_ip_configuration = {\n        public_ip_config = {\n          name = \"pip-fw-myorg-jpe-hub\"\n        }\n      }\n\n      management_ip_enabled = true\n      management_ip_configuration = {\n        public_ip_config = {\n          name = \"pip-fw-myorg-jpe-hub-mgmt\"\n        }\n      }\n    }\n\n    firewall_policy = {\n      name = \"fwp-myorg-jpe-hub\"\n    }\n\n    bastion = {\n      subnet_address_prefix = \"10.0.2.0/27\"\n      name                  = \"bas-myorg-jpe-hub\"\n\n      public_ip = {\n        name  = \"pip-bas-myorg-jpe-hub\"\n        zones = []  # Japan region\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-5-2-commit-pr","title":"Step 5-2: Commit &amp; PR","text":"<pre><code>git add platform-landing-zone.auto.tfvars\ngit commit -m \"Enable Firewall and Bastion for production\"\ngit push origin feature/enable-production-resources\n\n# PR\u4f5c\u6210\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-5-3-plan","title":"Step 5-3: Plan\u78ba\u8a8d","text":"<pre><code>PR\u753b\u9762 \u2192 Checks \u2192 Details\n  \u2193\nPlan\u7d50\u679c\u78ba\u8a8d\n</code></pre> <p>\u8ffd\u52a0\u3055\u308c\u308b\u30ea\u30bd\u30fc\u30b9\uff1a <pre><code>+ Azure Firewall\n+ Firewall Policy\n+ Azure Bastion\n+ Public IP x3\n+ Route Tables\n+ Subnets\n</code></pre></p> <p>\u30b3\u30b9\u30c8\u78ba\u8a8d\uff1a <pre><code>Firewall: \u7d0417\u4e07\u5186/\u6708\nBastion: \u7d042.7\u4e07\u5186/\u6708\n-----------------\n\u5408\u8a08: \u7d0420\u4e07\u5186/\u6708\n</code></pre></p> <p>OK\uff1f \u2192 \u627f\u8a8d &amp; \u30de\u30fc\u30b8</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-5-4","title":"Step 5-4: \u30c7\u30d7\u30ed\u30a4\u5f85\u6a5f","text":"<pre><code>CD\u5b9f\u884c \u2192 30\u301c60\u5206\u304b\u304b\u308b\n</code></pre> <p>Firewall\u306e\u4f5c\u6210\u304c\u9045\u3044\u3002</p> <p>\u30b3\u30fc\u30d2\u30fc\u98f2\u3093\u3067\u5f85\u3068\u3046\u2615</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#phase-6","title":"Phase 6: \u52d5\u4f5c\u78ba\u8a8d","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-6-1-management-group","title":"Step 6-1: Management Group\u78ba\u8a8d","text":"<pre><code>az account management-group show \\\n  --name myorg \\\n  --expand \\\n  --recurse\n</code></pre> <p>**\u968e\u5c64\u69cb\u9020**\u304c\u8868\u793a\u3055\u308c\u308b\u3002</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-6-2-policy","title":"Step 6-2: Policy\u78ba\u8a8d","text":"<pre><code># Policy Assignment\u4e00\u89a7\naz policy assignment list --output table\n\n# \u7279\u5b9a\u306eManagement Group\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305fPolicy\naz policy assignment list \\\n  --scope \"/providers/Microsoft.Management/managementGroups/myorg-landing-zones\" \\\n  --output table\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-6-3-log-analytics","title":"Step 6-3: Log Analytics\u78ba\u8a8d","text":"<pre><code># Workspace\u78ba\u8a8d\nWORKSPACE_ID=$(az monitor log-analytics workspace show \\\n  --resource-group rg-myorg-management-001 \\\n  --workspace-name law-myorg-management-001 \\\n  --query id -o tsv)\n\n# \u30c7\u30fc\u30bf\u78ba\u8a8d\uff08\u30b5\u30f3\u30d7\u30eb\u30af\u30a8\u30ea\uff09\naz monitor log-analytics query \\\n  --workspace $WORKSPACE_ID \\\n  --analytics-query \"AzureActivity | take 10\" \\\n  --output table\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-6-4-firewall","title":"Step 6-4: Firewall\u78ba\u8a8d","text":"<pre><code># Firewall\u78ba\u8a8d\naz network firewall show \\\n  --resource-group rg-myorg-connectivity-001 \\\n  --name fw-myorg-jpe-hub\n\n# Public IP\u78ba\u8a8d\naz network firewall show \\\n  --resource-group rg-myorg-connectivity-001 \\\n  --name fw-myorg-jpe-hub \\\n  --query \"ipConfigurations[0].publicIpAddress.id\" -o tsv\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-6-5-bastion","title":"Step 6-5: Bastion\u78ba\u8a8d","text":"<pre><code>az network bastion show \\\n  --resource-group rg-myorg-connectivity-001 \\\n  --name bas-myorg-jpe-hub\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#step-6-6-spoke-vnet","title":"Step 6-6: Spoke VNet\u8ffd\u52a0\u30c6\u30b9\u30c8","text":"<pre><code>git checkout -b feature/add-spoke-vnet\n</code></pre> <p>\u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\uff1a<code>spoke.tf</code></p> <pre><code>resource \"azurerm_virtual_network\" \"spoke1\" {\n  name                = \"vnet-myorg-spoke1\"\n  location            = \"japaneast\"\n  resource_group_name = azurerm_resource_group.spoke1.name\n  address_space       = [\"10.1.0.0/16\"]\n}\n\nresource \"azurerm_resource_group\" \"spoke1\" {\n  name     = \"rg-myorg-spoke1\"\n  location = \"japaneast\"\n}\n\n# Hub VNet\u3068\u30d4\u30a2\u30ea\u30f3\u30b0\nresource \"azurerm_virtual_network_peering\" \"spoke1_to_hub\" {\n  name                      = \"peer-spoke1-to-hub\"\n  resource_group_name       = azurerm_resource_group.spoke1.name\n  virtual_network_name      = azurerm_virtual_network.spoke1.name\n  remote_virtual_network_id = module.hub_and_spoke_vnet[0].hub_virtual_networks[\"primary\"].virtual_network.resource_id\n\n  allow_virtual_network_access = true\n  allow_forwarded_traffic      = true\n  allow_gateway_transit        = false\n  use_remote_gateways          = false\n}\n\nresource \"azurerm_virtual_network_peering\" \"hub_to_spoke1\" {\n  name                      = \"peer-hub-to-spoke1\"\n  resource_group_name       = \"rg-myorg-connectivity-001\"\n  virtual_network_name      = \"vnet-myorg-jpe-hub\"\n  remote_virtual_network_id = azurerm_virtual_network.spoke1.id\n\n  allow_virtual_network_access = true\n  allow_forwarded_traffic      = true\n  allow_gateway_transit        = true\n  use_remote_gateways          = false\n\n  depends_on = [module.hub_and_spoke_vnet]\n}\n</code></pre> <pre><code>git add spoke.tf\ngit commit -m \"Add spoke VNet\"\ngit push origin feature/add-spoke-vnet\n\n# PR \u2192 CI \u2192 \u627f\u8a8d \u2192 \u30de\u30fc\u30b8 \u2192 CD\n</code></pre> <p>Spoke VNet\u304c\u4f5c\u3089\u308c\u308b\uff01</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#_3","title":"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#1-oidc","title":"\u30a8\u30e9\u30fc1: OIDC\u8a8d\u8a3c\u5931\u6557","text":"<pre><code>Error: Unable to get ACTIONS_ID_TOKEN_REQUEST_URL\n</code></pre> <p>\u539f\u56e0\uff1aFederated Credential\u306e\u8a2d\u5b9a\u9593\u9055\u3044</p> <p>\u78ba\u8a8d\uff1a <pre><code>az ad app federated-credential list --id $APP_ID\n</code></pre></p> <p>subject\u78ba\u8a8d\uff1a <pre><code>{\n  \"subject\": \"repo:your-github-username/alz-mgmt:ref:refs/heads/main\"\n}\n</code></pre></p> <p>\u9593\u9055\u3063\u3066\u305f\u3089\u524a\u9664\u3057\u3066\u518d\u4f5c\u6210\uff1a <pre><code>az ad app federated-credential delete \\\n  --id $APP_ID \\\n  --federated-credential-id &lt;CREDENTIAL_ID&gt;\n\n# \u518d\u4f5c\u6210\uff08Phase 2\u306e\u30b3\u30de\u30f3\u30c9\uff09\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#2-storage-account","title":"\u30a8\u30e9\u30fc2: Storage Account\u6a29\u9650\u30a8\u30e9\u30fc","text":"<pre><code>Error: Failed to get existing workspaces: blob not found\n</code></pre> <p>\u539f\u56e0\uff1aService Principal\u306bStorage\u6a29\u9650\u304c\u306a\u3044</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>STORAGE_ACCOUNT_ID=$(az storage account show \\\n  --name $ARM_STORAGE_ACCOUNT_NAME \\\n  --resource-group $ARM_RESOURCE_GROUP_NAME \\\n  --query id -o tsv)\n\naz role assignment create \\\n  --assignee $APP_ID \\\n  --role \"Storage Blob Data Contributor\" \\\n  --scope $STORAGE_ACCOUNT_ID\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#3-subscription","title":"\u30a8\u30e9\u30fc3: Subscription\u6a29\u9650\u30a8\u30e9\u30fc","text":"<pre><code>Error: insufficient privileges to complete the operation\n</code></pre> <p>\u539f\u56e0\uff1aService Principal\u306bOwner\u6a29\u9650\u304c\u306a\u3044</p> <p>\u78ba\u8a8d\uff1a <pre><code>az role assignment list \\\n  --assignee $APP_ID \\\n  --scope \"/subscriptions/$SUBSCRIPTION_ID\"\n</code></pre></p> <p>Owner\u6a29\u9650\u4ed8\u4e0e\uff1a <pre><code>az role assignment create \\\n  --assignee $APP_ID \\\n  --role \"Owner\" \\\n  --scope \"/subscriptions/$SUBSCRIPTION_ID\"\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#4-terraform-lock","title":"\u30a8\u30e9\u30fc4: Terraform Lock","text":"<pre><code>Error: Error acquiring the state lock\n</code></pre> <p>\u539f\u56e0\uff1a\u524d\u56de\u306e\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u304c\u5931\u6557\u3057\u3066Lock\u304c\u6b8b\u3063\u3066\u308b</p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># Azure Portal \u2192 Storage Account \u2192 tfstate\u30b3\u30f3\u30c6\u30ca\n# .terraform.lock.info \u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\n\n# \u307e\u305f\u306fCLI\naz storage blob delete \\\n  --account-name $ARM_STORAGE_ACCOUNT_NAME \\\n  --container-name $ARM_CONTAINER_NAME \\\n  --name .terraform.lock.info \\\n  --auth-mode login\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#_4","title":"\u30c7\u30d7\u30ed\u30a4\u5f8c\u306e\u78ba\u8a8d\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#management-group_1","title":"\u2705 Management Group","text":"<pre><code># \u968e\u5c64\u69cb\u9020\u78ba\u8a8d\naz account management-group list --output table\n\n# \u671f\u5f85\u3055\u308c\u308b\u69cb\u9020\uff1a\n# myorg\n# \u251c\u2500\u2500 myorg-platform\n# \u2502   \u251c\u2500\u2500 myorg-management\n# \u2502   \u251c\u2500\u2500 myorg-identity\n# \u2502   \u2514\u2500\u2500 myorg-connectivity\n# \u251c\u2500\u2500 myorg-landing-zones\n# \u2502   \u251c\u2500\u2500 myorg-corp\n# \u2502   \u2514\u2500\u2500 myorg-online\n# \u2514\u2500\u2500 myorg-decommissioned\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#resource-group_1","title":"\u2705 Resource Group","text":"<pre><code>az group list --query \"[].{Name:name, Location:location}\" --output table\n\n# \u671f\u5f85\u3055\u308c\u308bResource Group\uff1a\n# rg-myorg-management-001\n# rg-myorg-connectivity-001\n# rg-myorg-identity-001\n# rg-terraform-state\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#log-analytics-workspace","title":"\u2705 Log Analytics Workspace","text":"<pre><code>az monitor log-analytics workspace list --output table\n\n# law-myorg-management-001 \u304c\u5b58\u5728\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#vnet","title":"\u2705 VNet\uff08\u6709\u52b9\u5316\u3057\u3066\u3044\u308b\u5834\u5408\uff09","text":"<pre><code>az network vnet list --output table\n\n# vnet-myorg-jpe-hub \u304c\u5b58\u5728\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#firewall","title":"\u2705 Firewall\uff08\u6709\u52b9\u5316\u3057\u3066\u3044\u308b\u5834\u5408\uff09","text":"<pre><code>az network firewall list --output table\n\n# fw-myorg-jpe-hub \u304c\u5b58\u5728\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#policy-assignment","title":"\u2705 Policy Assignment","text":"<pre><code>az policy assignment list \\\n  --scope \"/providers/Microsoft.Management/managementGroups/myorg\" \\\n  --output table\n\n# \u8907\u6570\u306ePolicy Assignment\u304c\u8868\u793a\u3055\u308c\u308b\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#github-actions","title":"\u2705 GitHub Actions\u5c65\u6b74","text":"<pre><code>GitHub \u2192 Actions\n  \u2193\nCI/CD\u306e\u5b9f\u884c\u5c65\u6b74\u304c\u6b8b\u3063\u3066\u308b\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#_5","title":"\u307e\u3068\u3081","text":"<p>\u30c7\u30d7\u30ed\u30a4\u306e\u6d41\u308c\uff1a <pre><code>Phase 1: Azure\u6e96\u5099\uff08Service Principal\u3001Storage Account\uff09\nPhase 2: GitHub\u6e96\u5099\uff08\u30ea\u30dd\u30b8\u30c8\u30ea\u3001Secrets\uff09\nPhase 3: \u30ed\u30fc\u30ab\u30eb\u3067\u306e\u521d\u56de\u30c7\u30d7\u30ed\u30a4\nPhase 4: GitHub Actions\u3067\u306e\u30c7\u30d7\u30ed\u30a4\nPhase 5: \u672c\u683c\u7684\u306a\u30c7\u30d7\u30ed\u30a4\nPhase 6: \u52d5\u4f5c\u78ba\u8a8d\n</code></pre></p> <p>\u6240\u8981\u6642\u9593\uff1a <pre><code>Phase 1: 30\u5206\nPhase 2: 30\u5206\nPhase 3: 60\u5206\nPhase 4: 30\u5206\nPhase 5: 60\u5206\nPhase 6: 20\u5206\n-----------\n\u5408\u8a08: \u7d043.5\u6642\u9593\n</code></pre></p> <p>\u91cd\u8981\u30dd\u30a4\u30f3\u30c8\uff1a - Service Principal: OIDC\u8a2d\u5b9a\u5fc5\u9808 - Storage Account: State\u4fdd\u5b58\u5148 - \u30ed\u30fc\u30ab\u30eb\u5b9f\u884c: \u6700\u521d\u306f\u30ed\u30fc\u30ab\u30eb\u3067\u78ba\u8a8d - \u6bb5\u968e\u7684\u30c7\u30d7\u30ed\u30a4: \u3044\u304d\u306a\u308a\u5168\u90e8\u6709\u52b9\u5316\u3057\u306a\u3044 - \u30b3\u30b9\u30c8\u78ba\u8a8d: Firewall\u7b49\u3092\u6709\u52b9\u5316\u3059\u308b\u524d\u306b\u78ba\u8a8d</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#_6","title":"\u7df4\u7fd2\u554f\u984c","text":"<p>\u5b9f\u8df5\u7684\u306a\u7406\u89e3\u5ea6\u30c1\u30a7\u30c3\u30af\u3067\u3059\u3002</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#1","title":"\u554f\u984c1","text":"<p>OIDC\u8a8d\u8a3c\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306e\u9055\u3044\u30923\u3064\u6319\u3052\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#2_1","title":"\u554f\u984c2","text":"<p>\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u5834\u5408\u3001\u4f55\u304c\u539f\u56e0\u3067\u3059\u304b\uff1f <pre><code>Error: zones are not supported in this region\n</code></pre></p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#3","title":"\u554f\u984c3","text":"<p>Terraform State\u30d5\u30a1\u30a4\u30eb\u3092\u30ed\u30fc\u30ab\u30eb\u3067\u306f\u306a\u304f\u3001 Azure Storage Account\u306b\u4fdd\u5b58\u3059\u308b\u7406\u7531\u30922\u3064\u6319\u3052\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#_7","title":"\u7df4\u7fd2\u554f\u984c\u306e\u7b54\u3048","text":""},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#1_1","title":"\u7b54\u30481","text":"<p>OIDC\u8a8d\u8a3c\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306e\u9055\u3044:</p> <ol> <li>\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3: OIDC = \u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c = \u6f0f\u6d29\u30ea\u30b9\u30af\u3042\u308a</li> <li>\u66f4\u65b0: OIDC = \u81ea\u52d5\u66f4\u65b0\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c = \u5b9a\u671f\u7684\u306a\u624b\u52d5\u66f4\u65b0\u304c\u5fc5\u8981</li> <li>\u4fe1\u983c\u30e2\u30c7\u30eb: OIDC = \u8a3c\u660e\u66f8\u30d9\u30fc\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c = \u79d8\u5bc6\u60c5\u5831\u306e\u4fdd\u5b58</li> </ol>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#2_2","title":"\u7b54\u30482","text":"<p>\u539f\u56e0: Japan East\u7b49\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u3001Availability Zones\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u3057\u3066 <code>zones = [\"1\", \"2\", \"3\"]</code>\u306e\u3088\u3046\u306b\u6307\u5b9a\u3057\u3066\u3044\u308b\u3002</p> <p>\u89e3\u6c7a\u7b56: <code>zones = []</code>\uff08\u7a7a\u30ea\u30b9\u30c8\uff09\u3092\u6307\u5b9a\u3059\u308b\u3002</p> <pre><code>primary_firewall_client_public_ip_zones = []\n</code></pre>"},{"location":"13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/#3_1","title":"\u7b54\u30483","text":"<p>Terraform State\u3092\u30ea\u30e2\u30fc\u30c8\u4fdd\u5b58\u3059\u308b\u7406\u7531:</p> <ol> <li>\u30c1\u30fc\u30e0\u5171\u6709: \u8907\u6570\u4eba\u3067\u540c\u3058State\u3092\u53c2\u7167\u3067\u304d\u308b\u3002\u30ed\u30fc\u30ab\u30eb\u3060\u3068\u500b\u4eba\u306ePC\u306b\u3057\u304b\u4fdd\u5b58\u3055\u308c\u306a\u3044\u3002</li> <li>\u5b89\u5168\u6027: \u30ed\u30fc\u30ab\u30ebPC\u306e\u6545\u969c\u3084\u30d5\u30a1\u30a4\u30eb\u524a\u9664\u3067State\u304c\u5931\u308f\u308c\u308b\u30ea\u30b9\u30af\u3092\u56de\u907f\u3002Azure Storage\u306f\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3055\u308c\u3066\u3044\u308b\u3002</li> </ol> <p>\u8ffd\u52a0\u306e\u5229\u70b9: - State Locking\u3067\u30c1\u30fc\u30e0\u5185\u306e\u7af6\u5408\u3092\u9632\u3052\u308b - GitHub Actions\u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b</p> <p>\u6b21\u306eChapter\u3067\u306f\u3001\u3088\u304f\u3042\u308b\u30c8\u30e9\u30d6\u30eb\u3068\u305d\u306e\u5bfe\u51e6\u6cd5\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u30c7\u30d7\u30ed\u30a4\u4e2d\u306b\u30cf\u30de\u308a\u3084\u3059\u3044\u30dd\u30a4\u30f3\u30c8\u3092\u89e3\u8aac\u3059\u308b\u3088\u3002</p> <p>\u6240\u8981\u6642\u9593: 65\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2605 \u524d: 12_GitHub_Actions.md \u6b21: 14_\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0.md</p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/","title":"14. \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 - \u3088\u304f\u3042\u308b\u554f\u984c\u3068\u89e3\u6c7a\u6cd5","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>\u5b9f\u969b\u306b\u30cf\u30de\u308a\u3084\u3059\u3044\u554f\u984c\u3068\u305d\u306e\u5bfe\u51e6\u6cd5\u3092\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002</p> <p>\u30c7\u30d7\u30ed\u30a4\u4e2d\u306b\u8d77\u3053\u308a\u3084\u3059\u3044\u30c8\u30e9\u30d6\u30eb\uff1a - OIDC\u8a8d\u8a3c\u30a8\u30e9\u30fc - Terraform State\u95a2\u9023 - \u6a29\u9650\u30a8\u30e9\u30fc - \u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u30a8\u30e9\u30fc - GitHub Actions\u30a8\u30e9\u30fc</p> <p>\u3053\u306eChapter\u304c\u3042\u308c\u3070\uff1a <pre><code>\u30a8\u30e9\u30fc\u767a\u751f\n  \u2193\n\u3053\u306eChapter\u3067\u691c\u7d22\n  \u2193\n\u539f\u56e0\u3068\u5bfe\u51e6\u6cd5\u304c\u308f\u304b\u308b\n  \u2193\n\u89e3\u6c7a\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#_1","title":"\u30ab\u30c6\u30b4\u30ea\u5225\u30c8\u30e9\u30d6\u30eb","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#1","title":"1. \u8a8d\u8a3c\u30a8\u30e9\u30fc","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#1-1-oidcgithub-actions","title":"\u30a8\u30e9\u30fc1-1: OIDC\u8a8d\u8a3c\u5931\u6557\uff08GitHub Actions\uff09","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: Unable to get ACTIONS_ID_TOKEN_REQUEST_URL env variable\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>permissions\u8a2d\u5b9a\u304c\u306a\u3044\n  \u2193\nOIDC\u30c8\u30fc\u30af\u30f3\u304c\u53d6\u5f97\u3067\u304d\u306a\u3044\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># .github/workflows/ci.yaml\njobs:\n  validate_and_plan:\n    permissions:\n      id-token: write  # \u2190\u3053\u308c\u5fc5\u9808\n      contents: read\n      pull-requests: write\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#1-2-oidc-issuer-mismatch","title":"\u30a8\u30e9\u30fc1-2: OIDC Issuer Mismatch","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: AADSTS70021: No matching federated identity record found\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>Federated Credential\u306e\u8a2d\u5b9a\u304c\u9593\u9055\u3063\u3066\u308b\n  \u2193\nsubject\uff08\u30ea\u30dd\u30b8\u30c8\u30ea\u30d1\u30b9\uff09\u304c\u9055\u3046\n</code></pre></p> <p>\u78ba\u8a8d\uff1a <pre><code>az ad app federated-credential list --id $APP_ID\n</code></pre></p> <p>\u4fee\u6b63\uff1a <pre><code># \u9593\u9055\u3063\u305fCredential\u3092\u524a\u9664\naz ad app federated-credential delete \\\n  --id $APP_ID \\\n  --federated-credential-id &lt;CREDENTIAL_ID&gt;\n\n# \u6b63\u3057\u3044\u3082\u306e\u3092\u4f5c\u6210\naz ad app federated-credential create \\\n  --id $APP_ID \\\n  --parameters '{\n    \"name\": \"github-actions-main\",\n    \"issuer\": \"https://token.actions.githubusercontent.com\",\n    \"subject\": \"repo:your-username/alz-mgmt:ref:refs/heads/main\",\n    \"audiences\": [\"api://AzureADTokenExchange\"]\n  }'\n</code></pre></p> <p>subject\u78ba\u8a8d\uff1a <pre><code>repo:&lt;GitHub\u30e6\u30fc\u30b6\u30fc\u540d&gt;/&lt;\u30ea\u30dd\u30b8\u30c8\u30ea\u540d&gt;:ref:refs/heads/&lt;\u30d6\u30e9\u30f3\u30c1\u540d&gt;\n\n\u4f8b\uff1a\nrepo:shuhei0720org01/alz-mgmt:ref:refs/heads/main\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#1-3-azure-login","title":"\u30a8\u30e9\u30fc1-3: Azure Login\u5931\u6557\uff08\u30ed\u30fc\u30ab\u30eb\uff09","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: No subscriptions found for &lt;user@example.com&gt;\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u30a2\u30ab\u30a6\u30f3\u30c8\u306bSubscription\u304c\u306a\u3044\n  \u2193\n\u307e\u305f\u306f\n  \u2193\n\u6b63\u3057\u304f\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u3066\u306a\u3044\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># \u518d\u30ed\u30b0\u30a4\u30f3\naz logout\naz login\n\n# Subscription\u78ba\u8a8d\naz account list --output table\n\n# \u7279\u5b9a\u306eTenant\u3067\u30ed\u30b0\u30a4\u30f3\naz login --tenant &lt;TENANT_ID&gt;\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#1-4-service-principal","title":"\u30a8\u30e9\u30fc1-4: Service Principal\u6a29\u9650\u4e0d\u8db3","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: insufficient privileges to complete the operation\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>Service Principal\u306bOwner\u6a29\u9650\u304c\u306a\u3044\n  \u2193\nManagement Group\u4f5c\u6210\nPolicy\u5272\u308a\u5f53\u3066\n\u306a\u3069\u304c\u3067\u304d\u306a\u3044\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># \u73fe\u5728\u306e\u6a29\u9650\u78ba\u8a8d\naz role assignment list \\\n  --assignee $APP_ID \\\n  --all \\\n  --output table\n\n# Owner\u6a29\u9650\u4ed8\u4e0e\uff08Subscription\uff09\naz role assignment create \\\n  --assignee $APP_ID \\\n  --role \"Owner\" \\\n  --scope \"/subscriptions/$SUBSCRIPTION_ID\"\n\n# Management Group Root Scope\u306b\u6a29\u9650\u4ed8\u4e0e\uff08\u5fc5\u8981\u306a\u5834\u5408\uff09\naz role assignment create \\\n  --assignee $APP_ID \\\n  --role \"Owner\" \\\n  --scope \"/providers/Microsoft.Management/managementGroups/$ROOT_MG_ID\"\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#2-terraform-state","title":"2. Terraform State\u95a2\u9023","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#2-1-state-lock","title":"\u30a8\u30e9\u30fc2-1: State Lock\u53d6\u5f97\u5931\u6557","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: Error acquiring the state lock\nLock Info:\n  ID:        abc123-def456-...\n  Path:      alz-mgmt.tfstate\n  Operation: OperationTypeApply\n  Who:       GitHub Actions\n  Created:   2026-01-16 10:00:00 UTC\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>\u524d\u56de\u306eterraform\u5b9f\u884c\u304c\u9014\u4e2d\u3067\u6b62\u307e\u3063\u305f\n  \u2193\nLock\u304c\u6b8b\u3063\u3066\u308b\n  \u2193\n\u6b21\u306e\u5b9f\u884c\u304c\u30d6\u30ed\u30c3\u30af\u3055\u308c\u308b\n</code></pre></p> <p>\u5bfe\u51e6\u6cd51\uff08\u63a8\u5968\uff09\uff1a\u30ed\u30c3\u30af\u89e3\u9664 <pre><code># \u30ed\u30c3\u30afID\u78ba\u8a8d\uff08\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304b\u3089\uff09\nLOCK_ID=\"abc123-def456-...\"\n\n# \u30ed\u30c3\u30af\u89e3\u9664\nterraform force-unlock $LOCK_ID\n</code></pre></p> <p>\u5bfe\u51e6\u6cd52\uff08Storage Account\u304b\u3089\u76f4\u63a5\u524a\u9664\uff09\uff1a <pre><code># Azure Portal\nStorage Account \u2192 Containers \u2192 tfstate \u2192 .terraform.lock.info\n\u2192 Delete\n\n# \u307e\u305f\u306f CLI\naz storage blob delete \\\n  --account-name $ARM_STORAGE_ACCOUNT_NAME \\\n  --container-name $ARM_CONTAINER_NAME \\\n  --name .terraform.lock.info \\\n  --auth-mode login\n</code></pre></p> <p>\u6ce8\u610f\uff1a <pre><code>\u672c\u5f53\u306b\u4ed6\u306e\u4eba\u304c\u5b9f\u884c\u3057\u3066\u306a\u3044\u304b\u78ba\u8a8d\u3057\u3066\u304b\u3089\u524a\u9664\uff01\n  \u2193\n\u540c\u6642\u5b9f\u884c\u3059\u308b\u3068State\u30d5\u30a1\u30a4\u30eb\u58ca\u308c\u308b\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#2-2-state-file-not-found","title":"\u30a8\u30e9\u30fc2-2: State File Not Found","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: Failed to get existing workspaces: storage: service returned error: StatusCode=404\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>Storage Account\u307e\u305f\u306fContainer\u304c\u5b58\u5728\u3057\u306a\u3044\n  \u2193\n\u307e\u305f\u306f\n  \u2193\nBackend\u8a2d\u5b9a\u306e\u74b0\u5883\u5909\u6570\u304c\u9593\u9055\u3063\u3066\u308b\n</code></pre></p> <p>\u78ba\u8a8d\uff1a <pre><code># Storage Account\u78ba\u8a8d\naz storage account show \\\n  --name $ARM_STORAGE_ACCOUNT_NAME \\\n  --resource-group $ARM_RESOURCE_GROUP_NAME\n\n# Container\u78ba\u8a8d\naz storage container show \\\n  --account-name $ARM_STORAGE_ACCOUNT_NAME \\\n  --name $ARM_CONTAINER_NAME \\\n  --auth-mode login\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># Container\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u3001\u4f5c\u6210\naz storage container create \\\n  --name $ARM_CONTAINER_NAME \\\n  --account-name $ARM_STORAGE_ACCOUNT_NAME \\\n  --auth-mode login\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#2-3-storage-account","title":"\u30a8\u30e9\u30fc2-3: Storage Account\u6a29\u9650\u30a8\u30e9\u30fc","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: storage: service returned error: StatusCode=403\nThis request is not authorized to perform this operation\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>Service Principal\u306bStorage Blob Data Contributor\u6a29\u9650\u304c\u306a\u3044\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># Storage Account ID\u3092\u53d6\u5f97\nSTORAGE_ACCOUNT_ID=$(az storage account show \\\n  --name $ARM_STORAGE_ACCOUNT_NAME \\\n  --resource-group $ARM_RESOURCE_GROUP_NAME \\\n  --query id -o tsv)\n\n# \u6a29\u9650\u4ed8\u4e0e\naz role assignment create \\\n  --assignee $APP_ID \\\n  --role \"Storage Blob Data Contributor\" \\\n  --scope $STORAGE_ACCOUNT_ID\n\n# \u78ba\u8a8d\naz role assignment list \\\n  --assignee $APP_ID \\\n  --scope $STORAGE_ACCOUNT_ID\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#2-4-state-drift","title":"\u30a8\u30e9\u30fc2-4: State Drift\uff08\u5dee\u5206\u767a\u751f\uff09","text":"<p>\u73fe\u8c61\uff1a <pre><code>terraform plan\n  \u2193\n\u4f55\u3082\u5909\u66f4\u3057\u3066\u306a\u3044\u306e\u306b\u5909\u66f4\u304c\u691c\u51fa\u3055\u308c\u308b\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>Azure\u3067\u76f4\u63a5\u30ea\u30bd\u30fc\u30b9\u3092\u5909\u66f4\u3057\u305f\n  \u2193\nState\u30d5\u30a1\u30a4\u30eb\u3068\u5b9f\u969b\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u4e0d\u4e00\u81f4\n</code></pre></p> <p>\u5bfe\u51e6\u6cd51\uff08\u5909\u66f4\u3092\u53d6\u308a\u8fbc\u3080\uff09\uff1a <pre><code># \u73fe\u5728\u306e\u72b6\u614b\u3092State\u306b\u53cd\u6620\nterraform apply -refresh-only\n\n# \u307e\u305f\u306f\u7279\u5b9a\u306e\u30ea\u30bd\u30fc\u30b9\u3060\u3051\nterraform apply -refresh-only -target=azurerm_resource_group.example\n</code></pre></p> <p>\u5bfe\u51e6\u6cd52\uff08Azure\u306e\u5909\u66f4\u3092\u623b\u3059\uff09\uff1a <pre><code># terraform apply\u3067\u5143\u306b\u623b\u3059\nterraform apply\n</code></pre></p> <p>\u4e88\u9632\u7b56\uff1a <pre><code>Azure\u30dd\u30fc\u30bf\u30eb\u3067\u76f4\u63a5\u5909\u66f4\u3057\u306a\u3044\n  \u2193\n\u5168\u90e8Terraform\u3067\u7ba1\u7406\n  \u2193\nInfrastructure as Code\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#3","title":"3. \u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u30a8\u30e9\u30fc","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#3-1-region-availability-zones","title":"\u30a8\u30e9\u30fc3-1: Region Availability Zones\u5bfe\u5fdc\u30a8\u30e9\u30fc","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: zones - availability zones are not supported in this region\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>Japan East/West\u3067zones\u6307\u5b9a\u3057\u3066\u308b\n  \u2193\n\u3067\u3082Availability Zones\u975e\u5bfe\u5fdc\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># NG\nbastion = {\n  zones = [\"1\", \"2\", \"3\"]\n}\n\n# OK\uff08Japan region\uff09\nbastion = {\n  zones = []  # \u2190\u7a7a\u30ea\u30b9\u30c8\n}\n</code></pre></p> <p>\u8a72\u5f53\u30ea\u30bd\u30fc\u30b9\uff1a <pre><code>- Azure Bastion\n- Public IP Address\n- Virtual Machine\uff08\u4e00\u90e8\uff09\n</code></pre></p> <p>Chapter 3\u3067\u8a73\u3057\u304f\u89e3\u8aac\u3057\u305f\u3084\u3064\u3002</p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#3-2","title":"\u30a8\u30e9\u30fc3-2: \u30ea\u30bd\u30fc\u30b9\u540d\u306e\u91cd\u8907","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: A resource with the ID \"/subscriptions/.../resourceGroups/rg-test\" already exists\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>\u540c\u3058\u540d\u524d\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u65e2\u306b\u5b58\u5728\n</code></pre></p> <p>\u78ba\u8a8d\uff1a <pre><code># Resource Group\u78ba\u8a8d\naz group show --name rg-test\n\n# \u524a\u9664\uff08\u5fc5\u8981\u306a\u3089\uff09\naz group delete --name rg-test --yes\n</code></pre></p> <p>\u4e88\u9632\u7b56\uff1a <pre><code>\u4e00\u610f\u306a\u540d\u524d\u3092\u4f7f\u3046\n  \u2193\npostfix\u3092\u8ffd\u52a0\n  \u2193\nrg-myorg-test-001\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#3-3-subnet-address-prefix","title":"\u30a8\u30e9\u30fc3-3: Subnet Address Prefix\u91cd\u8907","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: subnet address prefix overlaps with existing subnet\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2\u304c\u91cd\u8907\n</code></pre></p> <p>\u4f8b\uff08NG\uff09\uff1a <pre><code>hub_virtual_network = {\n  address_space = [\"10.0.0.0/16\"]\n}\n\nfirewall = {\n  subnet_address_prefix = \"10.0.0.0/24\"  # \u2190OK\n}\n\nbastion = {\n  subnet_address_prefix = \"10.0.0.0/26\"  # \u2190NG\uff0810.0.0.0/24\u306b\u542b\u307e\u308c\u308b\uff09\n}\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>firewall = {\n  subnet_address_prefix = \"10.0.0.0/26\"   # 10.0.0.0 - 10.0.0.63\n}\n\nbastion = {\n  subnet_address_prefix = \"10.0.0.64/26\"  # 10.0.0.64 - 10.0.0.127\n}\n\ngateway = {\n  subnet_address_prefix = \"10.0.1.0/26\"   # 10.0.1.0 - 10.0.1.63\n}\n</code></pre></p> <p>\u30c4\u30fc\u30eb\uff1a <pre><code>IP\u30a2\u30c9\u30ec\u30b9\u8a08\u7b97\u30b5\u30a4\u30c8\uff1a\nhttps://www.subnet-calculator.com/\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#3-4-management-group","title":"\u30a8\u30e9\u30fc3-4: Management Group\u540d\u304c\u9577\u3059\u304e\u308b","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: management group name must be 90 characters or less\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>root_id + \"-\" + \u540d\u524d \u304c\u9577\u3044\n</code></pre></p> <p>\u4f8b\uff08NG\uff09\uff1a <pre><code>root_id = \"my-very-long-organization-name\"\n  \u2193\nManagement Group\u540d:\n\"my-very-long-organization-name-landing-zones-corp\"\n\u2192 90\u6587\u5b57\u8d85\u3048\u308b\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># root_id\u3092\u77ed\u304f\u3059\u308b\nroot_id = \"myorg\"\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#3-5-firewall","title":"\u30a8\u30e9\u30fc3-5: Firewall\u4f5c\u6210\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: timeout while waiting for state to become 'Succeeded'\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>Firewall\u306e\u4f5c\u6210\u306b\u6642\u9593\u304c\u304b\u304b\u308b\uff0830\u301c60\u5206\uff09\n  \u2193\nTerraform\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n</code></pre></p> <p>\u5bfe\u51e6\u6cd51\uff08\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u5ef6\u9577\uff09\uff1a <pre><code># variables.tf\u307e\u305f\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u5185\nresource \"azurerm_firewall\" \"example\" {\n  ...\n\n  timeouts {\n    create = \"90m\"  # \u219090\u5206\u306b\u5ef6\u9577\n    update = \"90m\"\n    delete = \"90m\"\n  }\n}\n</code></pre></p> <p>\u5bfe\u51e6\u6cd52\uff08\u518d\u5b9f\u884c\uff09\uff1a <pre><code># \u3082\u3046\u4e00\u5ea6apply\nterraform apply\n\n# Firewall\u306f\u4f5c\u6210\u9014\u4e2d\u3067\u6b62\u307e\u3063\u3066\u308b\u53ef\u80fd\u6027\n# \u518d\u5b9f\u884c\u3067\u7d9a\u304d\u304b\u3089\u518d\u958b\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#3-6-policy-assignment","title":"\u30a8\u30e9\u30fc3-6: Policy Assignment\u5931\u6557","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: policy assignment failed: policy definition not found\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>Policy Definition\u304c\u5b58\u5728\u3057\u306a\u3044\n  \u2193\n\u30ab\u30b9\u30bf\u30e0Policy\u306e\u5834\u5408\u3001\u5148\u306b\u5b9a\u7fa9\u304c\u5fc5\u8981\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># Policy Definition\u4f5c\u6210\nresource \"azurerm_policy_definition\" \"example\" {\n  name         = \"custom-policy\"\n  policy_type  = \"Custom\"\n  mode         = \"All\"\n  display_name = \"Custom Policy\"\n\n  policy_rule = jsonencode({\n    if = {\n      allOf = [...]\n    }\n    then = {\n      effect = \"deny\"\n    }\n  })\n}\n\n# Policy Assignment\uff08depends_on\u6307\u5b9a\uff09\nresource \"azurerm_management_group_policy_assignment\" \"example\" {\n  name                 = \"assign-custom-policy\"\n  policy_definition_id = azurerm_policy_definition.example.id\n  management_group_id  = azurerm_management_group.example.id\n\n  depends_on = [azurerm_policy_definition.example]  # \u2190\u4f9d\u5b58\u95a2\u4fc2\n}\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#4-github-actions","title":"4. GitHub Actions\u95a2\u9023","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#4-1-workflow-permission-denied","title":"\u30a8\u30e9\u30fc4-1: Workflow Permission Denied","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: Resource not accessible by integration\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>GitHub\u306eRepository\u8a2d\u5b9a\u3067Workflow\u6a29\u9650\u304c\u5236\u9650\u3055\u308c\u3066\u308b\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>GitHub \u2192 Settings \u2192 Actions \u2192 General\n  \u2193\nWorkflow permissions:\n  \u2713 Read and write permissions  # \u2190\u3053\u308c\u9078\u629e\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#4-2-secrets-not-found","title":"\u30a8\u30e9\u30fc4-2: Secrets Not Found","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: Input required and not supplied: client-id\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>GitHub Secrets\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u306a\u3044\n  \u2193\n\u307e\u305f\u306f\u540d\u524d\u304c\u9593\u9055\u3063\u3066\u308b\n</code></pre></p> <p>\u78ba\u8a8d\uff1a <pre><code>GitHub \u2192 Settings \u2192 Secrets and variables \u2192 Actions\n  \u2193\n\u5fc5\u8981\u306aSecrets:\n- AZURE_CLIENT_ID\n- AZURE_TENANT_ID\n- AZURE_SUBSCRIPTION_ID\n- ARM_STORAGE_ACCOUNT_NAME\n- ARM_CONTAINER_NAME\n- ARM_KEY\n- ARM_RESOURCE_GROUP_NAME\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>Secrets\u3092\u8ffd\u52a0\n  \u2193\n\u540d\u524d\u306e\u30b9\u30da\u30eb\u30df\u30b9\u306b\u6ce8\u610f\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#4-3-environment-protection-rule","title":"\u30a8\u30e9\u30fc4-3: Environment Protection Rule\u30a8\u30e9\u30fc","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: Required reviewers not found\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>Environment\u8a2d\u5b9a\u3067Required reviewers\u304c\u7a7a\n  \u2193\n\u307e\u305f\u306f\u6307\u5b9a\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u304c\u5b58\u5728\u3057\u306a\u3044\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>GitHub \u2192 Settings \u2192 Environments \u2192 production\n  \u2193\nRequired reviewers:\n  - \u81ea\u5206\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u8ffd\u52a0\n  - \u307e\u305f\u306f\u4ed6\u306e\u30ec\u30d3\u30e5\u30a2\u30fc\u8ffd\u52a0\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#4-4-workflow-concurrent","title":"\u30a8\u30e9\u30fc4-4: Workflow Concurrent\u5b9f\u884c\u30a8\u30e9\u30fc","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: Another job is currently holding the lock\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>\u8907\u6570\u306e\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u304c\u540c\u6642\u5b9f\u884c\n  \u2193\nTerraform State Lock\u7af6\u5408\n</code></pre></p> <p>\u5bfe\u51e6\u6cd51\uff08Concurrency\u8a2d\u5b9a\uff09\uff1a <pre><code># .github/workflows/cd.yaml\njobs:\n  plan_and_apply:\n    concurrency:\n      group: terraform-${{ github.ref }}\n      cancel-in-progress: false  # \u2190\u524d\u306e\u5b9f\u884c\u3092\u5f85\u3064\n</code></pre></p> <p>\u5bfe\u51e6\u6cd52\uff08\u624b\u52d5\u3067Lock\u89e3\u9664\uff09\uff1a <pre><code>terraform force-unlock &lt;LOCK_ID&gt;\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#5","title":"5. \u30e2\u30b8\u30e5\u30fc\u30eb\u95a2\u9023","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#5-1-module-not-found","title":"\u30a8\u30e9\u30fc5-1: Module Not Found","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: Module not found\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>terraform init \u3057\u3066\u306a\u3044\n  \u2193\n\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u3066\u306a\u3044\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>terraform init\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#5-2-module-version-constraint","title":"\u30a8\u30e9\u30fc5-2: Module Version Constraint","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: no available releases match the given constraints\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>\u6307\u5b9a\u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5b58\u5728\u3057\u306a\u3044\n</code></pre></p> <p>\u78ba\u8a8d\uff1a <pre><code>module \"hub_and_spoke_vnet\" {\n  source  = \"Azure/avm-ptn-alz-connectivity-hub-and-spoke-vnet/azurerm\"\n  version = \"0.16.8\"  # \u2190\u3053\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5b58\u5728\u3059\u308b\u304b\n}\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>Terraform Registry\u78ba\u8a8d\uff1a\nhttps://registry.terraform.io/modules/Azure/avm-ptn-alz-connectivity-hub-and-spoke-vnet/azurerm\n  \u2193\n\u5229\u7528\u53ef\u80fd\u306a\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#5-3-module-input-variable-error","title":"\u30a8\u30e9\u30fc5-3: Module Input Variable Error","text":"<p>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>Error: Unsupported argument\n</code></pre></p> <p>\u539f\u56e0\uff1a <pre><code>\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u5b58\u5728\u3057\u306a\u3044\u5909\u6570\u3092\u6e21\u3057\u3066\u308b\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u78ba\u8a8d\n  \u2193\nvariables.tf\u78ba\u8a8d\n  \u2193\n\u6b63\u3057\u3044\u5909\u6570\u540d\u3092\u4f7f\u3046\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#6","title":"6. \u30c7\u30d0\u30c3\u30b0\u30c6\u30af\u30cb\u30c3\u30af","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#1-terraform-debug-mode","title":"\u30c6\u30af\u30cb\u30c3\u30af1: Terraform Debug Mode","text":"<pre><code># \u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9\u6709\u52b9\u5316\nexport TF_LOG=DEBUG\nexport TF_LOG_PATH=terraform-debug.log\n\n# \u5b9f\u884c\nterraform plan\n\n# \u30ed\u30b0\u78ba\u8a8d\ncat terraform-debug.log\n</code></pre> <p>\u30ed\u30b0\u30ec\u30d9\u30eb\uff1a <pre><code>TRACE\uff1a\u6700\u3082\u8a73\u7d30\nDEBUG\uff1a\u30c7\u30d0\u30c3\u30b0\u60c5\u5831\nINFO\uff1a\u4e00\u822c\u60c5\u5831\nWARN\uff1a\u8b66\u544a\nERROR\uff1a\u30a8\u30e9\u30fc\u306e\u307f\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#2-terraform-graph","title":"\u30c6\u30af\u30cb\u30c3\u30af2: Terraform Graph","text":"<pre><code># \u4f9d\u5b58\u95a2\u4fc2\u306e\u53ef\u8996\u5316\nterraform graph | dot -Tpng &gt; graph.png\n\n# macOS\nopen graph.png\n\n# Windows\nstart graph.png\n</code></pre> <p>\u4f7f\u3044\u9053\uff1a <pre><code>\u30ea\u30bd\u30fc\u30b9\u306e\u4f9d\u5b58\u95a2\u4fc2\u304c\u898b\u3048\u308b\n  \u2193\n\u3069\u306e\u9806\u756a\u3067\u4f5c\u6210\u3055\u308c\u308b\u304b\u308f\u304b\u308b\n  \u2193\n\u5faa\u74b0\u4f9d\u5b58\u306e\u30c7\u30d0\u30c3\u30b0\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#3-terraform-show","title":"\u30c6\u30af\u30cb\u30c3\u30af3: Terraform Show","text":"<pre><code># Plan\u7d50\u679c\u306e\u8a73\u7d30\u8868\u793a\nterraform show tfplan\n\n# State\u5185\u5bb9\u306e\u8868\u793a\nterraform show\n\n# JSON\u5f62\u5f0f\u3067\u51fa\u529b\nterraform show -json &gt; state.json\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#4-terraform-console","title":"\u30c6\u30af\u30cb\u30c3\u30af4: Terraform Console","text":"<pre><code># \u5bfe\u8a71\u578b\u30b3\u30f3\u30bd\u30fc\u30eb\nterraform console\n\n# \u5909\u6570\u306e\u78ba\u8a8d\n&gt; var.root_id\n\"myorg\"\n\n&gt; local.management_group_settings\n{\n  \"root\" = {\n    ...\n  }\n}\n\n# \u95a2\u6570\u306e\u30c6\u30b9\u30c8\n&gt; format(\"rg-%s-test\", var.root_id)\n\"rg-myorg-test\"\n</code></pre> <p>\u8d85\u4fbf\u5229\uff1a <pre><code>\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4fee\u6b63\u524d\u306b\u5024\u3092\u78ba\u8a8d\u3067\u304d\u308b\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#5-azure-cli-debug","title":"\u30c6\u30af\u30cb\u30c3\u30af5: Azure CLI Debug","text":"<pre><code># Azure CLI Debug Mode\naz login --debug\n\n# \u8a73\u7d30\u30ed\u30b0\naz group list --debug\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#7","title":"7. \u3088\u304f\u3042\u308b\u8cea\u554f\u3068\u56de\u7b54","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#q1-terraform","title":"Q1: Terraform\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4e0a\u3052\u305f\u3044","text":"<p>\u8cea\u554f\uff1a <pre><code>Terraform 1.12\u304b\u30891.13\u306b\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3057\u305f\u3044\n</code></pre></p> <p>\u56de\u7b54\uff1a <pre><code># 1. \u30ed\u30fc\u30ab\u30eb\u3067\u30c6\u30b9\u30c8\nterraform version  # \u73fe\u5728: 1.12\n\n# Terraform\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\nbrew upgrade terraform  # macOS\n# \u307e\u305f\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\nterraform version  # \u78ba\u8a8d: 1.13\n\n# 2. terraform.tf\u66f4\u65b0\n# terraform.tf\nterraform {\n  required_version = \"~&gt; 1.13\"  # \u2190\u66f4\u65b0\n}\n\n# 3. \u521d\u671f\u5316\nterraform init -upgrade\n\n# 4. Plan\u78ba\u8a8d\nterraform plan\n\n# 5. \u554f\u984c\u306a\u3051\u308c\u3070Commit\ngit commit -am \"Upgrade Terraform to 1.13\"\n\n# 6. GitHub Actions\u8a2d\u5b9a\u66f4\u65b0\n# .github/workflows/ci.yaml\nterraform_cli_version: '1.13.0'  # \u2190\u66f4\u65b0\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#q2-terraform","title":"Q2: \u30ea\u30bd\u30fc\u30b9\u3092Terraform\u306e\u7ba1\u7406\u4e0b\u304b\u3089\u5916\u3057\u305f\u3044","text":"<p>\u8cea\u554f\uff1a <pre><code>\u65e2\u5b58\u306eResource Group\u3092\u524a\u9664\u305b\u305a\u306b\u3001Terraform\u306e\u7ba1\u7406\u304b\u3089\u5916\u3057\u305f\u3044\n</code></pre></p> <p>\u56de\u7b54\uff1a <pre><code># 1. State\u304b\u3089\u524a\u9664\nterraform state rm azurerm_resource_group.example\n\n# 2. .tf\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u524a\u9664\n# main.tf \u304b\u3089\u8a72\u5f53\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\n\n# 3. Plan\u78ba\u8a8d\uff08\u524a\u9664\u3055\u308c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\uff09\nterraform plan\n# \"No changes\" \u3068\u8868\u793a\u3055\u308c\u308b\n\n# \u30ea\u30bd\u30fc\u30b9\u306fAzure\u4e0a\u306b\u6b8b\u308b\n# Terraform\u306e\u7ba1\u7406\u304b\u3089\u5916\u308c\u305f\u3060\u3051\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#q3-terraformimport","title":"Q3: \u65e2\u5b58\u306e\u30ea\u30bd\u30fc\u30b9\u3092Terraform\u306bImport\u3057\u305f\u3044","text":"<p>\u8cea\u554f\uff1a <pre><code>\u624b\u52d5\u3067\u4f5c\u3063\u305fResource Group\u3092Terraform\u3067\u7ba1\u7406\u3057\u305f\u3044\n</code></pre></p> <p>\u56de\u7b54\uff1a <pre><code># 1. .tf\u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u8ffd\u52a0\n# main.tf\nresource \"azurerm_resource_group\" \"imported\" {\n  name     = \"rg-existing\"\n  location = \"japaneast\"\n}\n\n# 2. Import\nterraform import azurerm_resource_group.imported /subscriptions/&lt;SUB_ID&gt;/resourceGroups/rg-existing\n\n# 3. Plan\u78ba\u8a8d\nterraform plan\n# \u5dee\u5206\u304c\u3042\u308c\u3070\u8abf\u6574\n\n# 4. Apply\nterraform apply\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#q4","title":"Q4: \u30b3\u30b9\u30c8\u3092\u524a\u6e1b\u3057\u305f\u3044","text":"<p>\u8cea\u554f\uff1a <pre><code>\u958b\u767a\u74b0\u5883\u3067\u30b3\u30b9\u30c8\u3092\u6291\u3048\u305f\u3044\n</code></pre></p> <p>\u56de\u7b54\uff1a <pre><code># \u9ad8\u984d\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u7121\u52b9\u5316\nhub_virtual_networks = {\n  primary = {\n    enabled_resources = {\n      firewall                              = false  # \u7d0417\u4e07\u5186/\u6708\n      bastion                               = false  # \u7d042.7\u4e07\u5186/\u6708\n      virtual_network_gateway_express_route = false\n      virtual_network_gateway_vpn           = false  # \u7d044\u4e07\u5186/\u6708\n      private_dns_zones                     = true   # \u7121\u6599\n      private_dns_resolver                  = false\n    }\n  }\n}\n\nhub_and_spoke_networks_settings = {\n  enabled_resources = {\n    ddos_protection_plan = false  # \u7d0440\u4e07\u5186/\u6708\n  }\n}\n\n# \u30de\u30eb\u30c1\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u5358\u4e00\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\n# secondary \u306f\u524a\u9664\n</code></pre></p> <p>\u524a\u6e1b\u3067\u304d\u308b\u30b3\u30b9\u30c8\uff1a <pre><code>Firewall: 17\u4e07\u5186\nVPN Gateway: 4\u4e07\u5186\nBastion: 2.7\u4e07\u5186\nDDoS: 40\u4e07\u5186\n--------------\n\u5408\u8a08: \u7d0464\u4e07\u5186/\u6708 \u2192 \u307b\u307c0\u5186\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#q5-github-actions","title":"Q5: \u30ed\u30fc\u30ab\u30eb\u3068GitHub Actions\u3067\u7d50\u679c\u304c\u9055\u3046","text":"<p>\u8cea\u554f\uff1a <pre><code>\u30ed\u30fc\u30ab\u30eb\u3067\u306fplan\u304c\u901a\u308b\u306e\u306b\u3001GitHub Actions\u3067\u30a8\u30e9\u30fc\n</code></pre></p> <p>\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ol> <li> <p>Terraform\u30d0\u30fc\u30b8\u30e7\u30f3\uff1a <pre><code># \u30ed\u30fc\u30ab\u30eb\nterraform version\n\n# GitHub Actions\n# .github/workflows/ci.yaml\nterraform_cli_version: '1.12.0'  # \u2190\u3053\u308c\u3068\u4e00\u81f4\u3055\u305b\u308b\n</code></pre></p> </li> <li> <p>\u74b0\u5883\u5909\u6570\uff1a <pre><code># \u30ed\u30fc\u30ab\u30eb\nenv | grep ARM_\n\n# GitHub Actions\n# Secrets\u304c\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u304b\u78ba\u8a8d\n</code></pre></p> </li> <li> <p>\u6a29\u9650\uff1a <pre><code># \u30ed\u30fc\u30ab\u30eb: \u30e6\u30fc\u30b6\u30fc\u306e\u6a29\u9650\naz account show\n\n# GitHub Actions: Service Principal\u306e\u6a29\u9650\naz role assignment list --assignee $APP_ID\n</code></pre></p> </li> </ol>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#_2","title":"\u30a8\u30e9\u30fc\u767a\u751f\u6642\u306e\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#1_1","title":"\u30b9\u30c6\u30c3\u30d71: \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u3080","text":"<pre><code>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6700\u521d\u306e1\u301c2\u884c\n  \u2193\n\u30a8\u30e9\u30fc\u306e\u7a2e\u985e\u304c\u308f\u304b\u308b\n</code></pre> <p>\u4f8b\uff1a <pre><code>Error: Error acquiring the state lock\n\u2192 State Lock\u554f\u984c\n\nError: insufficient privileges\n\u2192 \u6a29\u9650\u554f\u984c\n\nError: zones - availability zones are not supported\n\u2192 Region\u554f\u984c\n</code></pre></p>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#2","title":"\u30b9\u30c6\u30c3\u30d72: \u30ed\u30b0\u3092\u78ba\u8a8d","text":"<pre><code># Terraform\u5b9f\u884c\u30ed\u30b0\nterraform plan 2&gt;&amp;1 | tee terraform.log\n\n# GitHub Actions\nActions \u2192 \u5931\u6557\u3057\u305f\u30ef\u30fc\u30af\u30d5\u30ed\u30fc \u2192 Details\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#3-state","title":"\u30b9\u30c6\u30c3\u30d73: State\u78ba\u8a8d","text":"<pre><code># State\u4e00\u89a7\nterraform state list\n\n# \u7279\u5b9a\u306e\u30ea\u30bd\u30fc\u30b9\u78ba\u8a8d\nterraform state show azurerm_resource_group.example\n\n# State\u5168\u4f53\nterraform show\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#4-azure","title":"\u30b9\u30c6\u30c3\u30d74: Azure\u78ba\u8a8d","text":"<pre><code># \u30ea\u30bd\u30fc\u30b9\u78ba\u8a8d\naz resource list --output table\n\n# Resource Group\u78ba\u8a8d\naz group list --output table\n\n# Management Group\u78ba\u8a8d\naz account management-group list --output table\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#5_1","title":"\u30b9\u30c6\u30c3\u30d75: \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u78ba\u8a8d","text":"<pre><code>Terraform Azure Provider:\nhttps://registry.terraform.io/providers/hashicorp/azurerm/latest/docs\n\nAzure CLI:\nhttps://docs.microsoft.com/cli/azure/\n\n\u30e2\u30b8\u30e5\u30fc\u30eb:\nhttps://registry.terraform.io/modules/Azure/...\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#6_1","title":"\u30b9\u30c6\u30c3\u30d76: \u5207\u308a\u5206\u3051","text":"<pre><code># \u6700\u5c0f\u69cb\u6210\u3067\u30c6\u30b9\u30c8\n# test.tf\nresource \"azurerm_resource_group\" \"test\" {\n  name     = \"rg-test\"\n  location = \"japaneast\"\n}\n\nterraform plan\n\n# \u554f\u984c\u306a\u3051\u308c\u3070\u3001\u5c11\u3057\u305a\u3064\u8ffd\u52a0\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#_3","title":"\u4e88\u9632\u7b56\uff08\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\uff09","text":""},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#1-pr","title":"1. \u30ed\u30fc\u30ab\u30eb\u3067\u78ba\u8a8d\u3057\u3066\u304b\u3089PR","text":"<pre><code>\u30b3\u30fc\u30c9\u5909\u66f4\n  \u2193\n\u30ed\u30fc\u30ab\u30eb\u3067terraform plan\n  \u2193\n\u554f\u984c\u306a\u3051\u308c\u3070Commit\n  \u2193\nPR\u4f5c\u6210\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#2_1","title":"2. \u5c0f\u3055\u3044\u5909\u66f4\u3092\u983b\u7e41\u306b","text":"<pre><code>\u5927\u91cf\u306e\u5909\u66f4\u3092\u4e00\u5ea6\u306bCommit\n  \u2193\n\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u3068\u304d\u306e\u539f\u56e0\u7279\u5b9a\u304c\u5927\u5909\n\n\u5c0f\u3055\u3044\u5909\u66f4\u3092\u983b\u7e41\u306bCommit\n  \u2193\n\u30a8\u30e9\u30fc\u306e\u539f\u56e0\u304c\u3059\u3050\u308f\u304b\u308b\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#3_1","title":"3. \u672c\u756a\u3068\u958b\u767a\u3092\u5206\u3051\u308b","text":"<pre><code>\u958b\u767a\u74b0\u5883\uff1a\n- \u6c17\u8efd\u306b\u8a66\u3059\n- \u5931\u6557OK\n\n\u672c\u756a\u74b0\u5883\uff1a\n- \u614e\u91cd\u306b\u30c7\u30d7\u30ed\u30a4\n- \u30ec\u30d3\u30e5\u30fc\u5fc5\u9808\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#4","title":"4. \u30d0\u30c3\u30af\u30a2\u30c3\u30d7","text":"<pre><code># State File\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nterraform state pull &gt; state-backup.json\n\n# \u5b9a\u671f\u7684\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u53d6\u5f97\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#5_2","title":"5. \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5316","text":"<pre><code>\u4f55\u304b\u554f\u984c\u304c\u8d77\u304d\u305f\u3089\uff1a\n- \u539f\u56e0\n- \u5bfe\u51e6\u6cd5\n- \u518d\u767a\u9632\u6b62\u7b56\n\u3092\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u6b8b\u3059\n</code></pre>"},{"location":"14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/#_4","title":"\u307e\u3068\u3081","text":"<p>\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u6d41\u308c\uff1a <pre><code>1. \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u3080\n2. \u30ed\u30b0\u3092\u78ba\u8a8d\n3. State\u78ba\u8a8d\n4. Azure\u78ba\u8a8d\n5. \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u78ba\u8a8d\n6. \u5207\u308a\u5206\u3051\n7. \u89e3\u6c7a\n</code></pre></p> <p>\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc\uff1a - OIDC\u8a8d\u8a3c\uff1aFederated Credential\u8a2d\u5b9a - State Lock\uff1a\u524d\u56de\u306e\u5b9f\u884c\u304c\u6b8b\u3063\u3066\u308b - \u6a29\u9650\uff1aService Principal\u306bOwner\u4ed8\u4e0e - Zones\uff1aJapan region\u306f\u7a7a\u30ea\u30b9\u30c8 - Timeout\uff1aFirewall\u4f5c\u6210\u306f\u6642\u9593\u304b\u304b\u308b</p> <p>\u30c7\u30d0\u30c3\u30b0\u30c4\u30fc\u30eb\uff1a - <code>TF_LOG=DEBUG</code>\uff1a\u8a73\u7d30\u30ed\u30b0 - <code>terraform console</code>\uff1a\u5909\u6570\u78ba\u8a8d - <code>terraform graph</code>\uff1a\u4f9d\u5b58\u95a2\u4fc2\u53ef\u8996\u5316 - <code>terraform state show</code>\uff1aState\u78ba\u8a8d</p> <p>\u6b21\u306eChapter\u3067\u306f\u3001\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u65b9\u6cd5\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u81ea\u5206\u306e\u7d44\u7e54\u306b\u5408\u308f\u305b\u305f\u5909\u66f4\u65b9\u6cd5\u3092\u89e3\u8aac\u3059\u308b\u3088\u3002</p> <p>\u6240\u8981\u6642\u9593: 55\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2606 \u524d: 13_\u30c7\u30d7\u30ed\u30a4\u624b\u9806.md \u6b21: 15_\u30ab\u30b9\u30bf\u30de\u30a4\u30ba.md</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/","title":"15. \u30ab\u30b9\u30bf\u30de\u30a4\u30ba - \u81ea\u5206\u306e\u7d44\u7e54\u306b\u5408\u308f\u305b\u308b","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>Azure Landing Zones\u3092\u81ea\u5206\u306e\u7d44\u7e54\u306b\u5408\u308f\u305b\u3066\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3088\u3046\u3002</p> <p>\u30c7\u30d5\u30a9\u30eb\u30c8\u69cb\u6210\uff1a <pre><code>Microsoft\u63a8\u5968\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\n  \u2193\n\u3067\u3082\u5168\u3066\u306e\u7d44\u7e54\u306b\u5b8c\u74a7\u306b\u5408\u3046\u308f\u3051\u3058\u3083\u306a\u3044\n</code></pre></p> <p>\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3067\uff1a <pre><code>- Management Group\u69cb\u9020\u3092\u5909\u3048\u308b\n- \u30dd\u30ea\u30b7\u30fc\u3092\u8ffd\u52a0\u30fb\u524a\u9664\n- \u547d\u540d\u898f\u5247\u3092\u5909\u3048\u308b\n- \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u3092\u8abf\u6574\n</code></pre></p> <p>\u3053\u306eChapter\u3067\u5b66\u3076\u3053\u3068\uff1a - lib\u30d5\u30a9\u30eb\u30c0\u306e\u4f7f\u3044\u65b9 - Management Group\u69cb\u9020\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba - \u30dd\u30ea\u30b7\u30fc\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba - \u547d\u540d\u898f\u5247\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#part-1-lib","title":"Part 1: lib\u30d5\u30a9\u30eb\u30c0\u306e\u69cb\u9020","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_1","title":"\u30d5\u30a1\u30a4\u30eb\u69cb\u6210","text":"<pre><code>lib/\n\u251c\u2500\u2500 alz_library_metadata.json\n\u251c\u2500\u2500 archetype_definitions/\n\u2502   \u251c\u2500\u2500 connectivity_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 corp_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 decommissioned_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 identity_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 landing_zones_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 management_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 online_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 platform_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 root_custom.alz_archetype_override.yaml\n\u2502   \u251c\u2500\u2500 sandbox_custom.alz_archetype_override.yaml\n\u2502   \u2514\u2500\u2500 security_custom.alz_archetype_override.yaml\n\u2514\u2500\u2500 architecture_definitions/\n    \u2514\u2500\u2500 alz_custom.alz_architecture_definition.yaml\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_2","title":"\u5404\u30d5\u30a1\u30a4\u30eb\u306e\u5f79\u5272","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#architecture_definitions","title":"architecture_definitions\uff08\u69cb\u9020\u5b9a\u7fa9\uff09","text":"<p>alz_custom.alz_architecture_definition.yaml\uff1a <pre><code>Management Group\u306e\u968e\u5c64\u69cb\u9020\u3092\u5b9a\u7fa9\n</code></pre></p> <p>\u5185\u5bb9\uff1a <pre><code>name: alz_custom\nmanagement_groups:\n  - id: alz\n    display_name: Azure Landing Zones\n    archetypes:\n      - root_custom\n    parent_id: null\n\n  - id: platform\n    display_name: Platform\n    parent_id: alz\n\n  - id: landingzones\n    display_name: Landing Zones\n    parent_id: alz\n\n  ...\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#archetype_definitions","title":"archetype_definitions\uff08\u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\uff09","text":"<p>root_custom.alz_archetype_override.yaml\uff1a <pre><code>\u5404Management Group\u306b\u9069\u7528\u3059\u308b\u30dd\u30ea\u30b7\u30fc\u3092\u5b9a\u7fa9\n</code></pre></p> <p>\u5185\u5bb9\uff1a <pre><code>base_archetype: root\nname: root_custom\npolicy_assignments_to_add: []      # \u8ffd\u52a0\u3059\u308b\u30dd\u30ea\u30b7\u30fc\npolicy_assignments_to_remove: []   # \u524a\u9664\u3059\u308b\u30dd\u30ea\u30b7\u30fc\npolicy_definitions_to_add: []      # \u30ab\u30b9\u30bf\u30e0\u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\npolicy_set_definitions_to_add: []  # \u30ab\u30b9\u30bf\u30e0\u30dd\u30ea\u30b7\u30fc\u30bb\u30c3\u30c8\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#part-2-management-group","title":"Part 2: Management Group\u69cb\u9020\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#1-management-group","title":"\u30b1\u30fc\u30b91: Management Group\u3092\u8ffd\u52a0","text":"<p>\u4f8b\uff1a\u300cDevelopment\u300dManagement Group\u3092\u8ffd\u52a0\u3057\u305f\u3044</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#step-1-architecture_definitions","title":"Step 1: architecture_definitions\u306b\u8ffd\u52a0","text":"<p>lib/architecture_definitions/alz_custom.alz_architecture_definition.yaml\uff1a</p> <pre><code>management_groups:\n  # ...\u65e2\u5b58\u306eManagement Groups...\n\n  - id: development\n    display_name: Development\n    archetypes:\n      - development_custom\n    exists: false\n    parent_id: landingzones  # Landing Zones\u306e\u4e0b\u306b\u914d\u7f6e\n</code></pre> <p>\u968e\u5c64\u69cb\u9020\uff1a <pre><code>alz\n\u251c\u2500\u2500 platform\n\u251c\u2500\u2500 landingzones\n\u2502   \u251c\u2500\u2500 corp\n\u2502   \u251c\u2500\u2500 online\n\u2502   \u2514\u2500\u2500 development  # \u2190\u65b0\u898f\u8ffd\u52a0\n\u251c\u2500\u2500 sandbox\n\u2514\u2500\u2500 decommissioned\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#step-2-archetype_definitions","title":"Step 2: archetype_definitions\u3092\u4f5c\u6210","text":"<p>lib/archetype_definitions/development_custom.alz_archetype_override.yaml\uff1a</p> <pre><code>base_archetype: landing_zones\nname: development_custom\n\n# \u958b\u767a\u74b0\u5883\u7528\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\npolicy_assignments_to_add: []\n\n# \u672c\u756a\u74b0\u5883\u5411\u3051\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u524a\u9664\uff08\u7de9\u3081\u308b\uff09\npolicy_assignments_to_remove:\n  - Deploy-SQL-TDE          # \u6697\u53f7\u5316\u306f\u958b\u767a\u74b0\u5883\u3067\u306f\u4e0d\u8981\n  - Deploy-SQL-minTLS       # TLS\u6700\u5c0f\u30d0\u30fc\u30b8\u30e7\u30f3\u5f37\u5236\u3082\u7de9\u548c\n  - Deny-Subnet-Without-Nsg # NSG\u5fc5\u9808\u3082\u7de9\u548c\uff08\u30c6\u30b9\u30c8\u7528\uff09\n\npolicy_definitions_to_add: []\npolicy_set_definitions_to_add: []\nrole_definitions_to_add: []\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#step-3","title":"Step 3: \u30c7\u30d7\u30ed\u30a4","text":"<pre><code># Plan\u78ba\u8a8d\nterraform plan\n\n# Apply\nterraform apply\n</code></pre> <p>\u7d50\u679c\uff1a <pre><code>Development Management Group\u304c\u4f5c\u6210\u3055\u308c\u308b\n  \u2193\n\u30dd\u30ea\u30b7\u30fc\u304c\u7de9\u3044\uff08\u958b\u767a\u3057\u3084\u3059\u3044\uff09\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#2-management-group","title":"\u30b1\u30fc\u30b92: Management Group\u3092\u524a\u9664","text":"<p>\u4f8b\uff1a\u300cSandbox\u300d\u306f\u4f7f\u308f\u306a\u3044</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#step-1-architecture_definitions_1","title":"Step 1: architecture_definitions\u304b\u3089\u524a\u9664","text":"<p>lib/architecture_definitions/alz_custom.alz_architecture_definition.yaml\uff1a</p> <pre><code>management_groups:\n  # ...\n\n  # Sandbox\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u307e\u305f\u306f\u524a\u9664\n  # - id: sandbox\n  #   display_name: Sandbox\n  #   archetypes:\n  #     - sandbox_custom\n  #   exists: false\n  #   parent_id: alz\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#step-2","title":"Step 2: \u30c7\u30d7\u30ed\u30a4","text":"<pre><code>terraform plan\n# \u300csandbox\u300dManagement Group\u304c\u524a\u9664\u3055\u308c\u308b\n\nterraform apply\n</code></pre> <p>\u6ce8\u610f\uff1a <pre><code>Management Group\u306b\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u304c\u3042\u308b\u5834\u5408\u306f\u524a\u9664\u3067\u304d\u306a\u3044\n  \u2193\n\u5148\u306b\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u79fb\u52d5\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#3","title":"\u30b1\u30fc\u30b93: \u968e\u5c64\u69cb\u9020\u3092\u5909\u66f4","text":"<p>\u4f8b\uff1a\u300cSecurity\u300d\u3092\u300cPlatform\u300d\u306e\u4e0b\u304b\u3089\u300cRoot\u300d\u306e\u76f4\u4e0b\u306b\u79fb\u52d5</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#before","title":"Before:","text":"<pre><code>alz\n\u2514\u2500\u2500 platform\n    \u2514\u2500\u2500 security  # \u2190\u3053\u3053\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#after","title":"After:","text":"<pre><code>alz\n\u251c\u2500\u2500 platform\n\u2514\u2500\u2500 security  # \u2190\u3053\u3053\u306b\u79fb\u52d5\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_3","title":"\u5909\u66f4:","text":"<p>lib/architecture_definitions/alz_custom.alz_architecture_definition.yaml\uff1a</p> <pre><code>- id: security\n  display_name: Security\n  archetypes:\n    - security_custom\n  exists: false\n  parent_id: alz  # platform \u2192 alz \u306b\u5909\u66f4\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#part-3","title":"Part 3: \u30dd\u30ea\u30b7\u30fc\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#1","title":"\u30b1\u30fc\u30b91: \u65e2\u5b58\u30dd\u30ea\u30b7\u30fc\u3092\u524a\u9664","text":"<p>\u4f8b\uff1a\u300c\u8a31\u53ef\u3055\u308c\u305f\u30ea\u30fc\u30b8\u30e7\u30f3\u4ee5\u5916\u62d2\u5426\u300d\u30dd\u30ea\u30b7\u30fc\u3092\u524a\u9664</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_4","title":"\u7406\u7531:","text":"<pre><code>\u958b\u767a\u74b0\u5883\u3067\u8272\u3005\u306a\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u8a66\u3057\u305f\u3044\n  \u2193\n\u3067\u3082\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u30ea\u30fc\u30b8\u30e7\u30f3\u5236\u9650\u304c\u3042\u308b\n  \u2193\n\u524a\u9664\u3057\u3066\u81ea\u7531\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_5","title":"\u624b\u9806:","text":"<p>lib/archetype_definitions/landing_zones_custom.alz_archetype_override.yaml\uff1a</p> <pre><code>base_archetype: landing_zones\nname: landing_zones_custom\n\npolicy_assignments_to_add: []\n\npolicy_assignments_to_remove:\n  - Deny-Resources-Locations  # \u2190\u30ea\u30fc\u30b8\u30e7\u30f3\u5236\u9650\u30dd\u30ea\u30b7\u30fc\u3092\u524a\u9664\n\npolicy_definitions_to_add: []\npolicy_set_definitions_to_add: []\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#2","title":"\u30b1\u30fc\u30b92: \u30ab\u30b9\u30bf\u30e0\u30dd\u30ea\u30b7\u30fc\u3092\u8ffd\u52a0","text":"<p>\u4f8b\uff1a\u300c\u7279\u5b9a\u306e\u30bf\u30b0\u304c\u306a\u3044\u30ea\u30bd\u30fc\u30b9\u3092\u62d2\u5426\u300d\u30dd\u30ea\u30b7\u30fc</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_6","title":"\u624b\u9806:","text":"<p>lib/archetype_definitions/corp_custom.alz_archetype_override.yaml\uff1a</p> <pre><code>base_archetype: corp\nname: corp_custom\n\npolicy_assignments_to_add:\n  - Deny-Resources-Without-Required-Tags  # \u2190\u8ffd\u52a0\n\npolicy_definitions_to_add:\n  - name: Deny-Resources-Without-Required-Tags\n    display_name: \"Require specific tags on resources\"\n    description: \"Enforce required tags on all resources\"\n    mode: \"Indexed\"\n    metadata:\n      category: \"Tags\"\n\n    parameters:\n      tagName:\n        type: \"String\"\n        metadata:\n          displayName: \"Tag Name\"\n          description: \"Name of the tag, such as 'CostCenter'\"\n\n      tagValue:\n        type: \"Array\"\n        metadata:\n          displayName: \"Allowed Tag Values\"\n          description: \"List of allowed values for the tag\"\n\n    policy_rule:\n      if:\n        anyOf:\n          - field: \"[concat('tags[', parameters('tagName'), ']')]\"\n            exists: false\n          - field: \"[concat('tags[', parameters('tagName'), ']')]\"\n            notIn: \"[parameters('tagValue')]\"\n      then:\n        effect: \"deny\"\n\npolicy_set_definitions_to_add: []\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#assignment","title":"Assignment\u3082\u8ffd\u52a0:","text":"<p>\u540c\u3058\u30d5\u30a1\u30a4\u30eb\u306b\u8ffd\u52a0\uff1a</p> <pre><code>policy_assignments_to_add:\n  - assignment_name: Deny-Resources-Without-Required-Tags\n    assignment_display_name: \"Require CostCenter tag\"\n    assignment_description: \"All resources must have a valid CostCenter tag\"\n    assignment_effect: \"deny\"\n    assignment_parameters:\n      tagName: \"CostCenter\"\n      tagValue:\n        - \"1000\"\n        - \"2000\"\n        - \"3000\"\n    assignment_enforcement_mode: \"Default\"\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#3_1","title":"\u30b1\u30fc\u30b93: \u30dd\u30ea\u30b7\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5909\u66f4","text":"<p>\u4f8b\uff1a\u300c\u8a31\u53ef\u3055\u308c\u305fVM SKU\u300d\u3092\u5909\u66f4</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_7","title":"\u30c7\u30d5\u30a9\u30eb\u30c8:","text":"<pre><code>Standard_B2s, Standard_D2s_v3 \u306e\u307f\u8a31\u53ef\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_8","title":"\u5909\u66f4\u5f8c:","text":"<pre><code>Standard_B2s, Standard_D2s_v3, Standard_D4s_v3 \u3082\u8a31\u53ef\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_9","title":"\u624b\u9806:","text":"<p>lib/archetype_definitions/corp_custom.alz_archetype_override.yaml\uff1a</p> <pre><code>policy_assignments_to_add:\n  - assignment_name: Deny-VM-SKUs\n    assignment_parameters:\n      listOfAllowedSKUs:\n        - \"Standard_B2s\"\n        - \"Standard_D2s_v3\"\n        - \"Standard_D4s_v3\"  # \u2190\u8ffd\u52a0\n        - \"Standard_E4s_v3\"  # \u2190\u8ffd\u52a0\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#part-4","title":"Part 4: \u547d\u540d\u898f\u5247\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_10","title":"\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u547d\u540d\u898f\u5247","text":"<p>terraform.tfvars.json\uff1a <pre><code>{\n  \"resource_group_name_prefix\": \"rg\",\n  \"virtual_network_name_prefix\": \"vnet\",\n  \"subnet_name_prefix\": \"snet\",\n  \"network_security_group_name_prefix\": \"nsg\"\n}\n</code></pre></p> <p>\u7d50\u679c\uff1a <pre><code>rg-myorg-management-001\nvnet-myorg-jpe-hub\nsnet-firewall\nnsg-web-001\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_11","title":"\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u4f8b","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#1_1","title":"\u4f8b1: \u74b0\u5883\u540d\u3092\u5148\u982d\u306b","text":"<p>\u671b\u307e\u3057\u3044\u5f62\uff1a <pre><code>prd-rg-myorg-management-001  # \u2190\u672c\u756a\ndev-rg-myorg-management-001  # \u2190\u958b\u767a\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#localstf","title":"locals.tf\u306b\u8ffd\u52a0:","text":"<pre><code>locals {\n  environment_prefix = var.environment  # \"prd\" or \"dev\"\n\n  resource_group_name = format(\n    \"%s-rg-%s-%s-%s\",\n    local.environment_prefix,\n    var.root_id,\n    var.resource_type,\n    var.default_postfix\n  )\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_12","title":"\u5909\u6570\u8ffd\u52a0:","text":"<p>variables.tf\uff1a <pre><code>variable \"environment\" {\n  type        = string\n  description = \"Environment name (prd, stg, dev)\"\n  default     = \"prd\"\n\n  validation {\n    condition     = contains([\"prd\", \"stg\", \"dev\"], var.environment)\n    error_message = \"Environment must be prd, stg, or dev.\"\n  }\n}\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#terraformtfvarsjson","title":"terraform.tfvars.json\u306b\u8a2d\u5b9a:","text":"<pre><code>{\n  \"environment\": \"prd\"\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#2_1","title":"\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u4f8b2: \u30ea\u30fc\u30b8\u30e7\u30f3\u540d\u3092\u7701\u7565\u5f62\u306b","text":"<p>\u30c7\u30d5\u30a9\u30eb\u30c8\uff1a <pre><code>vnet-myorg-japaneast-hub  # \u2190\u9577\u3044\n</code></pre></p> <p>\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u5f8c\uff1a <pre><code>vnet-myorg-jpe-hub  # \u2190\u77ed\u3044\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#localstf_1","title":"locals.tf\u306b\u8ffd\u52a0:","text":"<pre><code>locals {\n  region_abbreviations = {\n    \"japaneast\"  = \"jpe\"\n    \"japanwest\"  = \"jpw\"\n    \"eastus\"     = \"eus\"\n    \"westus\"     = \"wus\"\n    \"westeurope\" = \"weu\"\n  }\n\n  region_abbr = lookup(\n    local.region_abbreviations,\n    var.default_location,\n    substr(var.default_location, 0, 3)  # \u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\n  )\n\n  hub_vnet_name = format(\n    \"vnet-%s-%s-hub\",\n    var.root_id,\n    local.region_abbr\n  )\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#part-5","title":"Part 5: \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#1_2","title":"\u30b1\u30fc\u30b91: \u30ab\u30b9\u30bf\u30e0\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8ffd\u52a0","text":"<p>\u4f8b\uff1aApplication Gateway\u7528\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8ffd\u52a0</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#platform-landing-zoneautotfvars","title":"platform-landing-zone.auto.tfvars\u306b\u8ffd\u52a0:","text":"<pre><code>hub_virtual_networks = {\n  primary = {\n    hub_virtual_network = {\n      name          = \"vnet-myorg-jpe-hub\"\n      address_space = [\"10.0.0.0/16\"]\n\n      subnets = {\n        appgw = {\n          name             = \"snet-appgw\"\n          address_prefixes = [\"10.0.10.0/24\"]\n        }\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#2-firewall","title":"\u30b1\u30fc\u30b92: Firewall\u30eb\u30fc\u30eb\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","text":"<p>\u4f8b\uff1a\u7279\u5b9a\u306eFQDN\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#firewall-rulestf","title":"\u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210: firewall-rules.tf","text":"<pre><code>resource \"azurerm_firewall_policy_rule_collection_group\" \"custom\" {\n  name               = \"custom-rules\"\n  firewall_policy_id = module.hub_and_spoke_vnet[0].firewall_policy[\"primary\"].id\n  priority           = 100\n\n  application_rule_collection {\n    name     = \"allow-microsoft-services\"\n    priority = 100\n    action   = \"Allow\"\n\n    rule {\n      name = \"allow-azure-portal\"\n      protocols {\n        type = \"Https\"\n        port = 443\n      }\n      source_addresses = [\"*\"]\n      destination_fqdns = [\n        \"*.azure.com\",\n        \"*.microsoft.com\",\n        \"*.windows.net\"\n      ]\n    }\n\n    rule {\n      name = \"allow-github\"\n      protocols {\n        type = \"Https\"\n        port = 443\n      }\n      source_addresses = [\"*\"]\n      destination_fqdns = [\n        \"*.github.com\",\n        \"*.githubusercontent.com\"\n      ]\n    }\n  }\n\n  network_rule_collection {\n    name     = \"allow-ntp\"\n    priority = 200\n    action   = \"Allow\"\n\n    rule {\n      name                  = \"allow-ntp\"\n      protocols             = [\"UDP\"]\n      source_addresses      = [\"*\"]\n      destination_addresses = [\"*\"]\n      destination_ports     = [\"123\"]\n    }\n  }\n\n  depends_on = [module.hub_and_spoke_vnet]\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#3-spoke-vnet","title":"\u30b1\u30fc\u30b93: \u8ffd\u52a0\u306eSpoke VNet\u3092\u4f5c\u6210","text":"<p>\u4f8b\uff1a\u672c\u756a\u7528\u3068DR\u7528\u306eSpoke VNet</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#spoke-vnetstf","title":"spoke-vnets.tf:","text":"<pre><code># \u672c\u756a\u7528Spoke VNet\nresource \"azurerm_virtual_network\" \"spoke_production\" {\n  name                = \"vnet-myorg-spoke-prd\"\n  location            = \"japaneast\"\n  resource_group_name = azurerm_resource_group.spoke_production.name\n  address_space       = [\"10.1.0.0/16\"]\n\n  tags = {\n    Environment = \"Production\"\n    CostCenter  = \"1000\"\n  }\n}\n\nresource \"azurerm_resource_group\" \"spoke_production\" {\n  name     = \"rg-myorg-spoke-prd\"\n  location = \"japaneast\"\n}\n\n# Hub\u3068\u306e\u30d4\u30a2\u30ea\u30f3\u30b0\uff08Production \u2192 Hub\uff09\nresource \"azurerm_virtual_network_peering\" \"spoke_prd_to_hub\" {\n  name                      = \"peer-spoke-prd-to-hub\"\n  resource_group_name       = azurerm_resource_group.spoke_production.name\n  virtual_network_name      = azurerm_virtual_network.spoke_production.name\n  remote_virtual_network_id = module.hub_and_spoke_vnet[0].hub_virtual_networks[\"primary\"].virtual_network.resource_id\n\n  allow_virtual_network_access = true\n  allow_forwarded_traffic      = true\n  allow_gateway_transit        = false\n  use_remote_gateways          = false\n}\n\n# Hub \u2192 Production\nresource \"azurerm_virtual_network_peering\" \"hub_to_spoke_prd\" {\n  name                      = \"peer-hub-to-spoke-prd\"\n  resource_group_name       = \"rg-myorg-connectivity-001\"\n  virtual_network_name      = \"vnet-myorg-jpe-hub\"\n  remote_virtual_network_id = azurerm_virtual_network.spoke_production.id\n\n  allow_virtual_network_access = true\n  allow_forwarded_traffic      = true\n  allow_gateway_transit        = true\n  use_remote_gateways          = false\n\n  depends_on = [module.hub_and_spoke_vnet]\n}\n\n# DR\u7528Spoke VNet\uff08\u540c\u69d8\u306b\u4f5c\u6210\uff09\nresource \"azurerm_virtual_network\" \"spoke_dr\" {\n  name                = \"vnet-myorg-spoke-dr\"\n  location            = \"japanwest\"  # DR\u7528\u306f\u5225\u30ea\u30fc\u30b8\u30e7\u30f3\n  resource_group_name = azurerm_resource_group.spoke_dr.name\n  address_space       = [\"10.2.0.0/16\"]\n\n  tags = {\n    Environment = \"DR\"\n    CostCenter  = \"1000\"\n  }\n}\n\n# ...\u30d4\u30a2\u30ea\u30f3\u30b0\u8a2d\u5b9a\u3082\u540c\u69d8...\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#part-6","title":"Part 6: \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u914d\u7f6e\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_13","title":"\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a","text":"<p>platform-landing-zone.auto.tfvars\uff1a <pre><code>subscription_id_management  = \"&lt;SUB_ID_1&gt;\"\nsubscription_id_identity    = \"&lt;SUB_ID_2&gt;\"\nsubscription_id_connectivity = \"&lt;SUB_ID_3&gt;\"\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#1_3","title":"\u30ab\u30b9\u30bf\u30de\u30a4\u30ba: 1\u3064\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3067\u5168\u90e8","text":"<p>\u5c0f\u898f\u6a21\u306a\u7d44\u7e54\u306e\u5834\u5408\uff1a <pre><code># \u5168\u90e8\u540c\u3058Subscription ID\nsubscription_id_management  = \"&lt;SINGLE_SUB_ID&gt;\"\nsubscription_id_identity    = \"&lt;SINGLE_SUB_ID&gt;\"\nsubscription_id_connectivity = \"&lt;SINGLE_SUB_ID&gt;\"\n</code></pre></p> <p>\u30e1\u30ea\u30c3\u30c8\uff1a <pre><code>- \u30b3\u30b9\u30c8\u524a\u6e1b\n- \u7ba1\u7406\u304c\u30b7\u30f3\u30d7\u30eb\n</code></pre></p> <p>\u30c7\u30e1\u30ea\u30c3\u30c8\uff1a <pre><code>- \u5206\u96e2\u3067\u304d\u306a\u3044\n- \u6a29\u9650\u7ba1\u7406\u304c\u8907\u96d1\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_14","title":"\u30ab\u30b9\u30bf\u30de\u30a4\u30ba: \u8ffd\u52a0\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u914d\u7f6e","text":"<p>\u4f8b\uff1a\u958b\u767a\u7528\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092Development Management Group\u306b\u914d\u7f6e</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#terraformtfvarsjson_1","title":"terraform.tfvars.json\u306b\u8ffd\u52a0:","text":"<pre><code>{\n  \"subscription_id_development\": \"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#variablestf","title":"variables.tf\u306b\u8ffd\u52a0:","text":"<pre><code>variable \"subscription_id_development\" {\n  type        = string\n  description = \"Subscription ID for Development\"\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#localstfmaintfmanagement-group","title":"locals.tf\u307e\u305f\u306fmain.tf\u3067Management Group\u306b\u914d\u7f6e:","text":"<pre><code>resource \"azurerm_management_group_subscription_association\" \"development\" {\n  management_group_id = \"/providers/Microsoft.Management/managementGroups/${var.root_id}-development\"\n  subscription_id     = \"/subscriptions/${var.subscription_id_development}\"\n\n  depends_on = [module.management_groups]\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#part-7","title":"Part 7: \u30bf\u30b0\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_15","title":"\u30c7\u30d5\u30a9\u30eb\u30c8\u30bf\u30b0","text":"<p>platform-landing-zone.auto.tfvars\uff1a <pre><code>tags = {\n  Environment = \"Production\"\n  ManagedBy   = \"Terraform\"\n}\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_16","title":"\u30ab\u30b9\u30bf\u30de\u30a4\u30ba: \u7d44\u7e54\u56fa\u6709\u306e\u30bf\u30b0\u8ffd\u52a0","text":"<pre><code>tags = {\n  Environment = \"Production\"\n  ManagedBy   = \"Terraform\"\n  CostCenter  = \"1000\"\n  Department  = \"IT\"\n  Owner       = \"platform-team@example.com\"\n  Project     = \"Azure Landing Zones\"\n  Compliance  = \"ISO27001\"\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_17","title":"\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u3054\u3068\u306e\u30bf\u30b0","text":"<pre><code>management_tags = {\n  Environment = \"Management\"\n  Purpose     = \"Logging and Monitoring\"\n}\n\nconnectivity_tags = {\n  Environment = \"Connectivity\"\n  Purpose     = \"Network Hub\"\n}\n\nidentity_tags = {\n  Environment = \"Identity\"\n  Purpose     = \"Active Directory\"\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#part-8","title":"Part 8: \u30ed\u30ae\u30f3\u30b0\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#log-analytics-workspace","title":"Log Analytics Workspace\u306e\u4fdd\u6301\u671f\u9593\u5909\u66f4","text":"<p>\u30c7\u30d5\u30a9\u30eb\u30c8\uff1a30\u65e5</p> <p>\u5909\u66f4\uff1a</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#platform-landing-zoneautotfvars_1","title":"platform-landing-zone.auto.tfvars\u306b\u8ffd\u52a0:","text":"<pre><code>management_resources_settings = {\n  log_analytics_workspace = {\n    retention_in_days = 90  # \u219090\u65e5\u306b\u5ef6\u9577\n  }\n}\n</code></pre> <p>\u30b3\u30b9\u30c8\uff1a <pre><code>30\u65e5: \u7121\u6599\u67a0\n90\u65e5: \u8ffd\u52a0\u6599\u91d1\uff08\u7d040.12\u5186/GB/\u65e5\uff09\n180\u65e5: \u3055\u3089\u306b\u9ad8\u3044\n</code></pre></p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#dcrdata-collection-rule","title":"\u30ab\u30b9\u30bf\u30e0DCR\uff08Data Collection Rule\uff09\u8ffd\u52a0","text":"<p>\u4f8b\uff1a\u7279\u5b9a\u306e\u30ed\u30b0\u3092\u53ce\u96c6</p>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#custom-dcrtf","title":"\u65b0\u898f\u30d5\u30a1\u30a4\u30eb: custom-dcr.tf","text":"<pre><code>resource \"azurerm_monitor_data_collection_rule\" \"custom_logs\" {\n  name                = \"dcr-custom-logs\"\n  resource_group_name = \"rg-myorg-management-001\"\n  location            = \"japaneast\"\n\n  destinations {\n    log_analytics {\n      workspace_resource_id = module.management_resources[0].log_analytics_workspace.id\n      name                  = \"destination-log-analytics\"\n    }\n  }\n\n  data_flow {\n    streams      = [\"Microsoft-Syslog\"]\n    destinations = [\"destination-log-analytics\"]\n  }\n\n  data_sources {\n    syslog {\n      facility_names = [\"*\"]\n      log_levels     = [\"Warning\", \"Error\", \"Critical\"]\n      name           = \"datasource-syslog\"\n    }\n  }\n\n  depends_on = [module.management_resources]\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_18","title":"\u5b9f\u8df5\u4f8b: \u5b8c\u5168\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#3_2","title":"\u4f8b: 3\u74b0\u5883\uff08\u672c\u756a\u3001\u30b9\u30c6\u30fc\u30b8\u30f3\u30b0\u3001\u958b\u767a\uff09\u3092\u5206\u96e2","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#step-1-management-group","title":"Step 1: Management Group\u69cb\u9020","text":"<p>lib/architecture_definitions/alz_custom.alz_architecture_definition.yaml\uff1a</p> <pre><code>management_groups:\n  - id: alz\n    display_name: My Organization\n    archetypes: [root_custom]\n    parent_id: null\n\n  - id: platform\n    display_name: Platform\n    archetypes: [platform_custom]\n    parent_id: alz\n\n  - id: workloads\n    display_name: Workloads\n    archetypes: [landing_zones_custom]\n    parent_id: alz\n\n  - id: production\n    display_name: Production\n    archetypes: [production_custom]\n    parent_id: workloads\n\n  - id: staging\n    display_name: Staging\n    archetypes: [staging_custom]\n    parent_id: workloads\n\n  - id: development\n    display_name: Development\n    archetypes: [development_custom]\n    parent_id: workloads\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#step-2_1","title":"Step 2: \u74b0\u5883\u3054\u3068\u306e\u30dd\u30ea\u30b7\u30fc","text":"<p>lib/archetype_definitions/production_custom.alz_archetype_override.yaml\uff1a</p> <pre><code>base_archetype: landing_zones\nname: production_custom\n\n# \u672c\u756a\u74b0\u5883: \u53b3\u3057\u3044\u30dd\u30ea\u30b7\u30fc\npolicy_assignments_to_add:\n  - Deploy-SQL-TDE          # \u6697\u53f7\u5316\u5fc5\u9808\n  - Deploy-SQL-minTLS       # TLS 1.2\u5fc5\u9808\n  - Deny-Subnet-Without-Nsg # NSG\u5fc5\u9808\n  - Deny-Public-IP          # Public IP\u7981\u6b62\n\npolicy_assignments_to_remove: []\n</code></pre> <p>lib/archetype_definitions/development_custom.alz_archetype_override.yaml\uff1a</p> <pre><code>base_archetype: landing_zones\nname: development_custom\n\n# \u958b\u767a\u74b0\u5883: \u7de9\u3044\u30dd\u30ea\u30b7\u30fc\npolicy_assignments_to_add: []\n\npolicy_assignments_to_remove:\n  - Deploy-SQL-TDE          # \u6697\u53f7\u5316\u4e0d\u8981\n  - Deploy-SQL-minTLS       # TLS\u5236\u9650\u306a\u3057\n  - Deny-Subnet-Without-Nsg # NSG\u306a\u3057OK\n  - Deny-Public-IP          # Public IP\u4f7f\u7528OK\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#step-3_1","title":"Step 3: \u74b0\u5883\u3054\u3068\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af","text":"<p>platform-landing-zone.auto.tfvars\uff1a</p> <pre><code># \u672c\u756a\u7528Hub\nhub_virtual_networks = {\n  production = {\n    location = \"japaneast\"\n\n    enabled_resources = {\n      firewall = true   # Firewall\u6709\u52b9\n      bastion  = true\n      vpn_gateway = true\n    }\n\n    hub_virtual_network = {\n      name          = \"vnet-prd-jpe-hub\"\n      address_space = [\"10.0.0.0/16\"]\n    }\n  }\n\n  # \u958b\u767a\u7528Hub\uff08\u7c21\u6613\u7248\uff09\n  development = {\n    location = \"japaneast\"\n\n    enabled_resources = {\n      firewall = false  # Firewall\u7121\u52b9\uff08\u30b3\u30b9\u30c8\u524a\u6e1b\uff09\n      bastion  = true   # Bastion\u306f\u6709\u52b9\uff08\u4fbf\u5229\uff09\n      vpn_gateway = false\n    }\n\n    hub_virtual_network = {\n      name          = \"vnet-dev-jpe-hub\"\n      address_space = [\"10.10.0.0/16\"]\n    }\n  }\n}\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_19","title":"\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#1_4","title":"1. \u6bb5\u968e\u7684\u306b\u5909\u66f4","text":"<pre><code>\u4e00\u5ea6\u306b\u5168\u90e8\u5909\u66f4\u3057\u306a\u3044\n  \u2193\n1\u3064\u305a\u3064\u5909\u66f4 \u2192 \u30c6\u30b9\u30c8 \u2192 \u6b21\u3078\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#2_2","title":"2. \u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406","text":"<pre><code>lib\u30d5\u30a9\u30eb\u30c0\u306e\u5909\u66f4\u5c65\u6b74\u3092\u6b8b\u3059\n  \u2193\ngit commit -m \"Add Development MG with relaxed policies\"\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#3_3","title":"3. \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5316","text":"<pre><code>\u306a\u305c\u3053\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3092\u3057\u305f\u304b\u8a18\u9332\n  \u2193\nREADME.md\u3084Wiki\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#4","title":"4. \u30c7\u30d5\u30a9\u30eb\u30c8\u3092\u5c0a\u91cd","text":"<pre><code>Microsoft\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u57fa\u6e96\u306b\n  \u2193\n\u5fc5\u8981\u306a\u90e8\u5206\u3060\u3051\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\n  \u2193\n\u3084\u308a\u3059\u304e\u306a\u3044\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#5","title":"5. \u30c6\u30b9\u30c8\u74b0\u5883\u3067\u691c\u8a3c","text":"<pre><code>\u672c\u756a\u74b0\u5883\u3067\u3044\u304d\u306a\u308a\u5909\u66f4\u3057\u306a\u3044\n  \u2193\n\u958b\u767a\u74b0\u5883\u3067\u8a66\u3059\n  \u2193\n\u554f\u984c\u306a\u3051\u308c\u3070\u672c\u756a\u3078\n</code></pre>"},{"location":"15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/#_20","title":"\u307e\u3068\u3081","text":"<p>\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3067\u304d\u308b\u9805\u76ee\uff1a 1. Management Group\u69cb\u9020\uff1a\u8ffd\u52a0\u30fb\u524a\u9664\u30fb\u968e\u5c64\u5909\u66f4 2. \u30dd\u30ea\u30b7\u30fc\uff1a\u8ffd\u52a0\u30fb\u524a\u9664\u30fb\u30d1\u30e9\u30e1\u30fc\u30bf\u5909\u66f4 3. \u547d\u540d\u898f\u5247\uff1aprefix\u3001\u74b0\u5883\u540d\u3001\u30ea\u30fc\u30b8\u30e7\u30f3\u540d 4. \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a\u30b5\u30d6\u30cd\u30c3\u30c8\u3001Firewall\u30eb\u30fc\u30eb\u3001Spoke VNet 5. \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u914d\u7f6e\uff1aManagement Group\u3078\u306e\u5272\u308a\u5f53\u3066 6. \u30bf\u30b0\uff1a\u7d44\u7e54\u56fa\u6709\u306e\u30bf\u30b0\u8ffd\u52a0 7. \u30ed\u30ae\u30f3\u30b0\uff1a\u4fdd\u6301\u671f\u9593\u3001\u30ab\u30b9\u30bf\u30e0DCR</p> <p>\u91cd\u8981\u306a\u30d5\u30a1\u30a4\u30eb\uff1a - <code>lib/architecture_definitions/alz_custom.alz_architecture_definition.yaml</code>\uff1a\u69cb\u9020\u5b9a\u7fa9 - <code>lib/archetype_definitions/*.yaml</code>\uff1a\u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9 - <code>platform-landing-zone.auto.tfvars</code>\uff1a\u8a2d\u5b9a\u5024 - <code>locals.tf</code>\uff1a\u547d\u540d\u898f\u5247\u30ed\u30b8\u30c3\u30af</p> <p>\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u306e\u6d41\u308c\uff1a <pre><code>1. \u8981\u4ef6\u6574\u7406\uff08\u4f55\u3092\u5909\u66f4\u3057\u305f\u3044\u304b\uff09\n2. lib\u30d5\u30a9\u30eb\u30c0\u7de8\u96c6\n3. tfvars\u7de8\u96c6\n4. \u30ed\u30fc\u30ab\u30eb\u3067plan\u78ba\u8a8d\n5. PR\u4f5c\u6210\n6. \u30ec\u30d3\u30e5\u30fc\n7. \u30c7\u30d7\u30ed\u30a4\n</code></pre></p> <p>\u6b21\u306eChapter\u3067\u306f\u3001\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002 \u904b\u7528\u3067\u6c17\u3092\u3064\u3051\u308b\u3079\u304d\u30dd\u30a4\u30f3\u30c8\u3092\u307e\u3068\u3081\u308b\u3088\u3002</p> <p>\u6240\u8981\u6642\u9593: 60\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2606 \u524d: 14_\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0.md \u6b21: 16_\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9.md</p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/","title":"16. \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9 - \u904b\u7528\u3067\u6c17\u3092\u3064\u3051\u308b\u3053\u3068","text":""},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>Azure Landing Zones\u3092\u904b\u7528\u3059\u308b\u4e0a\u3067\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u307e\u3068\u3081\u308b\u3088\u3002</p> <p>\u904b\u7528\u3067\u91cd\u8981\u306a\u3053\u3068\uff1a - \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3 - \u30b3\u30b9\u30c8\u7ba1\u7406 - \u5b89\u5b9a\u904b\u7528 - \u30c1\u30fc\u30e0\u5354\u696d - \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</p> <p>\u3053\u306eChapter\u306f\uff1a <pre><code>\u5931\u6557\u304b\u3089\u5b66\u3093\u3060\u77e5\u898b\n  +\nMicrosoft\u306e\u63a8\u5968\u4e8b\u9805\n  =\n\u5b9f\u8df5\u7684\u306a\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#1","title":"1. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3","text":""},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#1-1","title":"1-1. \u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u5fc5\u8981\u6700\u5c0f\u9650\u306e\u6a29\u9650\u3060\u3051\u4ed8\u4e0e\n</code></pre></p> <p>NG\u4f8b\uff1a <pre><code>\u5168\u54e1\u306bOwner\u6a29\u9650\n  \u2193\n\u8aa4\u64cd\u4f5c\u3067\u5168\u524a\u9664\u306e\u30ea\u30b9\u30af\n</code></pre></p> <p>OK\u4f8b\uff1a <pre><code>\u958b\u767a\u8005\uff1aContributor\uff08\u8aad\u307f\u66f8\u304d\uff09\n\u95b2\u89a7\u8005\uff1aReader\uff08\u8aad\u307f\u53d6\u308a\u306e\u307f\uff09\n\u7ba1\u7406\u8005\uff1aOwner\uff08\u5168\u6a29\u9650\uff09\n</code></pre></p> <p>\u5b9f\u88c5\uff1a <pre><code># \u30ab\u30b9\u30bf\u30e0\u30ed\u30fc\u30eb\u5b9a\u7fa9\nresource \"azurerm_role_definition\" \"developer\" {\n  name  = \"Landing Zone Developer\"\n  scope = \"/subscriptions/${var.subscription_id}\"\n\n  permissions {\n    actions = [\n      \"Microsoft.Resources/subscriptions/resourceGroups/read\",\n      \"Microsoft.Resources/deployments/*\",\n      \"Microsoft.Compute/*\",\n      \"Microsoft.Storage/*\",\n      \"Microsoft.Network/*\"\n    ]\n    not_actions = [\n      \"Microsoft.Network/virtualNetworks/delete\",  # VNet\u524a\u9664\u306f\u7981\u6b62\n      \"Microsoft.Storage/storageAccounts/delete\"   # Storage\u524a\u9664\u306f\u7981\u6b62\n    ]\n  }\n}\n\n# \u5272\u308a\u5f53\u3066\nresource \"azurerm_role_assignment\" \"developer\" {\n  scope                = \"/providers/Microsoft.Management/managementGroups/${var.root_id}-landing-zones\"\n  role_definition_name = azurerm_role_definition.developer.name\n  principal_id         = var.developer_group_id\n}\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#1-2-mfa","title":"1-2. \u591a\u8981\u7d20\u8a8d\u8a3c\uff08MFA\uff09\u5fc5\u9808","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>Azure AD\u3067\u6761\u4ef6\u4ed8\u304d\u30a2\u30af\u30bb\u30b9\u8a2d\u5b9a\n  \u2193\nAzure Portal\u30a2\u30af\u30bb\u30b9\u6642\u306bMFA\u5fc5\u9808\n</code></pre></p> <p>\u78ba\u8a8d\uff1a <pre><code>Azure Portal \u2192 Azure AD \u2192 Security \u2192 Conditional Access\n  \u2193\nRequire multi-factor authentication for Azure management\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#1-3-secrets","title":"1-3. Secrets\u306e\u7ba1\u7406","text":"<p>NG\u4f8b\uff1a <pre><code># terraform.tfvars\uff08Git\u7ba1\u7406\u4e0b\uff09\nadmin_password = \"MyPassword123!\"  # \u2190\u5371\u967a\n</code></pre></p> <p>OK\u4f8b\uff1a <pre><code># Azure Key Vault\u306b\u4fdd\u5b58\ndata \"azurerm_key_vault_secret\" \"admin_password\" {\n  name         = \"admin-password\"\n  key_vault_id = azurerm_key_vault.example.id\n}\n\n# \u4f7f\u7528\nresource \"azurerm_virtual_machine\" \"example\" {\n  admin_password = data.azurerm_key_vault_secret.admin_password.value\n}\n</code></pre></p> <p>GitHub Secrets\uff1a <pre><code>\u74b0\u5883\u5909\u6570\u306f\u5168\u90e8GitHub Secrets\u306b\n  \u2193\n\u30b3\u30fc\u30c9\u306b\u306f\u66f8\u304b\u306a\u3044\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#1-4","title":"1-4. \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u96e2","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u74b0\u5883\u3054\u3068\u306bVNet\u5206\u96e2\n  \u2193\n\u672c\u756a \u2194\ufe0e \u958b\u767a\u306f\u901a\u4fe1\u3067\u304d\u306a\u3044\u3088\u3046\u306b\n</code></pre></p> <p>\u5b9f\u88c5\uff1a <pre><code>\u672c\u756aSpoke VNet: 10.1.0.0/16\n\u958b\u767aSpoke VNet: 10.10.0.0/16\n  \u2193\nVNet Peering\u306f\u4f5c\u3089\u306a\u3044\n  \u2193\n\u307e\u305f\u306f\n  \u2193\nFirewall\u3067\u5236\u5fa1\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#1-5-private-endpoint","title":"1-5. Private Endpoint\u4f7f\u7528","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>PaaS\u30b5\u30fc\u30d3\u30b9\u306fPrivate Endpoint\u7d4c\u7531\n  \u2193\nPublic Endpoint\u7121\u52b9\u5316\n</code></pre></p> <p>\u4f8b\uff08Storage Account\uff09\uff1a <pre><code>resource \"azurerm_storage_account\" \"example\" {\n  name                     = \"stexample12345\"\n  resource_group_name      = azurerm_resource_group.example.name\n  location                 = \"japaneast\"\n  account_tier             = \"Standard\"\n  account_replication_type = \"LRS\"\n\n  public_network_access_enabled = false  # \u2190Public\u7121\u52b9\n}\n\nresource \"azurerm_private_endpoint\" \"example\" {\n  name                = \"pe-storage\"\n  location            = \"japaneast\"\n  resource_group_name = azurerm_resource_group.example.name\n  subnet_id           = azurerm_subnet.example.id\n\n  private_service_connection {\n    name                           = \"psc-storage\"\n    private_connection_resource_id = azurerm_storage_account.example.id\n    subresource_names              = [\"blob\"]\n    is_manual_connection           = false\n  }\n}\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#1-6","title":"1-6. \u5b9a\u671f\u7684\u306a\u30a2\u30af\u30bb\u30b9\u30ec\u30d3\u30e5\u30fc","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u67081\u56de\uff1a\n- \u8ab0\u304c\u3069\u3093\u306a\u6a29\u9650\u3092\u6301\u3063\u3066\u308b\u304b\u78ba\u8a8d\n- \u4e0d\u8981\u306a\u6a29\u9650\u3092\u524a\u9664\n- \u9000\u8077\u8005\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u524a\u9664\n</code></pre></p> <p>\u30c4\u30fc\u30eb\uff1a <pre><code># \u5168\u30ed\u30fc\u30eb\u5272\u308a\u5f53\u3066\u78ba\u8a8d\naz role assignment list --all --output table\n\n# \u7279\u5b9a\u306eManagement Group\u306e\u307f\naz role assignment list \\\n  --scope \"/providers/Microsoft.Management/managementGroups/${ROOT_ID}\" \\\n  --output table\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#2","title":"2. \u30b3\u30b9\u30c8\u7ba1\u7406","text":""},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#2-1","title":"2-1. \u30b3\u30b9\u30c8\u4e88\u6e2c","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u30c7\u30d7\u30ed\u30a4\u524d\u306b\u6982\u7b97\u898b\u7a4d\u3082\u308a\n</code></pre></p> <p>\u30c4\u30fc\u30eb\uff1a <pre><code>Azure Pricing Calculator:\nhttps://azure.microsoft.com/pricing/calculator/\n</code></pre></p> <p>\u4e3b\u306a\u6599\u91d1\uff1a <pre><code>Firewall Standard: \u7d0417\u4e07\u5186/\u6708\nVPN Gateway VpnGw1: \u7d044\u4e07\u5186/\u6708\nBastion Basic: \u7d042.7\u4e07\u5186/\u6708\nDDoS Protection: \u7d0440\u4e07\u5186/\u6708\nLog Analytics: \u30c7\u30fc\u30bf\u91cf\u306b\u3088\u308b\uff085GB/\u6708\u307e\u3067\u7121\u6599\uff09\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#2-2","title":"2-2. \u30bf\u30b0\u6226\u7565","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u5168\u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u9808\u30bf\u30b0\u4ed8\u4e0e\n  \u2193\n\u30b3\u30b9\u30c8\u5206\u6790\u304c\u697d\u306b\u306a\u308b\n</code></pre></p> <p>\u5fc5\u9808\u30bf\u30b0\uff1a <pre><code>tags = {\n  CostCenter  = \"1000\"           # \u30b3\u30b9\u30c8\u30bb\u30f3\u30bf\u30fc\n  Environment = \"Production\"      # \u74b0\u5883\n  Owner       = \"platform-team\"   # \u62c5\u5f53\u8005\n  Project     = \"ALZ\"             # \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n  AutoShutdown = \"Yes\"            # \u81ea\u52d5\u505c\u6b62\u5bfe\u8c61\u304b\n}\n</code></pre></p> <p>\u30dd\u30ea\u30b7\u30fc\u3067\u5f37\u5236\uff1a <pre><code># lib/archetype_definitions/corp_custom.alz_archetype_override.yaml\npolicy_assignments_to_add:\n  - Require-Tags\n    assignment_parameters:\n      tagName: \"CostCenter\"\n      tagValue: [\"1000\", \"2000\", \"3000\"]\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#2-3","title":"2-3. \u958b\u767a\u74b0\u5883\u306e\u81ea\u52d5\u505c\u6b62","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u958b\u767a\u74b0\u5883\u306eVM\u3092\u591c\u9593\u30fb\u4f11\u65e5\u505c\u6b62\n  \u2193\n\u7a3c\u50cd\u6642\u9593\u309250%\u524a\u6e1b\n  \u2193\n\u30b3\u30b9\u30c8\u534a\u5206\n</code></pre></p> <p>\u5b9f\u88c5\uff08Azure Automation\uff09\uff1a <pre><code>resource \"azurerm_automation_schedule\" \"stop_vms\" {\n  name                    = \"schedule-stop-vms\"\n  resource_group_name     = azurerm_resource_group.automation.name\n  automation_account_name = azurerm_automation_account.example.name\n  frequency               = \"Day\"\n  start_time              = \"2026-01-17T20:00:00+09:00\"\n  timezone                = \"Tokyo Standard Time\"\n}\n\nresource \"azurerm_automation_schedule\" \"start_vms\" {\n  name                    = \"schedule-start-vms\"\n  resource_group_name     = azurerm_resource_group.automation.name\n  automation_account_name = azurerm_automation_account.example.name\n  frequency               = \"Week\"\n  start_time              = \"2026-01-20T08:00:00+09:00\"\n  week_days               = [\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\"]\n  timezone                = \"Tokyo Standard Time\"\n}\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#2-4-reserved-instances","title":"2-4. Reserved Instances\u306e\u6d3b\u7528","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u9577\u671f\u5229\u7528\u304c\u78ba\u5b9a\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u306f\u4e88\u7d04\u3057\u307e\u3059\n  \u2193\n1\u5e74\u4e88\u7d04: \u7d0440%\u5272\u5f15\n3\u5e74\u4e88\u7d04: \u7d0460%\u5272\u5f15\n</code></pre></p> <p>\u5bfe\u8c61\u30ea\u30bd\u30fc\u30b9\uff1a <pre><code>- Virtual Machines\n- SQL Database\n- App Service\n- Cosmos DB\n</code></pre></p> <p>\u8cfc\u5165\uff1a <pre><code>Azure Portal \u2192 Reservations \u2192 Purchase reservation\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#2-5","title":"2-5. \u30b3\u30b9\u30c8\u30a2\u30e9\u30fc\u30c8\u8a2d\u5b9a","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u4e88\u7b97\u8d85\u904e\u3057\u305f\u3089\u901a\u77e5\n</code></pre></p> <p>\u5b9f\u88c5\uff1a <pre><code>resource \"azurerm_consumption_budget_subscription\" \"example\" {\n  name            = \"budget-monthly\"\n  subscription_id = \"/subscriptions/${var.subscription_id}\"\n\n  amount     = 500000  # 50\u4e07\u5186\n  time_grain = \"Monthly\"\n\n  time_period {\n    start_date = \"2026-01-01T00:00:00Z\"\n  }\n\n  notification {\n    enabled   = true\n    threshold = 80  # 80%\u3067\u901a\u77e5\n    operator  = \"GreaterThan\"\n\n    contact_emails = [\n      \"platform-team@example.com\"\n    ]\n  }\n\n  notification {\n    enabled   = true\n    threshold = 100  # 100%\u3067\u901a\u77e5\n    operator  = \"GreaterThan\"\n\n    contact_emails = [\n      \"cfo@example.com\"\n    ]\n  }\n}\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#2-6","title":"2-6. \u4e0d\u8981\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664","text":"<p>\u5b9a\u671f\u7684\u306b\u30c1\u30a7\u30c3\u30af\uff1a <pre><code># \u904e\u53bb30\u65e5\u9593\u4f7f\u308f\u308c\u3066\u306a\u3044VM\naz vm list --query \"[?powerState=='VM deallocated']\" --output table\n\n# \u5b64\u7acb\u3057\u305fDisk\uff08VM\u306b\u30a2\u30bf\u30c3\u30c1\u3055\u308c\u3066\u306a\u3044\uff09\naz disk list --query \"[?diskState=='Unattached']\" --output table\n\n# \u5b64\u7acb\u3057\u305fPublic IP\naz network public-ip list --query \"[?ipConfiguration==null]\" --output table\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#3-infrastructure-as-code","title":"3. Infrastructure as Code","text":""},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#3-1","title":"3-1. \u5168\u90e8\u30b3\u30fc\u30c9\u5316","text":"<p>\u30eb\u30fc\u30eb\uff1a <pre><code>Azure Portal\u3067\u624b\u4f5c\u696d\u3057\u306a\u3044\n  \u2193\n\u5168\u90e8Terraform\u3067\u5b9a\u7fa9\n  \u2193\nInfrastructure as Code\n</code></pre></p> <p>\u30e1\u30ea\u30c3\u30c8\uff1a <pre><code>- \u518d\u73fe\u53ef\u80fd\n- \u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\n- \u30ec\u30d3\u30e5\u30fc\u53ef\u80fd\n- \u81ea\u52d5\u5316\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#3-2-state","title":"3-2. State\u7ba1\u7406","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>State\u30d5\u30a1\u30a4\u30eb\u306f\u5fc5\u305a\u30ea\u30e2\u30fc\u30c8Backend\n  \u2193\n\u30ed\u30fc\u30ab\u30eb\u306b\u7f6e\u304b\u306a\u3044\n</code></pre></p> <p>\u7406\u7531\uff1a <pre><code>\u30ed\u30fc\u30ab\u30eb\uff1a\n- PC\u58ca\u308c\u305f\u3089\u7d42\u308f\u308a\n- \u30c1\u30fc\u30e0\u3067\u5171\u6709\u3067\u304d\u306a\u3044\n- \u540c\u6642\u5b9f\u884c\u3067\u304d\u306a\u3044\n\n\u30ea\u30e2\u30fc\u30c8\uff08Azure Storage\uff09\uff1a\n- \u5b89\u5168\n- \u5171\u6709\u3067\u304d\u308b\n- Lock\u6a5f\u80fd\u3067\u540c\u6642\u5b9f\u884c\u9632\u6b62\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#3-3","title":"3-3. \u30e2\u30b8\u30e5\u30fc\u30eb\u5316","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u5171\u901a\u51e6\u7406\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u5316\n  \u2193\n\u518d\u5229\u7528\n</code></pre></p> <p>\u4f8b\uff1a <pre><code>modules/\n\u251c\u2500\u2500 spoke-vnet/\n\u2502   \u251c\u2500\u2500 main.tf\n\u2502   \u251c\u2500\u2500 variables.tf\n\u2502   \u2514\u2500\u2500 outputs.tf\n\u251c\u2500\u2500 app-service/\n\u2502   \u251c\u2500\u2500 main.tf\n\u2502   \u251c\u2500\u2500 variables.tf\n\u2502   \u2514\u2500\u2500 outputs.tf\n\u2514\u2500\u2500 sql-database/\n    \u251c\u2500\u2500 main.tf\n    \u251c\u2500\u2500 variables.tf\n    \u2514\u2500\u2500 outputs.tf\n</code></pre></p> <p>\u4f7f\u7528\uff1a <pre><code>module \"spoke_production\" {\n  source = \"./modules/spoke-vnet\"\n\n  name                = \"vnet-prd-spoke\"\n  location            = \"japaneast\"\n  address_space       = [\"10.1.0.0/16\"]\n  hub_vnet_id         = module.hub.vnet_id\n}\n\nmodule \"spoke_development\" {\n  source = \"./modules/spoke-vnet\"\n\n  name                = \"vnet-dev-spoke\"\n  location            = \"japaneast\"\n  address_space       = [\"10.10.0.0/16\"]\n  hub_vnet_id         = module.hub.vnet_id\n}\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#3-4","title":"3-4. \u5909\u6570\u306e\u691c\u8a3c","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u5909\u6570\u306bvalidation\u3092\u8ffd\u52a0\n  \u2193\n\u9593\u9055\u3063\u305f\u5024\u3092\u4e8b\u524d\u306b\u9632\u3050\n</code></pre></p> <p>\u4f8b\uff1a <pre><code>variable \"environment\" {\n  type        = string\n  description = \"Environment name\"\n\n  validation {\n    condition     = contains([\"prd\", \"stg\", \"dev\"], var.environment)\n    error_message = \"Environment must be prd, stg, or dev.\"\n  }\n}\n\nvariable \"location\" {\n  type        = string\n  description = \"Azure region\"\n\n  validation {\n    condition     = contains([\"japaneast\", \"japanwest\"], var.location)\n    error_message = \"Location must be japaneast or japanwest.\"\n  }\n}\n\nvariable \"vm_size\" {\n  type        = string\n  description = \"VM size\"\n\n  validation {\n    condition = can(regex(\"^Standard_[BDE][0-9]+[a-z]*s_v[0-9]+$\", var.vm_size))\n    error_message = \"VM size must be a valid Azure VM SKU.\"\n  }\n}\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#3-5-output","title":"3-5. Output\u306e\u6d3b\u7528","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u4ed6\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u4f7f\u3046\u5024\u306foutput\n</code></pre></p> <p>\u4f8b\uff1a <pre><code># modules/hub-vnet/outputs.tf\noutput \"vnet_id\" {\n  value       = azurerm_virtual_network.hub.id\n  description = \"Hub VNet ID\"\n}\n\noutput \"firewall_private_ip\" {\n  value       = azurerm_firewall.hub.ip_configuration[0].private_ip_address\n  description = \"Firewall private IP address\"\n}\n\n# \u4f7f\u3046\u5074\nmodule \"hub\" {\n  source = \"./modules/hub-vnet\"\n  ...\n}\n\nresource \"azurerm_route\" \"to_internet\" {\n  name                   = \"route-to-internet\"\n  resource_group_name    = azurerm_resource_group.example.name\n  route_table_name       = azurerm_route_table.example.name\n  address_prefix         = \"0.0.0.0/0\"\n  next_hop_type          = \"VirtualAppliance\"\n  next_hop_in_ip_address = module.hub.firewall_private_ip  # \u2190output\u4f7f\u7528\n}\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#4","title":"4. \u30c1\u30fc\u30e0\u5354\u696d","text":""},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#4-1","title":"4-1. \u30d6\u30e9\u30f3\u30c1\u6226\u7565","text":"<p>\u63a8\u5968\uff1aGitHub Flow</p> <pre><code>main\uff08\u672c\u756a\uff09\n  \u2191\n  \u2502 PR\u30fb\u30ec\u30d3\u30e5\u30fc\u30fb\u30de\u30fc\u30b8\n  \u2502\nfeature/* \u30d6\u30e9\u30f3\u30c1\uff08\u958b\u767a\uff09\n</code></pre> <p>\u624b\u9806\uff1a <pre><code>1. main\u304b\u3089feature\u30d6\u30e9\u30f3\u30c1\u4f5c\u6210\n2. \u30b3\u30fc\u30c9\u5909\u66f4\n3. PR\u4f5c\u6210\n4. CI\u5b9f\u884c\uff08terraform plan\uff09\n5. \u30ec\u30d3\u30e5\u30fc\n6. \u627f\u8a8d\n7. main\u306b\u30de\u30fc\u30b8\n8. CD\u5b9f\u884c\uff08terraform apply\uff09\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#4-2-prpull-request","title":"4-2. PR\uff08Pull Request\uff09\u30eb\u30fc\u30eb","text":"<p>\u5fc5\u9808\u9805\u76ee\uff1a <pre><code>\u2713 terraform plan\u306e\u7d50\u679c\u3092\u78ba\u8a8d\n\u2713 \u6700\u4f4e1\u4eba\u306e\u627f\u8a8d\n\u2713 CI\u901a\u904e\n\u2713 \u30b3\u30f3\u30d5\u30ea\u30af\u30c8\u89e3\u6c7a\u6e08\u307f\n</code></pre></p> <p>Branch Protection\u8a2d\u5b9a\uff1a <pre><code>GitHub \u2192 Settings \u2192 Branches \u2192 Add rule\n  \u2193\nBranch name pattern: main\n  \u2713 Require pull request reviews before merging\n  \u2713 Require status checks to pass before merging\n    - CI\uff08terraform plan\uff09\n  \u2713 Require branches to be up to date before merging\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#4-3","title":"4-3. \u30b3\u30fc\u30c9\u30ec\u30d3\u30e5\u30fc\u306e\u30dd\u30a4\u30f3\u30c8","text":"<p>\u30c1\u30a7\u30c3\u30af\u9805\u76ee\uff1a <pre><code>\u25a1 \u547d\u540d\u898f\u5247\u306b\u5f93\u3063\u3066\u308b\uff1f\n\u25a1 \u30bf\u30b0\u304c\u5168\u90e8\u4ed8\u3044\u3066\u308b\uff1f\n\u25a1 Security Group\u306e\u30eb\u30fc\u30eb\u306f\u9069\u5207\uff1f\n\u25a1 \u30b3\u30b9\u30c8\u3078\u306e\u5f71\u97ff\u306f\uff1f\n\u25a1 \u524a\u9664\u3055\u308c\u308b\u30ea\u30bd\u30fc\u30b9\u306f\u306a\u3044\uff1f\n\u25a1 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u66f4\u65b0\u3057\u305f\uff1f\n</code></pre></p> <p>\u30ec\u30d3\u30e5\u30fc\u30b3\u30e1\u30f3\u30c8\u4f8b\uff1a <pre><code>Good:\n\u300c\u3053\u306eFirewall\u30eb\u30fc\u30eb\u3001\u30bd\u30fc\u30b9\u30920.0.0.0/0\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\n\u7279\u5b9a\u306eIP\u306b\u7d5e\u308c\u306a\u3044\uff1f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ea\u30b9\u30af\u3042\u308b\u304b\u3082\u300d\n\nBad:\n\u300c\u30c0\u30e1\u300d\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#4-4","title":"4-4. \u30da\u30a2\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0","text":"<p>\u63a8\u5968\uff1a <pre><code>\u91cd\u8981\u306a\u5909\u66f4\u306f2\u4eba\u3067\u4f5c\u696d\n  \u2193\n- \u77e5\u8b58\u5171\u6709\n- \u30df\u30b9\u9632\u6b62\n- \u30aa\u30f3\u30dc\u30fc\u30c7\u30a3\u30f3\u30b0\n</code></pre></p> <p>\u7279\u306b\u91cd\u8981\u306a\u5834\u9762\uff1a <pre><code>- \u672c\u756a\u74b0\u5883\u3078\u306e\u521d\u56de\u30c7\u30d7\u30ed\u30a4\n- \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u306e\u5927\u5e45\u5909\u66f4\n- \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30dd\u30ea\u30b7\u30fc\u306e\u5909\u66f4\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#5","title":"5. \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8","text":""},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#5-1-readme","title":"5-1. README\u306f\u5fc5\u9808","text":"<p>\u6700\u4f4e\u9650\u306e\u5185\u5bb9\uff1a <pre><code># Azure Landing Zones\n\n## \u6982\u8981\n\u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306f...\n\n## \u524d\u63d0\u6761\u4ef6\n- Azure Subscription\uff08Owner\u6a29\u9650\uff09\n- Terraform v1.12+\n- Azure CLI\n\n## \u30c7\u30d7\u30ed\u30a4\u624b\u9806\n1. ...\n2. ...\n\n## \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n</code></pre> \u251c\u2500\u2500 lib/                    # \u30ab\u30b9\u30bf\u30e0\u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9 \u251c\u2500\u2500 modules/                # \u30ab\u30b9\u30bf\u30e0\u30e2\u30b8\u30e5\u30fc\u30eb \u251c\u2500\u2500 main.*.tf               # \u30e1\u30a4\u30f3\u30b3\u30fc\u30c9 \u2514\u2500\u2500 platform-landing-zone.auto.tfvars  # \u8a2d\u5b9a <pre><code>## \u74b0\u5883\n- \u672c\u756a: `subscription_id_xxx`\n- \u958b\u767a: `subscription_id_yyy`\n\n## \u9023\u7d61\u5148\n- \u30c1\u30fc\u30e0: platform-team@example.com\n- Slack: #platform-team\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#5-2-architecture-decision-recordsadr","title":"5-2. Architecture Decision Records\uff08ADR\uff09","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u91cd\u8981\u306a\u8a2d\u8a08\u5224\u65ad\u3092\u8a18\u9332\n</code></pre></p> <p>\u4f8b\uff1a <pre><code># ADR-001: Hub-and-Spoke\u3092\u63a1\u7528\n\n## \u72b6\u6cc1\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u3068\u3057\u3066Hub-and-Spoke\u3068Virtual WAN\u306e\u9078\u629e\u80a2\u304c\u3042\u3063\u305f\u3002\n\n## \u6c7a\u5b9a\nHub-and-Spoke\u3092\u63a1\u7528\u3002\n\n## \u7406\u7531\n- \u5c0f\u898f\u6a21\uff08VNet 10\u500b\u4ee5\u4e0b\uff09\n- Virtual WAN\u306f\u30b3\u30b9\u30c8\u304c\u9ad8\u3044\uff08\u670850\u4e07\u5186\u8ffd\u52a0\uff09\n- \u7d30\u304b\u3044\u5236\u5fa1\u304c\u5fc5\u8981\n\n## \u7d50\u679c\n- \u30b3\u30b9\u30c8\u524a\u6e1b\n- \u67d4\u8edf\u306a\u8a2d\u5b9a\u304c\u53ef\u80fd\n\n## \u65e5\u4ed8\n2026-01-15\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#5-3","title":"5-3. \u30e9\u30f3\u30d6\u30c3\u30af","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u904b\u7528\u624b\u9806\u66f8\u3092\u4f5c\u6210\n</code></pre></p> <p>\u5185\u5bb9\u4f8b\uff1a <pre><code># \u30e9\u30f3\u30d6\u30c3\u30af\n\n## \u65b0\u3057\u3044Spoke VNet\u306e\u8ffd\u52a0\n\n### \u624b\u9806\n1. \u30d6\u30e9\u30f3\u30c1\u4f5c\u6210\n   ```bash\n   git checkout -b feature/add-spoke-xxx\n   ```\n\n2. spoke-vnets.tf\u306b\u8ffd\u52a0\n   ```hcl\n   resource \"azurerm_virtual_network\" \"spoke_xxx\" {\n     ...\n   }\n   ```\n\n3. PR\u4f5c\u6210\u30fb\u30ec\u30d3\u30e5\u30fc\u30fb\u30de\u30fc\u30b8\n\n4. \u30c7\u30d7\u30ed\u30a4\u78ba\u8a8d\n   ```bash\n   az network vnet show --name vnet-spoke-xxx\n   ```\n\n### \u6240\u8981\u6642\u9593\n\u7d0430\u5206\n\n### \u6ce8\u610f\u70b9\n- \u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\u306e\u91cd\u8907\u306b\u6ce8\u610f\n- \u30bf\u30b0\u3092\u5fd8\u308c\u305a\u306b\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#5-4","title":"5-4. \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u30ac\u30a4\u30c9","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u904e\u53bb\u306e\u30c8\u30e9\u30d6\u30eb\u3068\u89e3\u6c7a\u7b56\u3092\u8a18\u9332\n</code></pre></p> <p>Chapter 14\u306e\u5185\u5bb9\u3092\u30d9\u30fc\u30b9\u306b\u4f5c\u6210\u3002</p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#6","title":"6. \u76e3\u8996\u3068\u30a2\u30e9\u30fc\u30c8","text":""},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#6-1-log-analytics","title":"6-1. Log Analytics\u30af\u30a8\u30ea","text":"<p>\u5b9a\u671f\u7684\u306b\u78ba\u8a8d\u3059\u308b\u30af\u30a8\u30ea\uff1a</p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#1-firewall","title":"1. Firewall\u3067\u62d2\u5426\u3055\u308c\u305f\u30c8\u30e9\u30d5\u30a3\u30c3\u30af","text":"<pre><code>AzureDiagnostics\n| where Category == \"AzureFirewallApplicationRule\" or Category == \"AzureFirewallNetworkRule\"\n| where msg_s contains \"Deny\"\n| project TimeGenerated, msg_s\n| order by TimeGenerated desc\n| take 100\n</code></pre>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#2_1","title":"2. \u7570\u5e38\u306a\u30ed\u30b0\u30a4\u30f3\u8a66\u884c","text":"<pre><code>SigninLogs\n| where ResultType != \"0\"  // \u5931\u6557\n| where TimeGenerated &gt; ago(24h)\n| summarize FailedAttempts = count() by UserPrincipalName, IPAddress\n| where FailedAttempts &gt; 5\n| order by FailedAttempts desc\n</code></pre>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#3","title":"3. \u30ea\u30bd\u30fc\u30b9\u306e\u5909\u66f4\u5c65\u6b74","text":"<pre><code>AzureActivity\n| where OperationName contains \"write\" or OperationName contains \"delete\"\n| where TimeGenerated &gt; ago(7d)\n| project TimeGenerated, Caller, OperationName, ResourceGroup, Resource\n| order by TimeGenerated desc\n</code></pre>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#6-2","title":"6-2. \u30a2\u30e9\u30fc\u30c8\u30eb\u30fc\u30eb","text":"<p>\u8a2d\u5b9a\u3059\u3079\u304d\u30a2\u30e9\u30fc\u30c8\uff1a</p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#1-firewall-cpu","title":"1. Firewall CPU\u4f7f\u7528\u7387","text":"<pre><code>resource \"azurerm_monitor_metric_alert\" \"firewall_cpu\" {\n  name                = \"alert-firewall-cpu-high\"\n  resource_group_name = azurerm_resource_group.connectivity.name\n  scopes              = [azurerm_firewall.hub.id]\n  description         = \"Firewall CPU usage is high\"\n\n  criteria {\n    metric_namespace = \"Microsoft.Network/azureFirewalls\"\n    metric_name      = \"FirewallHealth\"\n    aggregation      = \"Average\"\n    operator         = \"LessThan\"\n    threshold        = 90\n  }\n\n  action {\n    action_group_id = azurerm_monitor_action_group.platform_team.id\n  }\n}\n</code></pre>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#2-storage-account","title":"2. Storage Account\u5bb9\u91cf","text":"<pre><code>resource \"azurerm_monitor_metric_alert\" \"storage_capacity\" {\n  name                = \"alert-storage-capacity-high\"\n  resource_group_name = azurerm_resource_group.management.name\n  scopes              = [azurerm_storage_account.logs.id]\n  description         = \"Storage account is almost full\"\n\n  criteria {\n    metric_namespace = \"Microsoft.Storage/storageAccounts\"\n    metric_name      = \"UsedCapacity\"\n    aggregation      = \"Average\"\n    operator         = \"GreaterThan\"\n    threshold        = 900000000000  # 900GB\n  }\n\n  action {\n    action_group_id = azurerm_monitor_action_group.platform_team.id\n  }\n}\n</code></pre>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#6-3-action-group","title":"6-3. Action Group","text":"<p>\u901a\u77e5\u5148\u306e\u8a2d\u5b9a\uff1a <pre><code>resource \"azurerm_monitor_action_group\" \"platform_team\" {\n  name                = \"ag-platform-team\"\n  resource_group_name = azurerm_resource_group.management.name\n  short_name          = \"platform\"\n\n  email_receiver {\n    name          = \"platform-team\"\n    email_address = \"platform-team@example.com\"\n  }\n\n  sms_receiver {\n    name         = \"on-call\"\n    country_code = \"81\"\n    phone_number = \"9012345678\"\n  }\n\n  webhook_receiver {\n    name        = \"slack\"\n    service_uri = \"https://hooks.slack.com/services/...\"\n  }\n}\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#7","title":"7. \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3068\u707d\u5bb3\u5bfe\u7b56","text":""},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#7-1-terraform-state","title":"7-1. Terraform State\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7","text":"<p>\u3084\u308b\u3053\u3068\uff1a <pre><code>\u5b9a\u671f\u7684\u306bState\u30d5\u30a1\u30a4\u30eb\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n</code></pre></p> <p>\u5b9f\u88c5\uff1a <pre><code>#!/bin/bash\n# backup-tfstate.sh\n\nDATE=$(date +%Y%m%d-%H%M%S)\nBACKUP_DIR=\"./backups\"\n\nmkdir -p $BACKUP_DIR\n\n# State pull\nterraform state pull &gt; \"$BACKUP_DIR/terraform-state-$DATE.json\"\n\n# \u53e4\u3044\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u524a\u9664\uff0830\u65e5\u4ee5\u4e0a\u524d\uff09\nfind $BACKUP_DIR -name \"terraform-state-*.json\" -mtime +30 -delete\n\necho \"Backup completed: $BACKUP_DIR/terraform-state-$DATE.json\"\n</code></pre></p> <p>Cron\u8a2d\u5b9a\uff1a <pre><code># \u6bce\u65e5\u5348\u524d2\u6642\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n0 2 * * * /path/to/backup-tfstate.sh\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#7-2","title":"7-2. \u30de\u30eb\u30c1\u30ea\u30fc\u30b8\u30e7\u30f3\u69cb\u6210","text":"<p>\u63a8\u5968\uff1a <pre><code>\u672c\u756a\u74b0\u5883\u306f2\u30ea\u30fc\u30b8\u30e7\u30f3\n  \u2193\nJapan East\uff08Primary\uff09\nJapan West\uff08Secondary\uff09\n</code></pre></p> <p>\u30c7\u30fc\u30bf\u540c\u671f\uff1a <pre><code>Storage Account: GRS\uff08Geo-Redundant Storage\uff09\nSQL Database: Geo-Replication\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#7-3-dr","title":"7-3. \u707d\u5bb3\u5fa9\u65e7\u8a08\u753b\uff08DR\uff09","text":"<p>RTO/RPO\u5b9a\u7fa9\uff1a <pre><code>RTO\uff08Recovery Time Objective\uff09\uff1a\u5fa9\u65e7\u76ee\u6a19\u6642\u9593\n- Critical: 4\u6642\u9593\u4ee5\u5185\n- High: 24\u6642\u9593\u4ee5\u5185\n- Medium: 72\u6642\u9593\u4ee5\u5185\n\nRPO\uff08Recovery Point Objective\uff09\uff1a\u30c7\u30fc\u30bf\u640d\u5931\u8a31\u5bb9\u6642\u9593\n- Critical: 1\u6642\u9593\u4ee5\u5185\n- High: 24\u6642\u9593\u4ee5\u5185\n- Medium: 1\u9031\u9593\u4ee5\u5185\n</code></pre></p> <p>DR\u624b\u9806\u66f8\uff1a <pre><code># \u707d\u5bb3\u5fa9\u65e7\u624b\u9806\n\n## Japan East\u304c\u505c\u6b62\u3057\u305f\u5834\u5408\n\n1. \u72b6\u6cc1\u78ba\u8a8d\n   - Azure Status\u78ba\u8a8d\n   - \u30ea\u30bd\u30fc\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n2. Japan West\u3078\u306e\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\n   - DNS\u5207\u308a\u66ff\u3048\n   - \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8d77\u52d5\u78ba\u8a8d\n   - \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u78ba\u8a8d\n\n3. \u30e6\u30fc\u30b6\u30fc\u901a\u77e5\n   - \u969c\u5bb3\u901a\u77e5\u30e1\u30fc\u30eb\u9001\u4fe1\n   - Status Page\u66f4\u65b0\n\n4. \u5fa9\u65e7\u5f8c\n   - Japan East\u3078\u306e\u30d5\u30a7\u30a4\u30eb\u30d0\u30c3\u30af\n   - \u30c7\u30fc\u30bf\u540c\u671f\u78ba\u8a8d\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#8","title":"8. \u5909\u66f4\u7ba1\u7406","text":""},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#8-1","title":"8-1. \u5909\u66f4\u30a6\u30a3\u30f3\u30c9\u30a6","text":"<p>\u30eb\u30fc\u30eb\uff1a <pre><code>\u672c\u756a\u74b0\u5883\u306e\u5909\u66f4\u306f\u6c7a\u307e\u3063\u305f\u6642\u9593\u5e2f\u306e\u307f\n</code></pre></p> <p>\u63a8\u5968\u6642\u9593\u5e2f\uff1a <pre><code>\u5e73\u65e5: 20:00 - 23:00\uff08\u696d\u52d9\u6642\u9593\u5916\uff09\n\u9031\u672b: \u571f\u66dc\u65e5 10:00 - 18:00\n\n\u907f\u3051\u308b\u3079\u304d\uff1a\n- \u6708\u66dc\u65e5\u5348\u524d\uff08\u9031\u521d\u3081\uff09\n- \u91d1\u66dc\u65e5\u5348\u5f8c\uff08\u9031\u672b\u524d\uff09\n- \u6708\u672b\u30fb\u6708\u521d\uff08\u6c7a\u7b97\u51e6\u7406\uff09\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#8-2","title":"8-2. \u5909\u66f4\u627f\u8a8d\u30d7\u30ed\u30bb\u30b9","text":"<p>\u624b\u9806\uff1a <pre><code>1. \u5909\u66f4\u7533\u8acb\uff08Change Request\uff09\n   - \u5909\u66f4\u5185\u5bb9\n   - \u5f71\u97ff\u7bc4\u56f2\n   - \u30ea\u30b9\u30af\n   - \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u624b\u9806\n\n2. \u30ec\u30d3\u30e5\u30fc\n   - \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c1\u30fc\u30e0\n   - \u904b\u7528\u30c1\u30fc\u30e0\n   - \u95a2\u4fc2\u90e8\u7f72\n\n3. \u627f\u8a8d\n   - \u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u627f\u8a8d\n\n4. \u5b9f\u65bd\n   - \u5909\u66f4\u30a6\u30a3\u30f3\u30c9\u30a6\u5185\u3067\u5b9f\u65bd\n   - \u76e3\u8996\u4f53\u5236\n\n5. \u5b8c\u4e86\u5831\u544a\n   - \u7d50\u679c\u5831\u544a\n   - \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u66f4\u65b0\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#8-3","title":"8-3. \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u8a08\u753b","text":"<p>\u5fc5\u9808\uff1a <pre><code>\u5909\u66f4\u524d\u306b\u5fc5\u305a\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u624b\u9806\u3092\u7528\u610f\n</code></pre></p> <p>\u4f8b\uff1a <pre><code>## \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u624b\u9806\n\n### \u5909\u66f4\u5185\u5bb9\nFirewall SKU\u3092Standard\u304b\u3089Premium\u306b\u5909\u66f4\n\n### \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u624b\u9806\n1. Git\u3067Revert\n   ```bash\n   git revert &lt;commit-hash&gt;\n   git push\n   ```\n\n2. CD\u5b9f\u884c\n   - \u81ea\u52d5\u3067terraform apply\u5b9f\u884c\n   - Firewall SKU\u304cStandard\u306b\u623b\u308b\n\n3. \u78ba\u8a8d\n   ```bash\n   az network firewall show --name fw-hub\n   ```\n\n### \u6240\u8981\u6642\u9593\n\u7d0430\u5206\n\n### \u6ce8\u610f\u70b9\n- Firewall\u306e\u518d\u4f5c\u6210\u304c\u767a\u751f\u3059\u308b\n- 30\u5206\u7a0b\u5ea6\u901a\u4fe1\u65ad\u304c\u767a\u751f\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#9","title":"9. \u7d99\u7d9a\u7684\u6539\u5584","text":""},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#9-1","title":"9-1. \u5b9a\u671f\u30ec\u30d3\u30e5\u30fc","text":"<p>\u6708\u6b21\u30ec\u30d3\u30e5\u30fc\uff1a <pre><code>\u25a1 \u30b3\u30b9\u30c8\u5206\u6790\n  - \u4e88\u7b97\u3068\u306e\u6bd4\u8f03\n  - \u4e0d\u8981\u30ea\u30bd\u30fc\u30b9\u78ba\u8a8d\n\n\u25a1 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u76e3\u67fb\n  - \u30a2\u30af\u30bb\u30b9\u6a29\u9650\u30ec\u30d3\u30e5\u30fc\n  - \u30dd\u30ea\u30b7\u30fc\u9075\u5b88\u78ba\u8a8d\n\n\u25a1 \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u5206\u6790\n  - \u30ea\u30bd\u30fc\u30b9\u4f7f\u7528\u7387\n  - \u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u7279\u5b9a\n\n\u25a1 \u30a4\u30f3\u30b7\u30c7\u30f3\u30c8\u632f\u308a\u8fd4\u308a\n  - \u767a\u751f\u3057\u305f\u30c8\u30e9\u30d6\u30eb\n  - \u6539\u5584\u7b56\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#9-2","title":"9-2. \u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7","text":"<p>\u5b9a\u671f\u7684\u306b\u66f4\u65b0\uff1a <pre><code>\u25a1 Terraform\n\u25a1 Azure Provider\n\u25a1 \u30e2\u30b8\u30e5\u30fc\u30eb\n\u25a1 \u30dd\u30ea\u30b7\u30fc\u5b9a\u7fa9\n</code></pre></p> <p>\u624b\u9806\uff1a <pre><code>1. \u5909\u66f4\u5c65\u6b74\u78ba\u8a8d\n2. \u958b\u767a\u74b0\u5883\u3067\u30c6\u30b9\u30c8\n3. \u554f\u984c\u306a\u3051\u308c\u3070\u672c\u756a\u9069\u7528\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#9-3","title":"9-3. \u6280\u8853\u8ca0\u50b5\u306e\u7ba1\u7406","text":"<p>\u653e\u7f6e\u3057\u306a\u3044\uff1a <pre><code>\u300c\u5f8c\u3067\u76f4\u3059\u300d\u306f\u76f4\u3055\u306a\u3044\n  \u2193\n\u6280\u8853\u8ca0\u50b5\u3068\u3057\u3066\u7ba1\u7406\n  \u2193\n\u8a08\u753b\u7684\u306b\u89e3\u6d88\n</code></pre></p> <p>GitHub Issues\u6d3b\u7528\uff1a <pre><code>Label: tech-debt\n  \u2193\n\u512a\u5148\u5ea6\u3092\u3064\u3051\u308b\n  \u2193\n\u30b9\u30d7\u30ea\u30f3\u30c8\u3054\u3068\u306b\u89e3\u6d88\n</code></pre></p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#_1","title":"\u307e\u3068\u3081","text":"<p>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306e\u67f1\uff1a</p>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#1_1","title":"1. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3","text":"<ul> <li>\u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247</li> <li>MFA\u5fc5\u9808</li> <li>Private Endpoint\u4f7f\u7528</li> <li>\u5b9a\u671f\u7684\u306a\u30ec\u30d3\u30e5\u30fc</li> </ul>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#2_2","title":"2. \u30b3\u30b9\u30c8\u7ba1\u7406","text":"<ul> <li>\u4e8b\u524d\u898b\u7a4d\u3082\u308a</li> <li>\u30bf\u30b0\u6226\u7565</li> <li>\u81ea\u52d5\u505c\u6b62</li> <li>\u30b3\u30b9\u30c8\u30a2\u30e9\u30fc\u30c8</li> </ul>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#3-infrastructure-as-code_1","title":"3. Infrastructure as Code","text":"<ul> <li>\u5168\u90e8\u30b3\u30fc\u30c9\u5316</li> <li>State\u306f\u30ea\u30e2\u30fc\u30c8</li> <li>\u30e2\u30b8\u30e5\u30fc\u30eb\u5316</li> <li>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> </ul>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#4_1","title":"4. \u30c1\u30fc\u30e0\u5354\u696d","text":"<ul> <li>\u30d6\u30e9\u30f3\u30c1\u6226\u7565</li> <li>PR\u30eb\u30fc\u30eb</li> <li>\u30b3\u30fc\u30c9\u30ec\u30d3\u30e5\u30fc</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> </ul>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#5_1","title":"5. \u76e3\u8996\u3068\u904b\u7528","text":"<ul> <li>Log Analytics</li> <li>\u30a2\u30e9\u30fc\u30c8\u8a2d\u5b9a</li> <li>\u30d0\u30c3\u30af\u30a2\u30c3\u30d7</li> <li>DR\u8a08\u753b</li> </ul>"},{"location":"16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/#6_1","title":"6. \u7d99\u7d9a\u7684\u6539\u5584","text":"<ul> <li>\u5b9a\u671f\u30ec\u30d3\u30e5\u30fc</li> <li>\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7</li> <li>\u6280\u8853\u8ca0\u50b5\u7ba1\u7406</li> </ul> <p>\u91cd\u8981\u306a\u30de\u30a4\u30f3\u30c9\u30bb\u30c3\u30c8\uff1a <pre><code>\u5b8c\u74a7\u3092\u76ee\u6307\u3055\u306a\u3044\n  \u2193\n\u307e\u305a\u52d5\u304b\u3059\n  \u2193\n\u7d99\u7d9a\u7684\u306b\u6539\u5584\n</code></pre></p> <p>\u6b21\u306f\u6700\u5f8c\u306eChapter 17\uff08FAQ\uff09\u3067\u3059\uff01 \u3088\u304f\u3042\u308b\u8cea\u554f\u3092\u307e\u3068\u3081\u308b\u306d\u3002</p> <p>\u6240\u8981\u6642\u9593: 60\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2605\u2605\u2606 \u524d: 15_\u30ab\u30b9\u30bf\u30de\u30a4\u30ba.md \u6b21: 17_FAQ.md</p>"},{"location":"17_FAQ/","title":"17. FAQ - \u3088\u304f\u3042\u308b\u8cea\u554f","text":""},{"location":"17_FAQ/#chapter","title":"\u3053\u306eChapter\u3067\u3084\u308b\u3053\u3068","text":"<p>Azure Landing Zones\u306b\u95a2\u3059\u308b\u3088\u304f\u3042\u308b\u8cea\u554f\u3092\u307e\u3068\u3081\u305f\u3088\u3002</p> <p>\u56f0\u3063\u305f\u3068\u304d\u306f\u3053\u3053\u3092\u898b\u3066\u304f\u3060\u3055\u3044\uff01</p>"},{"location":"17_FAQ/#_1","title":"\u57fa\u672c\u7de8","text":""},{"location":"17_FAQ/#q1-azure-landing-zones","title":"Q1: Azure Landing Zones\u3063\u3066\u4f55\uff1f","text":"<p>A: Azure\u3092\u4f01\u696d\u3067\u4f7f\u3046\u305f\u3081\u306e\u300c\u571f\u53f0\u300d\u3067\u3059\u3002</p> <pre><code>\u500b\u4eba\u3067\u4f7f\u3046\uff1a\n- \u9069\u5f53\u306b\u30ea\u30bd\u30fc\u30b9\u4f5c\u3063\u3066OK\n\n\u4f01\u696d\u3067\u4f7f\u3046\uff1a\n- \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\n- \u30ac\u30d0\u30ca\u30f3\u30b9\n- \u30b3\u30b9\u30c8\u7ba1\u7406\n- \u8907\u6570\u30c1\u30fc\u30e0\n\u2192 \u3061\u3083\u3093\u3068\u3057\u305f\u69cb\u9020\u304c\u5fc5\u8981\n  \u2193\n\u305d\u308c\u304cAzure Landing Zones\n</code></pre> <p>\u69cb\u6210\u8981\u7d20\uff1a - Management Group\uff08\u7d44\u7e54\u968e\u5c64\uff09 - Policy\uff08\u30eb\u30fc\u30eb\uff09 - Network\uff08Hub-and-Spoke\uff09 - Logging\uff08\u76e3\u8996\uff09</p>"},{"location":"17_FAQ/#q2-azure-landing-zones","title":"Q2: \u5fc5\u305aAzure Landing Zones\u3092\u4f7f\u308f\u306a\u3044\u3068\u30c0\u30e1\uff1f","text":"<p>A: \u3044\u3084\u3001\u7d76\u5bfe\u3058\u3083\u306a\u3044\u3002</p> <p>\u4f7f\u3063\u305f\u65b9\u304c\u3044\u3044\u5834\u5408\uff1a <pre><code>\u2713 \u8907\u6570\u306e\u30c1\u30fc\u30e0\u30fb\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n\u2713 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8981\u4ef6\u304c\u53b3\u3057\u3044\n\u2713 \u30ac\u30d0\u30ca\u30f3\u30b9\u304c\u5fc5\u8981\n\u2713 \u9577\u671f\u904b\u7528\n\u2713 \u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\n</code></pre></p> <p>\u4f7f\u308f\u306a\u304f\u3066\u3082\u3044\u3044\u5834\u5408\uff1a <pre><code>\u2713 \u500b\u4eba\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n\u2713 \u5c0f\u898f\u6a21\uff08VM\u6570\u53f0\uff09\n\u2713 \u77ed\u671f\u9593\u306e\u691c\u8a3c\n\u2713 PoC\uff08\u6982\u5ff5\u5b9f\u8a3c\uff09\n</code></pre></p> <p>\u5224\u65ad\u57fa\u6e96\uff1a <pre><code>Subscription 1\u500b\u3001VM 10\u53f0\u4ee5\u4e0b\n  \u2193\n\u666e\u901a\u306bAzure\u30ea\u30bd\u30fc\u30b9\u4f5c\u308b\u3060\u3051\u3067OK\n\nSubscription 3\u500b\u4ee5\u4e0a\u3001\u8907\u6570\u90e8\u7f72\n  \u2193\nAzure Landing Zones\u4f7f\u304a\u3046\n</code></pre></p>"},{"location":"17_FAQ/#q3","title":"Q3: \u30c7\u30d7\u30ed\u30a4\u306b\u3069\u306e\u304f\u3089\u3044\u6642\u9593\u304b\u304b\u308b\uff1f","text":"<p>A: \u521d\u56de\u306f2\u301c3\u6642\u9593\u3002</p> <p>\u5185\u8a33\uff1a <pre><code>\u6e96\u5099\uff08Azure\u3001GitHub\u8a2d\u5b9a\uff09: 1\u6642\u9593\n\u521d\u56de\u30c7\u30d7\u30ed\u30a4: 1\u6642\u9593\n\u52d5\u4f5c\u78ba\u8a8d: 30\u5206\n</code></pre></p> <p>2\u56de\u76ee\u4ee5\u964d\uff1a <pre><code>\u5909\u66f4\u5185\u5bb9\u306b\u3088\u308b\n- \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u8ffd\u52a0: 5\u5206\n- Firewall\u4f5c\u6210: 30\u301c60\u5206\n- Management Group\u8ffd\u52a0: 10\u5206\n</code></pre></p>"},{"location":"17_FAQ/#q4","title":"Q4: \u3044\u304f\u3089\u304b\u304b\u308b\uff1f","text":"<p>A: \u69cb\u6210\u306b\u3088\u308b\u3002</p> <p>\u6700\u5c0f\u69cb\u6210\uff08\u958b\u767a\u74b0\u5883\uff09\uff1a <pre><code>VNet: \u7121\u6599\nLog Analytics: 5GB/\u6708\u307e\u3067\u7121\u6599\nManagement Group: \u7121\u6599\nPolicy: \u7121\u6599\n----------\n\u5408\u8a08: \u307b\u307c0\u5186/\u6708\n</code></pre></p> <p>\u6a19\u6e96\u69cb\u6210\uff08\u672c\u756a\u74b0\u5883\uff09\uff1a <pre><code>Firewall Standard: 17\u4e07\u5186/\u6708\nVPN Gateway: 4\u4e07\u5186/\u6708\nBastion: 2.7\u4e07\u5186/\u6708\nLog Analytics: 1\u4e07\u5186/\u6708\n----------\n\u5408\u8a08: \u7d0425\u4e07\u5186/\u6708\n</code></pre></p> <p>\u30d5\u30eb\u69cb\u6210\uff08\u5927\u898f\u6a21\uff09\uff1a <pre><code>Firewall Premium: 25\u4e07\u5186/\u6708\nDDoS Protection: 40\u4e07\u5186/\u6708\nExpressRoute: 10\u4e07\u5186/\u6708\nVPN Gateway: 4\u4e07\u5186/\u6708\nBastion: 2.7\u4e07\u5186/\u6708\n----------\n\u5408\u8a08: \u7d0480\u4e07\u5186/\u6708\n</code></pre></p> <p>\u30b3\u30b9\u30c8\u524a\u6e1b\u306e\u30b3\u30c4\uff1a - \u958b\u767a\u74b0\u5883\u306fFirewall\u7121\u52b9\u5316 - DDoS Protection\u306f\u672c\u756a\u306e\u307f - VM\u81ea\u52d5\u505c\u6b62 - Reserved Instances\u6d3b\u7528</p>"},{"location":"17_FAQ/#q5-terraform","title":"Q5: Terraform\u3058\u3083\u306a\u3044\u3068\u30c0\u30e1\uff1f","text":"<p>A: \u3044\u3084\u3001\u4ed6\u306e\u65b9\u6cd5\u3082\u3042\u308b\u3002</p> <p>\u9078\u629e\u80a2\uff1a 1. Terraform\uff08\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\uff09    - \u30e1\u30ea\u30c3\u30c8\uff1a\u67d4\u8edf\u3001\u30de\u30eb\u30c1\u30af\u30e9\u30a6\u30c9\u3001\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u5927\u304d\u3044    - \u30c7\u30e1\u30ea\u30c3\u30c8\uff1a\u5b66\u7fd2\u30b3\u30b9\u30c8</p> <ol> <li>Bicep\uff08Azure\u516c\u5f0f\uff09</li> <li>\u30e1\u30ea\u30c3\u30c8\uff1aAzure\u5c02\u7528\u3001\u30b7\u30f3\u30d7\u30eb</li> <li> <p>\u30c7\u30e1\u30ea\u30c3\u30c8\uff1aAzure\u9650\u5b9a</p> </li> <li> <p>Azure Portal\uff08GUI\uff09</p> </li> <li>\u30e1\u30ea\u30c3\u30c8\uff1a\u7c21\u5358</li> <li> <p>\u30c7\u30e1\u30ea\u30c3\u30c8\uff1a\u518d\u73fe\u6027\u306a\u3044\u3001\u81ea\u52d5\u5316\u3067\u304d\u306a\u3044</p> </li> <li> <p>Azure CLI/PowerShell</p> </li> <li>\u30e1\u30ea\u30c3\u30c8\uff1a\u30b9\u30af\u30ea\u30d7\u30c8\u5316\u3067\u304d\u308b</li> <li>\u30c7\u30e1\u30ea\u30c3\u30c8\uff1a\u8907\u96d1\u306b\u306a\u308b</li> </ol> <p>\u63a8\u5968\uff1a <pre><code>\u5c0f\u898f\u6a21 \u2192 Azure Portal\uff08\u697d\uff09\n\u4e2d\u898f\u6a21 \u2192 Bicep\uff08\u30d0\u30e9\u30f3\u30b9\u826f\u3044\uff09\n\u5927\u898f\u6a21 \u2192 Terraform\uff08\u67d4\u8edf\uff09\n</code></pre></p>"},{"location":"17_FAQ/#_2","title":"\u30c7\u30d7\u30ed\u30a4\u7de8","text":""},{"location":"17_FAQ/#q6-azure","title":"Q6: \u65e2\u5b58\u306eAzure\u74b0\u5883\u306b\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u308b\uff1f","text":"<p>A: \u3067\u304d\u308b\u3051\u3069\u6ce8\u610f\u304c\u5fc5\u8981\u3002</p> <p>\u554f\u984c\u70b9\uff1a <pre><code>\u65e2\u5b58\u306eManagement Group\u304c\u3042\u308b\n  \u2193\nTerraform\u306e\u7ba1\u7406\u4e0b\u306b\u5165\u308c\u308b\u5fc5\u8981\n  \u2193\nterraform import\n</code></pre></p> <p>\u624b\u9806\uff1a <pre><code># \u65e2\u5b58Management Group\u3092import\nterraform import 'module.management_groups[0].azurerm_management_group.level_1[\"existing-mg\"]' /providers/Microsoft.Management/managementGroups/existing-mg\n\n# Plan\u78ba\u8a8d\nterraform plan\n\n# \u5dee\u5206\u304c\u3042\u308c\u3070\u8abf\u6574\n</code></pre></p> <p>\u63a8\u5968\uff1a <pre><code>\u65b0\u3057\u3044Azure\u74b0\u5883\u3067\u59cb\u3081\u308b\n  \u2193\n\u65e2\u5b58\u74b0\u5883\u306f\u79fb\u884c\u8a08\u753b\u3092\u7acb\u3066\u308b\n</code></pre></p>"},{"location":"17_FAQ/#q7","title":"Q7: \u8907\u6570\u74b0\u5883\uff08\u672c\u756a\u30fb\u958b\u767a\uff09\u3092\u3069\u3046\u7ba1\u7406\u3059\u308b\uff1f","text":"<p>A: \u65b9\u6cd5\u306f3\u3064\u3002</p>"},{"location":"17_FAQ/#1-state","title":"\u65b9\u6cd51: \u540c\u3058\u30ea\u30dd\u30b8\u30c8\u30ea\u3001\u5225State\uff08\u63a8\u5968\uff09","text":"<pre><code>alz-mgmt/\n\u251c\u2500\u2500 environments/\n\u2502   \u251c\u2500\u2500 production/\n\u2502   \u2502   \u2514\u2500\u2500 terraform.tfvars.json\n\u2502   \u2514\u2500\u2500 development/\n\u2502       \u2514\u2500\u2500 terraform.tfvars.json\n\u251c\u2500\u2500 main.tf\n\u2514\u2500\u2500 ...\n</code></pre> <p>\u30c7\u30d7\u30ed\u30a4\uff1a <pre><code># \u672c\u756a\ncd environments/production\nterraform init -backend-config=\"key=prod.tfstate\"\nterraform apply -var-file=terraform.tfvars.json\n\n# \u958b\u767a\ncd environments/development\nterraform init -backend-config=\"key=dev.tfstate\"\nterraform apply -var-file=terraform.tfvars.json\n</code></pre></p>"},{"location":"17_FAQ/#2-terraform-workspace","title":"\u65b9\u6cd52: Terraform Workspace","text":"<pre><code># Workspace\u4f5c\u6210\nterraform workspace new production\nterraform workspace new development\n\n# \u5207\u308a\u66ff\u3048\nterraform workspace select production\nterraform apply\n\nterraform workspace select development\nterraform apply\n</code></pre>"},{"location":"17_FAQ/#3","title":"\u65b9\u6cd53: \u5b8c\u5168\u306b\u5225\u30ea\u30dd\u30b8\u30c8\u30ea","text":"<pre><code>alz-mgmt-production/\nalz-mgmt-development/\n</code></pre> <p>\u63a8\u5968\uff1a\u65b9\u6cd51\uff08\u5225State\uff09</p>"},{"location":"17_FAQ/#q8","title":"Q8: \u30c7\u30d7\u30ed\u30a4\u4e2d\u306b\u5931\u6557\u3057\u305f\u3089\u3069\u3046\u3059\u308b\uff1f","text":"<p>A: \u307e\u305a\u843d\u3061\u7740\u3044\u3066\u78ba\u8a8d\u3002</p> <p>\u624b\u9806\uff1a <pre><code>1. \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u78ba\u8a8d\n2. Chapter 14\uff08\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\uff09\u3092\u898b\u308b\n3. Azure\u306e\u72b6\u614b\u78ba\u8a8d\n4. terraform state\u78ba\u8a8d\n5. \u518d\u5ea6terraform apply\n</code></pre></p> <p>\u3088\u304f\u3042\u308b\u5931\u6557\uff1a <pre><code>- Firewall\u4f5c\u6210\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n  \u2192 \u3082\u3046\u4e00\u5ea6terraform apply\n\n- State Lock\n  \u2192 terraform force-unlock\n\n- \u6a29\u9650\u30a8\u30e9\u30fc\n  \u2192 Service Principal\u306e\u6a29\u9650\u78ba\u8a8d\n</code></pre></p> <p>\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\uff1a <pre><code># \u6700\u5f8c\u306eCommit\u306b\u623b\u3059\ngit revert HEAD\ngit push\n\n# \u307e\u305f\u306fDestroy\u3057\u3066\u518d\u4f5c\u6210\nterraform destroy\nterraform apply\n</code></pre></p>"},{"location":"17_FAQ/#q9-github-actions","title":"Q9: GitHub Actions\u306a\u3057\u3067\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u308b\uff1f","text":"<p>A: \u3067\u304d\u308b\u3002\u30ed\u30fc\u30ab\u30eb\u3067\u5b9f\u884c\u3059\u308c\u3070OK\u3002</p> <p>\u30ed\u30fc\u30ab\u30eb\u5b9f\u884c\uff1a <pre><code># \u74b0\u5883\u5909\u6570\u8a2d\u5b9a\nexport ARM_STORAGE_ACCOUNT_NAME=\"...\"\nexport ARM_CONTAINER_NAME=\"tfstate\"\nexport ARM_KEY=\"alz-mgmt.tfstate\"\nexport ARM_RESOURCE_GROUP_NAME=\"rg-terraform-state\"\n\n# Azure\u30ed\u30b0\u30a4\u30f3\naz login\n\n# \u30c7\u30d7\u30ed\u30a4\nterraform init\nterraform plan\nterraform apply\n</code></pre></p> <p>\u30e1\u30ea\u30c3\u30c8\uff1a <pre><code>- \u30b7\u30f3\u30d7\u30eb\n- \u8a2d\u5b9a\u304c\u5c11\u306a\u3044\n</code></pre></p> <p>\u30c7\u30e1\u30ea\u30c3\u30c8\uff1a <pre><code>- \u81ea\u52d5\u5316\u3055\u308c\u306a\u3044\n- \u30c1\u30fc\u30e0\u5354\u696d\u3057\u306b\u304f\u3044\n- \u5c65\u6b74\u304c\u6b8b\u308a\u306b\u304f\u3044\n</code></pre></p> <p>\u63a8\u5968\uff1a <pre><code>\u6700\u521d\u306f\u30ed\u30fc\u30ab\u30eb\n  \u2193\n\u6163\u308c\u305f\u3089GitHub Actions\n</code></pre></p>"},{"location":"17_FAQ/#_3","title":"\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7de8","text":""},{"location":"17_FAQ/#q10-hub-and-spokevirtual-wan","title":"Q10: Hub-and-Spoke\u3068Virtual WAN\u3001\u3069\u3063\u3061\u9078\u3076\uff1f","text":"<p>A: \u898f\u6a21\u3068\u8981\u4ef6\u3067\u6c7a\u3081\u308b\u3002</p> <p>Hub-and-Spoke\uff1a <pre><code>\u2713 \u5c0f\u301c\u4e2d\u898f\u6a21\uff08VNet 10\u500b\u4ee5\u4e0b\uff09\n\u2713 \u5358\u4e00\u301c\u6570\u30ea\u30fc\u30b8\u30e7\u30f3\n\u2713 \u30b3\u30b9\u30c8\u91cd\u8996\n\u2713 \u7d30\u304b\u3044\u5236\u5fa1\u304c\u5fc5\u8981\n\u2713 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3057\u305f\u3044\n\n\u4f8b\uff1a\n- \u56fd\u5185\u306e\u307f\u5c55\u958b\n- Spoke VNet 5\u500b\n- VPN\u63a5\u7d9a 1\u301c2\u672c\n- \u30b3\u30b9\u30c8: \u7d04\u00a550\u4e07/\u6708\n</code></pre></p> <p>Virtual WAN\uff1a <pre><code>\u2713 \u5927\u898f\u6a21\uff08VNet 10\u500b\u4ee5\u4e0a\uff09\n\u2713 \u591a\u6570\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\uff085+\uff09\n\u2713 \u591a\u6570\u306eVPN\u63a5\u7d9a\uff0810+\uff09\n\u2713 \u30b0\u30ed\u30fc\u30d0\u30eb\u5c55\u958b\n\u2713 \u7ba1\u7406\u306e\u7c21\u7d20\u5316\u91cd\u8996\n\u2713 Microsoft\u306b\u4efb\u305b\u305f\u3044\n\n\u4f8b\uff1a\n- \u4e16\u754c10\u30ea\u30fc\u30b8\u30e7\u30f3\n- Spoke VNet 50\u500b\n- \u62e0\u70b9VPN\u63a5\u7d9a 100\u672c\n- \u30b3\u30b9\u30c8: \u7d04\u00a5150\u4e07/\u6708\n</code></pre></p> <p>\u5224\u65ad\u57fa\u6e96\uff1a <pre><code>VNet 10\u500b\u4ee5\u4e0b \u2192 Hub-and-Spoke\nVNet 10\u500b\u4ee5\u4e0a \u2192 Virtual WAN\n\n\u30ea\u30fc\u30b8\u30e7\u30f3 3\u500b\u4ee5\u4e0b \u2192 Hub-and-Spoke\n\u30ea\u30fc\u30b8\u30e7\u30f3 4\u500b\u4ee5\u4e0a \u2192 Virtual WAN\n\nVPN\u62e0\u70b9 10\u500b\u4ee5\u4e0b \u2192 Hub-and-Spoke\nVPN\u62e0\u70b9 10\u500b\u4ee5\u4e0a \u2192 Virtual WAN\n\n\u521d\u3081\u3066\u306eLanding Zones \u2192 Hub-and-Spoke\uff08\u5b66\u7fd2\u3057\u3084\u3059\u3044\uff09\n</code></pre></p> <p>\u8a73\u7d30\uff1aChapter 10\u3068Chapter 11\u3067\u8a73\u3057\u304f\u89e3\u8aac\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"17_FAQ/#q105-hub-and-spokevirtual-wan","title":"Q10.5: Hub-and-Spoke\u304b\u3089Virtual WAN\u306b\u79fb\u884c\u3067\u304d\u308b\uff1f","text":"<p>A: \u3067\u304d\u308b\u3051\u3069\u3001\u7d50\u69cb\u5927\u5909\u3002</p> <p>\u79fb\u884c\u624b\u9806\uff08\u6982\u8981\uff09\uff1a <pre><code>1. Virtual WAN\u4f5c\u6210\n2. Virtual Hub\u4f5c\u6210\uff08\u65e2\u5b58Hub\u3068\u5225\u30ea\u30fc\u30b8\u30e7\u30f3\u63a8\u5968\uff09\n3. Spoke VNet\u3092\u65b0Hub\u306b\u63a5\u7d9a\n4. DNS\u3068\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5207\u308a\u66ff\u3048\n5. \u65e2\u5b58Hub\u306e\u505c\u6b62\n6. \u52d5\u4f5c\u78ba\u8a8d\n7. \u65e2\u5b58Hub\u524a\u9664\n</code></pre></p> <p>\u30c0\u30a6\u30f3\u30bf\u30a4\u30e0\uff1a <pre><code>\u8a08\u753b\u7684\u306b\u5207\u308a\u66ff\u3048\u308c\u3070\u6700\u5c0f\u9650\uff08\u6570\u5206\u301c\u6570\u6642\u9593\uff09\n</code></pre></p> <p>\u30b3\u30b9\u30c8\u5f71\u97ff\uff1a <pre><code>\u79fb\u884c\u671f\u9593\u4e2d\uff1a\u4e21\u65b9\u306e\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308b\n\u79fb\u884c\u5f8c\uff1aVirtual WAN\u306e\u65b9\u304c\u9ad8\u3044\uff08\u7d042\u301c3\u500d\uff09\n</code></pre></p> <p>\u63a8\u5968\uff1a <pre><code>\u6700\u521d\u304b\u3089Virtual WAN\u306b\u3059\u308b\u304b\u3001Hub-and-Spoke\u3067\u5341\u5206\u304b\u614e\u91cd\u306b\u691c\u8a0e\u3002\n\u79fb\u884c\u306f\u53ef\u80fd\u3060\u3051\u3069\u3001\u6700\u521d\u306e\u9078\u629e\u304c\u91cd\u8981\u3002\n</code></pre></p>"},{"location":"17_FAQ/#q106","title":"Q10.6: \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u306e\u968e\u5c64\u306f\u3069\u3046\u8a2d\u8a08\u3059\u308b\uff1f","text":"<p>A: \u7d44\u7e54\u69cb\u9020\u306b\u5408\u308f\u305b\u308b\u3002</p> <p>\u57fa\u672c\u30d1\u30bf\u30fc\u30f3\uff08\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\uff09\uff1a <pre><code>Root\n\u2514\u2500\u2500 Azure Landing Zones\n    \u251c\u2500\u2500 Platform\uff08\u57fa\u76e4\u30c1\u30fc\u30e0\u7ba1\u7406\uff09\n    \u2502   \u251c\u2500\u2500 Management\uff08\u76e3\u8996\uff09\n    \u2502   \u251c\u2500\u2500 Connectivity\uff08\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09\n    \u2502   \u2514\u2500\u2500 Identity\uff08\u8a8d\u8a3c\uff09\n    \u251c\u2500\u2500 Landing Zones\uff08\u30a2\u30d7\u30ea\u30c1\u30fc\u30e0\u7ba1\u7406\uff09\n    \u2502   \u251c\u2500\u2500 Corp\uff08\u793e\u5185\u5411\u3051\uff09\n    \u2502   \u2514\u2500\u2500 Online\uff08\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u516c\u958b\uff09\n    \u251c\u2500\u2500 Sandbox\uff08\u5b9f\u9a13\u7528\uff09\n    \u2514\u2500\u2500 Decommissioned\uff08\u5ec3\u6b62\u4e88\u5b9a\uff09\n</code></pre></p> <p>\u5927\u4f01\u696d\u30d1\u30bf\u30fc\u30f3\uff08\u90e8\u9580\u5225\uff09\uff1a <pre><code>Root\n\u2514\u2500\u2500 Azure Landing Zones\n    \u251c\u2500\u2500 Platform\n    \u251c\u2500\u2500 Division A\uff08\u55b6\u696d\u90e8\u9580\uff09\n    \u2502   \u251c\u2500\u2500 Production\n    \u2502   \u2514\u2500\u2500 Development\n    \u251c\u2500\u2500 Division B\uff08\u958b\u767a\u90e8\u9580\uff09\n    \u2502   \u251c\u2500\u2500 Production\n    \u2502   \u2514\u2500\u2500 Development\n    \u2514\u2500\u2500 Shared Services\uff08\u5171\u6709\u30b5\u30fc\u30d3\u30b9\uff09\n</code></pre></p> <p>\u30b0\u30ed\u30fc\u30d0\u30eb\u4f01\u696d\u30d1\u30bf\u30fc\u30f3\uff08\u5730\u57df\u5225\uff09\uff1a <pre><code>Root\n\u2514\u2500\u2500 Azure Landing Zones\n    \u251c\u2500\u2500 Platform\n    \u251c\u2500\u2500 Asia Pacific\n    \u2502   \u251c\u2500\u2500 Japan\n    \u2502   \u2514\u2500\u2500 Singapore\n    \u251c\u2500\u2500 Europe\n    \u2502   \u251c\u2500\u2500 UK\n    \u2502   \u2514\u2500\u2500 Germany\n    \u2514\u2500\u2500 Americas\n        \u251c\u2500\u2500 US East\n        \u2514\u2500\u2500 US West\n</code></pre></p> <p>\u8a2d\u8a08\u306e\u30dd\u30a4\u30f3\u30c8\uff1a 1. \u968e\u5c64\u306f3\u301c4\u5c64\u307e\u3067\uff08\u6df1\u3059\u304e\u308b\u3068\u7ba1\u7406\u304c\u8907\u96d1\uff09 2. \u8cac\u4efb\u7bc4\u56f2\u3067\u5206\u3051\u308b\uff08\u8ab0\u304c\u7ba1\u7406\u3059\u308b\u304b\uff09 3. \u30dd\u30ea\u30b7\u30fc\u306e\u7d99\u627f\u3092\u8003\u3048\u308b\uff08\u89aa\u306e\u8a2d\u5b9a\u304c\u5b50\u306b\u9069\u7528\u3055\u308c\u308b\uff09 4. \u5c06\u6765\u306e\u62e1\u5f35\u3092\u8003\u616e\uff08\u5f8c\u304b\u3089\u8ffd\u52a0\u3057\u3084\u3059\u304f\uff09</p> <p>\u8a73\u7d30\uff1aChapter 08\u3067\u8a73\u3057\u304f\u89e3\u8aac\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"17_FAQ/#q107","title":"Q10.7: \u30ea\u30fc\u30b8\u30e7\u30f3\u306f\u4f55\u500b\u5fc5\u8981\uff1f","text":"<p>A: \u8981\u4ef6\u306b\u3088\u308b\u3002</p> <p>\u6700\u5c0f\u69cb\u6210\uff081\u30ea\u30fc\u30b8\u30e7\u30f3\uff09\uff1a <pre><code>\u2713 \u707d\u5bb3\u5bfe\u7b56\u4e0d\u8981\uff08\u5272\u308a\u5207\u308a\uff09\n\u2713 \u30b3\u30b9\u30c8\u6700\u91cd\u8996\n\u2713 \u691c\u8a3c\u74b0\u5883\n\n\u4f8b\uff1a\n- Japan East \u306e\u307f\n- \u30b3\u30b9\u30c8: \u7d04\u00a550\u4e07/\u6708\n</code></pre></p> <p>\u63a8\u5968\u69cb\u6210\uff082\u30ea\u30fc\u30b8\u30e7\u30f3\uff09\uff1a <pre><code>\u2713 \u707d\u5bb3\u5bfe\u7b56\u3042\u308a\uff08\u57fa\u672c\uff09\n\u2713 \u30d0\u30e9\u30f3\u30b9\u91cd\u8996\n\u2713 \u672c\u756a\u74b0\u5883\n\n\u4f8b\uff1a\n- Japan East\uff08\u30d7\u30e9\u30a4\u30de\u30ea\uff09\n- Japan West\uff08\u30bb\u30ab\u30f3\u30c0\u30ea\uff09\n- \u30b3\u30b9\u30c8: \u7d04\u00a5100\u4e07/\u6708\n</code></pre></p> <p>\u30b0\u30ed\u30fc\u30d0\u30eb\u69cb\u6210\uff083+\u30ea\u30fc\u30b8\u30e7\u30f3\uff09\uff1a <pre><code>\u2713 \u30b0\u30ed\u30fc\u30d0\u30eb\u5c55\u958b\n\u2713 \u4f4e\u9045\u5ef6\uff08\u30e6\u30fc\u30b6\u30fc\u306b\u8fd1\u3044\uff09\n\u2713 \u898f\u5236\u5bfe\u5fdc\uff08\u30c7\u30fc\u30bf\u3092\u56fd\u5916\u306b\u51fa\u305b\u306a\u3044\uff09\n\n\u4f8b\uff1a\n- Japan East\n- Southeast Asia\n- East US\n- West Europe\n- \u30b3\u30b9\u30c8: \u7d04\u00a5300\u4e07/\u6708\n</code></pre></p> <p>\u5224\u65ad\u57fa\u6e96\uff1a <pre><code>RPO/RTO\u8981\u4ef6\u306a\u3057 \u2192 1\u30ea\u30fc\u30b8\u30e7\u30f3\nRPO/RTO\u8981\u4ef6\u3042\u308a \u2192 2\u30ea\u30fc\u30b8\u30e7\u30f3\n\u6d77\u5916\u30e6\u30fc\u30b6\u30fc\u3042\u308a \u2192 3+\u30ea\u30fc\u30b8\u30e7\u30f3\n</code></pre></p> <p>\u6ce8\u610f\u70b9\uff1a - \u30ea\u30fc\u30b8\u30e7\u30f3\u9593\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u306f\u8ab2\u91d1\u3055\u308c\u308b - \u7ba1\u7406\u304c\u8907\u96d1\u306b\u306a\u308b\uff08\u30ea\u30fc\u30b8\u30e7\u30f3\u6570 \u00d7 \u8a2d\u5b9a\u6570\uff09 - \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f2\u30ea\u30fc\u30b8\u30e7\u30f3\u69cb\u6210</p>"},{"location":"17_FAQ/#q108-dr","title":"Q10.8: DR\u30b5\u30a4\u30c8\uff08\u707d\u5bb3\u5bfe\u7b56\u30b5\u30a4\u30c8\uff09\u306f\u5fc5\u9808\uff1f","text":"<p>A: \u30d3\u30b8\u30cd\u30b9\u8981\u4ef6\u306b\u3088\u308b\u3002</p> <p>DR\u4e0d\u8981\u306a\u30b1\u30fc\u30b9\uff1a <pre><code>- \u505c\u6b62\u3057\u3066\u3082\u5927\u304d\u306a\u5f71\u97ff\u306a\u3057\n- \u5fa9\u65e7\u306b\u6570\u65e5\u304b\u3051\u3066OK\n- \u30b3\u30b9\u30c8\u6700\u512a\u5148\n- \u691c\u8a3c\u74b0\u5883\n\n\u2192 1\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u5341\u5206\n</code></pre></p> <p>DR\u5fc5\u8981\u306a\u30b1\u30fc\u30b9\uff1a <pre><code>- \u6b62\u307e\u3063\u305f\u3089\u56f0\u308b\uff08EC\u30b5\u30a4\u30c8\u3001\u57fa\u5e79\u30b7\u30b9\u30c6\u30e0\uff09\n- SLA\uff08\u53ef\u7528\u6027\u4fdd\u8a3c\uff09\u304c\u5fc5\u8981\n- \u898f\u5236\u8981\u4ef6\n- \u672c\u756a\u74b0\u5883\n\n\u2192 2\u30ea\u30fc\u30b8\u30e7\u30f3\u69cb\u6210\n</code></pre></p> <p>DR\u306e\u7a2e\u985e\uff1a</p> \u30bf\u30a4\u30d7 RPO RTO \u30b3\u30b9\u30c8 \u8aac\u660e Cold Standby \u6570\u6642\u9593 \u6570\u6642\u9593\u301c1\u65e5 \u4f4e \u5fc5\u8981\u6642\u306b\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210 Warm Standby \u6570\u5206\u301c\u6570\u6642\u9593 \u6570\u6642\u9593 \u4e2d \u6700\u5c0f\u9650\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5e38\u6642\u8d77\u52d5 Hot Standby \u6570\u79d2\u301c\u6570\u5206 \u6570\u5206 \u9ad8 \u5168\u30ea\u30bd\u30fc\u30b9\u3092\u5e38\u6642\u8d77\u52d5\uff08Active-Passive\uff09 Active-Active \u307b\u307c0 \u307b\u307c0 \u6700\u9ad8 \u4e21\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u5e38\u6642\u7a3c\u50cd <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u69cb\u6210\uff1a - **Warm Standby**\u76f8\u5f53 - \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u57fa\u76e4\u306f\u4e21\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u69cb\u7bc9 - \u30a2\u30d7\u30ea\u306f\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u8ffd\u52a0</p> <p>\u8a73\u7d30\uff1aChapter 00\u30672\u62e0\u70b9\u69cb\u6210\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"17_FAQ/#q11-spoke-vnet","title":"Q11: Spoke VNet\u306f\u3044\u304f\u3064\u4f5c\u308c\u308b\uff1f","text":"<p>A: \u5236\u9650\u306f\u3042\u308b\u3051\u3069\u3001\u5b9f\u7528\u4e0a\u306f\u554f\u984c\u306a\u3044\u3002</p> <p>\u5236\u9650\uff1a <pre><code>Hub-and-Spoke\uff1a\n- VNet\u30d4\u30a2\u30ea\u30f3\u30b0: \u6700\u5927500\u500b/VNet\n  \u2193\nSpoke VNet 500\u500b\u307e\u3067\n\nVirtual WAN\uff1a\n- VNet\u63a5\u7d9a: \u5236\u9650\u306a\u3057\uff08\u5b9f\u8cea\u7121\u5236\u9650\uff09\n</code></pre></p> <p>\u5b9f\u7528\u4e0a\uff1a <pre><code>\u307b\u3068\u3093\u3069\u306e\u7d44\u7e54\u306f10\u301c50\u500b\u3067\u5341\u5206\n</code></pre></p>"},{"location":"17_FAQ/#q12","title":"Q12: \u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u3068\u306e\u63a5\u7d9a\u306f\u5fc5\u9808\uff1f","text":"<p>A: \u3044\u3084\u3001\u5fc5\u9808\u3058\u3083\u306a\u3044\u3002</p> <p>\u69cb\u6210\u4f8b\uff1a</p>"},{"location":"17_FAQ/#_4","title":"\u30aa\u30f3\u30d7\u30ec\u63a5\u7d9a\u3042\u308a","text":"<pre><code>\u30aa\u30f3\u30d7\u30ec\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\n  \u2193 VPN / ExpressRoute\nAzure Hub VNet\n  \u2193\nSpoke VNet\uff08\u30a2\u30d7\u30ea\uff09\n</code></pre>"},{"location":"17_FAQ/#_5","title":"\u30aa\u30f3\u30d7\u30ec\u63a5\u7d9a\u306a\u3057\uff08\u30af\u30e9\u30a6\u30c9\u30cd\u30a4\u30c6\u30a3\u30d6\uff09","text":"<pre><code>Azure Hub VNet\n  \u2193\nSpoke VNet\uff08\u30a2\u30d7\u30ea\uff09\n  \u2193\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u7d4c\u7531\u3067\u30e6\u30fc\u30b6\u30fc\u30a2\u30af\u30bb\u30b9\n</code></pre> <p>\u30aa\u30f3\u30d7\u30ec\u63a5\u7d9a\u304c\u5fc5\u8981\u306a\u5834\u5408\uff1a <pre><code>\u2713 \u65e2\u5b58\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u9023\u643a\n\u2713 Active Directory\u9023\u643a\n\u2713 \u30c7\u30fc\u30bf\u79fb\u884c\n\u2713 \u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u30af\u30e9\u30a6\u30c9\n</code></pre></p> <p>\u4e0d\u8981\u306a\u5834\u5408\uff1a <pre><code>\u2713 \u65b0\u898f\u30af\u30e9\u30a6\u30c9\u30cd\u30a4\u30c6\u30a3\u30d6\u30a2\u30d7\u30ea\n\u2713 SaaS\u7684\u306a\u5229\u7528\n\u2713 \u5b8c\u5168\u30af\u30e9\u30a6\u30c9\u79fb\u884c\n</code></pre></p>"},{"location":"17_FAQ/#q13-firewallnsg","title":"Q13: Firewall\u3068NSG\u306e\u9055\u3044\u306f\uff1f","text":"<p>A: \u5f79\u5272\u304c\u9055\u3046\u3002</p> <p>NSG\uff08Network Security Group\uff09\uff1a <pre><code>\u30ec\u30d9\u30eb: \u30b5\u30d6\u30cd\u30c3\u30c8\u30fbNIC\n\u6a5f\u80fd: L4\uff08IP\u30a2\u30c9\u30ec\u30b9\u3001\u30dd\u30fc\u30c8\uff09\n\u7528\u9014: \u57fa\u672c\u7684\u306a\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\n\u30b3\u30b9\u30c8: \u7121\u6599\n</code></pre></p> <p>Azure Firewall\uff1a <pre><code>\u30ec\u30d9\u30eb: VNet\u5168\u4f53\n\u6a5f\u80fd: L7\uff08FQDN\u3001URL\u3001\u8105\u5a01\u691c\u77e5\uff09\n\u7528\u9014: \u9ad8\u5ea6\u306a\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\n\u30b3\u30b9\u30c8: \u7d0417\u4e07\u5186/\u6708\u301c\n</code></pre></p> <p>\u4f7f\u3044\u5206\u3051\uff1a <pre><code>NSG:\n- \u30b5\u30d6\u30cd\u30c3\u30c8\u9593\u306e\u901a\u4fe1\u5236\u5fa1\n- VM\u9593\u306e\u901a\u4fe1\u5236\u5fa1\n- \u57fa\u672c\u7684\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\n\nFirewall:\n- \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5411\u3051\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u5236\u5fa1\n- \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ec\u30d9\u30eb\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\n- \u8105\u5a01\u691c\u77e5\n- \u4e00\u5143\u7ba1\u7406\n</code></pre></p> <p>\u4e21\u65b9\u4f7f\u3046\uff1a <pre><code>Firewall: Hub VNet\u306b\u914d\u7f6e\uff08\u5168\u4f53\u306e\u5236\u5fa1\uff09\nNSG: \u5404\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u914d\u7f6e\uff08\u8a73\u7d30\u5236\u5fa1\uff09\n  \u2193\n\u591a\u5c64\u9632\u5fa1\n</code></pre></p>"},{"location":"17_FAQ/#_6","title":"\u904b\u7528\u7de8","text":""},{"location":"17_FAQ/#q14-terraform","title":"Q14: Terraform\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306f\u3069\u3046\u3059\u308b\uff1f","text":"<p>A: \u6bb5\u968e\u7684\u306b\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3002</p> <p>\u624b\u9806\uff1a <pre><code>1. \u30ea\u30ea\u30fc\u30b9\u30ce\u30fc\u30c8\u78ba\u8a8d\n   https://github.com/hashicorp/terraform/releases\n\n2. \u7834\u58ca\u7684\u5909\u66f4\uff08Breaking Changes\uff09\u78ba\u8a8d\n\n3. \u30ed\u30fc\u30ab\u30eb\u3067\u30c6\u30b9\u30c8\n   terraform init -upgrade\n   terraform plan\n\n4. \u554f\u984c\u306a\u3051\u308c\u3070terraform.tf\u66f4\u65b0\n   terraform {\n     required_version = \"~&gt; 1.13\"  # \u66f4\u65b0\n   }\n\n5. Commit &amp; Deploy\n\n6. GitHub Actions\u8a2d\u5b9a\u3082\u66f4\u65b0\n   terraform_cli_version: '1.13.0'\n</code></pre></p> <p>\u6ce8\u610f\uff1a <pre><code>\u30e1\u30b8\u30e3\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\uff081.x \u2192 2.x\uff09\u306f\u614e\u91cd\u306b\n  \u2193\n\u7834\u58ca\u7684\u5909\u66f4\u304c\u591a\u3044\n  \u2193\n\u5341\u5206\u306a\u30c6\u30b9\u30c8\u304c\u5fc5\u8981\n</code></pre></p>"},{"location":"17_FAQ/#q15","title":"Q15: \u30ea\u30bd\u30fc\u30b9\u3092\u624b\u52d5\u3067\u5909\u66f4\u3057\u3061\u3083\u3063\u305f\u3089\u3069\u3046\u3059\u308b\uff1f","text":"<p>A: Terraform\u306b\u53d6\u308a\u8fbc\u3080\u304b\u3001\u623b\u3059\u3002</p>"},{"location":"17_FAQ/#1-terraform","title":"\u65b9\u6cd51: Terraform\u306b\u53d6\u308a\u8fbc\u3080\uff08\u63a8\u5968\uff09","text":"<pre><code># \u73fe\u5728\u306e\u72b6\u614b\u3092\u53d6\u308a\u8fbc\u3080\nterraform apply -refresh-only\n\n# Plan\u78ba\u8a8d\nterraform plan\n# \"No changes\" \u3068\u8868\u793a\u3055\u308c\u308b\n\n# .tf\u30d5\u30a1\u30a4\u30eb\u3082\u66f4\u65b0\n# \uff08\u624b\u52d5\u5909\u66f4\u5185\u5bb9\u3092\u30b3\u30fc\u30c9\u306b\u53cd\u6620\uff09\n</code></pre>"},{"location":"17_FAQ/#2","title":"\u65b9\u6cd52: \u624b\u52d5\u5909\u66f4\u3092\u623b\u3059","text":"<pre><code># Terraform\u306e\u5b9a\u7fa9\u901a\u308a\u306b\u623b\u3059\nterraform apply\n</code></pre> <p>\u4e88\u9632\u7b56\uff1a <pre><code>Azure Portal\u3067\u306e\u624b\u52d5\u5909\u66f4\u3092\u7981\u6b62\n  \u2193\nPolicy\u8a2d\u5b9a\n  \u2193\n\u7279\u5b9a\u30bf\u30b0\u304c\u306a\u3044\u30ea\u30bd\u30fc\u30b9\u306f\u4f5c\u6210\u4e0d\u53ef\n</code></pre></p>"},{"location":"17_FAQ/#q16-state","title":"Q16: State\u30d5\u30a1\u30a4\u30eb\u304c\u58ca\u308c\u305f\u3089\u3069\u3046\u3059\u308b\uff1f","text":"<p>A: \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304b\u3089\u5fa9\u5143\u3002</p> <p>\u5bfe\u51e6\u6cd5\uff1a</p>"},{"location":"17_FAQ/#_7","title":"\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304c\u3042\u308b\u5834\u5408","text":"<pre><code># State\u30d5\u30a1\u30a4\u30eb\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304b\u3089\u5fa9\u5143\naz storage blob upload \\\n  --account-name $ARM_STORAGE_ACCOUNT_NAME \\\n  --container-name $ARM_CONTAINER_NAME \\\n  --name alz-mgmt.tfstate \\\n  --file ./backups/terraform-state-20260115.json \\\n  --overwrite\n</code></pre>"},{"location":"17_FAQ/#_8","title":"\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304c\u306a\u3044\u5834\u5408","text":"<pre><code># Azure\u306e\u73fe\u72b6\u304b\u3089State\u3092\u518d\u69cb\u7bc9\nterraform import &lt;\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7&gt;.&lt;\u540d\u524d&gt; &lt;Azure Resource ID&gt;\n\n# \u5168\u30ea\u30bd\u30fc\u30b9\u3092import\uff08\u5927\u5909\uff09\nterraform import azurerm_resource_group.management /subscriptions/.../resourceGroups/rg-management\nterraform import azurerm_virtual_network.hub /subscriptions/.../virtualNetworks/vnet-hub\n...\n</code></pre> <p>\u4e88\u9632\u7b56\uff1a <pre><code>\u5b9a\u671f\u7684\u306bState\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n  \u2193\nChapter 16\u306ebackup-tfstate.sh\u3092\u4f7f\u3046\n</code></pre></p>"},{"location":"17_FAQ/#q17","title":"Q17: \u30c1\u30fc\u30e0\u30e1\u30f3\u30d0\u30fc\u304c\u5897\u3048\u305f\u3089\uff1f","text":"<p>A: \u6a29\u9650\u3068\u30d7\u30ed\u30bb\u30b9\u3092\u6574\u5099\u3002</p> <p>\u6a29\u9650\u8a2d\u5b9a\uff1a <pre><code>1. Azure AD Group\u306b\u8ffd\u52a0\n2. GitHub Team\u306b\u8ffd\u52a0\n3. \u5fc5\u8981\u306a\u6a29\u9650\u3092\u4ed8\u4e0e\n   - Reader\uff08\u95b2\u89a7\uff09\n   - Contributor\uff08\u4f5c\u696d\uff09\n   - Owner\uff08\u7ba1\u7406\uff09\n</code></pre></p> <p>\u30d7\u30ed\u30bb\u30b9\u6574\u5099\uff1a <pre><code>1. \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6574\u5099\n   - README\u66f4\u65b0\n   - \u904b\u7528\u624b\u9806\u66f8\n   - \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u56f3\n\n2. \u30aa\u30f3\u30dc\u30fc\u30c7\u30a3\u30f3\u30b0\n   - \u30c4\u30fc\u30eb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n   - \u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n   - \u30da\u30a2\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\n\n3. \u30b3\u30fc\u30c9\u30ec\u30d3\u30e5\u30fc\n   - PR\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n   - \u30ec\u30d3\u30e5\u30fc\u89b3\u70b9\n   - \u627f\u8a8d\u30eb\u30fc\u30eb\n</code></pre></p>"},{"location":"17_FAQ/#_9","title":"\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u7de8","text":""},{"location":"17_FAQ/#q18","title":"Q18: \u547d\u540d\u898f\u5247\u3092\u5909\u3048\u305f\u3044","text":"<p>A: locals.tf\u3092\u4fee\u6b63\u3002</p> <p>\u30c7\u30d5\u30a9\u30eb\u30c8\uff1a <pre><code>rg-myorg-management-001\n</code></pre></p> <p>\u5909\u66f4\u4f8b\uff1a <pre><code>prd-rg-myorg-management-001  # \u74b0\u5883prefix\u8ffd\u52a0\n</code></pre></p> <p>\u5b9f\u88c5\uff1a <pre><code># locals.tf\nlocals {\n  environment_prefix = var.environment  # \"prd\", \"dev\"\n\n  resource_group_name = format(\n    \"%s-rg-%s-%s-%s\",\n    local.environment_prefix,\n    var.root_id,\n    var.purpose,\n    var.default_postfix\n  )\n}\n</code></pre></p> <p>Chapter 15\u306b\u8a73\u3057\u3044\u4f8b\u304c\u3042\u308b\u3088\u3002</p>"},{"location":"17_FAQ/#q19","title":"Q19: \u72ec\u81ea\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u8ffd\u52a0\u3057\u305f\u3044","text":"<p>A: lib/archetype_definitions\u306b\u8ffd\u52a0\u3002</p> <p>\u624b\u9806\uff1a <pre><code># lib/archetype_definitions/corp_custom.alz_archetype_override.yaml\npolicy_definitions_to_add:\n  - name: Custom-Policy-Example\n    display_name: \"My Custom Policy\"\n    mode: \"Indexed\"\n    policy_rule:\n      if:\n        field: \"tags['CostCenter']\"\n        exists: false\n      then:\n        effect: \"deny\"\n\npolicy_assignments_to_add:\n  - Custom-Policy-Example\n</code></pre></p> <p>Chapter 15\u3067\u30ab\u30b9\u30bf\u30e0\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u308a\u65b9\u3092\u89e3\u8aac\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"17_FAQ/#q20-management-group","title":"Q20: Management Group\u69cb\u9020\u3092\u5909\u3048\u305f\u3044","text":"<p>A: lib/architecture_definitions\u3092\u4fee\u6b63\u3002</p> <p>\u624b\u9806\uff1a <pre><code># lib/architecture_definitions/alz_custom.alz_architecture_definition.yaml\nmanagement_groups:\n  - id: myorg\n    display_name: My Organization\n    parent_id: null\n\n  - id: production  # \u8ffd\u52a0\n    display_name: Production\n    parent_id: myorg\n\n  - id: development  # \u8ffd\u52a0\n    display_name: Development\n    parent_id: myorg\n</code></pre></p> <p>Chapter 15\u306b\u8a73\u3057\u304f\u66f8\u3044\u3066\u3042\u308b\u3002</p>"},{"location":"17_FAQ/#_10","title":"\u30c8\u30e9\u30d6\u30eb\u7de8","text":""},{"location":"17_FAQ/#q21-terraform-apply","title":"Q21: terraform apply\u304c\u3081\u3063\u3061\u3083\u9045\u3044","text":"<p>A: Firewall\u304c\u539f\u56e0\u304b\u3082\u3002</p> <p>\u539f\u56e0\uff1a <pre><code>Firewall\u4f5c\u6210: 30\u301c60\u5206\n  \u2193\n\u3069\u3046\u3057\u3088\u3046\u3082\u306a\u3044\n  \u2193\nAzure\u306e\u4ed5\u69d8\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code>\u30b3\u30fc\u30d2\u30fc\u98f2\u3093\u3067\u5f85\u3064\u2615\n</code></pre></p> <p>\u6642\u77ed\u306e\u30b3\u30c4\uff1a <pre><code>\u958b\u767a\u74b0\u5883\u306fFirewall\u7121\u52b9\u5316\n  \u2193\nenabled_resources = {\n  firewall = false\n}\n</code></pre></p>"},{"location":"17_FAQ/#q22-github-actions","title":"Q22: GitHub Actions\u3067\u8b0e\u306e\u30a8\u30e9\u30fc","text":"<p>A: \u30ed\u30fc\u30ab\u30eb\u3067\u518d\u73fe\u3059\u308b\u304b\u78ba\u8a8d\u3002</p> <p>\u624b\u9806\uff1a <pre><code>1. \u30ed\u30fc\u30ab\u30eb\u3067\u540c\u3058\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\n   terraform init\n   terraform plan\n\n2. \u518d\u73fe\u3059\u308b\n   \u2192 \u30b3\u30fc\u30c9\u306e\u554f\u984c\n   \u2192 \u4fee\u6b63\n\n3. \u518d\u73fe\u3057\u306a\u3044\n   \u2192 GitHub Actions\u56fa\u6709\u306e\u554f\u984c\n   \u2192 Secrets\u78ba\u8a8d\n   \u2192 \u6a29\u9650\u78ba\u8a8d\n</code></pre></p> <p>Chapter 14\u306b\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u30ac\u30a4\u30c9\u304c\u3042\u308b\u3002</p>"},{"location":"17_FAQ/#q23-zones-are-not-supported","title":"Q23: \"zones are not supported\"\u30a8\u30e9\u30fc","text":"<p>A: Japan region\u306e\u554f\u984c\u3002</p> <p>\u539f\u56e0\uff1a <pre><code>Japan East/West\u306fAvailability Zones\u975e\u5bfe\u5fdc\n  \u2193\n\u3067\u3082zones\u6307\u5b9a\u3057\u3066\u308b\n  \u2193\n\u30a8\u30e9\u30fc\n</code></pre></p> <p>\u5bfe\u51e6\u6cd5\uff1a <pre><code># NG\nzones = [\"1\", \"2\", \"3\"]\n\n# OK\nzones = []  # \u7a7a\u30ea\u30b9\u30c8\n</code></pre></p> <p>Chapter 3\u3067\u8a73\u3057\u304f\u89e3\u8aac\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"17_FAQ/#_11","title":"\u305d\u306e\u4ed6","text":""},{"location":"17_FAQ/#q24-awsgcp","title":"Q24: \u4ed6\u306e\u30af\u30e9\u30a6\u30c9\uff08AWS\u3001GCP\uff09\u3067\u3082\u4f7f\u3048\u308b\uff1f","text":"<p>A: Terraform\u306a\u3089\u7406\u8ad6\u7684\u306b\u306f\u53ef\u80fd\u3002</p> <p>\u5b9f\u969b\uff1a <pre><code>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\uff1a\n- Azure\u5c02\u7528\n- azurerm\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\n- Azure\u56fa\u6709\u306e\u6a5f\u80fd\n\n\u30de\u30eb\u30c1\u30af\u30e9\u30a6\u30c9\u5316\u3059\u308b\u306b\u306f\uff1a\n- AWS provider\u3092\u8ffd\u52a0\n- AWS\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\n- \u30e2\u30b8\u30e5\u30fc\u30eb\u5206\u96e2\n\u2192 \u304b\u306a\u308a\u5927\u5909\n</code></pre></p> <p>\u63a8\u5968\uff1a <pre><code>Azure: \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\nAWS: AWS Landing Zone\u4f7f\u3046\nGCP: GCP Foundation\u4f7f\u3046\n  \u2193\n\u5404\u30af\u30e9\u30a6\u30c9\u5c02\u7528\u306e\u3082\u306e\u3092\u4f7f\u3046\u65b9\u304c\u697d\n</code></pre></p>"},{"location":"17_FAQ/#q25","title":"Q25: \u30b5\u30dd\u30fc\u30c8\u306f\u3042\u308b\uff1f","text":"<p>A: \u3044\u304f\u3064\u304b\u306e\u9078\u629e\u80a2\u304c\u3042\u308b\u3002</p> <p>\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30b5\u30dd\u30fc\u30c8\uff1a <pre><code>GitHub Issues:\n- \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eIssue\n- \u30e2\u30b8\u30e5\u30fc\u30eb\u306eIssue\n\nStack Overflow:\n- terraform \u30bf\u30b0\n- azure \u30bf\u30b0\n</code></pre></p> <p>\u6709\u511f\u30b5\u30dd\u30fc\u30c8\uff1a <pre><code>Microsoft:\n- Azure \u30b5\u30dd\u30fc\u30c8\u30d7\u30e9\u30f3\n- Professional Services\n\nHashiCorp:\n- Terraform Enterprise\n- \u30b3\u30f3\u30b5\u30eb\u30c6\u30a3\u30f3\u30b0\n\n\u30d1\u30fc\u30c8\u30ca\u30fc:\n- SIer\n- \u30af\u30e9\u30a6\u30c9\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30bf\u30fc\n</code></pre></p>"},{"location":"17_FAQ/#q26","title":"Q26: \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3069\u3053\uff1f","text":"<p>A: \u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u7fa4\u3068\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3002</p> <p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff1a <pre><code>docs_new/\n\u251c\u2500\u2500 00_\u306f\u3058\u3081\u306b.md\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 01_\u57fa\u790e\u77e5\u8b58.md\n\u251c\u2500\u2500 02_\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020.md\n\u251c\u2500\u2500 03_\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5b8c\u5168\u89e3\u8aac.md\n...\n\u2514\u2500\u2500 17_FAQ.md\uff08\u3053\u308c\uff09\n</code></pre></p> <p>\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff1a <pre><code>Terraform:\nhttps://www.terraform.io/docs\n\nAzure Provider:\nhttps://registry.terraform.io/providers/hashicorp/azurerm/latest/docs\n\nAzure Landing Zones\uff08Microsoft\u516c\u5f0f\uff09:\nhttps://docs.microsoft.com/azure/cloud-adoption-framework/ready/landing-zone/\n</code></pre></p>"},{"location":"17_FAQ/#q27","title":"Q27: \u5b66\u7fd2\u30ea\u30bd\u30fc\u30b9\u306f\uff1f","text":"<p>A: \u305f\u304f\u3055\u3093\u3042\u308b\u3002</p> <p>\u7121\u6599\uff1a <pre><code>Microsoft Learn:\nhttps://docs.microsoft.com/learn/azure/\n\nTerraform Tutorial:\nhttps://learn.hashicorp.com/terraform\n\nYouTube:\n- Azure Friday\n- HashiCorp\n</code></pre></p> <p>\u6709\u6599\uff1a <pre><code>Udemy:\n- Azure \u30b3\u30fc\u30b9\n- Terraform \u30b3\u30fc\u30b9\n\nPluralsight:\n- Azure Learning Path\n- Terraform Learning Path\n</code></pre></p> <p>\u5b9f\u8df5\uff1a <pre><code>\u4e00\u756a\u306e\u5b66\u7fd2\u306f\u5b9f\u969b\u306b\u89e6\u308b\u3053\u3068\n  \u2193\n\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u307f\u308b\n  \u2193\n\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u307f\u308b\n  \u2193\n\u58ca\u3057\u3066\u76f4\u3059\n</code></pre></p>"},{"location":"17_FAQ/#q28","title":"Q28: \u672c\u756a\u904b\u7528\u306e\u524d\u306b\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3053\u3068\u306f\uff1f","text":"<p>A: \u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8\u3092\u4f7f\u304a\u3046\u3002</p> <p>\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\uff1a <pre><code>\u25a1 MFA\u6709\u52b9\u5316\n\u25a1 \u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247\n\u25a1 Private Endpoint\u4f7f\u7528\n\u25a1 Secrets\u7ba1\u7406\uff08Key Vault\uff09\n\u25a1 NSG\u30fbFirewall\u8a2d\u5b9a\u78ba\u8a8d\n</code></pre></p> <p>\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a <pre><code>\u25a1 \u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\u91cd\u8907\u306a\u3057\n\u25a1 \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u78ba\u8a8d\n\u25a1 VPN\u307e\u305f\u306fExpressRoute\u63a5\u7d9a\u30c6\u30b9\u30c8\n\u25a1 DNS\u8a2d\u5b9a\u78ba\u8a8d\n</code></pre></p> <p>\u76e3\u8996\uff1a <pre><code>\u25a1 Log Analytics\u8a2d\u5b9a\n\u25a1 \u30a2\u30e9\u30fc\u30c8\u30eb\u30fc\u30eb\u8a2d\u5b9a\n\u25a1 \u30b3\u30b9\u30c8\u30a2\u30e9\u30fc\u30c8\u8a2d\u5b9a\n\u25a1 Dashboard\u4f5c\u6210\n</code></pre></p> <p>\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\uff1a <pre><code>\u25a1 Terraform State\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n\u25a1 DR\u30d7\u30e9\u30f3\u4f5c\u6210\n\u25a1 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6574\u5099\n</code></pre></p> <p>\u30c6\u30b9\u30c8\uff1a <pre><code>\u25a1 \u958b\u767a\u74b0\u5883\u3067\u30d5\u30eb\u30c6\u30b9\u30c8\n\u25a1 \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u624b\u9806\u78ba\u8a8d\n\u25a1 \u7dca\u6025\u9023\u7d61\u5148\u78ba\u8a8d\n</code></pre></p> <p>Chapter 16\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u898b\u3066\u304f\u3060\u3055\u3044\uff01</p>"},{"location":"17_FAQ/#q29","title":"Q29: \u56f0\u3063\u305f\u3068\u304d\u306f\uff1f","text":"<p>A: \u3053\u306e\u9806\u756a\u3067\u78ba\u8a8d\u3002</p> <p>\u30b9\u30c6\u30c3\u30d71: \u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 <pre><code>Chapter 14: \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\nChapter 17: FAQ\uff08\u3053\u308c\uff09\n</code></pre></p> <p>\u30b9\u30c6\u30c3\u30d72: \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30b0\u30b0\u308b <pre><code>\"Error: zones are not supported\" terraform azure\n  \u2193\nStack Overflow\u3001GitHub Issues\u306b\u7b54\u3048\u304c\u3042\u308b\n</code></pre></p> <p>\u30b9\u30c6\u30c3\u30d73: GitHub Issue\u3092\u898b\u308b <pre><code>https://github.com/Azure/terraform-azurerm-avm-ptn-alz/issues\n  \u2193\n\u4f3c\u305f\u3088\u3046\u306a\u554f\u984c\u304c\u5831\u544a\u3055\u308c\u3066\u308b\u304b\u3082\n</code></pre></p> <p>\u30b9\u30c6\u30c3\u30d74: \u8cea\u554f\u3059\u308b <pre><code>Stack Overflow:\n- terraform \u30bf\u30b0\u4ed8\u3051\u3066\u8cea\u554f\n- \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3001\u30b3\u30fc\u30c9\u3001\u74b0\u5883\u60c5\u5831\u3092\u6dfb\u3048\u308b\n\nGitHub Issue:\n- \u518d\u73fe\u624b\u9806\u3092\u660e\u78ba\u306b\n- terraform version\u3001provider version\u8a18\u8f09\n</code></pre></p> <p>\u30b9\u30c6\u30c3\u30d75: \u30b5\u30dd\u30fc\u30c8\u306b\u9023\u7d61 <pre><code>Azure\u30b5\u30dd\u30fc\u30c8\u5951\u7d04\u304c\u3042\u308b\u5834\u5408\n  \u2193\n\u30b5\u30dd\u30fc\u30c8\u30c1\u30b1\u30c3\u30c8\u4f5c\u6210\n</code></pre></p>"},{"location":"17_FAQ/#_12","title":"\u6700\u5f8c\u306b","text":""},{"location":"17_FAQ/#q30-azure-landing-zones","title":"Q30: \u7d50\u5c40\u3001Azure Landing Zones\u3063\u3066\u5fc5\u8981\uff1f","text":"<p>A: \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u6b21\u7b2c\u3002</p> <p>\u5fc5\u8981\u306a\u5834\u5408\uff1a <pre><code>\u2713 \u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\n\u2713 \u8907\u6570\u30c1\u30fc\u30e0\n\u2713 \u9577\u671f\u904b\u7528\n\u2713 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fb\u30ac\u30d0\u30ca\u30f3\u30b9\u91cd\u8996\n\u2713 \u62e1\u5f35\u6027\u304c\u5fc5\u8981\n\n\u2192 Azure Landing Zones\u4f7f\u304a\u3046\n</code></pre></p> <p>\u30aa\u30fc\u30d0\u30fc\u30b9\u30da\u30c3\u30af\u306a\u5834\u5408\uff1a <pre><code>\u2713 \u5c0f\u898f\u6a21\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n\u2713 \u500b\u4eba\u5229\u7528\n\u2713 \u77ed\u671f\u9593\u306ePoC\n\u2713 \u30b7\u30f3\u30d7\u30eb\u306a\u69cb\u6210\n\n\u2192 \u666e\u901a\u306bAzure\u30ea\u30bd\u30fc\u30b9\u4f5c\u308c\u3070OK\n</code></pre></p> <p>\u5224\u65ad\u57fa\u6e96\uff1a <pre><code>\u300c\u5f8c\u3067\u62e1\u5f35\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\uff1f\u300d\n  \u2193\nYes \u2192 Azure Landing Zones\nNo \u2192 \u30b7\u30f3\u30d7\u30eb\u306b\u3044\u3053\u3046\n</code></pre></p> <p>\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u76ee\u7684\uff1a <pre><code>Azure Landing Zones\u3092\u7406\u89e3\u3057\u3066\n  \u2193\n\u81ea\u5206\u3067\u69cb\u7bc9\u30fb\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\n  \u2193\n\u6700\u9ad8\u306e\u6559\u79d1\u66f8\n</code></pre></p> <p>\u9054\u6210\u3067\u304d\u305f\uff1f <pre><code>Chapter 00: \u306f\u3058\u3081\u306b\nChapter 01: \u57fa\u790e\u77e5\u8b58\nChapter 02: \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020\nChapter 03: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5b8c\u5168\u89e3\u8aac\nChapter 04: \u5909\u6570\u5b9a\u7fa9\nChapter 05: \u30ed\u30fc\u30ab\u30eb\u5909\u6570\nChapter 06: \u8a2d\u5b9a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\nChapter 07: \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\nChapter 08: \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc\nChapter 09: \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9\nChapter 10: Hub-and-Spoke\nChapter 11: Virtual WAN\nChapter 12: GitHub Actions\nChapter 13: \u30c7\u30d7\u30ed\u30a4\u624b\u9806\nChapter 14: \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\nChapter 15: \u30ab\u30b9\u30bf\u30de\u30a4\u30ba\nChapter 16: \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\nChapter 17: FAQ\n\n\u5168\u90e8\u8aad\u3081\u3070\u5b8c\u74a7\uff01\n</code></pre></p> <p>\u6700\u5f8c\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\uff1a <pre><code>\u5b8c\u74a7\u3092\u76ee\u6307\u3055\u306a\u304f\u3066\u3044\u3044\n  \u2193\n\u307e\u305a\u52d5\u304b\u3057\u3066\u307f\u308b\n  \u2193\n\u5931\u6557\u304b\u3089\u5b66\u3076\n  \u2193\n\u5c11\u3057\u305a\u3064\u6539\u5584\n  \u2193\n\u305d\u308c\u304c\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\n</code></pre></p> <p>\u304c\u3093\u3070\u3063\u3066\uff01\ud83d\ude80</p>"},{"location":"17_FAQ/#_13","title":"\u307e\u3068\u3081","text":"<p>\u3053\u306e\u6559\u79d1\u66f8\u3067\u5b66\u3093\u3060\u3053\u3068\uff1a</p>"},{"location":"17_FAQ/#chapter-00-02","title":"\u57fa\u790e\u7de8\uff08Chapter 00-02\uff09","text":"<ul> <li>Azure Landing Zones\u306e\u5168\u4f53\u50cf\u3068\u76ee\u7684</li> <li>Terraform\u30fbAzure\u30fbIaC\u306e\u57fa\u790e\u77e5\u8b58</li> <li>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30d5\u30a1\u30a4\u30eb\u69cb\u9020\u306e\u7406\u89e3</li> </ul>"},{"location":"17_FAQ/#chapter-03-06","title":"\u8a2d\u5b9a\u7de8\uff08Chapter 03-06\uff09","text":"<ul> <li><code>platform-landing-zone.auto.tfvars</code>\u306e\u5b8c\u5168\u89e3\u8aac</li> <li><code>variables.tf</code>\u306e\u578b\u5b9a\u7fa9\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> <li><code>locals.tf</code>\u306e\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u6d3b\u7528</li> <li><code>config-templating</code>\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u51e6\u7406</li> </ul>"},{"location":"17_FAQ/#chapter-07-11","title":"\u30ea\u30bd\u30fc\u30b9\u4f5c\u6210\u7de8\uff08Chapter 07-11\uff09","text":"<ul> <li>\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210</li> <li>\u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc\u306e\u69cb\u6210</li> <li>Log Analytics\u30fbDCR\u306a\u3069\u7ba1\u7406\u30ea\u30bd\u30fc\u30b9</li> <li>Hub-and-Spoke / Virtual WAN\u30cd\u30c3\u30c8\u30ef\u30fc\u30af</li> </ul>"},{"location":"17_FAQ/#chapter-12-14","title":"\u904b\u7528\u7de8\uff08Chapter 12-14\uff09","text":"<ul> <li>GitHub Actions\u306b\u3088\u308b\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4</li> <li>\u5b9f\u969b\u306e\u30c7\u30d7\u30ed\u30a4\u624b\u9806</li> <li>\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0</li> </ul>"},{"location":"17_FAQ/#chapter-15-17","title":"\u5fdc\u7528\u7de8\uff08Chapter 15-17\uff09","text":"<ul> <li>\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u65b9\u6cd5</li> <li>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</li> <li>\u3088\u304f\u3042\u308b\u8cea\u554f\uff08FAQ\uff09</li> </ul> <p>\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\uff1a 1. \u958b\u767a\u74b0\u5883\u3067\u5b9f\u969b\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u307f\u308b 2. \u81ea\u793e\u306e\u8981\u4ef6\u306b\u5408\u308f\u305b\u3066\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b 3. \u6bb5\u968e\u7684\u306b\u672c\u756a\u74b0\u5883\u3078\u9069\u7528\u3059\u308b 4. \u30c1\u30fc\u30e0\u3067\u30ca\u30ec\u30c3\u30b8\u3092\u5171\u6709\u3059\u308b</p> <p>\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\uff01</p> <p>\u6240\u8981\u6642\u9593: 45\u5206 \u96e3\u6613\u5ea6: \u2605\u2605\u2606\u2606\u2606 \u524d: 16_\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9.md \u6b21: README.md\uff08\u6559\u79d1\u66f8\u306e\u76ee\u6b21\u306b\u623b\u308b\uff09</p>"},{"location":"17_FAQ/#_14","title":"\u7d22\u5f15","text":"<p>\u5404Chapter\u3078\u306e\u30ea\u30f3\u30af\uff1a</p> <ul> <li>Chapter 00: \u306f\u3058\u3081\u306b</li> <li>Chapter 01: \u57fa\u790e\u77e5\u8b58</li> <li>Chapter 02: \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020</li> <li>Chapter 03: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5b8c\u5168\u89e3\u8aac</li> <li>Chapter 04: \u5909\u6570\u5b9a\u7fa9</li> <li>Chapter 05: \u30ed\u30fc\u30ab\u30eb\u5909\u6570</li> <li>Chapter 06: \u8a2d\u5b9a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8</li> <li>Chapter 07: \u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7</li> <li>Chapter 08: \u7ba1\u7406\u30b0\u30eb\u30fc\u30d7\u3068\u30dd\u30ea\u30b7\u30fc</li> <li>Chapter 09: \u7ba1\u7406\u30ea\u30bd\u30fc\u30b9</li> <li>Chapter 10: Hub-and-Spoke</li> <li>Chapter 11: Virtual WAN</li> <li>Chapter 12: GitHub Actions</li> <li>Chapter 13: \u30c7\u30d7\u30ed\u30a4\u624b\u9806</li> <li>Chapter 14: \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0</li> <li>Chapter 15: \u30ab\u30b9\u30bf\u30de\u30a4\u30ba</li> <li>Chapter 16: \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</li> <li>Chapter 17: FAQ\uff08\u3053\u308c\uff09</li> </ul>"}]}