
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="TerraformでAzure Landing Zonesを完全理解する教科書">
      
      
        <meta name="author" content="shuhei0720org01">
      
      
        <link rel="canonical" href="https://shuhei0720org01.github.io/alz-mgmt/03_%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%AC/">
      
      
        <link rel="prev" href="../02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/">
      
      
        <link rel="next" href="../04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>03. 設定ファイル完全解説 - Azure Landing Zones 完全マスターコース</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#03-platform-landing-zoneautotfvars" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href=".." title="Azure Landing Zones 完全マスターコース" class="md-header__button md-logo" aria-label="Azure Landing Zones 完全マスターコース" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Azure Landing Zones 完全マスターコース
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              03. 設定ファイル完全解説
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="ダークモードに切り替え"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="ダークモードに切り替え" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="ライトモードに切り替え"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="ライトモードに切り替え" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/shuhei0720org01/alz-mgmt" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    shuhei0720org01/alz-mgmt
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="タブ" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  ホーム

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/" class="md-tabs__link">
          
  
  
  基礎編

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  設定編

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/" class="md-tabs__link">
          
  
  
  モジュール編

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../12_GitHub_Actions/" class="md-tabs__link">
          
  
  
  実践編

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/" class="md-tabs__link">
          
  
  
  運用編

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Azure Landing Zones 完全マスターコース" class="md-nav__button md-logo" aria-label="Azure Landing Zones 完全マスターコース" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Azure Landing Zones 完全マスターコース
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/shuhei0720org01/alz-mgmt" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    shuhei0720org01/alz-mgmt
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ホーム
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    基礎編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    基礎編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00_%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    00. はじめに
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01. 基礎知識
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    02. プロジェクト構造
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    設定編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    設定編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    03. 設定ファイル完全解説
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    03. 設定ファイル完全解説
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      
        8つの設計領域との対応
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        このChapterでやること
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chapter_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        このChapterを読む前に知っておくべきこと
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="このChapterを読む前に知っておくべきこと">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        テンプレート変数について
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        ファイルの全体構造
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 1: リージョン設定
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 1: リージョン設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starter_locations" class="md-nav__link">
    <span class="md-ellipsis">
      
        starter_locations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-names" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 2: カスタム置換 - names セクション
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 2: カスタム置換 - names セクション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-1-defender" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-1. Defenderのメール設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-2. リソースグループ名
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-3. 管理リソースの名前
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2-3. 管理リソースの名前">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log_analytics_workspace_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        log_analytics_workspace_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ddos_protection_plan_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        ddos_protection_plan_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ama_user_assigned_managed_identity_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        ama_user_assigned_managed_identity_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcr__namedata-collection-rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        dcr_*_name（Data Collection Rule）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-4. リソースの有効/無効設定（グローバル）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-5-hub" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-5. プライマリHubの設定
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2-5. プライマリHubの設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1つずつ見ていきましょう
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1つずつ見ていきましょう">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primary_firewall_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_firewall_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_firewall_management_ip_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_firewall_management_ip_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_virtual_network_gateway_express_route_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_virtual_network_gateway_express_route_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_virtual_network_gateway_vpn_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_virtual_network_gateway_vpn_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_private_dns_zones_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_private_dns_zones_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_private_dns_auto_registration_zone_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_private_dns_auto_registration_zone_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_private_dns_resolver_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_private_dns_resolver_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_bastion_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_bastion_enabled
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-6-hub" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-6. セカンダリHubの設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-7" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-7. プライマリリソースの名前
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-8" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-8. セカンダリリソースの名前
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        ☕ 休憩タイム（1回目）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 3: 設定値のアドレス空間
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 3: 設定値のアドレス空間">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1-firewall" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-1. Firewallの設定
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3-1. Firewallの設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primary_firewall_sku_tier" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_firewall_sku_tier
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_firewall_subnet_address_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_firewall_subnet_address_prefix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_firewall_client_public_ip_zones" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_firewall_client_public_ip_zones
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2-vpn-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-2. VPN Gatewayの設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3-ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-3. IPアドレスの設計（プライマリ）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-4-ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-4. IPアドレスの設計（セカンダリ）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 4: リソースグループ識別子
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 5: リソース識別子
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        ☕ 休憩タイム（2回目）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 6: タグ設定
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-7" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 7: 管理リソース設定
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-8" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 8: 管理グループとポリシー
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 8: 管理グループとポリシー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        architecture_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#policy_default_values" class="md-nav__link">
    <span class="md-ellipsis">
      
        policy_default_values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subscription_placement" class="md-nav__link">
    <span class="md-ellipsis">
      
        subscription_placement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defender" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defenderの設定
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        ☕ 休憩タイム（3回目・最後）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-9-hub-and-spoke" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 9: ネットワーク設定（Hub-and-Spoke）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 9: ネットワーク設定（Hub-and-Spoke）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connectivity_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        connectivity_type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connectivity_resource_groups" class="md-nav__link">
    <span class="md-ellipsis">
      
        connectivity_resource_groups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hub_virtual_networks" class="md-nav__link">
    <span class="md-ellipsis">
      
        hub_virtual_networks（プライマリ）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hub_virtual_networks（プライマリ）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vnet" class="md-nav__link">
    <span class="md-ellipsis">
      
        VNet設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    <span class="md-ellipsis">
      
        Firewall設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpnexpressroute-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      
        VPN/ExpressRoute Gateway設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bastion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bastion設定
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        まとめ
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        練習問題
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="練習問題">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        問題1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        問題2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        問題3
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        練習問題の答え
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="練習問題の答え">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        答え1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        答え2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        答え3
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    04. 変数定義
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    05. ローカル変数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    モジュール編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    モジュール編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    06. 設定テンプレート
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    07. リソースグループ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08_%E7%AE%A1%E7%90%86%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%A8%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    08. 管理グループとポリシー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09_%E7%AE%A1%E7%90%86%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    09. 管理リソース
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10_Hub-and-Spoke/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Hub-and-Spoke
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11_Virtual_WAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Virtual WAN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    実践編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12_GitHub_Actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. GitHub Actions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13_%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. デプロイ手順
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    運用編
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    運用編
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../14_%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. トラブルシューティング
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../15_%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. カスタマイズ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../16_%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. ベストプラクティス
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../17_FAQ/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      
        8つの設計領域との対応
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        このChapterでやること
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chapter_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        このChapterを読む前に知っておくべきこと
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="このChapterを読む前に知っておくべきこと">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        テンプレート変数について
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        ファイルの全体構造
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 1: リージョン設定
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 1: リージョン設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starter_locations" class="md-nav__link">
    <span class="md-ellipsis">
      
        starter_locations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-names" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 2: カスタム置換 - names セクション
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 2: カスタム置換 - names セクション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-1-defender" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-1. Defenderのメール設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-2. リソースグループ名
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-3. 管理リソースの名前
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2-3. 管理リソースの名前">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log_analytics_workspace_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        log_analytics_workspace_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ddos_protection_plan_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        ddos_protection_plan_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ama_user_assigned_managed_identity_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        ama_user_assigned_managed_identity_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcr__namedata-collection-rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        dcr_*_name（Data Collection Rule）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-4. リソースの有効/無効設定（グローバル）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-5-hub" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-5. プライマリHubの設定
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2-5. プライマリHubの設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1つずつ見ていきましょう
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1つずつ見ていきましょう">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primary_firewall_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_firewall_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_firewall_management_ip_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_firewall_management_ip_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_virtual_network_gateway_express_route_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_virtual_network_gateway_express_route_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_virtual_network_gateway_vpn_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_virtual_network_gateway_vpn_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_private_dns_zones_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_private_dns_zones_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_private_dns_auto_registration_zone_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_private_dns_auto_registration_zone_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_private_dns_resolver_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_private_dns_resolver_enabled
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_bastion_enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_bastion_enabled
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-6-hub" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-6. セカンダリHubの設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-7" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-7. プライマリリソースの名前
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-8" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-8. セカンダリリソースの名前
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        ☕ 休憩タイム（1回目）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 3: 設定値のアドレス空間
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 3: 設定値のアドレス空間">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1-firewall" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-1. Firewallの設定
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3-1. Firewallの設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primary_firewall_sku_tier" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_firewall_sku_tier
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_firewall_subnet_address_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_firewall_subnet_address_prefix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary_firewall_client_public_ip_zones" class="md-nav__link">
    <span class="md-ellipsis">
      
        primary_firewall_client_public_ip_zones
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2-vpn-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-2. VPN Gatewayの設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3-ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-3. IPアドレスの設計（プライマリ）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-4-ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-4. IPアドレスの設計（セカンダリ）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 4: リソースグループ識別子
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 5: リソース識別子
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        ☕ 休憩タイム（2回目）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 6: タグ設定
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-7" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 7: 管理リソース設定
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-8" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 8: 管理グループとポリシー
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 8: 管理グループとポリシー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        architecture_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#policy_default_values" class="md-nav__link">
    <span class="md-ellipsis">
      
        policy_default_values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subscription_placement" class="md-nav__link">
    <span class="md-ellipsis">
      
        subscription_placement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defender" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defenderの設定
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        ☕ 休憩タイム（3回目・最後）
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-9-hub-and-spoke" class="md-nav__link">
    <span class="md-ellipsis">
      
        Part 9: ネットワーク設定（Hub-and-Spoke）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 9: ネットワーク設定（Hub-and-Spoke）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connectivity_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        connectivity_type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connectivity_resource_groups" class="md-nav__link">
    <span class="md-ellipsis">
      
        connectivity_resource_groups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hub_virtual_networks" class="md-nav__link">
    <span class="md-ellipsis">
      
        hub_virtual_networks（プライマリ）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hub_virtual_networks（プライマリ）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vnet" class="md-nav__link">
    <span class="md-ellipsis">
      
        VNet設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    <span class="md-ellipsis">
      
        Firewall設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpnexpressroute-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      
        VPN/ExpressRoute Gateway設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bastion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bastion設定
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        まとめ
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        練習問題
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="練習問題">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        問題1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        問題2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        問題3
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        練習問題の答え
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="練習問題の答え">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        答え1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        答え2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        答え3
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="03-platform-landing-zoneautotfvars">03. 設定ファイル完全解説 - platform-landing-zone.auto.tfvars<a class="headerlink" href="#03-platform-landing-zoneautotfvars" title="Permanent link">&para;</a></h1>
<h2 id="8">8つの設計領域との対応<a class="headerlink" href="#8" title="Permanent link">&para;</a></h2>
<p>このChapterは以下の設計領域を実装します：
- ✅ <strong>1. Azure Billing and Active Directory Tenant</strong>（課金とテナント - リージョン設定）
- ✅ <strong>3. Resource Organization</strong>（リソース整理 - リソースグループ構成）
- ✅ <strong>4. Network Topology and Connectivity</strong>（ネットワーク構成 - Hub-and-Spoke/Virtual WAN設定）
- ✅ <strong>6. Management and Monitoring</strong>（管理と監視 - Log Analytics設定）</p>
<p>→ Chapter 01で学んだ8つの設計領域を復習したい方は<a href="../01_%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/">01_基礎知識.md</a>へ</p>
<hr />
<h2 id="chapter">このChapterでやること<a class="headerlink" href="#chapter" title="Permanent link">&para;</a></h2>
<p>このプロジェクトで一番重要なファイル、<code>platform-landing-zone.auto.tfvars</code>を1行ずつ解説していきます。</p>
<p>このファイルは約500行ありますが、怖がらなくて大丈夫です。
実は同じパターンの繰り返しが多いので、パターンさえ覚えれば読めるようになります。</p>
<p>このChapterを読み終わったら、
「ここを変えればFirewall有効になるんだ」
「このリージョン設定を変えればいいのか」
というのがわかるようになります。</p>
<hr />
<h2 id="chapter_1">このChapterを読む前に知っておくべきこと<a class="headerlink" href="#chapter_1" title="Permanent link">&para;</a></h2>
<h3 id="_1">テンプレート変数について<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>このファイルでは <strong>テンプレート変数</strong> を多用しています：</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="na">management_resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-management-$${starter_location_01}&quot;</span>
</span></code></pre></div>
<p><strong>何が起きるか</strong>:
- <code>$${starter_location_01}</code> → <code>japaneast</code> に自動置換される
- 実際の名前: <code>"rg-management-japaneast"</code></p>
<p><strong>Terraformの変数（<code>${}</code>）との違い</strong>:
| 記法 | 処理タイミング | 用途 |
|------|--------------|------|
| <code>${}</code> | Terraform実行時（即座） | Terraform変数の参照 |
| <code>$${}</code>  | テンプレート処理時（後で） | 設定ファイル内の置換 |</p>
<p><strong>よく使われる置換変数</strong>:
- <code>$${starter_location_01}</code> → 最初のリージョン（例: <code>japaneast</code>）
- <code>$${starter_location_02}</code> → 2番目のリージョン（例: <code>japanwest</code>）
- <code>$${starter_location_01_short}</code> → 短縮名（例: <code>jp</code>）</p>
<p>詳細は <a href="../06_%E8%A8%AD%E5%AE%9A%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88/">Chapter 06: 設定テンプレート</a> で解説します。
まずは「自動で置き換わる」と理解すればOKです。</p>
<hr />
<h2 id="_2">ファイルの全体構造<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>まず、このファイルがどんな構造になっているか見てみましょう：</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># 1. コメント（説明書き）</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="cm">/*</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="cm">--- Built-in Replacements ---</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="cm">...</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="cm">*/</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="c1"># 2. リージョン設定（どこに作るか）</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="na">starter_locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;japaneast&quot;, &quot;japanwest&quot;</span><span class="p">]</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1"># 3. カスタム置換設定（名前とか設定値）</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="nb">custom_replacements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">  </span><span class="nb">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="c1">                    # 名前とか有効/無効の設定</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">  </span><span class="nb">resource_group_identifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="c1">  # リソースグループのID</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">  </span><span class="nb">resource_identifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="c1">        # リソースのID</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="p">}</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="c1"># 4. リソースグループ設定（箱の設定）</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="nb">management_resource_groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="nb">connectivity_resource_groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="c1"># 5. 管理リソース設定（ログとか監視）</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="nb">management_resource_settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="c1"># 6. ネットワーク設定（Hub-and-Spoke）</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="nb">hub_and_spoke_vnet_settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>意外とシンプルですよね。</p>
<hr />
<h2 id="part-1">Part 1: リージョン設定<a class="headerlink" href="#part-1" title="Permanent link">&para;</a></h2>
<h3 id="starter_locations">starter_locations<a class="headerlink" href="#starter_locations" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="na">starter_locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;japaneast&quot;, &quot;japanwest&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p><strong>これは何でしょうか？</strong>
- このプロジェクトで使うAzureリージョンのリストです
- 最初の項目（<code>japaneast</code>）がプライマリ（メイン）
- 2番目の項目（<code>japanwest</code>）がセカンダリ（サブ）</p>
<p><strong>どう使われるのでしょうか？</strong>
後で出てくる設定で、以下のように自動置換されます：</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># 設定ファイル内で</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-hub-$${starter_location_01}&quot;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1"># 実際には</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-hub-japaneast&quot;</span><span class="c1">  # ←自動で置き換わる</span>
</span></code></pre></div>
<p><strong>変えたい時は？</strong>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># 東京だけにしたい</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="na">starter_locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;japaneast&quot;</span><span class="p">]</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># アメリカにしたい</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="na">starter_locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;eastus&quot;, &quot;westus&quot;</span><span class="p">]</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1"># 3リージョン使いたい</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="na">starter_locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;japaneast&quot;, &quot;japanwest&quot;, &quot;eastasia&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p>簡単ですよね。</p>
<hr />
<h2 id="part-2-names">Part 2: カスタム置換 - names セクション<a class="headerlink" href="#part-2-names" title="Permanent link">&para;</a></h2>
<p>ここからが本番です。<code>custom_replacements</code>の中身を見ていきます。</p>
<h3 id="2-1-defender">2-1. Defenderのメール設定<a class="headerlink" href="#2-1-defender" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">custom_replacements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="nb">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="na">defender_email_security_contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;shuhei_0720@icloud.com&quot;</span>
</span></code></pre></div>
<p><strong>これは何でしょうか？</strong>
- Microsoft Defender for Cloud（セキュリティ監視サービス）が脅威を検出したら、ここに通知が飛んできます
- セキュリティアラートのメールアドレスです</p>
<p><strong>変更する場合：</strong>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="na">defender_email_security_contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;security-team@yourcompany.com&quot;</span>
</span></code></pre></div></p>
<p>自分のメールアドレスに変更してください。</p>
<h3 id="2-2">2-2. リソースグループ名<a class="headerlink" href="#2-2" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1">    # Resource group names</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="na">management_resource_group_name</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-management-$${starter_location_01}&quot;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="na">connectivity_hub_primary_resource_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-hub-$${starter_location_01}&quot;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="na">connectivity_hub_secondary_resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-hub-$${starter_location_02}&quot;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="na">dns_resource_group_name</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-hub-dns-$${starter_location_01}&quot;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="na">ddos_resource_group_name</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-hub-ddos-$${starter_location_01}&quot;</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="na">asc_export_resource_group_name</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-asc-export-$${starter_location_01}&quot;</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
Azureのリソースグループ（リソースを入れる箱）の名前を決めてる。</p>
<p><strong>実際の名前は？</strong>
<code>$${starter_location_01}</code>が<code>japaneast</code>に置き換わるから：</p>
<table>
<thead>
<tr>
<th>変数名</th>
<th>実際の名前</th>
<th>何を入れる箱？</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>management_resource_group_name</code></td>
<td><code>rg-management-japaneast</code></td>
<td>Log Analyticsとか管理系</td>
</tr>
<tr>
<td><code>connectivity_hub_primary_resource_group_name</code></td>
<td><code>rg-hub-japaneast</code></td>
<td>プライマリHubのネットワーク</td>
</tr>
<tr>
<td><code>connectivity_hub_secondary_resource_group_name</code></td>
<td><code>rg-hub-japanwest</code></td>
<td>セカンダリHubのネットワーク</td>
</tr>
<tr>
<td><code>dns_resource_group_name</code></td>
<td><code>rg-hub-dns-japaneast</code></td>
<td>Private DNS Zones</td>
</tr>
<tr>
<td><code>ddos_resource_group_name</code></td>
<td><code>rg-hub-ddos-japaneast</code></td>
<td>DDoS Protection</td>
</tr>
<tr>
<td><code>asc_export_resource_group_name</code></td>
<td><code>rg-asc-export-japaneast</code></td>
<td>Defender データエクスポート</td>
</tr>
</tbody>
</table>
<p><strong>命名規則</strong>
<code>rg-{用途}-{リージョン}</code>って感じで統一されてるでしょ？
これがAzureの推奨命名規則。</p>
<p><strong>変えたい時は？</strong>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># 会社のルールに合わせたい</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="na">management_resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-prod-mgmt-$${starter_location_01}&quot;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="na">connectivity_hub_primary_resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-prod-network-$${starter_location_01}&quot;</span>
</span></code></pre></div></p>
<h3 id="2-3">2-3. 管理リソースの名前<a class="headerlink" href="#2-3" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1">    # Resource names management</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="na">log_analytics_workspace_name</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;law-management-$${starter_location_01}&quot;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="na">ddos_protection_plan_name</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ddos-$${starter_location_01}&quot;</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="na">ama_user_assigned_managed_identity_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;uami-management-ama-$${starter_location_01}&quot;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="na">dcr_change_tracking_name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dcr-change-tracking&quot;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="na">dcr_defender_sql_name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dcr-defender-sql&quot;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="na">dcr_vm_insights_name</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dcr-vm-insights&quot;</span>
</span></code></pre></div>
<p><strong>それぞれ解説します</strong></p>
<h4 id="log_analytics_workspace_name">log_analytics_workspace_name<a class="headerlink" href="#log_analytics_workspace_name" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="na">log_analytics_workspace_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;law-management-$${starter_location_01}&quot;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="c1"># 実際: &quot;law-management-japaneast&quot;</span>
</span></code></pre></div>
<p><strong>これは何でしょうか？</strong>
- Log Analytics Workspace（ログを集めるデータベース）の名前です
- <code>law</code>はLog Analytics Workspaceの略
- すべてのログがここに集まります</p>
<h4 id="ddos_protection_plan_name">ddos_protection_plan_name<a class="headerlink" href="#ddos_protection_plan_name" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="na">ddos_protection_plan_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ddos-$${starter_location_01}&quot;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="c1"># 実際: &quot;ddos-japaneast&quot;</span>
</span></code></pre></div>
<p><strong>これは何でしょうか？</strong>
- DDoS攻撃から守るサービスの名前です
- 非常に高額です（月¥400,000程度）
- インターネット公開しているアプリには必要です</p>
<h4 id="ama_user_assigned_managed_identity_name">ama_user_assigned_managed_identity_name<a class="headerlink" href="#ama_user_assigned_managed_identity_name" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="na">ama_user_assigned_managed_identity_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;uami-management-ama-$${starter_location_01}&quot;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="c1"># 実際: &quot;uami-management-ama-japaneast&quot;</span>
</span></code></pre></div>
<p><strong>これは何でしょうか？</strong>
- Azure Monitor Agent（監視エージェント）が使う認証IDです
- <code>uami</code>はUser Assigned Managed Identityの略
- VMなどにエージェント導入する際に使います</p>
<h4 id="dcr__namedata-collection-rule">dcr_*_name（Data Collection Rule）<a class="headerlink" href="#dcr__namedata-collection-rule" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="na">dcr_change_tracking_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dcr-change-tracking&quot;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="na">dcr_defender_sql_name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dcr-defender-sql&quot;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="na">dcr_vm_insights_name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dcr-vm-insights&quot;</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
- Data Collection Rule（データ収集ルール）の名前
- どのデータを収集するか決めるルール
- 3種類：
  - <code>change-tracking</code>：ファイルとか設定の変更を追跡
  - <code>defender-sql</code>：SQL Serverのセキュリティログ
  - <code>vm-insights</code>：VMのパフォーマンスデータ</p>
<h3 id="2-4">2-4. リソースの有効/無効設定（グローバル）<a class="headerlink" href="#2-4" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">    # Resource provisioning global connectivity</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="na">ddos_protection_plan_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
- DDoS Protectionを有効にするか無効にするか
- <code>true</code>にすると月¥400,000飛ぶ
- 検証環境なら<code>false</code>でOK</p>
<p><strong>変えたい時は？</strong>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># 本番環境で必要なら</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="na">ddos_protection_plan_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div></p>
<h3 id="2-5-hub">2-5. プライマリHubの設定<a class="headerlink" href="#2-5-hub" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">    # Resource provisioning primary connectivity</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="na">primary_firewall_enabled</span><span class="w">                                             </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="na">primary_firewall_management_ip_enabled</span><span class="w">                               </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="na">primary_virtual_network_gateway_express_route_enabled</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="na">primary_virtual_network_gateway_express_route_hobo_public_ip_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="na">primary_virtual_network_gateway_vpn_enabled</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="na">primary_private_dns_zones_enabled</span><span class="w">                                    </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="na">primary_private_dns_auto_registration_zone_enabled</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="na">primary_private_dns_resolver_enabled</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">    </span><span class="na">primary_bastion_enabled</span><span class="w">                                              </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p><strong>これが一番重要です！</strong>
プライマリHub（Japan East）で何を有効にするか決めています。</p>
<h4 id="1">1つずつ見ていきましょう<a class="headerlink" href="#1" title="Permanent link">&para;</a></h4>
<h5 id="primary_firewall_enabled">primary_firewall_enabled<a class="headerlink" href="#primary_firewall_enabled" title="Permanent link">&para;</a></h5>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="na">primary_firewall_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p><strong>これは何でしょうか？</strong>
- Azure Firewall（ファイアウォール）を作るかどうかです
- <code>true</code>：作ります（月¥170,000程度、Standard SKU）
- <code>false</code>：作りません</p>
<p><strong>いつfalseにしますか？</strong>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># コスト削減したい検証環境</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="na">primary_firewall_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="c1"># 代わりにNSG（無料のファイアウォール）だけ使う</span>
</span></code></pre></div></p>
<h5 id="primary_firewall_management_ip_enabled">primary_firewall_management_ip_enabled<a class="headerlink" href="#primary_firewall_management_ip_enabled" title="Permanent link">&para;</a></h5>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="na">primary_firewall_management_ip_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p><strong>これは何でしょうか？</strong>
- Firewall管理用のPublic IPを作るかどうかです
- Basic SKUのFirewallで必要です
- Standard/Premiumなら不要ですが、作っておいても問題ありません</p>
<h5 id="primary_virtual_network_gateway_express_route_enabled">primary_virtual_network_gateway_express_route_enabled<a class="headerlink" href="#primary_virtual_network_gateway_express_route_enabled" title="Permanent link">&para;</a></h5>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="na">primary_virtual_network_gateway_express_route_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p><strong>これは何でしょうか？</strong>
- ExpressRoute Gateway（専用線ゲートウェイ）を作るかどうかです
- オンプレとAzureを専用線で繋ぐ時に必要です
- 月¥40,000〜60,000程度です（SKUによる）</p>
<p><strong>いつfalseにしますか？</strong>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># オンプレとの接続が不要なら</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="na">primary_virtual_network_gateway_express_route_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span></code></pre></div></p>
<h5 id="primary_virtual_network_gateway_vpn_enabled">primary_virtual_network_gateway_vpn_enabled<a class="headerlink" href="#primary_virtual_network_gateway_vpn_enabled" title="Permanent link">&para;</a></h5>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="na">primary_virtual_network_gateway_vpn_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
- VPN Gateway（VPNゲートウェイ）を作るか
- オンプレとAzureをインターネット経由で繋ぐ
- 月¥40,000程度（VpnGw1 SKU）</p>
<p><strong>ExpressRouteとの違いは？</strong>
- ExpressRoute：専用線（速い、高い、安定）
- VPN：インターネット経由（普通、安い、不安定）</p>
<h5 id="primary_private_dns_zones_enabled">primary_private_dns_zones_enabled<a class="headerlink" href="#primary_private_dns_zones_enabled" title="Permanent link">&para;</a></h5>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="na">primary_private_dns_zones_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
- <strong>Private DNS Zones</strong>（Azure内部専用のDNSサービス）を作るか
- Azure PaaSサービス（Storage、SQL Database等）にプライベートエンドポイントで接続する時に必須
- 絶対<code>true</code>にしておこう</p>
<h5 id="primary_private_dns_auto_registration_zone_enabled">primary_private_dns_auto_registration_zone_enabled<a class="headerlink" href="#primary_private_dns_auto_registration_zone_enabled" title="Permanent link">&para;</a></h5>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="na">primary_private_dns_auto_registration_zone_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
- VMを作ったら自動でDNSに登録するか
- <code>true</code>にしておくとVMの名前で通信できて便利</p>
<h5 id="primary_private_dns_resolver_enabled">primary_private_dns_resolver_enabled<a class="headerlink" href="#primary_private_dns_resolver_enabled" title="Permanent link">&para;</a></h5>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="na">primary_private_dns_resolver_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
- Private DNS Resolver（DNS中継サーバー）を作るか
- オンプレとAzure間でDNS名前解決する時に必要</p>
<h5 id="primary_bastion_enabled">primary_bastion_enabled<a class="headerlink" href="#primary_bastion_enabled" title="Permanent link">&para;</a></h5>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="na">primary_bastion_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
- <strong>Azure Bastion</strong>（安全なVMリモート接続サービス）を作るか
- VMにSSH/RDPする時、Bastionを経由すると安全
- Public IPをVMに割り当てなくて済む
- 月¥27,000程度（Basic SKU）</p>
<p><strong>ポイント</strong>
Japan EastではAvailability Zones使えないから、後で<code>zones = []</code>設定が必要になる。</p>
<h3 id="2-6-hub">2-6. セカンダリHubの設定<a class="headerlink" href="#2-6-hub" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1">    # Resource provisioning secondary connectivity</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="na">secondary_firewall_enabled</span><span class="w">                                             </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="na">secondary_firewall_management_ip_enabled</span><span class="w">                               </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="na">secondary_virtual_network_gateway_express_route_enabled</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span><span class="na">secondary_virtual_network_gateway_express_route_hobo_public_ip_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">    </span><span class="na">secondary_virtual_network_gateway_vpn_enabled</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">    </span><span class="na">secondary_private_dns_zones_enabled</span><span class="w">                                    </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">    </span><span class="na">secondary_private_dns_auto_registration_zone_enabled</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">    </span><span class="na">secondary_private_dns_resolver_enabled</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">    </span><span class="na">secondary_bastion_enabled</span><span class="w">                                              </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
セカンダリHub（Japan West）の設定。プライマリと同じ項目。</p>
<p><strong>コスト削減したいなら？</strong>
セカンダリは最小構成にしよう：</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># セカンダリは最小限にしてコスト削減</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="na">secondary_firewall_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="na">secondary_virtual_network_gateway_express_route_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="na">secondary_virtual_network_gateway_vpn_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="na">secondary_bastion_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="c1"># DNS系だけ有効</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="na">secondary_private_dns_zones_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="na">secondary_private_dns_resolver_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span></code></pre></div>
<p>これでセカンダリはほぼ無料で使える。</p>
<h3 id="2-7">2-7. プライマリリソースの名前<a class="headerlink" href="#2-7" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">    # Resource names primary connectivity</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="na">primary_virtual_network_name</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vnet-hub-$${starter_location_01}&quot;</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span><span class="na">primary_firewall_name</span><span class="w">                                        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;fw-hub-$${starter_location_01}&quot;</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="na">primary_firewall_policy_name</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;fwp-hub-$${starter_location_01}&quot;</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">    </span><span class="na">primary_firewall_public_ip_name</span><span class="w">                              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pip-fw-hub-$${starter_location_01}&quot;</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span><span class="na">primary_firewall_management_public_ip_name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pip-fw-hub-mgmt-$${starter_location_01}&quot;</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="na">primary_route_table_firewall_name</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rt-hub-fw-$${starter_location_01}&quot;</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="na">primary_route_table_user_subnets_name</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rt-hub-std-$${starter_location_01}&quot;</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">    </span><span class="na">primary_virtual_network_gateway_express_route_name</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vgw-hub-er-$${starter_location_01}&quot;</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">    </span><span class="na">primary_virtual_network_gateway_express_route_public_ip_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pip-vgw-hub-er-$${starter_location_01}&quot;</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">    </span><span class="na">primary_virtual_network_gateway_vpn_name</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vgw-hub-vpn-$${starter_location_01}&quot;</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">    </span><span class="na">primary_virtual_network_gateway_vpn_public_ip_name_1</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pip-vgw-hub-vpn-$${starter_location_01}-001&quot;</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">    </span><span class="na">primary_virtual_network_gateway_vpn_public_ip_name_2</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pip-vgw-hub-vpn-$${starter_location_01}-002&quot;</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">    </span><span class="na">primary_private_dns_resolver_name</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pdr-hub-dns-$${starter_location_01}&quot;</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">    </span><span class="na">primary_bastion_host_name</span><span class="w">                                    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;bas-hub-$${starter_location_01}&quot;</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">    </span><span class="na">primary_bastion_host_public_ip_name</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pip-bastion-hub-$${starter_location_01}&quot;</span>
</span></code></pre></div>
<p>リソース名の一覧。命名規則を表にまとめるね：</p>
<table>
<thead>
<tr>
<th>プレフィックス</th>
<th>意味</th>
<th>例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>vnet-</code></td>
<td>Virtual Network</td>
<td><code>vnet-hub-japaneast</code></td>
</tr>
<tr>
<td><code>fw-</code></td>
<td>Firewall</td>
<td><code>fw-hub-japaneast</code></td>
</tr>
<tr>
<td><code>fwp-</code></td>
<td>Firewall Policy</td>
<td><code>fwp-hub-japaneast</code></td>
</tr>
<tr>
<td><code>pip-</code></td>
<td>Public IP</td>
<td><code>pip-fw-hub-japaneast</code></td>
</tr>
<tr>
<td><code>rt-</code></td>
<td>Route Table</td>
<td><code>rt-hub-fw-japaneast</code></td>
</tr>
<tr>
<td><code>vgw-</code></td>
<td>Virtual Network Gateway</td>
<td><code>vgw-hub-er-japaneast</code></td>
</tr>
<tr>
<td><code>pdr-</code></td>
<td>Private DNS Resolver</td>
<td><code>pdr-hub-dns-japaneast</code></td>
</tr>
<tr>
<td><code>bas-</code></td>
<td>Bastion Host</td>
<td><code>bas-hub-japaneast</code></td>
</tr>
</tbody>
</table>
<p>**Azureの推奨命名規則に従ってる**から、そのまま使えばOK。</p>
<h3 id="2-8">2-8. セカンダリリソースの名前<a class="headerlink" href="#2-8" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1">    # Resource names secondary connectivity</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="na">secondary_virtual_network_name</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vnet-hub-$${starter_location_02}&quot;</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="na">secondary_firewall_name</span><span class="w">                                        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;fw-hub-$${starter_location_02}&quot;</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="c1">    # ... 以下同じパターン</span>
</span></code></pre></div>
<p>セカンダリも同じパターン。<code>$${starter_location_02}</code>が<code>japanwest</code>に置き換わる。</p>
<hr />
<h2 id="1_1">☕ 休憩タイム（1回目）<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h2>
<p><strong>お疲れ様です！ここまでで以下を学びました</strong>：</p>
<p>✅ リージョン設定（<code>starter_locations</code>）<br />
✅ テンプレート変数（<code>$${starter_location_01}</code>）<br />
✅ カスタム置換の<code>names</code>セクション（リソース名、有効/無効設定）</p>
<p><strong>ここからはネットワークの細かい設定が続きます。</strong><br />
コーヒーを飲んで、少し休憩してから進みましょう。</p>
<p>次の Part 3 からは、IPアドレスやFirewallの設定が出てきます。</p>
<hr />
<h2 id="part-3">Part 3: 設定値のアドレス空間<a class="headerlink" href="#part-3" title="Permanent link">&para;</a></h2>
<p>ここから先は、ネットワークの細かい設定が続く。</p>
<h3 id="3-1-firewall">3-1. Firewallの設定<a class="headerlink" href="#3-1-firewall" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1">    # Primary firewall settings</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">    </span><span class="na">primary_firewall_sku_tier</span><span class="w">                           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Standard&quot;</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span><span class="na">primary_firewall_subnet_address_prefix</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.128.0/26&quot;</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span><span class="na">primary_firewall_management_subnet_address_prefix</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.128.64/26&quot;</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">    </span><span class="na">primary_firewall_client_public_ip_zones</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">    </span><span class="na">primary_firewall_management_public_ip_zones</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">    </span><span class="na">primary_virtual_network_address_space</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.0.0/16&quot;</span>
</span></code></pre></div>
<h4 id="primary_firewall_sku_tier">primary_firewall_sku_tier<a class="headerlink" href="#primary_firewall_sku_tier" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="na">primary_firewall_sku_tier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Standard&quot;</span>
</span></code></pre></div>
<p><strong>選択肢</strong>
- <code>Basic</code>：安い（月¥30,000程度）、機能少ない
- <code>Standard</code>：標準（月¥170,000程度）、脅威インテリジェンスあり
- <code>Premium</code>：高機能（月¥100,000 + Premium課金）、TLS検査あり</p>
<p><strong>おすすめ</strong>
- 検証：<code>Basic</code>
- 本番：<code>Standard</code>
- 高セキュリティ要件：<code>Premium</code></p>
<h4 id="primary_firewall_subnet_address_prefix">primary_firewall_subnet_address_prefix<a class="headerlink" href="#primary_firewall_subnet_address_prefix" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="na">primary_firewall_subnet_address_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.128.0/26&quot;</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
Firewallが使うSubnetのIPアドレス範囲。</p>
<p><strong>なぜ/26？</strong>
- /26 = 64個のIPアドレス
- Azureが5個予約するから、実際は59個使える
- Firewallには十分</p>
<h4 id="primary_firewall_client_public_ip_zones">primary_firewall_client_public_ip_zones<a class="headerlink" href="#primary_firewall_client_public_ip_zones" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="na">primary_firewall_client_public_ip_zones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
</span></code></pre></div>
<p><strong>🚨 重要！zones = [] の意味</strong></p>
<p><strong>zones</strong> は <strong>Availability Zones</strong>（可用性ゾーン）のことです。</p>
<p>Azureでは、リソースを複数のゾーン（物理的に離れたデータセンター）に分散配置することで、<br />
1つのデータセンター障害時にもサービスを継続できるようになっています。</p>
<p><strong>Japan East の制約</strong>:
- Firewall等の一部リソースは、Japan EastでAvailability Zonesに対応していません
- そのため、<code>zones = []</code>（空リスト）を指定する必要があります</p>
<p><strong>もし空リストにしないと？</strong>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>Error: zones are not supported in this region
</span></code></pre></div>
というエラーでデプロイが失敗します。</p>
<p><strong>US East等のゾーン対応リージョンでは</strong>:
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="na">primary_firewall_client_public_ip_zones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;1&quot;, &quot;2&quot;, &quot;3&quot;</span><span class="p">]</span><span class="c1">  # ←3つのゾーンに分散</span>
</span></code></pre></div>
と設定すると、3つのゾーンに分散配置されて高可用性になります。</p>
<h3 id="3-2-vpn-gateway">3-2. VPN Gatewayの設定<a class="headerlink" href="#3-2-vpn-gateway" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="w">    </span><span class="na">primary_virtual_network_gateway_vpn_public_ip_name_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pip-vgw-hub-vpn-$${starter_location_01}-001&quot;</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">    </span><span class="na">primary_virtual_network_gateway_vpn_public_ip_name_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pip-vgw-hub-vpn-$${starter_location_01}-002&quot;</span>
</span></code></pre></div>
<p><strong>なんで2個？</strong>
VPN Gatewayは**Active-Active構成**（2台同時稼働）にできるから。
- 1台目：<code>-001</code>
- 2台目：<code>-002</code></p>
<p>冗長化して可用性を上げたい時に使う。</p>
<h3 id="3-3-ip">3-3. IPアドレスの設計（プライマリ）<a class="headerlink" href="#3-3-ip" title="Permanent link">&para;</a></h3>
<p><strong>📚 IPアドレスとCIDR表記について</strong></p>
<p>ここから<code>10.0.0.0/16</code>のような表記が出てきます。
これは**CIDR表記**（サイダー表記）と呼ばれるIPアドレスの範囲を表す記法です。</p>
<p><strong>CIDR表記の読み方</strong>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>10.0.0.0/16
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>│      │
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>│      └─ ネットワーク部分のビット数（/16 = 最初の16ビット固定）
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>└─ 開始IPアドレス
</span></code></pre></div></p>
<p><strong>よく使うサイズ（覚えなくてOK、雰囲気だけ）</strong>:
- <code>/16</code>: 65,536個のIPアドレス（大規模ネットワーク全体）
- <code>/22</code>: 1,024個（Hub VNet用）
- <code>/24</code>: 256個（一般的なサブネット）
- <code>/26</code>: 64個（Firewall等の専用サブネット）
- <code>/27</code>: 32個（Gateway用）
- <code>/28</code>: 16個（DNS Resolver用）</p>
<p>**数字が小さいほど広い範囲**です。詳しく理解する必要はありません。<br />
「大きな範囲を小さく区切って使う」と思えばOKです。</p>
<hr />
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1">    # IP Ranges Primary</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="c1">    # Regional Address Space: 10.0.0.0/16</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">    </span><span class="na">primary_hub_address_space</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.0.0/16&quot;</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">    </span><span class="na">primary_hub_virtual_network_address_space</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.0.0/22&quot;</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">    </span><span class="na">primary_firewall_subnet_address_prefix</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.0.0/26&quot;</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">    </span><span class="na">primary_firewall_management_subnet_address_prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.0.192/26&quot;</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">    </span><span class="na">primary_bastion_subnet_address_prefix</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.0.64/26&quot;</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">    </span><span class="na">primary_gateway_subnet_address_prefix</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.0.128/27&quot;</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">    </span><span class="na">primary_private_dns_resolver_subnet_address_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.0.160/28&quot;</span>
</span></code></pre></div>
<p><strong>📊 IPアドレスの全体像（視覚化）</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>10.0.0.0/16（Regional全体: 65,536個のIPアドレス）
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>├─ 10.0.0.0/22（Hub VNet: 1,024個）
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>│  ├─ 10.0.0.0/26    [Firewall Subnet]          64個
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>│  ├─ 10.0.0.64/26   [Bastion Subnet]           64個
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>│  ├─ 10.0.0.128/27  [Gateway Subnet]           32個
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>│  ├─ 10.0.0.160/28  [DNS Resolver Subnet]      16個
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>│  └─ 10.0.0.192/26  [Firewall Mgmt Subnet]     64個
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>│
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>└─ 10.0.4.0〜10.0.255.255（残り: 64,512個）
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>   └─ Spoke VNet用に予約（将来の拡張用）
</span></code></pre></div>
<p><strong>表形式でも見てみましょう</strong></p>
<table>
<thead>
<tr>
<th>用途</th>
<th>CIDR</th>
<th>IP範囲</th>
<th>使える数</th>
</tr>
</thead>
<tbody>
<tr>
<td>Regional全体</td>
<td><code>10.0.0.0/16</code></td>
<td>10.0.0.0 - 10.0.255.255</td>
<td>65,536個</td>
</tr>
<tr>
<td>Hub VNet</td>
<td><code>10.0.0.0/22</code></td>
<td>10.0.0.0 - 10.0.3.255</td>
<td>1,024個</td>
</tr>
<tr>
<td>Firewall</td>
<td><code>10.0.0.0/26</code></td>
<td>10.0.0.0 - 10.0.0.63</td>
<td>64個</td>
</tr>
<tr>
<td>Firewall Management</td>
<td><code>10.0.0.192/26</code></td>
<td>10.0.0.192 - 10.0.0.255</td>
<td>64個</td>
</tr>
<tr>
<td>Bastion</td>
<td><code>10.0.0.64/26</code></td>
<td>10.0.0.64 - 10.0.0.127</td>
<td>64個</td>
</tr>
<tr>
<td>Gateway</td>
<td><code>10.0.0.128/27</code></td>
<td>10.0.0.128 - 10.0.0.159</td>
<td>32個</td>
</tr>
<tr>
<td>DNS Resolver</td>
<td><code>10.0.0.160/28</code></td>
<td>10.0.0.160 - 10.0.0.175</td>
<td>16個</td>
</tr>
</tbody>
</table>
<p><strong>🎯 設計のポイント</strong>
- Hub VNetは<code>10.0.0.0/22</code>（1,024個）だけ使う
- 残りの64,512個はSpoke VNet用に予約
- 各Subnetが重ならないように慎重に設計されている
- Firewallが2つ（本体+管理用）あることに注目</p>
<h3 id="3-4-ip">3-4. IPアドレスの設計（セカンダリ）<a class="headerlink" href="#3-4-ip" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1">    # IP Ranges Secondary</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="c1">    # Regional Address Space: 10.1.0.0/16</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">    </span><span class="na">secondary_hub_address_space</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.1.0.0/16&quot;</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">    </span><span class="na">secondary_hub_virtual_network_address_space</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.1.0.0/22&quot;</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">    </span><span class="na">secondary_firewall_subnet_address_prefix</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.1.0.0/26&quot;</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">    </span><span class="na">secondary_firewall_management_subnet_address_prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.1.0.192/26&quot;</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">    </span><span class="na">secondary_bastion_subnet_address_prefix</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.1.0.64/26&quot;</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">    </span><span class="na">secondary_gateway_subnet_address_prefix</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.1.0.128/27&quot;</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">    </span><span class="na">secondary_private_dns_resolver_subnet_address_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.1.0.160/28&quot;</span>
</span></code></pre></div>
<p><strong>パターン同じでしょ？</strong>
プライマリが<code>10.0.x.x</code>、セカンダリが<code>10.1.x.x</code>ってだけ。</p>
<p>これで2つのリージョンが重ならないように設計されてる。</p>
<hr />
<h2 id="part-4">Part 4: リソースグループ識別子<a class="headerlink" href="#part-4" title="Permanent link">&para;</a></h2>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="w">  </span><span class="nb">resource_group_identifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">    </span><span class="na">management_resource_group_id</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/subscriptions/$${subscription_id_management}/resourcegroups/$${management_resource_group_name}&quot;</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">    </span><span class="na">ddos_protection_plan_resource_group_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/subscriptions/$${subscription_id_connectivity}/resourcegroups/$${ddos_resource_group_name}&quot;</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">    </span><span class="na">primary_connectivity_resource_group_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/subscriptions/$${subscription_id_connectivity}/resourceGroups/$${connectivity_hub_primary_resource_group_name}&quot;</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">    </span><span class="na">secondary_connectivity_resource_group_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/subscriptions/$${subscription_id_connectivity}/resourceGroups/$${connectivity_hub_secondary_resource_group_name}&quot;</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">    </span><span class="na">dns_resource_group_id</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/subscriptions/$${subscription_id_connectivity}/resourceGroups/$${dns_resource_group_name}&quot;</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
リソースグループの**フルパス**（完全なID）を作ってる。</p>
<p><strong>形式</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>/subscriptions/{サブスクリプションID}/resourcegroups/{リソースグループ名}
</span></code></pre></div></p>
<p><strong>なぜ必要？</strong>
後で他のリソースから参照する時に使う。
例えば、「このLog AnalyticsはどのRGにある？」って聞かれた時に、このIDで答える。</p>
<hr />
<h2 id="part-5">Part 5: リソース識別子<a class="headerlink" href="#part-5" title="Permanent link">&para;</a></h2>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="w">  </span><span class="nb">resource_identifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">    </span><span class="na">ama_change_tracking_data_collection_rule_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${management_resource_group_id}/providers/Microsoft.Insights/dataCollectionRules/$${dcr_change_tracking_name}&quot;</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">    </span><span class="na">ama_mdfc_sql_data_collection_rule_id</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${management_resource_group_id}/providers/Microsoft.Insights/dataCollectionRules/$${dcr_defender_sql_name}&quot;</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">    </span><span class="na">ama_vm_insights_data_collection_rule_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${management_resource_group_id}/providers/Microsoft.Insights/dataCollectionRules/$${dcr_vm_insights_name}&quot;</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">    </span><span class="na">ama_user_assigned_managed_identity_id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${management_resource_group_id}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/$${ama_user_assigned_managed_identity_name}&quot;</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">    </span><span class="na">log_analytics_workspace_id</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${management_resource_group_id}/providers/Microsoft.OperationalInsights/workspaces/$${log_analytics_workspace_name}&quot;</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">    </span><span class="na">ddos_protection_plan_id</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${ddos_protection_plan_resource_group_id}/providers/Microsoft.Network/ddosProtectionPlans/$${ddos_protection_plan_name}&quot;</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
個別のリソースの**フルパス**（Resource ID）を作ってる。</p>
<p><strong>形式</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>{リソースグループID}/providers/{リソースタイプ}/{リソース名}
</span></code></pre></div></p>
<p><strong>例</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>/subscriptions/xxx/resourcegroups/rg-management-japaneast/providers/Microsoft.OperationalInsights/workspaces/law-management-japaneast
</span></code></pre></div></p>
<p>これでLog Analytics Workspaceを一意に特定できる。</p>
<hr />
<h2 id="2">☕ 休憩タイム（2回目）<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<p><strong>半分まで来ました！ここまでで学んだこと</strong>：</p>
<p>✅ ネットワークのIPアドレス設定（Part 3）<br />
✅ リソースグループ識別子（Part 4）<br />
✅ リソース識別子（Part 5）</p>
<p><strong>今から学ぶこと</strong>：
- タグ設定（コスト管理、管理用）
- 管理リソース（Log Analytics等）
- 管理グループとポリシー</p>
<p>もう少しで終わります。頭をリフレッシュしてから進みましょう！</p>
<hr />
<h2 id="part-6">Part 6: タグ設定<a class="headerlink" href="#part-6" title="Permanent link">&para;</a></h2>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">  </span><span class="na">deployed_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform&quot;</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">  </span><span class="na">source</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Azure Landing Zones Accelerator&quot;</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
全てのリソースに付けるタグ（メタデータ）。</p>
<p><strong>タグの使い道</strong>
- コスト管理：「Terraformで作ったリソースのコストは？」
- 検索：「ALZで作ったリソース一覧を出して」
- 自動化：「terraformタグがついてるやつだけバックアップ」</p>
<p><strong>カスタマイズ例</strong>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">  </span><span class="na">deployed_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform&quot;</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">  </span><span class="na">source</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Azure Landing Zones Accelerator&quot;</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">  </span><span class="na">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;production&quot;</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">  </span><span class="na">cost_center</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;IT-Platform&quot;</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">  </span><span class="na">owner</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;platform-team@example.com&quot;</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="p">}</span>
</span></code></pre></div></p>
<hr />
<h2 id="part-7">Part 7: 管理リソース設定<a class="headerlink" href="#part-7" title="Permanent link">&para;</a></h2>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nb">management_resource_settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="w">  </span><span class="na">enabled</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">  </span><span class="na">location</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${starter_location_01}&quot;</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">  </span><span class="na">log_analytics_workspace_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${log_analytics_workspace_name}&quot;</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="w">  </span><span class="na">resource_group_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${management_resource_group_name}&quot;</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">  </span><span class="nb">user_assigned_managed_identities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">    </span><span class="nb">ama</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">      </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${ama_user_assigned_managed_identity_name}&quot;</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="w">  </span><span class="nb">data_collection_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="w">    </span><span class="nb">change_tracking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="w">      </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${dcr_change_tracking_name}&quot;</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a><span class="w">    </span><span class="nb">defender_sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="w">      </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${dcr_defender_sql_name}&quot;</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="w">    </span><span class="nb">vm_insights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a><span class="w">      </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${dcr_vm_insights_name}&quot;</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
Log Analyticsなど、監視系のリソースをまとめて設定しています。</p>
<p><strong>enabled = true</strong> にすると：
- Log Analytics Workspace作られる
- Data Collection Rule（DCR）3種類作られる
- Managed Identity作られる</p>
<p><strong>無効にしたい場合</strong>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nb">management_resource_settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">  </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="c1">  # ←これだけでOK</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="p">}</span>
</span></code></pre></div></p>
<p>ログ不要な検証環境とかで使える。</p>
<hr />
<h2 id="part-8">Part 8: 管理グループとポリシー<a class="headerlink" href="#part-8" title="Permanent link">&para;</a></h2>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nb">management_group_settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">  </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">  </span><span class="na">architecture_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;alz_custom&quot;</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">  </span><span class="na">location</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${starter_location_01}&quot;</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">  </span><span class="na">parent_resource_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${root_parent_management_group_id}&quot;</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">  </span><span class="nb">policy_default_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">    </span><span class="na">ama_change_tracking_data_collection_rule_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${ama_change_tracking_data_collection_rule_id}&quot;</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">    </span><span class="na">ama_mdfc_sql_data_collection_rule_id</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${ama_mdfc_sql_data_collection_rule_id}&quot;</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">    </span><span class="na">ama_vm_insights_data_collection_rule_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${ama_vm_insights_data_collection_rule_id}&quot;</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">    </span><span class="na">ama_user_assigned_managed_identity_id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${ama_user_assigned_managed_identity_id}&quot;</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">    </span><span class="na">ama_user_assigned_managed_identity_name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${ama_user_assigned_managed_identity_name}&quot;</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">    </span><span class="na">log_analytics_workspace_id</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${log_analytics_workspace_id}&quot;</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">    </span><span class="na">ddos_protection_plan_id</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${ddos_protection_plan_id}&quot;</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">    </span><span class="na">private_dns_zone_subscription_id</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${subscription_id_connectivity}&quot;</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="w">    </span><span class="na">private_dns_zone_region</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${starter_location_01}&quot;</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="w">    </span><span class="na">private_dns_zone_resource_group_name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${dns_resource_group_name}&quot;</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">  </span><span class="nb">subscription_placement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="w">    </span><span class="nb">identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="w">      </span><span class="na">subscription_id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${subscription_id_identity}&quot;</span>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="w">      </span><span class="na">management_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;identity&quot;</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="w">    </span><span class="nb">connectivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="w">      </span><span class="na">subscription_id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${subscription_id_connectivity}&quot;</span>
</span><span id="__span-51-27"><a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a><span class="w">      </span><span class="na">management_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;connectivity&quot;</span>
</span><span id="__span-51-28"><a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-29"><a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="w">    </span><span class="nb">management</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-30"><a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="w">      </span><span class="na">subscription_id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${subscription_id_management}&quot;</span>
</span><span id="__span-51-31"><a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a><span class="w">      </span><span class="na">management_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;management&quot;</span>
</span><span id="__span-51-32"><a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-33"><a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a><span class="w">    </span><span class="nb">security</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-34"><a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a><span class="w">      </span><span class="na">subscription_id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${subscription_id_security}&quot;</span>
</span><span id="__span-51-35"><a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a><span class="w">      </span><span class="na">management_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;security&quot;</span>
</span><span id="__span-51-36"><a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-37"><a id="__codelineno-51-37" name="__codelineno-51-37" href="#__codelineno-51-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-51-38"><a id="__codelineno-51-38" name="__codelineno-51-38" href="#__codelineno-51-38"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>これが超重要！</strong></p>
<h3 id="architecture_name">architecture_name<a class="headerlink" href="#architecture_name" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="na">architecture_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;alz_custom&quot;</span>
</span></code></pre></div>
<p>これが<code>lib/architecture_definitions/alz_custom.alz_architecture_definition.yaml</code>を指しています。
管理グループの階層構造がそこに書いてある。</p>
<h3 id="policy_default_values">policy_default_values<a class="headerlink" href="#policy_default_values" title="Permanent link">&para;</a></h3>
<p>ポリシーで使うデフォルト値を全て指定しています。</p>
<p>例えば、「VMにAzure Monitor Agentを入れるポリシー」が動く時、
ここで指定したManaged IdentityとDCRが自動で設定される。</p>
<h3 id="subscription_placement">subscription_placement<a class="headerlink" href="#subscription_placement" title="Permanent link">&para;</a></h3>
<p>どのサブスクリプションをどの管理グループに入れるか決めてる。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>root
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>├── Platform
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>│   ├── Connectivity（← connectivity subscriptionがここ）
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>│   ├── Management（← management subscriptionがここ）
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>│   ├── Identity（← identity subscriptionがここ）
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>│   └── Security（← security subscriptionがここ）
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>└── Landing Zones
</span></code></pre></div>
<h3 id="defender">Defenderの設定<a class="headerlink" href="#defender" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="w">  </span><span class="nb">policy_assignments_to_modify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">    </span><span class="nb">alz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">      </span><span class="nb">policy_assignments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">        </span><span class="nb">Deploy-MDFC-Config-H224</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">          </span><span class="nb">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">            </span><span class="na">ascExportResourceGroupName</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${asc_export_resource_group_name}&quot;</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="w">            </span><span class="na">ascExportResourceGroupLocation</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${starter_location_01}&quot;</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="w">            </span><span class="na">emailSecurityContact</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${defender_email_security_contact}&quot;</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="w">            </span><span class="na">enableAscForServers</span><span class="w">                         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="w">            </span><span class="na">enableAscForServersVulnerabilityAssessments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="w">            </span><span class="na">enableAscForSql</span><span class="w">                             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="w">            </span><span class="na">enableAscForAppServices</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="w">            </span><span class="na">enableAscForStorage</span><span class="w">                         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="w">            </span><span class="na">enableAscForContainers</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a><span class="w">            </span><span class="na">enableAscForKeyVault</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a><span class="w">            </span><span class="na">enableAscForSqlOnVm</span><span class="w">                         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a><span class="w">            </span><span class="na">enableAscForArm</span><span class="w">                             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a><span class="w">            </span><span class="na">enableAscForOssDb</span><span class="w">                           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a><span class="w">            </span><span class="na">enableAscForCosmosDbs</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a><span class="w">            </span><span class="na">enableAscForCspm</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeployIfNotExists&quot;</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-54-25"><a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
Microsoft Defender for Cloud（セキュリティ監視）の設定。</p>
<p><strong>DeployIfNotExists</strong> = 「もし有効じゃなかったら、自動で有効にする」</p>
<p>全部のサービスで有効になってる。</p>
<p><strong>無効にしたい場合</strong>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="na">enableAscForServers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Disabled&quot;</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="na">enableAscForSql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Disabled&quot;</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="c1"># ... 全部Disabledに</span>
</span></code></pre></div></p>
<hr />
<h2 id="3">☕ 休憩タイム（3回目・最後）<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<p><strong>あと一息です！ここまでで学んだこと</strong>：</p>
<p>✅ タグ設定（Part 6）<br />
✅ 管理リソース（Log Analytics、Automation Account等）（Part 7）<br />
✅ 管理グループとポリシー（Part 8）</p>
<p><strong>残りの Part 9 は、この設定ファイルのメインイベント！</strong><br />
Hub-and-Spokeネットワークの詳細設定を見ていきます。</p>
<p>Firewall、Bastion、VPN、ExpressRouteの設定が出てきますよ。<br />
深呼吸して、集中していきましょう！</p>
<hr />
<h2 id="part-9-hub-and-spoke">Part 9: ネットワーク設定（Hub-and-Spoke）<a class="headerlink" href="#part-9-hub-and-spoke" title="Permanent link">&para;</a></h2>
<h3 id="connectivity_type">connectivity_type<a class="headerlink" href="#connectivity_type" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="na">connectivity_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hub_and_spoke_vnet&quot;</span>
</span></code></pre></div>
<p><strong>選択肢</strong>
- <code>"hub_and_spoke_vnet"</code>：Hub-and-Spoke構成（一般的）
- <code>"virtual_wan"</code>：Virtual WAN構成（大規模向け）
- <code>"none"</code>：ネットワーク作らない</p>
<p>このプロジェクトはHub-and-Spokeを使ってる。</p>
<h3 id="connectivity_resource_groups">connectivity_resource_groups<a class="headerlink" href="#connectivity_resource_groups" title="Permanent link">&para;</a></h3>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="nb">connectivity_resource_groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="w">  </span><span class="nb">ddos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">    </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${ddos_resource_group_name}&quot;</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">    </span><span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${starter_location_01}&quot;</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="w">    </span><span class="nb">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w">      </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${ddos_protection_plan_enabled}&quot;</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="w">  </span><span class="nb">vnet_primary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="w">    </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${connectivity_hub_primary_resource_group_name}&quot;</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="w">    </span><span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${starter_location_01}&quot;</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="w">    </span><span class="nb">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a><span class="w">      </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="w">  </span><span class="nb">vnet_secondary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a><span class="w">    </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${connectivity_hub_secondary_resource_group_name}&quot;</span>
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a><span class="w">    </span><span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${starter_location_02}&quot;</span>
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a><span class="w">    </span><span class="nb">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-20"><a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a><span class="w">      </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-57-21"><a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-57-22"><a id="__codelineno-57-22" name="__codelineno-57-22" href="#__codelineno-57-22"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-57-23"><a id="__codelineno-57-23" name="__codelineno-57-23" href="#__codelineno-57-23"></a><span class="w">  </span><span class="nb">dns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-24"><a id="__codelineno-57-24" name="__codelineno-57-24" href="#__codelineno-57-24"></a><span class="w">    </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${dns_resource_group_name}&quot;</span>
</span><span id="__span-57-25"><a id="__codelineno-57-25" name="__codelineno-57-25" href="#__codelineno-57-25"></a><span class="w">    </span><span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${starter_location_01}&quot;</span>
</span><span id="__span-57-26"><a id="__codelineno-57-26" name="__codelineno-57-26" href="#__codelineno-57-26"></a><span class="w">    </span><span class="nb">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-27"><a id="__codelineno-57-27" name="__codelineno-57-27" href="#__codelineno-57-27"></a><span class="w">      </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_private_dns_zones_enabled}&quot;</span>
</span><span id="__span-57-28"><a id="__codelineno-57-28" name="__codelineno-57-28" href="#__codelineno-57-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-57-29"><a id="__codelineno-57-29" name="__codelineno-57-29" href="#__codelineno-57-29"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-57-30"><a id="__codelineno-57-30" name="__codelineno-57-30" href="#__codelineno-57-30"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>これは何？</strong>
ネットワーク用のリソースグループを4つ作ってる：
1. <strong>ddos</strong>：DDoS Protection用
2. <strong>vnet_primary</strong>：プライマリHub用
3. <strong>vnet_secondary</strong>：セカンダリHub用
4. <strong>dns</strong>：Private DNS Zones用</p>
<p><code>enabled</code>が<code>false</code>のやつは作られない。</p>
<h3 id="hub_virtual_networks">hub_virtual_networks（プライマリ）<a class="headerlink" href="#hub_virtual_networks" title="Permanent link">&para;</a></h3>
<p>ここが一番長い。プライマリHubの全設定が入ってる。</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nb">hub_virtual_networks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="w">  </span><span class="nb">primary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">    </span><span class="na">location</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${starter_location_01}&quot;</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">    </span><span class="na">default_parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_connectivity_resource_group_id}&quot;</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="w">    </span><span class="nb">enabled_resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="w">      </span><span class="na">firewall</span><span class="w">                              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_firewall_enabled}&quot;</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="w">      </span><span class="na">bastion</span><span class="w">                               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_bastion_enabled}&quot;</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="w">      </span><span class="na">virtual_network_gateway_express_route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_virtual_network_gateway_express_route_enabled}&quot;</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="w">      </span><span class="na">virtual_network_gateway_vpn</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_virtual_network_gateway_vpn_enabled}&quot;</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="w">      </span><span class="na">private_dns_zones</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_private_dns_zones_enabled}&quot;</span>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="w">      </span><span class="na">private_dns_resolver</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_private_dns_resolver_enabled}&quot;</span>
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>enabled_resources</strong>
さっきPart 2で設定した有効/無効フラグがここで使われる。</p>
<h4 id="vnet">VNet設定<a class="headerlink" href="#vnet" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="w">    </span><span class="nb">hub_virtual_network</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="w">      </span><span class="na">name</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_virtual_network_name}&quot;</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">      </span><span class="na">address_space</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;$${primary_hub_virtual_network_address_space}&quot;</span><span class="p">]</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w">      </span><span class="na">routing_address_space</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;$${primary_hub_address_space}&quot;</span><span class="p">]</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">      </span><span class="na">route_table_name_firewall</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_route_table_firewall_name}&quot;</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">      </span><span class="na">route_table_name_user_subnets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_route_table_user_subnets_name}&quot;</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="w">      </span><span class="nb">subnets</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>address_space vs routing_address_space</strong>
- <code>address_space</code>：VNet実際のIP範囲（<code>10.0.0.0/22</code>）
- <code>routing_address_space</code>：ルーティングで広告する範囲（<code>10.0.0.0/16</code>）</p>
<p>広い範囲で広告しておいて、後からSpokeを追加できるようにしています。</p>
<h4 id="firewall">Firewall設定<a class="headerlink" href="#firewall" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="w">    </span><span class="nb">firewall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">      </span><span class="na">subnet_address_prefix</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_firewall_subnet_address_prefix}&quot;</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">      </span><span class="na">management_subnet_address_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_firewall_management_subnet_address_prefix}&quot;</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">      </span><span class="na">name</span><span class="w">                             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_firewall_name}&quot;</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="w">      </span><span class="nb">default_ip_configuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w">        </span><span class="nb">public_ip_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w">          </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_firewall_public_ip_name}&quot;</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="w">      </span><span class="na">management_ip_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_firewall_management_ip_enabled}&quot;</span>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="w">      </span><span class="nb">management_ip_configuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="w">        </span><span class="nb">public_ip_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="w">          </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_firewall_management_public_ip_name}&quot;</span>
</span><span id="__span-60-14"><a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-60-15"><a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-60-16"><a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<p>Firewallには2つのPublic IPが必要：
1. <strong>default_ip_configuration</strong>：トラフィック用
2. <strong>management_ip_configuration</strong>：管理用（Basic SKU</p>
<p>で必要）</p>
<h4 id="vpnexpressroute-gateway">VPN/ExpressRoute Gateway設定<a class="headerlink" href="#vpnexpressroute-gateway" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="w">    </span><span class="nb">virtual_network_gateways</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="w">      </span><span class="na">subnet_address_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_gateway_subnet_address_prefix}&quot;</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="w">      </span><span class="nb">express_route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="w">        </span><span class="na">name</span><span class="w">                                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_virtual_network_gateway_express_route_name}&quot;</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w">        </span><span class="na">hosted_on_behalf_of_public_ip_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_virtual_network_gateway_express_route_hobo_public_ip_enabled}&quot;</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="w">        </span><span class="nb">ip_configurations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w">          </span><span class="nb">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="w">            </span><span class="nb">public_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="w">              </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_virtual_network_gateway_express_route_public_ip_name}&quot;</span>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a><span class="w">      </span><span class="nb">vpn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a><span class="w">        </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_virtual_network_gateway_vpn_name}&quot;</span>
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a><span class="w">        </span><span class="nb">ip_configurations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a><span class="w">          </span><span class="nb">active_active_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-18"><a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="w">            </span><span class="nb">public_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-19"><a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a><span class="w">              </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_virtual_network_gateway_vpn_public_ip_name_1}&quot;</span>
</span><span id="__span-61-20"><a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-61-21"><a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-61-22"><a id="__codelineno-61-22" name="__codelineno-61-22" href="#__codelineno-61-22"></a><span class="w">          </span><span class="nb">active_active_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-23"><a id="__codelineno-61-23" name="__codelineno-61-23" href="#__codelineno-61-23"></a><span class="w">            </span><span class="nb">public_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-24"><a id="__codelineno-61-24" name="__codelineno-61-24" href="#__codelineno-61-24"></a><span class="w">              </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_virtual_network_gateway_vpn_public_ip_name_2}&quot;</span>
</span><span id="__span-61-25"><a id="__codelineno-61-25" name="__codelineno-61-25" href="#__codelineno-61-25"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-61-26"><a id="__codelineno-61-26" name="__codelineno-61-26" href="#__codelineno-61-26"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-61-27"><a id="__codelineno-61-27" name="__codelineno-61-27" href="#__codelineno-61-27"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-61-28"><a id="__codelineno-61-28" name="__codelineno-61-28" href="#__codelineno-61-28"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-61-29"><a id="__codelineno-61-29" name="__codelineno-61-29" href="#__codelineno-61-29"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<p>VPN Gatewayは**Active-Active**（2台構成）になってる。
ExpressRouteは1台だけ。</p>
<h4 id="bastion">Bastion設定<a class="headerlink" href="#bastion" title="Permanent link">&para;</a></h4>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="w">    </span><span class="nb">bastion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="w">      </span><span class="na">subnet_address_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_bastion_subnet_address_prefix}&quot;</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="w">      </span><span class="na">name</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_bastion_host_name}&quot;</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="w">      </span><span class="na">zones</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">      </span><span class="nb">bastion_public_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">        </span><span class="na">name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;$${primary_bastion_host_public_ip_name}&quot;</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="w">        </span><span class="na">zones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>超重要！</strong>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="na">zones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
</span></code></pre></div></p>
<p>Japan EastはAvailability Zonesに対応していないため<code>[]</code>に設定しています。
これ忘れるとエラーになる。</p>
<hr />
<h2 id="_3">まとめ<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>お疲れ様でした！platform-landing-zone.auto.tfvarsの全体を見てきました。</p>
<p><strong>長かったですが、パターンは3つだけです</strong>：
1. <strong>名前の定義</strong>（<code>names</code>セクション）
2. <strong>有効/無効の設定</strong>（<code>xxx_enabled</code>）
3. <strong>実際のリソース設定</strong>（各セクション）</p>
<p><strong>覚えておくべきポイント</strong>：
- リージョンは<code>starter_locations</code>で決まります
- 有効/無効は<code>xxx_enabled = true/false</code>で設定します
- Japan Eastは<code>zones = []</code>が必須です
- コスト削減したいならFirewall、VPN、Bastionを<code>false</code>に設定します</p>
<hr />
<h2 id="_4">練習問題<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>理解度チェックです。休憩中に考えてみましょう。</p>
<h3 id="1_2">問題1<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h3>
<p>このプロジェクトを西日本（japanwest）だけにデプロイするには、<br />
<code>starter_locations</code>をどう変更すればいいですか？</p>
<h3 id="2_1">問題2<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<p>Firewallを無効化してコストを削減したい場合、<br />
どの設定を<code>false</code>に変更すればいいですか？（具体的な変数名を答えてください）</p>
<h3 id="3_1">問題3<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h3>
<p><code>management_resource_group_name = "rg-management-$${starter_location_01}"</code>という設定で、<br />
<code>starter_locations = ["japaneast", "japanwest"]</code>の場合、<br />
実際のリソースグループ名は何になりますか？</p>
<hr />
<h2 id="_5">練習問題の答え<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<h3 id="1_3">答え1<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h3>
<p><div class="language-hcl highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="na">starter_locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;japanwest&quot;</span><span class="p">]</span>
</span></code></pre></div>
1つのリージョンだけ指定します。セカンダリは不要なので削除。</p>
<h3 id="2_2">答え2<a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h3>
<p><div class="language-hcl highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="na">primary_firewall_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="na">secondary_firewall_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span></code></pre></div>
プライマリとセカンダリ両方のFirewallを無効化します。<br />
これで月額約28万円のコスト削減になります。</p>
<h3 id="3_2">答え3<a class="headerlink" href="#3_2" title="Permanent link">&para;</a></h3>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>rg-management-japaneast
</span></code></pre></div>
<code>$${starter_location_01}</code>が最初のリージョン<code>japaneast</code>に置き換わります。</p>
<hr />
<p>次のChapterでは、<code>variables.tf</code>を見ていきます。
このtfvarsファイルの「型定義」がどうなっているか解説します。</p>
<hr />
<p><strong>所要時間</strong>: 60分<br />
<strong>難易度</strong>: ★★★★★<br />
<strong>前</strong>: <a href="../02_%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E9%80%A0/">02_プロジェクト構造.md</a><br />
<strong>次</strong>: <a href="../04_%E5%A4%89%E6%95%B0%E5%AE%9A%E7%BE%A9/">04_変数定義.md</a></p>









  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        このページは役に立ちましたか？
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="役に立った！" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="改善が必要" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              ありがとうございます！
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              フィードバックをお願いします
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  ページトップへ戻る
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026 shuhei0720org01
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/shuhei0720org01/alz-mgmt" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate", "toc.follow"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>