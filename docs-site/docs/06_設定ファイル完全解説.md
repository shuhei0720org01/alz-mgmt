# 06. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬ - platform-landing-zone.auto.tfvars

!!! info "ã“ã®ç« ã§å­¦ã¶ã“ã¨"
    `platform-landing-zone.auto.tfvars`ã‚’å®Œå…¨è§£èª¬ã—ã¾ã™ï¼š

    1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã®ä»•çµ„ã¿ï¼ˆ`$${ }`è¨˜æ³•ï¼‰
    2. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã®å…¨ä½“åƒï¼ˆ6ã¤ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
    3. å„è¨­å®šé …ç›®ã®è©³ç´°è§£èª¬
    4. ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®šã¨ã‚«ã‚¹ã‚¿ãƒ ç½®æ›
    5. ç®¡ç†ãƒªã‚½ãƒ¼ã‚¹ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
    6. å®Ÿè·µï¼šè¨­å®šå€¤ã®å¤‰æ›´æ–¹æ³•

---

## ã“ã®Chapterã‚’èª­ã‚€å‰ã«çŸ¥ã£ã¦ãŠãã¹ãã“ã¨

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã«ã¤ã„ã¦

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°** ã‚’å¤šç”¨ã—ã¦ã„ã¾ã™ï¼š

```hcl title="ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã®ä¾‹"
management_resource_group_name = "rg-management-$${starter_location_01}"
```

**ä½•ãŒèµ·ãã‚‹ã‹**:

- `$${starter_location_01}` â†’ `japaneast` ã«è‡ªå‹•ç½®æ›ã•ã‚Œã‚‹
- å®Ÿéš›ã®åå‰: `"rg-management-japaneast"`

**Terraformã®å¤‰æ•°ï¼ˆ`${}`ï¼‰ã¨ã®é•ã„**:

| è¨˜æ³• | å‡¦ç†ã‚¿ã‚¤ãƒŸãƒ³ã‚° | ç”¨é€” |
|------|--------------|------|
| `${}` | Terraformå®Ÿè¡Œæ™‚ï¼ˆå³åº§ï¼‰ | Terraformå¤‰æ•°ã®å‚ç…§ |
| `$${}`  | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†æ™‚ï¼ˆå¾Œã§ï¼‰ | è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ç½®æ› |

**ã‚ˆãä½¿ã‚ã‚Œã‚‹ç½®æ›å¤‰æ•°**:

- `$${starter_location_01}` â†’ æœ€åˆã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆä¾‹: `japaneast`ï¼‰
- `$${starter_location_02}` â†’ 2ç•ªç›®ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆä¾‹: `japanwest`ï¼‰
- `$${starter_location_01_short}` â†’ çŸ­ç¸®åï¼ˆä¾‹: `jp`ï¼‰

è©³ç´°ã¯ [Chapter 06: è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](./06_è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.md) ã§è§£èª¬ã—ã¾ã™ã€‚
ã¾ãšã¯ã€Œè‡ªå‹•ã§ç½®ãæ›ã‚ã‚‹ã€ã¨ç†è§£ã™ã‚Œã°OKã§ã™ã€‚

---

## ãƒ•ã‚¡ã‚¤ãƒ«ã®å…¨ä½“æ§‹é€ 

ã¾ãšã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã©ã‚“ãªæ§‹é€ ã«ãªã£ã¦ã„ã‚‹ã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```hcl title="platform-landing-zone.auto.tfvarsã®å…¨ä½“æ§‹é€ "
# 1. ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆèª¬æ˜æ›¸ãï¼‰
/*
--- Built-in Replacements ---
...
*/

# 2. ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®šï¼ˆã©ã“ã«ä½œã‚‹ã‹ï¼‰
starter_locations = ["japaneast", "japanwest"]

# 3. ã‚«ã‚¹ã‚¿ãƒ ç½®æ›è¨­å®šï¼ˆåå‰ã¨ã‹è¨­å®šå€¤ï¼‰
custom_replacements = {
  names = { ... }                    # åå‰ã¨ã‹æœ‰åŠ¹/ç„¡åŠ¹ã®è¨­å®š
  resource_group_identifiers = { ... }  # ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ID
  resource_identifiers = { ... }        # ãƒªã‚½ãƒ¼ã‚¹ã®ID
}

# 4. ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®šï¼ˆç®±ã®è¨­å®šï¼‰
management_resource_groups = { ... }
connectivity_resource_groups = { ... }

# 5. ç®¡ç†ãƒªã‚½ãƒ¼ã‚¹è¨­å®šï¼ˆãƒ­ã‚°ã¨ã‹ç›£è¦–ï¼‰
management_resource_settings = { ... }

# 6. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šï¼ˆHub-and-Spokeï¼‰
hub_and_spoke_vnet_settings = { ... }
```

æ„å¤–ã¨ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã‚ˆã­ã€‚

---

## Part 1: ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®š

### starter_locations

```hcl title="ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®š"
starter_locations = ["japaneast", "japanwest"]
```

**ã“ã‚Œã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ**

- ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ã†Azureãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒªã‚¹ãƒˆã§ã™
- æœ€åˆã®é …ç›®ï¼ˆ`japaneast`ï¼‰ãŒãƒ—ãƒ©ã‚¤ãƒãƒªï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰
- 2ç•ªç›®ã®é …ç›®ï¼ˆ`japanwest`ï¼‰ãŒã‚»ã‚«ãƒ³ãƒ€ãƒªï¼ˆã‚µãƒ–ï¼‰

**ã©ã†ä½¿ã‚ã‚Œã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ**
å¾Œã§å‡ºã¦ãã‚‹è¨­å®šã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è‡ªå‹•ç½®æ›ã•ã‚Œã¾ã™ï¼š

```hcl title="è‡ªå‹•ç½®æ›ã®ä»•çµ„ã¿"
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†…ã§
resource_group_name = "rg-hub-$${starter_location_01}"

# å®Ÿéš›ã«ã¯
resource_group_name = "rg-hub-japaneast"  # â†è‡ªå‹•ã§ç½®ãæ›ã‚ã‚‹
```

**å¤‰ãˆãŸã„æ™‚ã¯ï¼Ÿ**
```hcl title="ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®šã®å¤‰æ›´ä¾‹"
# æ±äº¬ã ã‘ã«ã—ãŸã„
starter_locations = ["japaneast"]

# ã‚¢ãƒ¡ãƒªã‚«ã«ã—ãŸã„
starter_locations = ["eastus", "westus"]

# 3ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ä½¿ã„ãŸã„
starter_locations = ["japaneast", "japanwest", "eastasia"]
```

ç°¡å˜ã§ã™ã‚ˆã­ã€‚

---

## Part 2: ã‚«ã‚¹ã‚¿ãƒ ç½®æ› - names ã‚»ã‚¯ã‚·ãƒ§ãƒ³

ã“ã“ã‹ã‚‰ãŒæœ¬ç•ªã§ã™ã€‚`custom_replacements`ã®ä¸­èº«ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

### 2-1. Defenderã®ãƒ¡ãƒ¼ãƒ«è¨­å®š

```hcl title="ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥å…ˆ"
custom_replacements = {
  names = {
    defender_email_security_contact = "security@example.com"
```

**ã“ã‚Œã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ**

- Microsoft Defender for Cloudï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ãŒè„…å¨ã‚’æ¤œå‡ºã—ãŸã‚‰ã€ã“ã“ã«é€šçŸ¥ãŒé£›ã‚“ã§ãã¾ã™
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™

**å¤‰æ›´ã™ã‚‹å ´åˆï¼š**
```hcl title="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¤‰æ›´"
defender_email_security_contact = "security-team@yourcompany.com"
```

è‡ªåˆ†ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

### 2-2. ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å

```hcl title="ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®å‘½å"
    # Resource group names
    management_resource_group_name                 = "rg-management-$${starter_location_01}"
    connectivity_hub_primary_resource_group_name   = "rg-hub-$${starter_location_01}"
    connectivity_hub_secondary_resource_group_name = "rg-hub-$${starter_location_02}"
    dns_resource_group_name                        = "rg-hub-dns-$${starter_location_01}"
    ddos_resource_group_name                       = "rg-hub-ddos-$${starter_location_01}"
    asc_export_resource_group_name                 = "rg-asc-export-$${starter_location_01}"
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

Azureã®ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆãƒªã‚½ãƒ¼ã‚¹ã‚’å…¥ã‚Œã‚‹ç®±ï¼‰ã®åå‰ã‚’æ±ºã‚ã¦ã‚‹ã€‚

**å®Ÿéš›ã®åå‰ã¯ï¼Ÿ**

`$${starter_location_01}`ãŒ`japaneast`ã«ç½®ãæ›ã‚ã‚‹ã‹ã‚‰ï¼š

| å¤‰æ•°å | å®Ÿéš›ã®åå‰ | ä½•ã‚’å…¥ã‚Œã‚‹ç®±ï¼Ÿ |
|--------|-----------|---------------|
| `management_resource_group_name` | `rg-management-japaneast` | Log Analyticsã¨ã‹ç®¡ç†ç³» |
| `connectivity_hub_primary_resource_group_name` | `rg-hub-japaneast` | ãƒ—ãƒ©ã‚¤ãƒãƒªHubã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ |
| `connectivity_hub_secondary_resource_group_name` | `rg-hub-japanwest` | ã‚»ã‚«ãƒ³ãƒ€ãƒªHubã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ |
| `dns_resource_group_name` | `rg-hub-dns-japaneast` | Private DNS Zones |
| `ddos_resource_group_name` | `rg-hub-ddos-japaneast` | DDoS Protection |
| `asc_export_resource_group_name` | `rg-asc-export-japaneast` | Defender ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |

**å‘½åè¦å‰‡**

`rg-{ç”¨é€”}-{ãƒªãƒ¼ã‚¸ãƒ§ãƒ³}`ã£ã¦æ„Ÿã˜ã§çµ±ä¸€ã•ã‚Œã¦ã‚‹ã§ã—ã‚‡ï¼Ÿ
ã“ã‚ŒãŒAzureã®æ¨å¥¨å‘½åè¦å‰‡ã€‚

**å¤‰ãˆãŸã„æ™‚ã¯ï¼Ÿ**
```hcl title="ã‚«ã‚¹ã‚¿ãƒ å‘½åè¦å‰‡"
# ä¼šç¤¾ã®ãƒ«ãƒ¼ãƒ«ã«åˆã‚ã›ãŸã„
management_resource_group_name = "rg-prod-mgmt-$${starter_location_01}"
connectivity_hub_primary_resource_group_name = "rg-prod-network-$${starter_location_01}"
```

### 2-3. ç®¡ç†ãƒªã‚½ãƒ¼ã‚¹ã®åå‰

```hcl title="ç®¡ç†ç³»ãƒªã‚½ãƒ¼ã‚¹ã®å‘½å"
    # Resource names management
    log_analytics_workspace_name            = "law-management-$${starter_location_01}"
    ddos_protection_plan_name               = "ddos-$${starter_location_01}"
    ama_user_assigned_managed_identity_name = "uami-management-ama-$${starter_location_01}"
    dcr_change_tracking_name                = "dcr-change-tracking"
    dcr_defender_sql_name                   = "dcr-defender-sql"
    dcr_vm_insights_name                    = "dcr-vm-insights"
```

**ãã‚Œãã‚Œè§£èª¬ã—ã¾ã™**

#### log_analytics_workspace_name
```hcl title="Log Analytics Workspaceã®åå‰"
log_analytics_workspace_name = "law-management-$${starter_location_01}"
# å®Ÿéš›: "law-management-japaneast"
```

**ã“ã‚Œã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ**

- Log Analytics Workspaceï¼ˆãƒ­ã‚°ã‚’é›†ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ã®åå‰ã§ã™
- `law`ã¯Log Analytics Workspaceã®ç•¥
- ã™ã¹ã¦ã®ãƒ­ã‚°ãŒã“ã“ã«é›†ã¾ã‚Šã¾ã™

#### ddos_protection_plan_name
```hcl title="DDoS Protectionã®åå‰"
ddos_protection_plan_name = "ddos-$${starter_location_01}"
# å®Ÿéš›: "ddos-japaneast"
```

**ã“ã‚Œã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ**

- DDoSæ”»æ’ƒã‹ã‚‰å®ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®åå‰ã§ã™
- éå¸¸ã«é«˜é¡ã§ã™ï¼ˆæœˆÂ¥400,000ç¨‹åº¦ï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå…¬é–‹ã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã«ã¯å¿…è¦ã§ã™

#### ama_user_assigned_managed_identity_name
```hcl title="Azure Monitor Agentç”¨ã®èªè¨¼ID"
ama_user_assigned_managed_identity_name = "uami-management-ama-$${starter_location_01}"
# å®Ÿéš›: "uami-management-ama-japaneast"
```

**ã“ã‚Œã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ**

- Azure Monitor Agentï¼ˆç›£è¦–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰ãŒä½¿ã†èªè¨¼IDã§ã™
- `uami`ã¯User Assigned Managed Identityã®ç•¥
- VMãªã©ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå°å…¥ã™ã‚‹éš›ã«ä½¿ã„ã¾ã™

#### dcr_*_nameï¼ˆData Collection Ruleï¼‰
```hcl title="ãƒ‡ãƒ¼ã‚¿åé›†ãƒ«ãƒ¼ãƒ«ã®åå‰"
dcr_change_tracking_name = "dcr-change-tracking"
dcr_defender_sql_name    = "dcr-defender-sql"
dcr_vm_insights_name     = "dcr-vm-insights"
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

- Data Collection Ruleï¼ˆãƒ‡ãƒ¼ã‚¿åé›†ãƒ«ãƒ¼ãƒ«ï¼‰ã®åå‰
- ã©ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã™ã‚‹ã‹æ±ºã‚ã‚‹ãƒ«ãƒ¼ãƒ«
- 3ç¨®é¡ï¼š
  - `change-tracking`ï¼šãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‹è¨­å®šã®å¤‰æ›´ã‚’è¿½è·¡
  - `defender-sql`ï¼šSQL Serverã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°
  - `vm-insights`ï¼šVMã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿

### 2-4. ãƒªã‚½ãƒ¼ã‚¹ã®æœ‰åŠ¹/ç„¡åŠ¹è¨­å®šï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼‰

```hcl title="DDoS Protectionã®æœ‰åŠ¹/ç„¡åŠ¹"
    # Resource provisioning global connectivity
    ddos_protection_plan_enabled = false
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

- DDoS Protectionã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ç„¡åŠ¹ã«ã™ã‚‹ã‹
- `true`ã«ã™ã‚‹ã¨æœˆÂ¥400,000é£›ã¶
- æ¤œè¨¼ç’°å¢ƒãªã‚‰`false`ã§OK

**å¤‰ãˆãŸã„æ™‚ã¯ï¼Ÿ**
```hcl title="æœ¬ç•ªç’°å¢ƒã§DDoSã‚’æœ‰åŠ¹åŒ–"
# æœ¬ç•ªç’°å¢ƒã§å¿…è¦ãªã‚‰
ddos_protection_plan_enabled = true
```

### 2-5. ãƒ—ãƒ©ã‚¤ãƒãƒªHubã®è¨­å®š

```hcl title="ãƒ—ãƒ©ã‚¤ãƒãƒªHubã®ãƒªã‚½ãƒ¼ã‚¹æœ‰åŠ¹/ç„¡åŠ¹è¨­å®š"
    # Resource provisioning primary connectivity
    primary_firewall_enabled                                             = true
    primary_firewall_management_ip_enabled                               = true
    primary_virtual_network_gateway_express_route_enabled                = true
    primary_virtual_network_gateway_express_route_hobo_public_ip_enabled = true
    primary_virtual_network_gateway_vpn_enabled                          = true
    primary_private_dns_zones_enabled                                    = true
    primary_private_dns_auto_registration_zone_enabled                   = true
    primary_private_dns_resolver_enabled                                 = true
    primary_bastion_enabled                                              = true
```

**ã“ã‚ŒãŒä¸€ç•ªé‡è¦ã§ã™ï¼**
ãƒ—ãƒ©ã‚¤ãƒãƒªHubï¼ˆJapan Eastï¼‰ã§ä½•ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹æ±ºã‚ã¦ã„ã¾ã™ã€‚

#### 1ã¤ãšã¤è¦‹ã¦ã„ãã¾ã—ã‚‡ã†

##### primary_firewall_enabled
```hcl
primary_firewall_enabled = true
```

**ã“ã‚Œã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ**

- Azure Firewallï¼ˆãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ï¼‰ã‚’ä½œã‚‹ã‹ã©ã†ã‹ã§ã™
- `true`ï¼šä½œã‚Šã¾ã™ï¼ˆæœˆÂ¥170,000ç¨‹åº¦ã€Standard SKUï¼‰
- `false`ï¼šä½œã‚Šã¾ã›ã‚“

**ã„ã¤falseã«ã—ã¾ã™ã‹ï¼Ÿ**
```hcl title="ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãŸã‚ã«Firewallã‚’ç„¡åŠ¹åŒ–"
# ã‚³ã‚¹ãƒˆå‰Šæ¸›ã—ãŸã„æ¤œè¨¼ç’°å¢ƒ
primary_firewall_enabled = false

# ä»£ã‚ã‚Šã«NSGï¼ˆç„¡æ–™ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ï¼‰ã ã‘ä½¿ã†
```

##### primary_firewall_management_ip_enabled
```hcl
primary_firewall_management_ip_enabled = true
```

**ã“ã‚Œã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ**

- Firewallç®¡ç†ç”¨ã®Public IPã‚’ä½œã‚‹ã‹ã©ã†ã‹ã§ã™
- Basic SKUã®Firewallã§å¿…è¦ã§ã™
- Standard/Premiumãªã‚‰ä¸è¦ã§ã™ãŒã€ä½œã£ã¦ãŠã„ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“

##### primary_virtual_network_gateway_express_route_enabled
```hcl
primary_virtual_network_gateway_express_route_enabled = true
```

**ã“ã‚Œã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ**

- ExpressRoute Gatewayï¼ˆå°‚ç”¨ç·šã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ï¼‰ã‚’ä½œã‚‹ã‹ã©ã†ã‹ã§ã™
- ã‚ªãƒ³ãƒ—ãƒ¬ã¨Azureã‚’å°‚ç”¨ç·šã§ç¹‹ãæ™‚ã«å¿…è¦ã§ã™
- æœˆÂ¥40,000ã€œ60,000ç¨‹åº¦ã§ã™ï¼ˆSKUã«ã‚ˆã‚‹ï¼‰

**ã„ã¤falseã«ã—ã¾ã™ã‹ï¼Ÿ**
```hcl title="ã‚ªãƒ³ãƒ—ãƒ¬æ¥ç¶šãŒä¸è¦ãªå ´åˆ"
# ã‚ªãƒ³ãƒ—ãƒ¬ã¨ã®æ¥ç¶šãŒä¸è¦ãªã‚‰
primary_virtual_network_gateway_express_route_enabled = false
```

##### primary_virtual_network_gateway_vpn_enabled
```hcl
primary_virtual_network_gateway_vpn_enabled = true
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

- VPN Gatewayï¼ˆVPNã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ï¼‰ã‚’ä½œã‚‹ã‹
- ã‚ªãƒ³ãƒ—ãƒ¬ã¨Azureã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆçµŒç”±ã§ç¹‹ã
- æœˆÂ¥40,000ç¨‹åº¦ï¼ˆVpnGw1 SKUï¼‰

**ExpressRouteã¨ã®é•ã„ã¯ï¼Ÿ**
- ExpressRouteï¼šå°‚ç”¨ç·šï¼ˆé€Ÿã„ã€é«˜ã„ã€å®‰å®šï¼‰
- VPNï¼šã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆçµŒç”±ï¼ˆæ™®é€šã€å®‰ã„ã€ä¸å®‰å®šï¼‰

##### primary_private_dns_zones_enabled
```hcl
primary_private_dns_zones_enabled = true
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

- **Private DNS Zones**ï¼ˆAzureå†…éƒ¨å°‚ç”¨ã®DNSã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‚’ä½œã‚‹ã‹
- Azure PaaSã‚µãƒ¼ãƒ“ã‚¹ï¼ˆStorageã€SQL Databaseç­‰ï¼‰ã«ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§æ¥ç¶šã™ã‚‹æ™‚ã«å¿…é ˆ
- çµ¶å¯¾`true`ã«ã—ã¦ãŠã“ã†

##### primary_private_dns_auto_registration_zone_enabled
```hcl
primary_private_dns_auto_registration_zone_enabled = true
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

- VMã‚’ä½œã£ãŸã‚‰è‡ªå‹•ã§DNSã«ç™»éŒ²ã™ã‚‹ã‹
- `true`ã«ã—ã¦ãŠãã¨VMã®åå‰ã§é€šä¿¡ã§ãã¦ä¾¿åˆ©

##### primary_private_dns_resolver_enabled
```hcl
primary_private_dns_resolver_enabled = true
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

- Private DNS Resolverï¼ˆDNSä¸­ç¶™ã‚µãƒ¼ãƒãƒ¼ï¼‰ã‚’ä½œã‚‹ã‹
- ã‚ªãƒ³ãƒ—ãƒ¬ã¨Azureé–“ã§DNSåå‰è§£æ±ºã™ã‚‹æ™‚ã«å¿…è¦

##### primary_bastion_enabled
```hcl
primary_bastion_enabled = true
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

- **Azure Bastion**ï¼ˆå®‰å…¨ãªVMãƒªãƒ¢ãƒ¼ãƒˆæ¥ç¶šã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‚’ä½œã‚‹ã‹
- VMã«SSH/RDPã™ã‚‹æ™‚ã€Bastionã‚’çµŒç”±ã™ã‚‹ã¨å®‰å…¨
- Public IPã‚’VMã«å‰²ã‚Šå½“ã¦ãªãã¦æ¸ˆã‚€
- æœˆÂ¥27,000ç¨‹åº¦ï¼ˆBasic SKUï¼‰

**ãƒã‚¤ãƒ³ãƒˆ**

Japan Eastã§ã¯Availability Zonesä½¿ãˆãªã„ã‹ã‚‰ã€å¾Œã§`zones = []`è¨­å®šãŒå¿…è¦ã«ãªã‚‹ã€‚

### 2-6. ã‚»ã‚«ãƒ³ãƒ€ãƒªHubã®è¨­å®š

```hcl title="ã‚»ã‚«ãƒ³ãƒ€ãƒªHubã®ãƒªã‚½ãƒ¼ã‚¹æœ‰åŠ¹/ç„¡åŠ¹è¨­å®š"
    # Resource provisioning secondary connectivity
    secondary_firewall_enabled                                             = true
    secondary_firewall_management_ip_enabled                               = true
    secondary_virtual_network_gateway_express_route_enabled                = true
    secondary_virtual_network_gateway_express_route_hobo_public_ip_enabled = true
    secondary_virtual_network_gateway_vpn_enabled                          = true
    secondary_private_dns_zones_enabled                                    = true
    secondary_private_dns_auto_registration_zone_enabled                   = true
    secondary_private_dns_resolver_enabled                                 = true
    secondary_bastion_enabled                                              = true
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

ã‚»ã‚«ãƒ³ãƒ€ãƒªHubï¼ˆJapan Westï¼‰ã®è¨­å®šã€‚ãƒ—ãƒ©ã‚¤ãƒãƒªã¨åŒã˜é …ç›®ã€‚

**ã‚³ã‚¹ãƒˆå‰Šæ¸›ã—ãŸã„ãªã‚‰ï¼Ÿ**

ã‚»ã‚«ãƒ³ãƒ€ãƒªã¯æœ€å°æ§‹æˆã«ã—ã‚ˆã†ï¼š

```hcl title="ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚’æœ€å°æ§‹æˆã«ã—ã¦ã‚³ã‚¹ãƒˆå‰Šæ¸›"
# ã‚»ã‚«ãƒ³ãƒ€ãƒªã¯æœ€å°é™ã«ã—ã¦ã‚³ã‚¹ãƒˆå‰Šæ¸›
secondary_firewall_enabled = false
secondary_virtual_network_gateway_express_route_enabled = false
secondary_virtual_network_gateway_vpn_enabled = false
secondary_bastion_enabled = false

# DNSç³»ã ã‘æœ‰åŠ¹
secondary_private_dns_zones_enabled = true
secondary_private_dns_resolver_enabled = true
```

ã“ã‚Œã§ã‚»ã‚«ãƒ³ãƒ€ãƒªã¯ã»ã¼ç„¡æ–™ã§ä½¿ãˆã‚‹ã€‚

### 2-7. ãƒ—ãƒ©ã‚¤ãƒãƒªãƒªã‚½ãƒ¼ã‚¹ã®åå‰

```hcl title="ãƒ—ãƒ©ã‚¤ãƒãƒªæ¥ç¶šãƒªã‚½ãƒ¼ã‚¹ã®å‘½å"
    # Resource names primary connectivity
    primary_virtual_network_name                                 = "vnet-hub-$${starter_location_01}"
    primary_firewall_name                                        = "fw-hub-$${starter_location_01}"
    primary_firewall_policy_name                                 = "fwp-hub-$${starter_location_01}"
    primary_firewall_public_ip_name                              = "pip-fw-hub-$${starter_location_01}"
    primary_firewall_management_public_ip_name                   = "pip-fw-hub-mgmt-$${starter_location_01}"
    primary_route_table_firewall_name                            = "rt-hub-fw-$${starter_location_01}"
    primary_route_table_user_subnets_name                        = "rt-hub-std-$${starter_location_01}"
    primary_virtual_network_gateway_express_route_name           = "vgw-hub-er-$${starter_location_01}"
    primary_virtual_network_gateway_express_route_public_ip_name = "pip-vgw-hub-er-$${starter_location_01}"
    primary_virtual_network_gateway_vpn_name                     = "vgw-hub-vpn-$${starter_location_01}"
    primary_virtual_network_gateway_vpn_public_ip_name_1         = "pip-vgw-hub-vpn-$${starter_location_01}-001"
    primary_virtual_network_gateway_vpn_public_ip_name_2         = "pip-vgw-hub-vpn-$${starter_location_01}-002"
    primary_private_dns_resolver_name                            = "pdr-hub-dns-$${starter_location_01}"
    primary_bastion_host_name                                    = "bas-hub-$${starter_location_01}"
    primary_bastion_host_public_ip_name                          = "pip-bastion-hub-$${starter_location_01}"
```

ãƒªã‚½ãƒ¼ã‚¹åã®ä¸€è¦§ã€‚å‘½åè¦å‰‡ã‚’è¡¨ã«ã¾ã¨ã‚ã‚‹ã­ï¼š

| ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ | æ„å‘³ | ä¾‹ |
|---------------|------|-----|
| `vnet-` | Virtual Network | `vnet-hub-japaneast` |
| `fw-` | Firewall | `fw-hub-japaneast` |
| `fwp-` | Firewall Policy | `fwp-hub-japaneast` |
| `pip-` | Public IP | `pip-fw-hub-japaneast` |
| `rt-` | Route Table | `rt-hub-fw-japaneast` |
| `vgw-` | Virtual Network Gateway | `vgw-hub-er-japaneast` |
| `pdr-` | Private DNS Resolver | `pdr-hub-dns-japaneast` |
| `bas-` | Bastion Host | `bas-hub-japaneast` |

Azureã®æ¨å¥¨å‘½åè¦å‰‡ã«å¾“ã£ã¦ã‚‹ã‹ã‚‰ã€ãã®ã¾ã¾ä½¿ãˆã°OKã€‚

### 2-8. ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒªã‚½ãƒ¼ã‚¹ã®åå‰

```hcl title="ã‚»ã‚«ãƒ³ãƒ€ãƒªæ¥ç¶šãƒªã‚½ãƒ¼ã‚¹ã®å‘½å"
    # Resource names secondary connectivity
    secondary_virtual_network_name                                 = "vnet-hub-$${starter_location_02}"
    secondary_firewall_name                                        = "fw-hub-$${starter_location_02}"
    # ... ä»¥ä¸‹åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³
```

ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚‚åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚`$${starter_location_02}`ãŒ`japanwest`ã«ç½®ãæ›ã‚ã‚‹ã€‚

### 2-9. Private DNSã‚¾ãƒ¼ãƒ³ã®åå‰

```hcl title="Private DNS Zones"
    # Private DNS Zones primary
    primary_auto_registration_zone_name = "$${starter_location_01}.azure.local"

    # Private DNS Zones secondary
    secondary_auto_registration_zone_name = "$${starter_location_02}.azure.local"
```

**auto_registration_zone ã¨ã¯ï¼Ÿ**

VMï¼ˆä»®æƒ³ãƒã‚·ãƒ³ï¼‰ãŒèµ·å‹•ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«ã“ã®DNSã‚¾ãƒ¼ãƒ³ã«ãƒ›ã‚¹ãƒˆåãŒç™»éŒ²ã•ã‚Œã¾ã™ã€‚

**ãªãœãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«åˆ†ã‘ã‚‹ï¼Ÿ**

- `japaneast.azure.local`
- `japanwest.azure.local`

ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«åˆ†ã‘ã‚‹ã“ã¨ã§ã€ã©ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®VMã‹ä¸€ç›®ã§åˆ†ã‹ã‚Šã¾ã™ã€‚

**ä½¿ç”¨ä¾‹:**
```
vm-app01.japaneast.azure.local  â† æ±æ—¥æœ¬ã®VM
vm-app02.japanwest.azure.local  â† è¥¿æ—¥æœ¬ã®VM
```

---

## â˜• ä¼‘æ†©ã‚¿ã‚¤ãƒ ï¼ˆ1å›ç›®ï¼‰

**ãŠç–²ã‚Œæ§˜ã§ã™ï¼ã“ã“ã¾ã§ã§ä»¥ä¸‹ã‚’å­¦ã³ã¾ã—ãŸ**ï¼š

âœ… ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®šï¼ˆ`starter_locations`ï¼‰  
âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ï¼ˆ`$${starter_location_01}`ï¼‰  
âœ… ã‚«ã‚¹ã‚¿ãƒ ç½®æ›ã®`names`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒªã‚½ãƒ¼ã‚¹åã€æœ‰åŠ¹/ç„¡åŠ¹è¨­å®šï¼‰

**ã“ã“ã‹ã‚‰ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç´°ã‹ã„è¨­å®šãŒç¶šãã¾ã™ã€‚**  
ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’é£²ã‚“ã§ã€å°‘ã—ä¼‘æ†©ã—ã¦ã‹ã‚‰é€²ã¿ã¾ã—ã‚‡ã†ã€‚

æ¬¡ã® Part 3 ã‹ã‚‰ã¯ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨­è¨ˆãŒå‡ºã¦ãã¾ã™ã€‚

---

## Part 3: è¨­å®šå€¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“

ã“ã“ã‹ã‚‰å…ˆã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç´°ã‹ã„è¨­å®šãŒç¶šãã¾ã™ã€‚

### 3-1. IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨­è¨ˆï¼ˆãƒ—ãƒ©ã‚¤ãƒãƒªï¼‰

ğŸ“š IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨CIDRè¡¨è¨˜ã«ã¤ã„ã¦

ã“ã“ã‹ã‚‰`10.0.0.0/16`ã®ã‚ˆã†ãªè¡¨è¨˜ãŒå‡ºã¦ãã¾ã™ã€‚
ã“ã‚Œã¯CIDRè¡¨è¨˜ï¼ˆã‚µã‚¤ãƒ€ãƒ¼è¡¨è¨˜ï¼‰ã¨å‘¼ã°ã‚Œã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¯„å›²ã‚’è¡¨ã™è¨˜æ³•ã§ã™ã€‚

CIDRè¡¨è¨˜ã®èª­ã¿æ–¹:
```
10.0.0.0/16
â”‚      â”‚
â”‚      â””â”€ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨åˆ†ã®ãƒ“ãƒƒãƒˆæ•°ï¼ˆ/16 = æœ€åˆã®16ãƒ“ãƒƒãƒˆå›ºå®šï¼‰
â””â”€ é–‹å§‹IPã‚¢ãƒ‰ãƒ¬ã‚¹
```

**ã‚ˆãä½¿ã†ã‚µã‚¤ã‚ºï¼ˆè¦šãˆãªãã¦OKã€é›°å›²æ°—ã ã‘ï¼‰**:

- `/16`: 65,536å€‹ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆå¤§è¦æ¨¡ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å…¨ä½“ï¼‰
- `/22`: 1,024å€‹ï¼ˆHub VNetç”¨ï¼‰
- `/24`: 256å€‹ï¼ˆä¸€èˆ¬çš„ãªã‚µãƒ–ãƒãƒƒãƒˆï¼‰
- `/26`: 64å€‹ï¼ˆFirewallç­‰ã®å°‚ç”¨ã‚µãƒ–ãƒãƒƒãƒˆï¼‰
- `/27`: 32å€‹ï¼ˆGatewayç”¨ï¼‰
- `/28`: 16å€‹ï¼ˆDNS Resolverç”¨ï¼‰

æ•°å­—ãŒå°ã•ã„ã»ã©åºƒã„ç¯„å›²ã§ã™ã€‚è©³ã—ãç†è§£ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚  
ã€Œå¤§ããªç¯„å›²ã‚’å°ã•ãåŒºåˆ‡ã£ã¦ä½¿ã†ã€ã¨æ€ãˆã°OKã§ã™ã€‚

---

```hcl title="ãƒ—ãƒ©ã‚¤ãƒãƒªHubã®IPã‚¢ãƒ‰ãƒ¬ã‚¹è¨­å®š"
    # IP Ranges Primary
    # Regional Address Space: 10.0.0.0/16
    primary_hub_address_space                          = "10.0.0.0/16"
    primary_hub_virtual_network_address_space          = "10.0.0.0/22"
    primary_firewall_subnet_address_prefix             = "10.0.0.0/26"
    primary_firewall_management_subnet_address_prefix  = "10.0.0.192/26"
    primary_bastion_subnet_address_prefix              = "10.0.0.64/26"
    primary_gateway_subnet_address_prefix              = "10.0.0.128/27"
    primary_private_dns_resolver_subnet_address_prefix = "10.0.0.160/28"
```

**ğŸ“Š IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å…¨ä½“åƒï¼ˆè¦–è¦šåŒ–ï¼‰**

```
10.0.0.0/16ï¼ˆãƒªãƒ¼ã‚¸ãƒ§ãƒ³å…¨ä½“: 65,536å€‹ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰
â”œâ”€ 10.0.0.0/22ï¼ˆHub VNet: 1,024å€‹ï¼‰
â”‚  â”œâ”€ 10.0.0.0/26    [Firewall Subnet]          64å€‹
â”‚  â”œâ”€ 10.0.0.64/26   [Bastion Subnet]           64å€‹
â”‚  â”œâ”€ 10.0.0.128/27  [Gateway Subnet]           32å€‹
â”‚  â”œâ”€ 10.0.0.160/28  [DNS Resolver Subnet]      16å€‹
â”‚  â””â”€ 10.0.0.192/26  [Firewall Mgmt Subnet]     64å€‹
â”‚
â””â”€ 10.0.4.0ã€œ10.0.255.255ï¼ˆæ®‹ã‚Š: 64,512å€‹ï¼‰
   â””â”€ ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å†…ã®Spokeã«äºˆç´„
```

**è¡¨å½¢å¼ã§ã‚‚è¦‹ã¦ã¿ã¾ã—ã‚‡ã†**

| ç”¨é€” | CIDR | IPç¯„å›² | ä½¿ãˆã‚‹æ•° |
|------|------|--------|----------|
| ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å…¨ä½“ | `10.0.0.0/16` | 10.0.0.0 - 10.0.255.255 | 65,536å€‹ |
| Hub VNet | `10.0.0.0/22` | 10.0.0.0 - 10.0.3.255 | 1,024å€‹ |
| Firewall | `10.0.0.0/26` | 10.0.0.0 - 10.0.0.63 | 64å€‹ |
| Firewall Management | `10.0.0.192/26` | 10.0.0.192 - 10.0.0.255 | 64å€‹ |
| Bastion | `10.0.0.64/26` | 10.0.0.64 - 10.0.0.127 | 64å€‹ |
| Gateway | `10.0.0.128/27` | 10.0.0.128 - 10.0.0.159 | 32å€‹ |
| DNS Resolver | `10.0.0.160/28` | 10.0.0.160 - 10.0.0.175 | 16å€‹ |

**ğŸ¯ è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ**

- Hub VNetã¯`10.0.0.0/22`ï¼ˆ1,024å€‹ï¼‰ã ã‘ä½¿ã†
- æ®‹ã‚Šã®64,512å€‹ã¯ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å†…ã®Spokeç”¨ã«äºˆç´„
- å„SubnetãŒé‡ãªã‚‰ãªã„ã‚ˆã†ã«æ…é‡ã«è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹
- FirewallãŒ2ã¤ï¼ˆæœ¬ä½“+ç®¡ç†ç”¨ï¼‰ã‚ã‚‹ã“ã¨ã«æ³¨ç›®

### 3-2. IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨­è¨ˆï¼ˆã‚»ã‚«ãƒ³ãƒ€ãƒªï¼‰

```hcl title="ã‚»ã‚«ãƒ³ãƒ€ãƒªHubã®IPã‚¢ãƒ‰ãƒ¬ã‚¹è¨­å®š"
    # IP Ranges Secondary
    # Regional Address Space: 10.1.0.0/16
    secondary_hub_address_space                          = "10.1.0.0/16"
    secondary_hub_virtual_network_address_space          = "10.1.0.0/22"
    secondary_firewall_subnet_address_prefix             = "10.1.0.0/26"
    secondary_firewall_management_subnet_address_prefix  = "10.1.0.192/26"
    secondary_bastion_subnet_address_prefix              = "10.1.0.64/26"
    secondary_gateway_subnet_address_prefix              = "10.1.0.128/27"
    secondary_private_dns_resolver_subnet_address_prefix = "10.1.0.160/28"
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³åŒã˜ã§ã—ã‚‡ï¼Ÿ**
ãƒ—ãƒ©ã‚¤ãƒãƒªãŒ`10.0.x.x`ã€ã‚»ã‚«ãƒ³ãƒ€ãƒªãŒ`10.1.x.x`ã£ã¦ã ã‘ã€‚

ã“ã‚Œã§2ã¤ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒé‡ãªã‚‰ãªã„ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã‚‹ã€‚

---

## Part 4: ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—è­˜åˆ¥å­

```hcl title="ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®å®Œå…¨ãƒ‘ã‚¹"
  resource_group_identifiers = {
    management_resource_group_id             = "/subscriptions/$${subscription_id_management}/resourcegroups/$${management_resource_group_name}"
    ddos_protection_plan_resource_group_id   = "/subscriptions/$${subscription_id_connectivity}/resourcegroups/$${ddos_resource_group_name}"
    primary_connectivity_resource_group_id   = "/subscriptions/$${subscription_id_connectivity}/resourceGroups/$${connectivity_hub_primary_resource_group_name}"
    secondary_connectivity_resource_group_id = "/subscriptions/$${subscription_id_connectivity}/resourceGroups/$${connectivity_hub_secondary_resource_group_name}"
    dns_resource_group_id                    = "/subscriptions/$${subscription_id_connectivity}/resourceGroups/$${dns_resource_group_name}"
  }
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ•ãƒ«ãƒ‘ã‚¹ï¼ˆå®Œå…¨ãªIDï¼‰ã‚’ä½œã£ã¦ã‚‹ã€‚

**å½¢å¼**
```
/subscriptions/{ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID}/resourcegroups/{ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å}
```

**ãªãœå¿…è¦ï¼Ÿ**

å¾Œã§ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰å‚ç…§ã™ã‚‹æ™‚ã«ä½¿ã†ã€‚
ä¾‹ãˆã°ã€ã€Œã“ã®Log Analyticsã¯ã©ã®RGã«ã‚ã‚‹ï¼Ÿã€ã£ã¦èã‹ã‚ŒãŸæ™‚ã«ã€ã“ã®IDã§ç­”ãˆã‚‹ã€‚

---

## Part 5: ãƒªã‚½ãƒ¼ã‚¹è­˜åˆ¥å­

```hcl title="å€‹åˆ¥ãƒªã‚½ãƒ¼ã‚¹ã®å®Œå…¨ãƒ‘ã‚¹"
  resource_identifiers = {
    ama_change_tracking_data_collection_rule_id = "$${management_resource_group_id}/providers/Microsoft.Insights/dataCollectionRules/$${dcr_change_tracking_name}"
    ama_mdfc_sql_data_collection_rule_id        = "$${management_resource_group_id}/providers/Microsoft.Insights/dataCollectionRules/$${dcr_defender_sql_name}"
    ama_vm_insights_data_collection_rule_id     = "$${management_resource_group_id}/providers/Microsoft.Insights/dataCollectionRules/$${dcr_vm_insights_name}"
    ama_user_assigned_managed_identity_id       = "$${management_resource_group_id}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/$${ama_user_assigned_managed_identity_name}"
    log_analytics_workspace_id                  = "$${management_resource_group_id}/providers/Microsoft.OperationalInsights/workspaces/$${log_analytics_workspace_name}"
    ddos_protection_plan_id                     = "$${ddos_protection_plan_resource_group_id}/providers/Microsoft.Network/ddosProtectionPlans/$${ddos_protection_plan_name}"
  }
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

å€‹åˆ¥ã®ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ•ãƒ«ãƒ‘ã‚¹ï¼ˆResource IDï¼‰ã‚’ä½œã£ã¦ã‚‹ã€‚

**å½¢å¼**
```
{ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ID}/providers/{ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—}/{ãƒªã‚½ãƒ¼ã‚¹å}
```

**ä¾‹**
```
/subscriptions/xxx/resourcegroups/rg-management-japaneast/providers/Microsoft.OperationalInsights/workspaces/law-management-japaneast
```

ã“ã‚Œã§Log Analytics Workspaceã‚’ä¸€æ„ã«ç‰¹å®šã§ãã‚‹ã€‚

---

### ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼è¨­å®š

```hcl title="enable_telemetry"
enable_telemetry = true
```

**ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ã¨ã¯ï¼Ÿ**

Microsoftã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®åˆ©ç”¨çŠ¶æ³ï¼ˆã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã©ã®ãã‚‰ã„ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹ï¼‰ã‚’åŒ¿åã§é€ä¿¡ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚

**ä½•ãŒé€ä¿¡ã•ã‚Œã‚‹ï¼Ÿ**

- ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
- ãƒªãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
- ãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡

**å€‹äººæƒ…å ±ã¯é€ä¿¡ã•ã‚Œã‚‹ï¼Ÿ**

ã„ã„ãˆã€‚ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³IDã€ãƒªã‚½ãƒ¼ã‚¹åã€è¨­å®šå€¤ãªã©ã¯ä¸€åˆ‡é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚

**ãªãœãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ï¼Ÿ**

MicrosoftãŒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ”¹å–„ã«ä½¿ã†ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã™ã‚‹ãŸã‚ã§ã™ã€‚  
ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¶­æŒã«å½¹ç«‹ã¡ã¾ã™ã€‚

**ç„¡åŠ¹ã«ã—ãŸã„å ´åˆ:**

```hcl
enable_telemetry = false
```

ä¼æ¥­ãƒãƒªã‚·ãƒ¼ã§å¤–éƒ¨ã¸ã®é€šä¿¡ãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€`false`ã«ã—ã¦ãã ã•ã„ã€‚

---

## â˜• ä¼‘æ†©ã‚¿ã‚¤ãƒ ï¼ˆ2å›ç›®ï¼‰

**åŠåˆ†ã¾ã§æ¥ã¾ã—ãŸï¼ã“ã“ã¾ã§ã§å­¦ã‚“ã ã“ã¨**ï¼š

âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹è¨­å®šï¼ˆPart 3ï¼‰  
âœ… ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—è­˜åˆ¥å­ï¼ˆPart 4ï¼‰  
âœ… ãƒªã‚½ãƒ¼ã‚¹è­˜åˆ¥å­ï¼ˆPart 5ï¼‰  

**ä»Šã‹ã‚‰å­¦ã¶ã“ã¨**ï¼š

- ã‚¿ã‚°è¨­å®šï¼ˆã‚³ã‚¹ãƒˆç®¡ç†ã€ç®¡ç†ç”¨ï¼‰
- ç®¡ç†ãƒªã‚½ãƒ¼ã‚¹ï¼ˆLog Analyticsç­‰ï¼‰
- ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒãƒªã‚·ãƒ¼

ã‚‚ã†å°‘ã—ã§çµ‚ã‚ã‚Šã¾ã™ã€‚é ­ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦ã‹ã‚‰é€²ã¿ã¾ã—ã‚‡ã†ï¼

---

## Part 6: ã‚¿ã‚°è¨­å®š

```hcl title="å…¨ãƒªã‚½ãƒ¼ã‚¹ã«ä»˜ä¸ã™ã‚‹ã‚¿ã‚°"
tags = {
  deployed_by = "terraform"
  source      = "Azure Landing Zones Accelerator"
}
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

å…¨ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã«ä»˜ã‘ã‚‹ã‚¿ã‚°ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰ã€‚

**ã‚¿ã‚°ã®ä½¿ã„é“**

- ã‚³ã‚¹ãƒˆç®¡ç†ï¼šã€ŒTerraformã§ä½œã£ãŸãƒªã‚½ãƒ¼ã‚¹ã®ã‚³ã‚¹ãƒˆã¯ï¼Ÿã€
- æ¤œç´¢ï¼šã€ŒALZã§ä½œã£ãŸãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ã‚’å‡ºã—ã¦ã€
- è‡ªå‹•åŒ–ï¼šã€Œterraformã‚¿ã‚°ãŒã¤ã„ã¦ã‚‹ã‚„ã¤ã ã‘ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€

**ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¾‹**
```hcl title="ã‚¿ã‚°ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¾‹"
tags = {
  deployed_by = "terraform"
  source      = "Azure Landing Zones Accelerator"
  environment = "production"
  cost_center = "IT-Platform"
  owner       = "platform-team@example.com"
}
```

---

## Part 7: ç®¡ç†ãƒªã‚½ãƒ¼ã‚¹è¨­å®š

```hcl title="Log Analyticsã¨ç›£è¦–ç³»ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®š"
management_resource_settings = {
  enabled                      = true
  location                     = "$${starter_location_01}"
  log_analytics_workspace_name = "$${log_analytics_workspace_name}"
  resource_group_name          = "$${management_resource_group_name}"
  
  user_assigned_managed_identities = {
    ama = {
      name = "$${ama_user_assigned_managed_identity_name}"
    }
  }
  
  data_collection_rules = {
    change_tracking = {
      name = "$${dcr_change_tracking_name}"
    }
    defender_sql = {
      name = "$${dcr_defender_sql_name}"
    }
    vm_insights = {
      name = "$${dcr_vm_insights_name}"
    }
  }
}
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

Log Analyticsãªã©ã€ç›£è¦–ç³»ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ã¾ã¨ã‚ã¦è¨­å®šã—ã¦ã„ã¾ã™ã€‚

**enabled = true** ã«ã™ã‚‹ã¨ï¼š

- Log Analytics Workspaceä½œã‚‰ã‚Œã‚‹
- Data Collection Ruleï¼ˆDCRï¼‰3ç¨®é¡ä½œã‚‰ã‚Œã‚‹
- Managed Identityä½œã‚‰ã‚Œã‚‹

**ç„¡åŠ¹ã«ã—ãŸã„å ´åˆ**
```hcl title="æ¤œè¨¼ç’°å¢ƒã§ãƒ­ã‚°ã‚’ç„¡åŠ¹åŒ–"
management_resource_settings = {
  enabled = false  # â†ã“ã‚Œã ã‘ã§OK
}
```

ãƒ­ã‚°ä¸è¦ãªæ¤œè¨¼ç’°å¢ƒã¨ã‹ã§ä½¿ãˆã‚‹ã€‚

---

## Part 8: ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒãƒªã‚·ãƒ¼

```hcl title="ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒãƒªã‚·ãƒ¼è¨­å®š"
management_group_settings = {
  enabled = true
  architecture_name  = "alz_custom"
  location           = "$${starter_location_01}"
  parent_resource_id = "$${root_parent_management_group_id}"
  
  policy_default_values = {
    ama_change_tracking_data_collection_rule_id = "$${ama_change_tracking_data_collection_rule_id}"
    ama_mdfc_sql_data_collection_rule_id        = "$${ama_mdfc_sql_data_collection_rule_id}"
    ama_vm_insights_data_collection_rule_id     = "$${ama_vm_insights_data_collection_rule_id}"
    ama_user_assigned_managed_identity_id       = "$${ama_user_assigned_managed_identity_id}"
    ama_user_assigned_managed_identity_name     = "$${ama_user_assigned_managed_identity_name}"
    log_analytics_workspace_id                  = "$${log_analytics_workspace_id}"
    ddos_protection_plan_id                     = "$${ddos_protection_plan_id}"
    private_dns_zone_subscription_id            = "$${subscription_id_connectivity}"
    private_dns_zone_region                     = "$${starter_location_01}"
    private_dns_zone_resource_group_name        = "$${dns_resource_group_name}"
  }
  
  subscription_placement = {
    identity = {
      subscription_id       = "$${subscription_id_identity}"
      management_group_name = "identity"
    }
    connectivity = {
      subscription_id       = "$${subscription_id_connectivity}"
      management_group_name = "connectivity"
    }
    management = {
      subscription_id       = "$${subscription_id_management}"
      management_group_name = "management"
    }
    security = {
      subscription_id       = "$${subscription_id_security}"
      management_group_name = "security"
    }
  }
}
```

**ã“ã‚ŒãŒè¶…é‡è¦ï¼**

### architecture_name
```hcl
architecture_name = "alz_custom"
```

ã“ã‚ŒãŒ`lib/architecture_definitions/alz_custom.alz_architecture_definition.yaml`ã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚
ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã®éšå±¤æ§‹é€ ãŒãã“ã«æ›¸ã„ã¦ã‚ã‚‹ã€‚

### policy_default_values
ãƒãƒªã‚·ãƒ¼ã§ä½¿ã†ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å…¨ã¦æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã€ã€ŒVMã«Azure Monitor Agentã‚’å…¥ã‚Œã‚‹ãƒãƒªã‚·ãƒ¼ã€ãŒå‹•ãæ™‚ã€
ã“ã“ã§æŒ‡å®šã—ãŸManaged Identityã¨DCRãŒè‡ªå‹•ã§è¨­å®šã•ã‚Œã‚‹ã€‚

### subscription_placement
ã©ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã©ã®ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã«å…¥ã‚Œã‚‹ã‹æ±ºã‚ã¦ã‚‹ã€‚

```
root
â”œâ”€â”€ Platform
â”‚   â”œâ”€â”€ Connectivityï¼ˆâ† connectivity subscriptionãŒã“ã“ï¼‰
â”‚   â”œâ”€â”€ Managementï¼ˆâ† management subscriptionãŒã“ã“ï¼‰
â”‚   â”œâ”€â”€ Identityï¼ˆâ† identity subscriptionãŒã“ã“ï¼‰
â”‚   â””â”€â”€ Securityï¼ˆâ† security subscriptionãŒã“ã“ï¼‰
â””â”€â”€ Landing Zones
```

### Defenderã®è¨­å®š

```hcl title="Microsoft Defender for Cloudã®è¨­å®š"
  policy_assignments_to_modify = {
    alz = {
      policy_assignments = {
        Deploy-MDFC-Config-H224 = {
          parameters = {
            ascExportResourceGroupName                  = "$${asc_export_resource_group_name}"
            ascExportResourceGroupLocation              = "$${starter_location_01}"
            emailSecurityContact                        = "$${defender_email_security_contact}"
            enableAscForServers                         = "DeployIfNotExists"
            enableAscForServersVulnerabilityAssessments = "DeployIfNotExists"
            enableAscForSql                             = "DeployIfNotExists"
            enableAscForAppServices                     = "DeployIfNotExists"
            enableAscForStorage                         = "DeployIfNotExists"
            enableAscForContainers                      = "DeployIfNotExists"
            enableAscForKeyVault                        = "DeployIfNotExists"
            enableAscForSqlOnVm                         = "DeployIfNotExists"
            enableAscForArm                             = "DeployIfNotExists"
            enableAscForOssDb                           = "DeployIfNotExists"
            enableAscForCosmosDbs                       = "DeployIfNotExists"
            enableAscForCspm                            = "DeployIfNotExists"
          }
        }
      }
    }
  }
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

Microsoft Defender for Cloudï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ï¼‰ã®è¨­å®šã€‚

**DeployIfNotExists** = ã€Œã‚‚ã—æœ‰åŠ¹ã˜ã‚ƒãªã‹ã£ãŸã‚‰ã€è‡ªå‹•ã§æœ‰åŠ¹ã«ã™ã‚‹ã€

å…¨éƒ¨ã®ã‚µãƒ¼ãƒ“ã‚¹ã§æœ‰åŠ¹ã«ãªã£ã¦ã‚‹ã€‚

**ç„¡åŠ¹ã«ã—ãŸã„å ´åˆ**
```hcl title="Defenderã‚’ç„¡åŠ¹åŒ–"
enableAscForServers = "Disabled"
enableAscForSql = "Disabled"
# ... å…¨éƒ¨Disabledã«
```

---

## â˜• ä¼‘æ†©ã‚¿ã‚¤ãƒ ï¼ˆ3å›ç›®ãƒ»æœ€å¾Œï¼‰

**ã‚ã¨ä¸€æ¯ã§ã™ï¼ã“ã“ã¾ã§ã§å­¦ã‚“ã ã“ã¨**ï¼š

âœ… ã‚¿ã‚°è¨­å®šï¼ˆPart 6ï¼‰  
âœ… ç®¡ç†ãƒªã‚½ãƒ¼ã‚¹ï¼ˆLog Analyticsã€Automation Accountç­‰ï¼‰ï¼ˆPart 7ï¼‰  
âœ… ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒãƒªã‚·ãƒ¼ï¼ˆPart 8ï¼‰

**æ®‹ã‚Šã® Part 9 ã¯ã€ã“ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼**  
Hub-and-Spokeãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è©³ç´°è¨­å®šã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

Firewallã€Bastionã€VPNã€ExpressRouteã®è¨­å®šãŒå‡ºã¦ãã¾ã™ã‚ˆã€‚  
æ·±å‘¼å¸ã—ã¦ã€é›†ä¸­ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

---

## Part 9: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šï¼ˆHub-and-Spokeï¼‰

### connectivity_type

```hcl title="ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã‚¿ã‚¤ãƒ—"
connectivity_type = "hub_and_spoke_vnet"
```

**é¸æŠè‚¢**

- `"hub_and_spoke_vnet"`ï¼šHub-and-Spokeæ§‹æˆï¼ˆä¸€èˆ¬çš„ï¼‰
- `"virtual_wan"`ï¼šVirtual WANæ§‹æˆï¼ˆå¤§è¦æ¨¡å‘ã‘ï¼‰
- `"none"`ï¼šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä½œã‚‰ãªã„

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Hub-and-Spokeã‚’ä½¿ã£ã¦ã‚‹ã€‚

### connectivity_resource_groups

```hcl title="æ¥ç¶šç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®š"
connectivity_resource_groups = {
  ddos = {
    name     = "$${ddos_resource_group_name}"
    location = "$${starter_location_01}"
    settings = {
      enabled = "$${ddos_protection_plan_enabled}"
    }
  }
  vnet_primary = {
    name     = "$${connectivity_hub_primary_resource_group_name}"
    location = "$${starter_location_01}"
    settings = {
      enabled = true
    }
  }
  vnet_secondary = {
    name     = "$${connectivity_hub_secondary_resource_group_name}"
    location = "$${starter_location_02}"
    settings = {
      enabled = true
    }
  }
  dns = {
    name     = "$${dns_resource_group_name}"
    location = "$${starter_location_01}"
    settings = {
      enabled = "$${primary_private_dns_zones_enabled}"
    }
  }
}
```

**ã“ã‚Œã¯ä½•ï¼Ÿ**

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”¨ã®ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’4ã¤ä½œã£ã¦ã‚‹ï¼š
1. **ddos**ï¼šDDoS Protectionç”¨
2. **vnet_primary**ï¼šãƒ—ãƒ©ã‚¤ãƒãƒªHubç”¨
3. **vnet_secondary**ï¼šã‚»ã‚«ãƒ³ãƒ€ãƒªHubç”¨
4. **dns**ï¼šPrivate DNS Zonesç”¨

`enabled`ãŒ`false`ã®ã‚„ã¤ã¯ä½œã‚‰ã‚Œãªã„ã€‚

### hub_virtual_networksï¼ˆãƒ—ãƒ©ã‚¤ãƒãƒªï¼‰

ã“ã“ãŒä¸€ç•ªé•·ã„ã€‚ãƒ—ãƒ©ã‚¤ãƒãƒªHubã®å…¨è¨­å®šãŒå…¥ã£ã¦ã‚‹ã€‚

```hcl title="Hubä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šï¼ˆãƒ—ãƒ©ã‚¤ãƒãƒªï¼‰"
hub_virtual_networks = {
  primary = {
    location          = "$${starter_location_01}"
    default_parent_id = "$${primary_connectivity_resource_group_id}"
    
    enabled_resources = {
      firewall                              = "$${primary_firewall_enabled}"
      bastion                               = "$${primary_bastion_enabled}"
      virtual_network_gateway_express_route = "$${primary_virtual_network_gateway_express_route_enabled}"
      virtual_network_gateway_vpn           = "$${primary_virtual_network_gateway_vpn_enabled}"
      private_dns_zones                     = "$${primary_private_dns_zones_enabled}"
      private_dns_resolver                  = "$${primary_private_dns_resolver_enabled}"
    }
```

**enabled_resources**

ã•ã£ãPart 2ã§è¨­å®šã—ãŸæœ‰åŠ¹/ç„¡åŠ¹ãƒ•ãƒ©ã‚°ãŒã“ã“ã§ä½¿ã‚ã‚Œã‚‹ã€‚

#### VNetè¨­å®š

```hcl title="Hub VNetã®è¨­å®š"
    hub_virtual_network = {
      name                          = "$${primary_virtual_network_name}"
      address_space                 = ["$${primary_hub_virtual_network_address_space}"]
      routing_address_space         = ["$${primary_hub_address_space}"]
      route_table_name_firewall     = "$${primary_route_table_firewall_name}"
      route_table_name_user_subnets = "$${primary_route_table_user_subnets_name}"
      subnets                       = {}
    }
```

**address_space vs routing_address_space**

- `address_space`ï¼šVNetå®Ÿéš›ã®IPç¯„å›²ï¼ˆ`10.0.0.0/22`ï¼‰
- `routing_address_space`ï¼šãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§åºƒå‘Šã™ã‚‹ç¯„å›²ï¼ˆ`10.0.0.0/16`ï¼‰

åºƒã„ç¯„å›²ã§åºƒå‘Šã—ã¦ãŠã„ã¦ã€å¾Œã‹ã‚‰Spokeã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

#### Firewallè¨­å®š

```hcl title="Firewallè©³ç´°è¨­å®š"
    firewall = {
      subnet_address_prefix            = "$${primary_firewall_subnet_address_prefix}"
      management_subnet_address_prefix = "$${primary_firewall_management_subnet_address_prefix}"
      name                             = "$${primary_firewall_name}"
      default_ip_configuration = {
        public_ip_config = {
          name = "$${primary_firewall_public_ip_name}"
        }
      }
      management_ip_enabled = "$${primary_firewall_management_ip_enabled}"
      management_ip_configuration = {
        public_ip_config = {
          name = "$${primary_firewall_management_public_ip_name}"
        }
      }
    }
    firewall_policy = {
      name = "$${primary_firewall_policy_name}"
    }
```

Firewallã«ã¯2ã¤ã®Public IPãŒå¿…è¦ï¼š

1. **default_ip_configuration**ï¼šãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ç”¨
2. **management_ip_configuration**ï¼šç®¡ç†ç”¨ï¼ˆBasic SKUã§å¿…è¦ï¼‰

#### VPN/ExpressRoute Gatewayè¨­å®š

```hcl title="ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤è¨­å®šï¼ˆVPNã¨ExpressRouteï¼‰"
    virtual_network_gateways = {
      subnet_address_prefix = "$${primary_gateway_subnet_address_prefix}"
      express_route = {
        name                                  = "$${primary_virtual_network_gateway_express_route_name}"
        hosted_on_behalf_of_public_ip_enabled = "$${primary_virtual_network_gateway_express_route_hobo_public_ip_enabled}"
        ip_configurations = {
          default = {
            public_ip = {
              name = "$${primary_virtual_network_gateway_express_route_public_ip_name}"
            }
          }
        }
      }
      vpn = {
        name = "$${primary_virtual_network_gateway_vpn_name}"
        ip_configurations = {
          active_active_1 = {
            public_ip = {
              name = "$${primary_virtual_network_gateway_vpn_public_ip_name_1}"
            }
          }
          active_active_2 = {
            public_ip = {
              name = "$${primary_virtual_network_gateway_vpn_public_ip_name_2}"
            }
          }
        }
      }
    }
```

VPN Gatewayã¯Active-Activeï¼ˆ2å°æ§‹æˆï¼‰ã«ãªã£ã¦ã‚‹ã€‚
ExpressRouteã¯1å°ã ã‘ã€‚

#### Private DNS Zonesè¨­å®š

```hcl title="Private DNSã‚¾ãƒ¼ãƒ³è¨­å®š"
    private_dns_zones = {
      parent_id = "$${dns_resource_group_id}"
      private_link_private_dns_zones_regex_filter = {
        enabled = false
      }
      auto_registration_zone_enabled = "$${primary_private_dns_auto_registration_zone_enabled}"
      auto_registration_zone_name    = "$${primary_auto_registration_zone_name}"
    }
```

**Private DNS Zonesã¨ã¯ï¼Ÿ**

Azureå†…éƒ¨ã§ã®ã¿ä½¿ãˆã‚‹åå‰è§£æ±ºï¼ˆDNSï¼‰ã®ä»•çµ„ã¿ã§ã™ã€‚

**ä¸»ãªç”¨é€”:**

1. **Private Linkç”¨ã®DNSã‚¾ãƒ¼ãƒ³**: Azure Storageã€SQL Databaseç­‰ã®Private Endpointã®åå‰è§£æ±º
2. **è‡ªå‹•ç™»éŒ²ã‚¾ãƒ¼ãƒ³**: VMãŒèµ·å‹•ã™ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ›ã‚¹ãƒˆåãŒç™»éŒ²ã•ã‚Œã‚‹

**private_link_private_dns_zones_regex_filter.enabled**
```hcl
enabled = false
```

- `false`: ã™ã¹ã¦ã®Private Linkç”¨DNSã‚¾ãƒ¼ãƒ³ã‚’ä½œæˆ
- `true`: æ­£è¦è¡¨ç¾ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ä¸€éƒ¨ã®ã¿ä½œæˆ

é€šå¸¸ã¯`false`ï¼ˆå…¨éƒ¨ä½œæˆï¼‰ã§OKã§ã™ã€‚

**auto_registration_zone**
```hcl
auto_registration_zone_enabled = "$${primary_private_dns_auto_registration_zone_enabled}"
auto_registration_zone_name    = "$${primary_auto_registration_zone_name}"
```

- VMãŒèµ·å‹•ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«`japaneast.azure.local`ã«ç™»éŒ²ã•ã‚Œã‚‹
- ä»–ã®VMã‹ã‚‰`vm-app01.japaneast.azure.local`ã§åå‰è§£æ±ºã§ãã‚‹

#### Private DNS Resolverè¨­å®š

```hcl title="Private DNS Resolverè¨­å®š"
    private_dns_resolver = {
      subnet_address_prefix = "$${primary_private_dns_resolver_subnet_address_prefix}"
      name                  = "$${primary_private_dns_resolver_name}"
    }
```

**Private DNS Resolverã¨ã¯ï¼Ÿ**

ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã¨Azureé–“ã§DNSè§£æ±ºã‚’å¯èƒ½ã«ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

**ä½¿ç”¨ä¾‹:**

- ã‚ªãƒ³ãƒ—ãƒ¬ â†’ Azure: ã‚ªãƒ³ãƒ—ãƒ¬ã®ã‚µãƒ¼ãƒãƒ¼ãŒAzureå†…ã®VMã‚’åå‰ã§è§£æ±º
- Azure â†’ ã‚ªãƒ³ãƒ—ãƒ¬: Azureå†…ã®VMãŒã‚ªãƒ³ãƒ—ãƒ¬ã®ã‚µãƒ¼ãƒãƒ¼ã‚’åå‰ã§è§£æ±º

**ãªãœå¿…è¦ï¼Ÿ**

å¾“æ¥ã®VPNçµŒç”±ã®DNSè»¢é€ã‚ˆã‚Šã‚‚ã€é«˜é€Ÿã§å®‰å®šã—ãŸDNSè§£æ±ºãŒã§ãã¾ã™ã€‚

**ã‚³ã‚¹ãƒˆ:**

- ç´„Â¥8,000/æœˆ + ã‚¯ã‚¨ãƒªèª²é‡‘

ã‚ªãƒ³ãƒ—ãƒ¬æ¥ç¶šãŒãªã„ç’°å¢ƒã§ã¯ç„¡åŠ¹åŒ–ã—ã¦ã‚³ã‚¹ãƒˆå‰Šæ¸›ã§ãã¾ã™ã€‚

#### Bastionè¨­å®š

```hcl title="Azure Bastionè¨­å®š"
    bastion = {
      subnet_address_prefix = "$${primary_bastion_subnet_address_prefix}"
      name                  = "$${primary_bastion_host_name}"
      zones                 = []
      bastion_public_ip = {
        name  = "$${primary_bastion_host_public_ip_name}"
        zones = []
      }
    }
```

**è¶…é‡è¦ï¼**
```hcl
zones = []
```

Japan Eastã¯Availability Zonesã«å¯¾å¿œã—ã¦ã„ãªã„ãŸã‚`[]`ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
ã“ã‚Œå¿˜ã‚Œã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚

---

ã‚ã¨ã¯ã‚»ã‚«ãƒ³ãƒ€ãƒªã®è¨­å®šã‚‚åŒã˜ã‚ˆã†ã«ã‚ã‚Šã¾ã™ã€‚

## ã¾ã¨ã‚

ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼platform-landing-zone.auto.tfvarsã®å…¨ä½“ã‚’è¦‹ã¦ãã¾ã—ãŸã€‚

**é•·ã‹ã£ãŸã§ã™ãŒã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯3ã¤ã ã‘ã§ã™**ï¼š

1. **åå‰ã®å®šç¾©**ï¼ˆ`names`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
2. **æœ‰åŠ¹/ç„¡åŠ¹ã®è¨­å®š**ï¼ˆ`xxx_enabled`ï¼‰
3. **å®Ÿéš›ã®ãƒªã‚½ãƒ¼ã‚¹è¨­å®š**ï¼ˆå„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰

**è¦šãˆã¦ãŠãã¹ããƒã‚¤ãƒ³ãƒˆ**ï¼š

- ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¯`starter_locations`ã§æ±ºã¾ã‚Šã¾ã™
- æœ‰åŠ¹/ç„¡åŠ¹ã¯`xxx_enabled = true/false`ã§è¨­å®šã—ã¾ã™
- ã‚³ã‚¹ãƒˆå‰Šæ¸›ã—ãŸã„ãªã‚‰Firewallã€VPNã€Bastionã‚’`false`ã«è¨­å®šã—ã¾ã™

---

## ç·´ç¿’å•é¡Œ

ç†è§£åº¦ãƒã‚§ãƒƒã‚¯ã§ã™ã€‚ä¼‘æ†©ä¸­ã«è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### å•é¡Œ1
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¥¿æ—¥æœ¬ï¼ˆjapanwestï¼‰ã ã‘ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã«ã¯ã€  
`starter_locations`ã‚’ã©ã†å¤‰æ›´ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ

### å•é¡Œ2
Firewallã‚’ç„¡åŠ¹åŒ–ã—ã¦ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã—ãŸã„å ´åˆã€  
ã©ã®è¨­å®šã‚’`false`ã«å¤‰æ›´ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿï¼ˆå…·ä½“çš„ãªå¤‰æ•°åã‚’ç­”ãˆã¦ãã ã•ã„ï¼‰

### å•é¡Œ3
`management_resource_group_name = "rg-management-$${starter_location_01}"`ã¨ã„ã†è¨­å®šã§ã€  
`starter_locations = ["japaneast", "japanwest"]`ã®å ´åˆã€  
å®Ÿéš›ã®ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—åã¯ä½•ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ

---

## ç·´ç¿’å•é¡Œã®ç­”ãˆ

### ç­”ãˆ1
```hcl title="è¥¿æ—¥æœ¬ã ã‘ã«ãƒ‡ãƒ—ãƒ­ã‚¤"
starter_locations = ["japanwest"]
```
1ã¤ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã ã‘æŒ‡å®šã—ã¾ã™ã€‚ã‚»ã‚«ãƒ³ãƒ€ãƒªã¯ä¸è¦ãªã®ã§å‰Šé™¤ã€‚

### ç­”ãˆ2
```hcl title="Firewallã‚’ç„¡åŠ¹åŒ–ã—ã¦ã‚³ã‚¹ãƒˆå‰Šæ¸›"
primary_firewall_enabled = false
secondary_firewall_enabled = false
```
ãƒ—ãƒ©ã‚¤ãƒãƒªã¨ã‚»ã‚«ãƒ³ãƒ€ãƒªä¸¡æ–¹ã®Firewallã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã€‚  
ã“ã‚Œã§æœˆé¡ç´„28ä¸‡å††ã®ã‚³ã‚¹ãƒˆå‰Šæ¸›ã«ãªã‚Šã¾ã™ã€‚

### ç­”ãˆ3
```
rg-management-japaneast
```
`$${starter_location_01}`ãŒæœ€åˆã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³`japaneast`ã«ç½®ãæ›ã‚ã‚Šã¾ã™ã€‚

---

æ¬¡ã®Chapterã§ã¯ã€`variables.tf`ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚
ã“ã®tfvarsãƒ•ã‚¡ã‚¤ãƒ«ã®ã€Œå‹å®šç¾©ã€ãŒã©ã†ãªã£ã¦ã„ã‚‹ã‹è§£èª¬ã—ã¾ã™ã€‚

---

**æ‰€è¦æ™‚é–“**: 60åˆ†  
**é›£æ˜“åº¦**: â˜…â˜…â˜…â˜…â˜…  
**å‰**: [06_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md](./06_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md)  
**æ¬¡**: [07_å¤‰æ•°å®šç¾©.md](./07_å¤‰æ•°å®šç¾©.md)
