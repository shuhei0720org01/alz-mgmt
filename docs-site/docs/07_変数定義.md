# 07. å¤‰æ•°å®šç¾© - variables.tfã®èª­ã¿æ–¹ ğŸ§©

!!! ğŸ’¡ info "ã“ã®ç« ã§å­¦ã¶ã“ã¨"
    `variables.tf`ã®å‹å®šç¾©ã‚’å®Œå…¨ç†è§£ã—ã¾ã™ï¼š

    1. å¤‰æ•°å®šç¾©ã®3ã¤ã®è¦ç´ ï¼ˆå‹ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
    2. åŸºæœ¬å‹ï¼ˆstringã€numberã€boolï¼‰
    3. ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‹ï¼ˆlistã€mapã€setï¼‰
    4. æ§‹é€ å‹ï¼ˆobjectï¼‰ã¨optionalä¿®é£¾å­
    5. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã®æ›¸ãæ–¹
    6. å®Ÿè·µï¼šã‚«ã‚¹ã‚¿ãƒ å¤‰æ•°ã®è¿½åŠ æ–¹æ³•

---

## ğŸ—ºï¸ å¤‰æ•°å®šç¾©ã®å…¨ä½“åƒ

å¤‰æ•°å®šç¾©ï¼ˆvariables.tfï¼‰ã®æ§‹é€ ã‚’è¦–è¦šåŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```mermaid
graph TB
    A[variables.tf] --> B[å‹å®šç¾©]
    A --> C[ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³]
    A --> D[ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤]
    
    B --> B1[åŸºæœ¬å‹<br/>string, number, bool]
    B --> B2[ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‹<br/>list, map, set]
    B --> B3[æ§‹é€ å‹<br/>object]
    
    C --> C1[condition<br/>æ¡ä»¶å¼]
    C --> C2[error_message<br/>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸]
    
    D --> D1[çœç•¥å¯èƒ½<br/>defaultæŒ‡å®š]
    D --> D2[å¿…é ˆ<br/>defaultæœªæŒ‡å®š]
    
    B3 --> E[optionalä¿®é£¾å­<br/>çœç•¥å¯èƒ½ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1e1
    style D fill:#e1ffe1
```

**ğŸ”‘ 3ã¤ã®è¦ç´ **ï¼š

1. **å‹å®šç¾©**ï¼šã©ã‚“ãªãƒ‡ãƒ¼ã‚¿å‹ã‹ï¼ˆstringã€numberã€listç­‰ï¼‰
2. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**ï¼šå…¥åŠ›å€¤ã®ãƒã‚§ãƒƒã‚¯ï¼ˆæ¡ä»¶ã‚’æº€ãŸã•ãªã„ã¨ã‚¨ãƒ©ãƒ¼ï¼‰
3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**ï¼šçœç•¥æ™‚ã®åˆæœŸå€¤ï¼ˆä»»æ„ï¼‰

---

## ğŸ“ variables.tfã®å½¹å‰²

**ğŸ” 3ã¤ã®å½¹å‰²ãŒã‚ã‚‹**ï¼š

### ğŸ§¬ 1. å‹ã®å®šç¾©
```hcl title="å‹ã®å®šç¾©ä¾‹"
variable "starter_locations" {
  type = list(string)  # â†æ–‡å­—åˆ—ã®ãƒªã‚¹ãƒˆ
}
```

ã€Œã“ã‚Œã¯æ–‡å­—åˆ—ã®ãƒªã‚¹ãƒˆã§ã™ã€ã¨å®£è¨€ã—ã¦ã„ã¾ã™ã€‚

---

### âœ… 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
```hcl title="å€¤ã®ãƒã‚§ãƒƒã‚¯"
validation {
  condition     = length(var.starter_locations) > 0
  error_message = "æœ€ä½1ã¤ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¿…è¦ã§ã™"
}
```

---


é–“é•ã£ãŸå€¤ãŒå…¥ã£ã¦ãŸã‚‰ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã™ã€‚

### ğŸ·ï¸ 3. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
```hcl title="åˆæœŸå€¤ã®è¨­å®š"
variable "enable_telemetry" {
  type    = bool
  default = true  # â†æŒ‡å®šã—ãªã‹ã£ãŸã‚‰true
}
```

å€¤ã‚’æŒ‡å®šã—ãªã‹ã£ãŸæ™‚ã®åˆæœŸå€¤ã€‚

---

## ğŸ—¾ Part 1: ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®š

### ğŸŒ starter_locations

```hcl title="ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®šå¤‰æ•°"
variable "starter_locations" {
  type        = list(string)
  description = "The default for Azure resources. (e.g 'uksouth')"
  
  validation {
    condition     = length(var.starter_locations) > 0
    error_message = "You must provide at least one starter location region."
  }
  
  validation {
    condition     = var.connectivity_type == "none" || ((length(var.virtual_hubs) <= length(var.starter_locations)) || (length(var.hub_virtual_networks) <= length(var.starter_locations)))
    error_message = "The number of regions supplied in `starter_locations` must match the number of regions specified for connectivity."
  }
}
```

**ğŸ” åˆ†è§£ã—ã¦è¦‹ã¦ã„ãã¾ã—ã‚‡ã†**

#### ğŸ“ type = list(string)
```hcl
type = list(string)
```

**æ„å‘³**ï¼šæ–‡å­—åˆ—ã®ãƒªã‚¹ãƒˆ

**ğŸŸ¢ OKä¾‹**ï¼š
```hcl title="æ­£ã—ã„è¨˜è¿°ä¾‹"
starter_locations = ["japaneast", "japanwest"]  # âœ…
starter_locations = ["eastus"]                   # âœ…
```

**ğŸ”´ NGä¾‹**ï¼š
```hcl title="é–“é•ã£ãŸè¨˜è¿°ä¾‹"
starter_locations = "japaneast"     # âŒ ãƒªã‚¹ãƒˆã˜ã‚ƒãªã„
starter_locations = [123, 456]      # âŒ æ–‡å­—åˆ—ã˜ã‚ƒãªã„
starter_locations = []              # âŒ ç©ºã¯ãƒ€ãƒ¡ï¼ˆæ¬¡ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¨ãƒ©ãƒ¼ï¼‰
```

#### âœ… validation 1: æœ€ä½1å€‹å¿…è¦
```hcl title="ç©ºãƒªã‚¹ãƒˆç¦æ­¢ã®ãƒã‚§ãƒƒã‚¯"
validation {
  condition     = length(var.starter_locations) > 0
  error_message = "You must provide at least one starter location region."
}
```

**ğŸ” ãƒã‚§ãƒƒã‚¯å†…å®¹**ï¼š

- `length(var.starter_locations) > 0`ï¼šãƒªã‚¹ãƒˆã®é•·ã•ãŒ0ã‚ˆã‚Šå¤§ãã„ï¼Ÿ

- ã¤ã¾ã‚Šã€æœ€ä½1å€‹ã¯å…¥ã£ã¦ãªã„ã¨ãƒ€ãƒ¡

**âš ï¸ ã‚¨ãƒ©ãƒ¼ä¾‹**ï¼š
```hcl
starter_locations = []  # âŒ

# ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š
# You must provide at least one starter location region.
```

#### âœ… validation 2: Hubã®æ•°ã¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³æ•°ãŒåˆã£ã¦ã‚‹ã‹
```hcl
validation {
  condition     = var.connectivity_type == "none" || ((length(var.virtual_hubs) <= length(var.starter_locations)) || (length(var.hub_virtual_networks) <= length(var.starter_locations)))
  error_message = "The number of regions supplied in `starter_locations` must match the number of regions specified for connectivity."
}
```

**ğŸ” æ„å‘³**ï¼š

- Hub VNetã‚’2å€‹ä½œã‚‹ãªã‚‰ã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚2å€‹æŒ‡å®šã—ã¦ã­
- Hub VNet 3å€‹ãªã®ã«ãƒªãƒ¼ã‚¸ãƒ§ãƒ³2å€‹ã ã¨è¶³ã‚Šãªã„ã‹ã‚‰ã‚¨ãƒ©ãƒ¼

**ğŸ“ ä¾‹**ï¼š
```hcl title="æ­£ã—ã„è¨­å®šä¾‹"
# OK
starter_locations = ["japaneast", "japanwest"]
hub_virtual_networks = {
  primary = { ... }
  secondary = { ... }
}

# NG
starter_locations = ["japaneast"]  # ãƒªãƒ¼ã‚¸ãƒ§ãƒ³1å€‹
hub_virtual_networks = {
  primary = { ... }
  secondary = { ... }  # Hub 2å€‹ â†’ è¶³ã‚Šãªã„ï¼
}
```

---

### ğŸ·ï¸ starter_locations_short

```hcl title="ãƒªãƒ¼ã‚¸ãƒ§ãƒ³çŸ­ç¸®ã‚³ãƒ¼ãƒ‰ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰"
variable "starter_locations_short" {
  type        = map(string)
  default     = {}
  description = <<DESCRIPTION
Optional overrides for the starter location short codes.
...
DESCRIPTION
}
```

**â“ ã“ã‚Œã¯ä½•ï¼Ÿ**

ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®çŸ­ç¸®ã‚³ãƒ¼ãƒ‰ã‚’æ‰‹å‹•ã§æŒ‡å®šã—ãŸã„æ™‚ã«ä½¿ã†ã€‚

**ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œ**ï¼š

- `japaneast` â†’ `jpe`ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
- `japanwest` â†’ `jpw`ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰

**ğŸ› ï¸ æ‰‹å‹•ã§å¤‰ãˆãŸã„å ´åˆ**ï¼š
```hcl title="çŸ­ç¸®ã‚³ãƒ¼ãƒ‰ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º"
starter_locations_short = {
  starter_location_01_short = "je"   # jpeã˜ã‚ƒãªãã¦jeã«ã—ãŸã„
  starter_location_02_short = "jw"   # jpwã˜ã‚ƒãªãã¦jwã«ã—ãŸã„
}
```

æ™®é€šã¯ä½¿ã‚ãªã„ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ååˆ†ã€‚

---

## ğŸ†” Part 2: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID

### ğŸ—‚ï¸ subscription_idsï¼ˆæ–°ã—ã„æ–¹å¼ï¼‰

```hcl title="ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³IDå¤‰æ•°ï¼ˆæ¨å¥¨ï¼‰"
variable "subscription_ids" {
  description = "The list of subscription IDs to deploy the Platform Landing Zones into"
  type        = map(string)
  default     = {}
  nullable    = false
  
  validation {
    condition     = length(var.subscription_ids) == 0 || alltrue([for id in values(var.subscription_ids) : can(regex("^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$", id))])
    error_message = "All subscription IDs must be valid GUIDs"
  }
  
  validation {
    condition     = length(var.subscription_ids) == 0 || alltrue([for id in keys(var.subscription_ids) : contains(["management", "connectivity", "identity", "security"], id)])
    error_message = "The keys of the subscription_ids map must be one of 'management', 'connectivity', 'identity' or 'security'"
  }
}
```

**ğŸ§© type = map(string)**

ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã€‚

**ğŸ“ ä½¿ã„æ–¹**ï¼š
```hcl title="ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³IDã®è¨­å®šä¾‹"
subscription_ids = {
  management   = "12345678-1234-1234-1234-123456789012"
  connectivity = "87654321-4321-4321-4321-210987654321"
  identity     = "11111111-2222-3333-4444-555555555555"
  security     = "99999999-8888-7777-6666-555555555555"
}
```

#### âœ… validation 1: GUIDå½¢å¼ãƒã‚§ãƒƒã‚¯
```hcl title="ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³IDã®å½¢å¼ãƒã‚§ãƒƒã‚¯"
validation {
  condition     = length(var.subscription_ids) == 0 || alltrue([for id in values(var.subscription_ids) : can(regex("^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$", id))])
  error_message = "All subscription IDs must be valid GUIDs"
}
```

**ğŸ” ãƒã‚§ãƒƒã‚¯å†…å®¹**ï¼š

- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³IDãŒæ­£ã—ã„GUIDå½¢å¼ã‹ï¼Ÿ

- `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`ã®å½¢å¼

**ğŸ”´ NGä¾‹**ï¼š
```hcl
subscription_ids = {
  management = "abc"  # âŒ GUIDå½¢å¼ã˜ã‚ƒãªã„
}

# ã‚¨ãƒ©ãƒ¼: All subscription IDs must be valid GUIDs
```

#### âœ… validation 2: ã‚­ãƒ¼åãƒã‚§ãƒƒã‚¯
```hcl title="è¨±å¯ã•ã‚ŒãŸã‚­ãƒ¼åã®ãƒã‚§ãƒƒã‚¯"
validation {
  condition     = length(var.subscription_ids) == 0 || alltrue([for id in keys(var.subscription_ids) : contains(["management", "connectivity", "identity", "security"], id)])
  error_message = "The keys of the subscription_ids map must be one of 'management', 'connectivity', 'identity' or 'security'"
}
```

**ğŸ” ãƒã‚§ãƒƒã‚¯å†…å®¹**ï¼š
ã‚­ãƒ¼åã¯`management`ã€`connectivity`ã€`identity`ã€`security`ã®ã©ã‚Œã‹ã˜ã‚ƒãªã„ã¨ãƒ€ãƒ¡ã€‚

**ğŸ”´ NGä¾‹**ï¼š
```hcl
subscription_ids = {
  production = "12345678-..."  # âŒ productionã¯ä½¿ãˆãªã„
}

# ã‚¨ãƒ©ãƒ¼: The keys of the subscription_ids map must be one of 'management', 'connectivity', 'identity' or 'security'
```

---

### ğŸ—ƒï¸ subscription_id_connectivityï¼ˆå¤ã„æ–¹å¼ï¼‰

```hcl title="éæ¨å¥¨ï¼šå¤ã„ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³IDè¨­å®š"
variable "subscription_id_connectivity" {
  description = "DEPRECATED (use subscription_ids instead): The identifier of the Connectivity Subscription"
  type        = string
  default     = null
  
  validation {
    condition     = var.subscription_id_connectivity == null || can(regex("^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$", var.subscription_id_connectivity))
    error_message = "The subscription ID must be a valid GUID"
  }
}
```

DEPRECATEDã£ã¦æ›¸ã„ã¦ã‚ã‚‹ã§ã—ã‚‡ï¼Ÿ
ã“ã‚Œã¯å¤ã„æ–¹å¼ã€‚ä½¿ã‚ãªã„ã§ã€‚

æ˜”ã¯ã“ã†æ›¸ã„ã¦ãŸï¼š
```hcl
# å¤ã„æ–¹å¼ï¼ˆä½¿ã‚ãªã„ã§ï¼‰
subscription_id_connectivity = "12345678-..."
subscription_id_management   = "87654321-..."
subscription_id_identity     = "11111111-..."
```

ä»Šã¯ã“ã†ï¼š
```hcl
# æ–°ã—ã„æ–¹å¼ï¼ˆã“ã£ã¡ä½¿ã£ã¦ï¼‰
subscription_ids = {
  connectivity = "12345678-..."
  management   = "87654321-..."
  identity     = "11111111-..."
}
```

---

## ğŸ¢ Part 3: ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®š

### ğŸ  root_parent_management_group_id

```hcl title="ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã®è¦ªè¨­å®š"
variable "root_parent_management_group_id" {
  type        = string
  default     = ""
  description = "This is the id of the management group that the ALZ hierarchy will be nested under, will default to the Tenant Root Group"
}
```

**ã“ã‚Œã¯ä½•ï¼ŸğŸ§**

Landing Zonesã®ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—éšå±¤ã‚’ã€ã©ã“ã«ã¶ã‚‰ä¸‹ã’ã‚‹ã‹ã€‚

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**ï¼ˆ`""`ï¼‰ï¼š
```
Tenant Root Groupï¼ˆãƒ†ãƒŠãƒ³ãƒˆãƒ«ãƒ¼ãƒˆï¼‰
  â””â”€â”€ ALZã®ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—éšå±¤
```

**æ—¢å­˜ã®ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸‹ã«ä½œã‚ŠãŸã„å ´åˆğŸ› ï¸**ï¼š
```hcl title="ã‚«ã‚¹ã‚¿ãƒ è¦ªç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã®æŒ‡å®š"
root_parent_management_group_id = "/providers/Microsoft.Management/managementGroups/my-company"

# çµæœ
my-company
  â””â”€â”€ ALZã®ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—éšå±¤
```

æ™®é€šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§OKã€‚

---

## ğŸ§° Part 4: ãã®ä»–ã®è¨­å®š

### ğŸ“¡ enable_telemetry

```hcl title="ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼æœ‰åŠ¹/ç„¡åŠ¹è¨­å®š"
variable "enable_telemetry" {
  type        = bool
  default     = true
  description = "Flag to enable/disable telemetry"
}
```

**ã“ã‚Œã¯ä½•ï¼ŸğŸ§**

Microsoftã«ä½¿ç”¨çŠ¶æ³ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹ã‹ã©ã†ã‹ã€‚

**true**ï¼šåŒ¿åãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
**false**ï¼šé€ã‚‰ãªã„

ç„¡åŠ¹ã«ã—ãŸã„å ´åˆï¼š
```hcl title="ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ã‚’ç„¡åŠ¹åŒ–"
enable_telemetry = false
```

å€‹äººæƒ…å ±ã¯é€ã‚‰ã‚Œãªã„ã‹ã‚‰ã€trueã®ã¾ã¾ã§ã„ã„ã¨æ€ã†ã€‚

---

### ğŸ› ï¸ custom_replacements

```hcl title="ã‚«ã‚¹ã‚¿ãƒ ç½®æ›å¤‰æ•°"
variable "custom_replacements" {
  type = object({
    names                      = optional(map(string), {})
    resource_group_identifiers = optional(map(string), {})
    resource_identifiers       = optional(map(string), {})
  })
  default = {
    names                      = {}
    resource_group_identifiers = {}
    resource_identifiers       = {}
  }
  description = "Custom replacements"
}
```

**å‹ãŒè¤‡é›‘ï¼ğŸ¤¯**

`object`å‹ã§ã€ä¸­ã«3ã¤ã®`map(string)`ãŒå…¥ã£ã¦ã‚‹ã€‚

**objectå‹ã¨ã¯ï¼ŸğŸ§©**

JavaScriptã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¿ãŸã„ãªã‚„ã¤ã€‚

```hcl title="custom_replacementsã®ä½¿ç”¨ä¾‹"
custom_replacements = {
  names = {
    firewall_name = "fw-custom-name"
  }
  resource_group_identifiers = {
    ...
  }
  resource_identifiers = {
    ...
  }
}
```

optionalã£ã¦ä½•ï¼ŸğŸ¤”

- `optional(map(string), {})`ï¼šçœç•¥å¯èƒ½ã€‚çœç•¥ã—ãŸã‚‰ç©ºãƒãƒƒãƒ—`{}`ã«ãªã‚‹

ã¤ã¾ã‚Šã€ã“ã‚Œã§ã‚‚OKï¼š
```hcl
custom_replacements = {
  names = {
    firewall_name = "fw-custom-name"
  }
  # resource_group_identifiersçœç•¥
  # resource_identifiersçœç•¥
}
```

Chapter 6ã§è¦‹ãŸè¨­å®šãŒã€ã“ã“ã§å®šç¾©ã•ã‚Œã¦ã‚‹ã€‚

---

### ğŸ·ï¸ tags

```hcl title="ã‚¿ã‚°å¤‰æ•°"
variable "tags" {
  type        = map(string)
  default     = null
  description = "(Optional) Tags of the resource."
}
```

**å‹**ï¼š`map(string)`ï¼ˆã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ï¼‰

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**ï¼š`null`ï¼ˆä½•ã‚‚æŒ‡å®šã—ãªã‘ã‚Œã°ã‚¿ã‚°ãªã—ï¼‰

**ä½¿ã„æ–¹**ï¼š
```hcl title="ã‚¿ã‚°ã®è¨­å®šä¾‹"
tags = {
  environment = "production"
  cost_center = "IT"
  owner       = "platform-team"
}
```

---

## ğŸ§¬ Part 5: å¤‰æ•°ã®å‹ã¾ã¨ã‚

Terraformã§ã‚ˆãä½¿ã†å‹ã‚’ã¾ã¨ã‚ã¨ãã­ã€‚

### ğŸ§± ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ï¼ˆåŸºæœ¬å‹ï¼‰

#### ğŸ“ stringï¼ˆæ–‡å­—åˆ—ï¼‰
```hcl title="æ–‡å­—åˆ—å‹ã®å®šç¾©"
variable "name" {
  type = string
}

# ä½¿ã„æ–¹
name = "my-resource"
```

#### ğŸ”¢ numberï¼ˆæ•°å€¤ï¼‰
```hcl title="æ•°å€¤å‹ã®å®šç¾©"
variable "count" {
  type = number
}

# ä½¿ã„æ–¹
count = 3
```

#### ğŸ”˜ boolï¼ˆçœŸå½å€¤ï¼‰
```hcl title="çœŸå½å€¤å‹ã®å®šç¾©"
variable "enabled" {
  type = bool
}

# ä½¿ã„æ–¹
enabled = true
```

---

### ğŸ“š ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‹ï¼ˆè¤‡æ•°ã®å€¤ï¼‰

#### ğŸ“‹ listï¼ˆãƒªã‚¹ãƒˆï¼‰
```hcl title="ãƒªã‚¹ãƒˆå‹ã®å®šç¾©"
variable "locations" {
  type = list(string)
}

# ä½¿ã„æ–¹
locations = ["japaneast", "japanwest"]
```

#### ğŸ—ºï¸ mapï¼ˆãƒãƒƒãƒ—ï¼‰
```hcl title="ãƒãƒƒãƒ—å‹ã®å®šç¾©"
variable "tags" {
  type = map(string)
}

# ä½¿ã„æ–¹
tags = {
  env = "prod"
  app = "web"
}
```

#### ğŸ§© setï¼ˆã‚»ãƒƒãƒˆï¼‰
```hcl title="ã‚»ãƒƒãƒˆå‹ã®å®šç¾©"
variable "unique_items" {
  type = set(string)
}

# ä½¿ã„æ–¹
unique_items = ["a", "b", "c"]  # é‡è¤‡ã¯è‡ªå‹•å‰Šé™¤ã•ã‚Œã‚‹
```

---

### ğŸ—ï¸ æ§‹é€ å‹ï¼ˆè¤‡é›‘ãªæ§‹é€ ï¼‰

#### ğŸ§© objectï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
```hcl title="ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ã®å®šç¾©"
variable "vm_config" {
  type = object({
    name = string
    size = string
    enabled = bool
  })
}

# ä½¿ã„æ–¹
vm_config = {
  name = "my-vm"
  size = "Standard_B2s"
  enabled = true
}
```

#### ğŸ·ï¸ optionalï¼ˆçœç•¥å¯èƒ½ï¼‰
```hcl title="çœç•¥å¯èƒ½ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å®šç¾©"
variable "config" {
  type = object({
    name = string
    tags = optional(map(string), {})  # çœç•¥å¯ã€‚çœç•¥ã—ãŸã‚‰{}
  })
}

# ä½¿ã„æ–¹1: å…¨éƒ¨æŒ‡å®š
config = {
  name = "test"
  tags = {env = "dev"}
}

# ä½¿ã„æ–¹2: tagsçœç•¥
config = {
  name = "test"
  # tagsçœç•¥ â†’ è‡ªå‹•ã§{}ã«ãªã‚‹
}
```

---

## âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ›¸ãæ–¹

### ğŸ“ åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

```hcl title="ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®åŸºæœ¬æ§‹æ–‡"
variable "example" {
  type = string
  
  validation {
    condition     = æ¡ä»¶å¼
    error_message = "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
  }
}
```

**conditionãŒfalseã«ãªã£ãŸã‚‰ã‚¨ãƒ©ãƒ¼**

---

### ğŸ”„ ã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³

#### ğŸ“ é•·ã•ãƒã‚§ãƒƒã‚¯
```hcl title="ãƒªã‚¹ãƒˆã®é•·ã•ãƒã‚§ãƒƒã‚¯"
validation {
  condition     = length(var.my_list) > 0
  error_message = "ãƒªã‚¹ãƒˆã¯æœ€ä½1å€‹å¿…è¦"
}
```

#### ğŸ”¤ æ­£è¦è¡¨ç¾ãƒã‚§ãƒƒã‚¯
```hcl title="æ–‡å­—åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒã‚§ãƒƒã‚¯"
validation {
  condition     = can(regex("^[a-z0-9-]+$", var.name))
  error_message = "åå‰ã¯å°æ–‡å­—ã€æ•°å­—ã€ãƒã‚¤ãƒ•ãƒ³ã®ã¿"
}
```

#### ğŸ¯ å€¤ã®ç¯„å›²ãƒã‚§ãƒƒã‚¯
```hcl title="æ•°å€¤ç¯„å›²ã®ãƒã‚§ãƒƒã‚¯"
validation {
  condition     = var.count >= 1 && var.count <= 10
  error_message = "countã¯1ã€œ10ã®é–“"
}
```

#### ğŸ—‚ï¸ é¸æŠè‚¢ãƒã‚§ãƒƒã‚¯
```hcl title="è¨±å¯ã•ã‚ŒãŸå€¤ã®ãƒã‚§ãƒƒã‚¯"
validation {
  condition     = contains(["dev", "stg", "prod"], var.environment)
  error_message = "environmentã¯devã€stgã€prodã®ã©ã‚Œã‹"
}
```

#### ğŸ§® ãƒªã‚¹ãƒˆå…¨è¦ç´ ãƒã‚§ãƒƒã‚¯
```hcl title="å…¨è¦ç´ ã®æ¡ä»¶ãƒã‚§ãƒƒã‚¯"
validation {
  condition     = alltrue([for item in var.items : length(item) > 3])
  error_message = "å…¨ã¦ã®è¦ç´ ã¯4æ–‡å­—ä»¥ä¸Š"
}
```

---

## ğŸ› ï¸ å®Ÿè·µï¼šè‡ªåˆ†ã§å¤‰æ•°ã‚’è¿½åŠ ã—ã¦ã¿ã‚ˆã†

ä¾‹ãˆã°ã€ã€ŒFirewallã®åå‰ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã„ã€ã£ã¦æ™‚ã€‚

### 1ï¸âƒ£ variables.tfã«è¿½åŠ 
```hcl title="ã‚«ã‚¹ã‚¿ãƒ Firewallåå¤‰æ•°ã®å®šç¾©"
variable "custom_firewall_name" {
  type        = string
  default     = null
  description = "Custom name for the firewall"
  
  validation {
    condition     = var.custom_firewall_name == null || can(regex("^fw-[a-z0-9-]+$", var.custom_firewall_name))
    error_message = "Firewall name must start with 'fw-' and contain only lowercase letters, numbers, and hyphens"
  }
}
```

---

### 2ï¸âƒ£ platform-landing-zone.auto.tfvarsã§ä½¿ã†
```hcl title="ã‚«ã‚¹ã‚¿ãƒ Firewallåã®è¨­å®š"
custom_firewall_name = "fw-my-custom-firewall"
```

---

### 3ï¸âƒ£ main.tfã§å‚ç…§
```hcl title="Firewallãƒªã‚½ãƒ¼ã‚¹ã§å¤‰æ•°ã‚’ä½¿ç”¨"
resource "azurerm_firewall" "example" {
  name = var.custom_firewall_name != null ? var.custom_firewall_name : "fw-default"
  ...
}
```

ç°¡å˜ã§ã—ã‚‡ï¼Ÿ

---

## ğŸ“ ã¾ã¨ã‚

**variables.tfã®å½¹å‰²**ï¼š

1. **å‹å®šç¾©**ï¼šã©ã‚“ãªãƒ‡ãƒ¼ã‚¿å‹ã‹
2. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**ï¼šé–“é•ã£ãŸå€¤ã‚’ãƒã‚§ãƒƒã‚¯
3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**ï¼šçœç•¥æ™‚ã®åˆæœŸå€¤

**ã‚ˆãä½¿ã†å‹**ï¼š

- `string`ã€`number`ã€`bool`ï¼šåŸºæœ¬å‹
- `list(type)`ã€`map(type)`ï¼šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‹
- `object({...})`ï¼šæ§‹é€ å‹
- `optional(type, default)`ï¼šçœç•¥å¯èƒ½

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**ï¼š

- `length()`ã€`can()`ã€`regex()`ã€`contains()`ã€`alltrue()`

æ¬¡ã®Chapterã§ã¯ã€`locals.tf`ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚
å¤‰æ•°ã‚’è¨ˆç®—ãƒ»åŠ å·¥ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ãŒã©ã†ãªã£ã¦ã„ã‚‹ã‹è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ‹ï¸â€â™‚ï¸ ç·´ç¿’å•é¡Œ

ç†è§£åº¦ãƒã‚§ãƒƒã‚¯ã§ã™ã€‚ä¼‘æ†©ä¸­ã«è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### â“ å•é¡Œ1
æ¬¡ã®å¤‰æ•°å®šç¾©ã®ã†ã¡ã€æ­£ã—ããªã„ã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ

```hcl
A. variable "name" { type = string }
B. variable "count" { type = number, default = 1 }
C. variable "tags" { type = map(string) }
```

### â“ å•é¡Œ2
`optional`ä¿®é£¾å­ã‚’ä½¿ã£ãŸå¤‰æ•°å®šç¾©ã§ã€  
çœç•¥æ™‚ã«ç©ºæ–‡å­—åˆ—ï¼ˆ`""`ï¼‰ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ãªã‚‹ã‚ˆã†ã«æ›¸ã„ã¦ãã ã•ã„ã€‚

### â“ å•é¡Œ3
æ¬¡ã®validationæ¡ä»¶ã¯ä½•ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ

```hcl
validation {
  condition     = contains(["japaneast", "japanwest"], var.location)
  error_message = "Invalid location"
}
```

---

## ğŸ“ ç·´ç¿’å•é¡Œã®ç­”ãˆ

### ğŸ’¡ ç­”ãˆ1
**B ãŒé–“é•ã„**ã§ã™ã€‚

```hcl
# âŒ ã‚«ãƒ³ãƒã¯ä½¿ã‚ãªã„
variable "count" { type = number, default = 1 }

# âœ… æ­£ã—ã„æ›¸ãæ–¹
variable "count" {
  type    = number
  default = 1
}
```

### ğŸ’¡ ç­”ãˆ2
```hcl title="optionalä¿®é£¾å­ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒ‡å®š"
variable "description" {
  type = object({
    text = optional(string, "")
  })
}
```

`optional(string, "")`ã¨ã™ã‚‹ã“ã¨ã§ã€çœç•¥æ™‚ã«ç©ºæ–‡å­—åˆ—ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ãªã‚Šã¾ã™ã€‚

### ğŸ’¡ ç­”ãˆ3
ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒ`japaneast`ã¾ãŸã¯`japanwest`ã®ã¿è¨±å¯ã•ã‚Œã‚‹ã“ã¨ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚

`contains(list, value)`ã§ã€ãƒªã‚¹ãƒˆã«å€¤ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚
å«ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯ã€`error_message`ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

---

**æ‰€è¦æ™‚é–“**: 35åˆ†  
**é›£æ˜“åº¦**: â˜…â˜…â˜…â˜†â˜†  
**å‰**: [06_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md](./06_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md)  
**æ¬¡**: [08_ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°.md](./08_ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°.md)
