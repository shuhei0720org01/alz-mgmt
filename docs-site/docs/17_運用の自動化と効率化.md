# 17. é‹ç”¨ã®è‡ªå‹•åŒ–ã¨åŠ¹ç‡åŒ–

!!! info "ã“ã®ç« ã§å­¦ã¶ã“ã¨"
    é‹ç”¨ã‚’è‡ªå‹•åŒ–ã—ã¦åŠ¹ç‡åŒ–ã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™ï¼š

    1. é‹ç”¨è‡ªå‹•åŒ–ã®è¨­è¨ˆ
    2. ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ
    3. ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®å®Ÿè·µ
    4. é‹ç”¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

    ã“ã®ç« ã§ã€åŠ¹ç‡çš„ãªé‹ç”¨ä½“åˆ¶ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

---

## Part 1: é‹ç”¨è‡ªå‹•åŒ–ã®è¨­è¨ˆ

### è‡ªå‹•åŒ–ã™ã¹ãã‚¿ã‚¹ã‚¯ã®é¸å®š

ã©ã®ã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•åŒ–ã™ã¹ãã‹åˆ¤æ–­ã—ã¾ã™ã€‚

=== "è‡ªå‹•åŒ–ã®å„ªå…ˆåº¦"

    **é«˜å„ªå…ˆåº¦ï¼ˆã™ãã«è‡ªå‹•åŒ–ï¼‰**:
    
    - âœ… å®šæœŸçš„ã«å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¹ã‚¯
    - âœ… æ‰‹é †ãŒæ˜ç¢ºãªã‚¿ã‚¹ã‚¯
    - âœ… ãƒŸã‚¹ãŒè¨±ã•ã‚Œãªã„ã‚¿ã‚¹ã‚¯
    - âœ… æ™‚é–“ãŒã‹ã‹ã‚‹ã‚¿ã‚¹ã‚¯
    
    **ä¾‹**:
    - Policyæº–æ‹ çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ¯é€±ï¼‰
    - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèªï¼ˆæ¯æ—¥ï¼‰
    - ã‚³ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ¯æœˆï¼‰
    - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆæ¯æ—¥ï¼‰

=== "è‡ªå‹•åŒ–ã—ãªã„ã‚¿ã‚¹ã‚¯"

    **è‡ªå‹•åŒ–ã«ä¸å‘ã**:
    
    - âŒ é »åº¦ãŒä½ã„ã‚¿ã‚¹ã‚¯ï¼ˆå¹´1å›ãªã©ï¼‰
    - âŒ åˆ¤æ–­ãŒå¿…è¦ãªã‚¿ã‚¹ã‚¯
    - âŒ æ‰‹é †ãŒä¸æ˜ç¢ºãªã‚¿ã‚¹ã‚¯
    - âŒ è‡ªå‹•åŒ–ã‚³ã‚¹ãƒˆãŒé«˜ã„ã‚¿ã‚¹ã‚¯
    
    **ä¾‹**:
    - é‡å¤§ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ
    - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
    - ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã®ãƒ’ã‚¢ãƒªãƒ³ã‚°

=== "ROIè©•ä¾¡"

    | ã‚¿ã‚¹ã‚¯ | é »åº¦ | æ‰‹å‹•æ™‚é–“ | è‡ªå‹•åŒ–ã‚³ã‚¹ãƒˆ | ROI |
    |--------|------|----------|------------|-----|
    | Policyæº–æ‹ ãƒ¬ãƒãƒ¼ãƒˆ | é€±1 | 30åˆ† | 4æ™‚é–“ | â­â­â­â­â­ |
    | ã‚³ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ | æœˆ1 | 2æ™‚é–“ | 8æ™‚é–“ | â­â­â­ |
    | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª | æ—¥1 | 10åˆ† | 4æ™‚é–“ | â­â­â­â­â­ |
    | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ | æ—¥1 | 15åˆ† | 6æ™‚é–“ | â­â­â­â­ |

### GitHub Actionsã§ã®è‡ªå‹•åŒ–

GitHub Actionsã§é‹ç”¨ã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚

=== "Policyæº–æ‹ ãƒ¬ãƒãƒ¼ãƒˆ"

    ```yaml title=".github/workflows/policy-compliance-report.yaml"
    name: Policy Compliance Report
    
    on:
      schedule:
        - cron: '0 9 * * 1'  # æ¯é€±æœˆæ›œ 9:00 JST
      workflow_dispatch:
    
    permissions:
      id-token: write
      contents: read
      issues: write
    
    jobs:
      compliance-check:
        runs-on: ubuntu-latest
        steps:
          - name: Azure Login (OIDC)
            uses: azure/login@v1
            with:
              client-id: ${{ secrets.AZURE_CLIENT_ID }}
              tenant-id: ${{ secrets.AZURE_TENANT_ID }}
              subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
          
          - name: Get Compliance Status
            id: compliance
            run: |
              az policy state summarize \
                --management-group alz \
                --output json > compliance.json
              
              # éæº–æ‹ æ•°ã‚’å–å¾—
              NON_COMPLIANT=$(jq '.results.nonCompliantResources' compliance.json)
              echo "non_compliant=$NON_COMPLIANT" >> $GITHUB_OUTPUT
          
          - name: Generate Report
            run: |
              cat << EOF > report.md
              # Policyæº–æ‹ ãƒ¬ãƒãƒ¼ãƒˆ
              
              **æ—¥æ™‚**: $(date '+%Y-%m-%d %H:%M JST')
              
              ## ã‚µãƒãƒªãƒ¼
              
              - éæº–æ‹ ãƒªã‚½ãƒ¼ã‚¹æ•°: ${{ steps.compliance.outputs.non_compliant }}
              
              ## è©³ç´°
              
              \`\`\`json
              $(cat compliance.json)
              \`\`\`
              
              ## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
              
              éæº–æ‹ ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã€å¯¾å¿œã—ã¦ãã ã•ã„ã€‚
              EOF
          
          - name: Create Issue
            uses: actions/github-script@v6
            with:
              script: |
                const fs = require('fs');
                const report = fs.readFileSync('report.md', 'utf8');
                
                await github.rest.issues.create({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  title: `Policyæº–æ‹ ãƒ¬ãƒãƒ¼ãƒˆ - ${new Date().toLocaleDateString('ja-JP')}`,
                  body: report,
                  labels: ['report', 'policy-compliance']
                });
    ```

=== "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª"

    ```yaml title=".github/workflows/backup-check.yaml"
    name: Backup Status Check
    
    on:
      schedule:
        - cron: '0 8 * * *'  # æ¯æ—¥ 8:00 JST
      workflow_dispatch:
    
    permissions:
      id-token: write
      contents: read
    
    jobs:
      backup-check:
        runs-on: ubuntu-latest
        steps:
          - name: Azure Login (OIDC)
            uses: azure/login@v1
            with:
              client-id: ${{ secrets.AZURE_CLIENT_ID }}
              tenant-id: ${{ secrets.AZURE_TENANT_ID }}
              subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
          
          - name: Check VM Backups
            run: |
              # Recovery Vaultã®ç¢ºèª
              az backup vault list --output table
              
              # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¸ãƒ§ãƒ–ã®ç¢ºèªï¼ˆéå»24æ™‚é–“ï¼‰
              az backup job list \
                --vault-name alz-backup-vault \
                --resource-group alz-management-rg \
                --status Failed \
                --output table > failed-jobs.txt
              
              if [ -s failed-jobs.txt ]; then
                echo "::warning::ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¸ãƒ§ãƒ–ãŒå¤±æ•—ã—ã¦ã„ã¾ã™"
                cat failed-jobs.txt
                exit 1
              fi
          
          - name: Notify on Failure
            if: failure()
            run: |
              # Slackã«é€šçŸ¥ï¼ˆå¾Œè¿°ï¼‰
              echo "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¤±æ•—ã‚’æ¤œçŸ¥ã—ã¾ã—ãŸ"
    ```

=== "æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹æ¤œå‡º"

    ```yaml title=".github/workflows/unused-resources.yaml"
    name: Unused Resources Detection
    
    on:
      schedule:
        - cron: '0 10 * * 1'  # æ¯é€±æœˆæ›œ 10:00 JST
      workflow_dispatch:
    
    permissions:
      id-token: write
      contents: read
      issues: write
    
    jobs:
      detect-unused:
        runs-on: ubuntu-latest
        steps:
          - name: Azure Login (OIDC)
            uses: azure/login@v1
            with:
              client-id: ${{ secrets.AZURE_CLIENT_ID }}
              tenant-id: ${{ secrets.AZURE_TENANT_ID }}
              subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
          
          - name: Find Unused Public IPs
            id: unused-ips
            run: |
              az network public-ip list \
                --query "[?ipConfiguration==null].{Name:name, RG:resourceGroup, Location:location}" \
                --output json > unused-ips.json
              
              COUNT=$(jq 'length' unused-ips.json)
              echo "count=$COUNT" >> $GITHUB_OUTPUT
          
          - name: Find Unused Disks
            id: unused-disks
            run: |
              az disk list \
                --query "[?diskState=='Unattached'].{Name:name, RG:resourceGroup, Size:diskSizeGb}" \
                --output json > unused-disks.json
              
              COUNT=$(jq 'length' unused-disks.json)
              echo "count=$COUNT" >> $GITHUB_OUTPUT
          
          - name: Create Report Issue
            if: ${{ steps.unused-ips.outputs.count > 0 || steps.unused-disks.outputs.count > 0 }}
            uses: actions/github-script@v6
            with:
              script: |
                const fs = require('fs');
                const unusedIPs = JSON.parse(fs.readFileSync('unused-ips.json', 'utf8'));
                const unusedDisks = JSON.parse(fs.readFileSync('unused-disks.json', 'utf8'));
                
                let body = '# æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ\n\n';
                body += `**æ—¥æ™‚**: ${new Date().toLocaleDateString('ja-JP')}\n\n`;
                
                if (unusedIPs.length > 0) {
                  body += '## æœªä½¿ç”¨Public IP\n\n';
                  body += '| Name | Resource Group | Location |\n';
                  body += '|------|----------------|----------|\n';
                  unusedIPs.forEach(ip => {
                    body += `| ${ip.Name} | ${ip.RG} | ${ip.Location} |\n`;
                  });
                  body += '\n';
                }
                
                if (unusedDisks.length > 0) {
                  body += '## æœªä½¿ç”¨Disk\n\n';
                  body += '| Name | Resource Group | Size (GB) |\n';
                  body += '|------|----------------|----------|\n';
                  unusedDisks.forEach(disk => {
                    body += `| ${disk.Name} | ${disk.RG} | ${disk.Size} |\n`;
                  });
                }
                
                await github.rest.issues.create({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  title: `æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹æ¤œå‡º - ${new Date().toLocaleDateString('ja-JP')}`,
                  body: body,
                  labels: ['report', 'cost-optimization']
                });
    ```

### Scheduled Workflowã®æ´»ç”¨

å®šæœŸå®Ÿè¡Œã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¨­å®šã—ã¾ã™ã€‚

=== "cronã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾‹"

    | é »åº¦ | cron | èª¬æ˜ |
    |------|------|------|
    | æ¯æ—¥8:00 | `0 8 * * *` | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª |
    | æ¯é€±æœˆæ›œ9:00 | `0 9 * * 1` | Policyæº–æ‹ ãƒ¬ãƒãƒ¼ãƒˆ |
    | æ¯æœˆ1æ—¥10:00 | `0 10 1 * *` | ã‚³ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ |
    | æ¯æ™‚ | `0 * * * *` | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ |
    
    !!! tip "cronè¨­å®š"
        cronã¯UTCæ™‚åˆ»ã§ã™ã€‚JST = UTC+9ãªã®ã§ã€9æ™‚é–“å¼•ã„ãŸæ™‚åˆ»ã‚’æŒ‡å®šã—ã¾ã™ã€‚
        - JST 9:00 â†’ UTC 0:00 â†’ cron: `0 0 * * *`
        - JST 18:00 â†’ UTC 9:00 â†’ cron: `0 9 * * *`

=== "workflow_dispatchä½µç”¨"

    ```yaml
    on:
      schedule:
        - cron: '0 9 * * 1'  # å®šæœŸå®Ÿè¡Œ
      workflow_dispatch:        # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
        inputs:
          scope:
            description: 'Scope (management-group or subscription)'
            required: false
            default: 'alz'
    ```
    
    å®šæœŸå®Ÿè¡Œã¨æ‰‹å‹•å®Ÿè¡Œã®ä¸¡æ–¹ã«å¯¾å¿œã—ã¾ã™ã€‚

### Slacké€šçŸ¥ã®çµ±åˆ

é‹ç”¨ã‚¿ã‚¹ã‚¯ã®çµæœã‚’Slackã«é€šçŸ¥ã—ã¾ã™ã€‚

=== "Slack Webhookè¨­å®š"

    **1. Slack Appã§Incoming Webhookã‚’ä½œæˆ**:
    
    - https://api.slack.com/apps â†’ Create New App
    - Incoming Webhooksã‚’æœ‰åŠ¹åŒ–
    - Webhook URLã‚’å–å¾—
    
    **2. GitHub Secretsã«ç™»éŒ²**:
    
    ```bash
    gh secret set SLACK_WEBHOOK_URL --body "https://hooks.slack.com/services/..."
    ```

=== "é€šçŸ¥ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼"

    ```yaml title=".github/workflows/notify-slack.yaml"
    name: Slack Notification Example
    
    on:
      workflow_dispatch:
    
    jobs:
      notify:
        runs-on: ubuntu-latest
        steps:
          - name: Send to Slack
            uses: slackapi/slack-github-action@v1
            with:
              payload: |
                {
                  "text": "Policyæº–æ‹ ãƒ¬ãƒãƒ¼ãƒˆ",
                  "blocks": [
                    {
                      "type": "header",
                      "text": {
                        "type": "plain_text",
                        "text": "ğŸ“Š Policyæº–æ‹ ãƒ¬ãƒãƒ¼ãƒˆ"
                      }
                    },
                    {
                      "type": "section",
                      "text": {
                        "type": "mrkdwn",
                        "text": "*æ—¥æ™‚*: $(date '+%Y-%m-%d %H:%M JST')\n*éæº–æ‹ ãƒªã‚½ãƒ¼ã‚¹*: 5ä»¶"
                      }
                    },
                    {
                      "type": "section",
                      "text": {
                        "type": "mrkdwn",
                        "text": "<https://github.com/${{ github.repository }}/issues/123|è©³ç´°ã‚’ç¢ºèª>"
                      }
                    }
                  ]
                }
            env:
              SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
              SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
    ```

=== "ã‚¨ãƒ©ãƒ¼é€šçŸ¥"

    ```yaml
    - name: Notify on Failure
      if: failure()
      uses: slackapi/slack-github-action@v1
      with:
        payload: |
          {
            "text": "âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯å¤±æ•—",
            "blocks": [
              {
                "type": "header",
                "text": {
                  "type": "plain_text",
                  "text": "âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯å¤±æ•—"
                }
              },
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn",
                  "text": "*ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼*: ${{ github.workflow }}\n*å®Ÿè¡ŒID*: ${{ github.run_id }}\n\n<https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}|è©³ç´°ã‚’ç¢ºèª>"
                }
              }
            ]
          }
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
    ```

### è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

å®šæœŸãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

=== "æœˆæ¬¡ã‚³ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ"

    ```yaml title=".github/workflows/monthly-cost-report.yaml"
    name: Monthly Cost Report
    
    on:
      schedule:
        - cron: '0 10 1 * *'  # æ¯æœˆ1æ—¥ 10:00 JST
      workflow_dispatch:
    
    permissions:
      id-token: write
      contents: read
      issues: write
    
    jobs:
      cost-report:
        runs-on: ubuntu-latest
        steps:
          - name: Azure Login (OIDC)
            uses: azure/login@v1
            with:
              client-id: ${{ secrets.AZURE_CLIENT_ID }}
              tenant-id: ${{ secrets.AZURE_TENANT_ID }}
              subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
          
          - name: Get Cost Data
            run: |
              # å…ˆæœˆã®ã‚³ã‚¹ãƒˆã‚’å–å¾—
              LAST_MONTH=$(date -d 'last month' '+%Y-%m-01')
              THIS_MONTH=$(date '+%Y-%m-01')
              
              az consumption usage list \
                --start-date $LAST_MONTH \
                --end-date $THIS_MONTH \
                --output json > cost-data.json
              
              # Subscriptionåˆ¥ã«é›†è¨ˆ
              jq -r 'group_by(.subscriptionId) | 
                     map({subscription: .[0].subscriptionId, 
                          cost: map(.pretaxCost) | add}) | 
                     .[] | "\(.subscription),\(.cost)"' \
                cost-data.json > cost-by-sub.csv
          
          - name: Generate Report
            run: |
              cat << 'EOF' > report.md
              # æœˆæ¬¡ã‚³ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
              
              **å¯¾è±¡æœˆ**: $(date -d 'last month' '+%Yå¹´%mæœˆ')
              **ä½œæˆæ—¥**: $(date '+%Y-%m-%d')
              
              ## Subscriptionåˆ¥ã‚³ã‚¹ãƒˆ
              
              | Subscription | ã‚³ã‚¹ãƒˆ (USD) |
              |-------------|-------------|
              EOF
              
              while IFS=, read -r sub cost; do
                echo "| $sub | \$$cost |" >> report.md
              done < cost-by-sub.csv
              
              cat << 'EOF' >> report.md
              
              ## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
              
              - ã‚³ã‚¹ãƒˆãŒäºˆç®—ã‚’è¶…ãˆã¦ã„ã‚‹Subscriptionã‚’ç¢ºèª
              - æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤ã‚’æ¤œè¨
              - Reserved Instancesã®æ´»ç”¨ã‚’æ¤œè¨
              EOF
          
          - name: Create Issue
            uses: actions/github-script@v6
            with:
              script: |
                const fs = require('fs');
                const report = fs.readFileSync('report.md', 'utf8');
                
                await github.rest.issues.create({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  title: `æœˆæ¬¡ã‚³ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ - ${new Date().toLocaleDateString('ja-JP', {year: 'numeric', month: 'long'})}`,
                  body: report,
                  labels: ['report', 'cost']
                });
    ```

---

## Part 2: ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ

### Log Analyticsã®æ´»ç”¨

Log Analyticsã§ãƒ­ã‚°ã‚’åˆ†æã—ã¾ã™ã€‚

=== "ã‚¯ã‚¨ãƒªä¾‹"

    **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ†æ**:
    
    ```kusto
    AzureDiagnostics
    | where Category == "AzureFirewallNetworkRule"
    | where TimeGenerated > ago(24h)
    | summarize count() by Action, msg_s
    | order by count_ desc
    ```
    
    **Policyé•åã®æ¤œå‡º**:
    
    ```kusto
    AzureActivity
    | where OperationNameValue contains "Microsoft.Authorization/policyAssignments"
    | where ActivityStatusValue == "Failure"
    | project TimeGenerated, Caller, OperationNameValue, ActivityStatusValue
    | order by TimeGenerated desc
    ```
    
    **ãƒªã‚½ãƒ¼ã‚¹ä½œæˆãƒˆãƒ¬ãƒ³ãƒ‰**:
    
    ```kusto
    AzureActivity
    | where OperationNameValue contains "Microsoft.Resources/subscriptions/resourceGroups/write"
    | where ActivityStatusValue == "Success"
    | summarize count() by bin(TimeGenerated, 1d), SubscriptionId
    | render timechart
    ```

=== "Saved Queries"

    ```bash title="ã‚ˆãä½¿ã†ã‚¯ã‚¨ãƒªã‚’ä¿å­˜"
    az monitor log-analytics query \
      --workspace <workspace-id> \
      --analytics-query "$(cat network-traffic.kusto)" \
      --output table
    ```
    
    ã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒ–ã—ã¦å®šæœŸå®Ÿè¡Œã§ãã¾ã™ã€‚

### Azure Monitorã®è¨­å®š

Azure Monitorã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç›£è¦–ã—ã¾ã™ã€‚

=== "Firewallãƒ¡ãƒˆãƒªã‚¯ã‚¹"

    **ç›£è¦–é …ç›®**:
    
    - Throughputï¼ˆã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆï¼‰
    - SNAT port utilizationï¼ˆSNAT ãƒãƒ¼ãƒˆä½¿ç”¨ç‡ï¼‰
    - Firewall health stateï¼ˆæ­£å¸¸æ€§çŠ¶æ…‹ï¼‰
    - Application rules hit countï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ãƒ’ãƒƒãƒˆæ•°ï¼‰
    
    ```bash title="ãƒ¡ãƒˆãƒªã‚¯ã‚¹å–å¾—"
    az monitor metrics list \
      --resource <firewall-id> \
      --metric "Throughput" \
      --start-time 2026-01-20T00:00:00Z \
      --end-time 2026-01-20T23:59:59Z \
      --interval PT1H \
      --output table
    ```

=== "VNetãƒ¡ãƒˆãƒªã‚¯ã‚¹"

    **ç›£è¦–é …ç›®**:
    
    - BytesInDDoSï¼ˆDDoSå—ä¿¡ãƒã‚¤ãƒˆæ•°ï¼‰
    - PacketsInDDoSï¼ˆDDoSå—ä¿¡ãƒ‘ã‚±ãƒƒãƒˆæ•°ï¼‰
    - IfUnderDDoSAttackï¼ˆDDoSæ”»æ’ƒæ¤œçŸ¥ï¼‰
    
    ```bash title="DDoSæ”»æ’ƒã®ç¢ºèª"
    az monitor metrics list \
      --resource <vnet-id> \
      --metric "IfUnderDDoSAttack" \
      --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \
      --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ') \
      --interval PT5M
    ```

### Policyé•åã®ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

Policyé•åã‚’æ¤œçŸ¥ã—ã¦ã‚¢ãƒ©ãƒ¼ãƒˆã—ã¾ã™ã€‚

=== "ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«ä½œæˆ"

    ```bash title="Policyé•åã‚¢ãƒ©ãƒ¼ãƒˆ"
    az monitor metrics alert create \
      --name "policy-violation-alert" \
      --resource-group alz-management-rg \
      --scopes "/providers/Microsoft.Management/managementGroups/alz" \
      --condition "count > 0" \
      --description "Policyé•åã‚’æ¤œçŸ¥ã—ã¾ã—ãŸ" \
      --evaluation-frequency 5m \
      --window-size 15m \
      --action <action-group-id>
    ```

=== "Action Groupè¨­å®š"

    ```bash title="Action Groupä½œæˆ"
    az monitor action-group create \
      --name "ops-team-alert" \
      --resource-group alz-management-rg \
      --short-name "OpsTeam" \
      --email-receiver \
        name="Admin" \
        email-address="admin@example.com" \
        use-common-alert-schema=true \
      --webhook-receiver \
        name="Slack" \
        service-uri="$SLACK_WEBHOOK_URL" \
        use-common-alert-schema=true
    ```

### ã‚³ã‚¹ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®š

äºˆç®—ã‚’è¶…éã—ãŸéš›ã«ã‚¢ãƒ©ãƒ¼ãƒˆã—ã¾ã™ã€‚

=== "äºˆç®—è¨­å®š"

    ```bash title="äºˆç®—ä½œæˆ"
    az consumption budget create \
      --budget-name "monthly-budget-mgmt" \
      --category "Cost" \
      --amount 50000 \
      --time-grain "Monthly" \
      --start-date 2026-01-01 \
      --end-date 2026-12-31 \
      --resource-group alz-management-rg \
      --notifications \
        actual_GreaterThan_80_Percent='{
          "enabled": true,
          "operator": "GreaterThan",
          "threshold": 80,
          "contactEmails": ["admin@example.com"],
          "contactRoles": ["Owner"]
        }' \
        actual_GreaterThan_100_Percent='{
          "enabled": true,
          "operator": "GreaterThan",
          "threshold": 100,
          "contactEmails": ["admin@example.com"],
          "contactRoles": ["Owner"]
        }'
    ```

=== "ã‚³ã‚¹ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆã®ãƒ¬ãƒ™ãƒ«"

    | ã—ãã„å€¤ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
    |---------|----------|
    | 50% | æƒ…å ±é€šçŸ¥ï¼ˆæœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼‰ |
    | 80% | è­¦å‘Šé€šçŸ¥ï¼ˆæ‹…å½“è€…ç¢ºèªï¼‰ |
    | 90% | ç·Šæ€¥é€šçŸ¥ï¼ˆå³åº§ã«å¯¾å¿œï¼‰ |
    | 100% | ç·Šæ€¥é€šçŸ¥ï¼ˆæ”¯å‡ºåœæ­¢æ¤œè¨ï¼‰ |

### Dashboardã®ä½œæˆ

ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚

=== "Azure Portal Dashboard"

    **æ‰‹é †**:
    
    1. Azureãƒãƒ¼ã‚¿ãƒ« â†’ Dashboard
    2. ã€Œæ–°ã—ã„ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ã‚’ä½œæˆ
    3. ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ ï¼š
       - Log Analyticsã‚¯ã‚¨ãƒª
       - ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚°ãƒ©ãƒ•
       - Policyæº–æ‹ çŠ¶æ³
       - ã‚³ã‚¹ãƒˆæ¨ç§»
    
    **å…±æœ‰**:
    
    ```bash title="Dashboardå…±æœ‰"
    # Dashboardã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    az portal dashboard show \
      --name "ALZ-Operations-Dashboard" \
      --resource-group alz-management-rg \
      --output json > dashboard.json
    
    # ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨å…±æœ‰
    az role assignment create \
      --assignee user@example.com \
      --role "Reader" \
      --scope "/subscriptions/<sub-id>/resourceGroups/alz-management-rg/providers/Microsoft.Portal/dashboards/ALZ-Operations-Dashboard"
    ```

=== "Grafanaçµ±åˆ"

    **Azure Managed Grafana**:
    
    ```bash title="Grafanaä½œæˆ"
    az grafana create \
      --name alz-grafana \
      --resource-group alz-management-rg
    
    # Log Analyticsã‚’ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã«è¿½åŠ 
    az grafana data-source create \
      --name alz-grafana \
      --definition '{
        "access": "proxy",
        "type": "grafana-azure-monitor-datasource",
        "jsonData": {
          "subscriptionId": "<sub-id>",
          "logAnalyticsDefaultWorkspace": "<workspace-id>"
        }
      }'
    ```

---

## Part 3: ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®å®Ÿè·µ

### ã‚³ã‚¹ãƒˆåˆ†æã®æ–¹æ³•

ã‚³ã‚¹ãƒˆã‚’åˆ†æã—ã¾ã™ã€‚

=== "Cost Analysisã®æ´»ç”¨"

    **æ‰‹é †**:
    
    1. Azureãƒãƒ¼ã‚¿ãƒ« â†’ Cost Management + Billing
    2. Cost Analysis ã‚’é–‹ã
    3. ã‚¹ã‚³ãƒ¼ãƒ—ã‚’é¸æŠï¼ˆManagement Groupï¼‰
    4. ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼š
       - Resource Groupåˆ¥
       - Serviceåˆ¥
       - Locationåˆ¥
       - Tagåˆ¥

=== "Azure CLI"

    ```bash title="ã‚³ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å–å¾—"
    # ä»Šæœˆã®ã‚³ã‚¹ãƒˆ
    az consumption usage list \
      --start-date $(date '+%Y-%m-01') \
      --end-date $(date '+%Y-%m-%d') \
      --output table
    
    # Serviceåˆ¥é›†è¨ˆ
    az consumption usage list \
      --start-date $(date -d 'last month' '+%Y-%m-01') \
      --end-date $(date '+%Y-%m-01') \
      --output json | \
      jq -r 'group_by(.instanceName) | 
             map({service: .[0].instanceName, 
                  cost: map(.pretaxCost) | add}) | 
             sort_by(-.cost) | 
             .[] | "\(.service),\(.cost)"'
    ```

=== "Power BIçµ±åˆ"

    **Cost Management Connector**:
    
    1. Power BI Desktop ã‚’é–‹ã
    2. Get Data â†’ Azure â†’ Cost Management
    3. Management Groupã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŒ‡å®š
    4. ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ

### ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ã®ã‚³ã‚¹ãƒˆé…è³¦

ã‚¿ã‚°ã‚’ä½¿ã£ã¦ã‚³ã‚¹ãƒˆã‚’é…è³¦ã—ã¾ã™ã€‚

=== "ã‚¿ã‚°æˆ¦ç•¥"

    **å¿…é ˆã‚¿ã‚°**:
    
    - `Environment`: Dev / Test / Prod
    - `CostCenter`: éƒ¨ç½²ã‚³ãƒ¼ãƒ‰
    - `Application`: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å
    - `Owner`: è²¬ä»»è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
    
    ```hcl title="terraform.tfvars"
    default_tags = {
      Environment = "Production"
      CostCenter  = "IT-001"
      Application = "ALZ"
      Owner       = "admin@example.com"
      ManagedBy   = "Terraform"
    }
    ```

=== "ã‚¿ã‚°ãƒãƒªã‚·ãƒ¼"

    ```json title="lib/policy_definitions/Require-Tags.json"
    {
      "name": "Require-Cost-Tags",
      "properties": {
        "displayName": "Require cost allocation tags",
        "policyType": "Custom",
        "mode": "Indexed",
        "policyRule": {
          "if": {
            "anyOf": [
              {
                "field": "tags['Environment']",
                "exists": "false"
              },
              {
                "field": "tags['CostCenter']",
                "exists": "false"
              }
            ]
          },
          "then": {
            "effect": "deny"
          }
        }
      }
    }
    ```

=== "ã‚³ã‚¹ãƒˆé…è³¦ãƒ¬ãƒãƒ¼ãƒˆ"

    ```bash title="ã‚¿ã‚°åˆ¥ã‚³ã‚¹ãƒˆé›†è¨ˆ"
    az consumption usage list \
      --start-date $(date '+%Y-%m-01') \
      --end-date $(date '+%Y-%m-%d') \
      --output json | \
      jq -r '.[] | 
             select(.tags != null) | 
             {costCenter: .tags.CostCenter, 
              environment: .tags.Environment, 
              cost: .pretaxCost} | 
             "\(.costCenter),\(.environment),\(.cost)"' | \
      awk -F, '{arr[$1","$2]+=$3} END {for (i in arr) print i","arr[i]}'
    ```

### æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã®æ¤œå‡º

æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚’ç‰¹å®šã—ã¾ã™ã€‚

=== "æ¤œå‡ºã‚¹ã‚¯ãƒªãƒ—ãƒˆ"

    ```bash title="unused-resources.sh"
    #!/bin/bash
    
    echo "=== æœªä½¿ç”¨Public IP ==="
    az network public-ip list \
      --query "[?ipConfiguration==null].{Name:name, RG:resourceGroup, Location:location}" \
      --output table
    
    echo ""
    echo "=== æœªæ¥ç¶šDisk ==="
    az disk list \
      --query "[?diskState=='Unattached'].{Name:name, RG:resourceGroup, Size:diskSizeGb, Cost:sku.tier}" \
      --output table
    
    echo ""
    echo "=== åœæ­¢ä¸­VMï¼ˆèª²é‡‘ç¶™ç¶šï¼‰ ==="
    az vm list \
      --query "[?powerState=='VM deallocated'].{Name:name, RG:resourceGroup}" \
      --output table
    
    echo ""
    echo "=== å¤ã„Snapshotï¼ˆ90æ—¥ä»¥ä¸Šï¼‰ ==="
    NINETY_DAYS_AGO=$(date -d '90 days ago' '+%Y-%m-%d')
    az snapshot list \
      --query "[?timeCreated<'$NINETY_DAYS_AGO'].{Name:name, RG:resourceGroup, Created:timeCreated}" \
      --output table
    ```

=== "è‡ªå‹•å‰Šé™¤ãƒãƒªã‚·ãƒ¼"

    ```yaml title=".github/workflows/cleanup-resources.yaml"
    name: Cleanup Unused Resources
    
    on:
      schedule:
        - cron: '0 11 * * 0'  # æ¯é€±æ—¥æ›œ 11:00 JST
      workflow_dispatch:
        inputs:
          dry_run:
            description: 'Dry run (true/false)'
            required: false
            default: 'true'
    
    jobs:
      cleanup:
        runs-on: ubuntu-latest
        steps:
          - name: Azure Login
            uses: azure/login@v1
            with:
              client-id: ${{ secrets.AZURE_CLIENT_ID }}
              tenant-id: ${{ secrets.AZURE_TENANT_ID }}
              subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
          
          - name: Delete Unused Public IPs
            run: |
              DRY_RUN="${{ github.event.inputs.dry_run || 'true' }}"
              
              az network public-ip list \
                --query "[?ipConfiguration==null].{Name:name, RG:resourceGroup}" \
                --output json > unused-ips.json
              
              if [ "$DRY_RUN" == "true" ]; then
                echo "Dry run - å‰Šé™¤å¯¾è±¡:"
                cat unused-ips.json
              else
                jq -r '.[] | "\(.Name) \(.RG)"' unused-ips.json | \
                while read name rg; do
                  echo "Deleting: $name in $rg"
                  az network public-ip delete --name "$name" --resource-group "$rg"
                done
              fi
    ```

### Reserved Instancesã®æ´»ç”¨

Reserved Instancesã§ã‚³ã‚¹ãƒˆå‰Šæ¸›ã—ã¾ã™ã€‚

=== "æ¨å¥¨åˆ†æ"

    **Azure Advisor**:
    
    ```bash title="RIæ¨å¥¨ç¢ºèª"
    az advisor recommendation list \
      --category "Cost" \
      --output table
    ```
    
    **å¯¾è±¡ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰**:
    
    - âœ… å¸¸æ™‚ç¨¼åƒVMï¼ˆ24/7ï¼‰
    - âœ… äºˆæ¸¬å¯èƒ½ãªãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰
    - âœ… 1å¹´ä»¥ä¸Šç¶™ç¶šåˆ©ç”¨
    
    **å¯¾è±¡å¤–**:
    
    - âŒ é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒï¼ˆå¤œé–“åœæ­¢ï¼‰
    - âŒ ã‚¹ãƒ‘ã‚¤ã‚¯çš„ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰
    - âŒ çŸ­æœŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

=== "è³¼å…¥è¨ˆç”»"

    | VM Size | å°æ•° | åˆ©ç”¨ç‡ | RIæ¨å¥¨ | ç¯€ç´„é¡/å¹´ |
    |---------|------|--------|--------|----------|
    | Standard_D2s_v3 | 10 | 100% | âœ… Yes | $2,500 |
    | Standard_D4s_v3 | 5 | 100% | âœ… Yes | $2,000 |
    | Standard_B2s | 3 | 60% | âŒ No | - |

### ã‚³ã‚¹ãƒˆå‰Šæ¸›æ–½ç­–

å…·ä½“çš„ãªã‚³ã‚¹ãƒˆå‰Šæ¸›æ–½ç­–ã§ã™ã€‚

=== "å³åŠ¹æ€§ã®ã‚ã‚‹æ–½ç­–"

    **1. æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤**:
    
    - Public IP: å‰Šé™¤ã§æœˆé¡$3ã€œ5/å€‹
    - Unattached Disk: å‰Šé™¤ã§ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆå‰Šæ¸›
    - å¤ã„Snapshot: å‰Šé™¤ã§ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆå‰Šæ¸›
    
    **2. VMã‚µã‚¤ã‚ºã®æœ€é©åŒ–**:
    
    ```bash title="ä½¿ç”¨ç‡ã®ä½ã„VMç¢ºèª"
    az monitor metrics list \
      --resource <vm-id> \
      --metric "Percentage CPU" \
      --start-time $(date -u -d '7 days ago' '+%Y-%m-%dT%H:%M:%SZ') \
      --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ') \
      --interval PT1H \
      --aggregation Average
    ```
    
    CPUä½¿ç”¨ç‡ãŒå¸¸ã«20%ä»¥ä¸‹ãªã‚‰ã‚µã‚¤ã‚ºãƒ€ã‚¦ãƒ³æ¤œè¨ã€‚
    
    **3. é–‹ç™ºç’°å¢ƒã®å¤œé–“åœæ­¢**:
    
    ```bash title="å¤œé–“åœæ­¢ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«"
    # Auto-shutdownè¨­å®š
    az vm auto-shutdown \
      --resource-group dev-rg \
      --name dev-vm \
      --time 1900 \
      --timezone "Tokyo Standard Time"
    ```

=== "ä¸­é•·æœŸæ–½ç­–"

    **1. Reserved Instancesè³¼å…¥**:
    
    - 1å¹´RI: æœ€å¤§40%å‰²å¼•
    - 3å¹´RI: æœ€å¤§60%å‰²å¼•
    
    **2. Azure Hybrid Benefit**:
    
    - Windows Server: æ—¢å­˜ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ´»ç”¨ã§æœ€å¤§40%å‰Šæ¸›
    - SQL Server: æœ€å¤§55%å‰Šæ¸›
    
    ```bash title="Hybrid Benefitæœ‰åŠ¹åŒ–"
    az vm update \
      --resource-group prod-rg \
      --name prod-vm \
      --license-type Windows_Server
    ```
    
    **3. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸éšå±¤ã®æœ€é©åŒ–**:
    
    - Hot â†’ Cool: 90æ—¥ä»¥ä¸Šã‚¢ã‚¯ã‚»ã‚¹ãªã—
    - Cool â†’ Archive: 180æ—¥ä»¥ä¸Šã‚¢ã‚¯ã‚»ã‚¹ãªã—

---

## Part 4: é‹ç”¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®ãƒ¬ãƒ“ãƒ¥ãƒ¼

å®šæœŸçš„ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¾ã™ã€‚

=== "Azure Security Center"

    **Secure Scoreç¢ºèª**:
    
    ```bash title="Secure Scoreå–å¾—"
    az security secure-score-controls list \
      --output table
    ```
    
    **æ¨å¥¨äº‹é …ã®ç¢ºèª**:
    
    ```bash title="æ¨å¥¨äº‹é …ä¸€è¦§"
    az security assessment list \
      --query "[?status.code=='Unhealthy'].{Name:displayName, Severity:status.severity}" \
      --output table
    ```

=== "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ"

    **å››åŠæœŸã”ã¨ã«ç¢ºèª**:
    
    - [ ] Secure ScoreãŒ80ç‚¹ä»¥ä¸Šã‹
    - [ ] é‡å¤§ãªæ¨å¥¨äº‹é …ãŒãªã„ã‹
    - [ ] ä¸è¦ãªPublic IPãŒå…¬é–‹ã•ã‚Œã¦ã„ãªã„ã‹
    - [ ] NSGãƒ«ãƒ¼ãƒ«ãŒé©åˆ‡ã‹
    - [ ] Firewallãƒ«ãƒ¼ãƒ«ãŒæœ€å°æ¨©é™ã‹
    - [ ] ä¸è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ãŒãªã„ã‹
    - [ ] MFAãŒå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§æœ‰åŠ¹ã‹
    - [ ] ç›£æŸ»ãƒ­ã‚°ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹ã‹

### IaCã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

Infrastructure as Codeã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ã€‚

=== "ã‚³ãƒ¼ãƒ‰å“è³ª"

    **å¿…é ˆäº‹é …**:
    
    - âœ… terraform fmt ã§æ•´å½¢
    - âœ… terraform validate ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    - âœ… tflint ã§ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°
    - âœ… ã‚³ãƒ¡ãƒ³ãƒˆã§æ„å›³ã‚’æ˜ç¢ºåŒ–
    - âœ… å¤‰æ•°ã®descriptionã‚’è¨˜è¼‰
    
    ```hcl title="è‰¯ã„ä¾‹"
    variable "hub_address_space" {
      description = "Hub VNetã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã€‚/16æ¨å¥¨ã€‚"
      type        = list(string)
      default     = ["10.0.0.0/16"]
      
      validation {
        condition     = can(cidrhost(var.hub_address_space[0], 0))
        error_message = "æœ‰åŠ¹ãªCIDRå½¢å¼ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚"
      }
    }
    ```

=== "Stateç®¡ç†"

    **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**:
    
    - âœ… Remote Backendã‚’ä½¿ç”¨ï¼ˆAzure Storageï¼‰
    - âœ… State Lockingã‚’æœ‰åŠ¹åŒ–
    - âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å®šæœŸå–å¾—
    - âœ… æ‰‹å‹•ç·¨é›†ã—ãªã„
    - âœ… ãƒãƒ¼ãƒ ã§Stateã‚’å…±æœ‰
    
    ```bash title="Stateãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—"
    # å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    terraform state pull > backup-$(date +%Y%m%d-%H%M%S).tfstate
    ```

=== "ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ"

    **è¨­è¨ˆåŸå‰‡**:
    
    - å˜ä¸€è²¬ä»»: 1ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«1æ©Ÿèƒ½
    - å†åˆ©ç”¨å¯èƒ½: æ±ç”¨çš„ã«è¨­è¨ˆ
    - ãƒ†ã‚¹ãƒˆå¯èƒ½: å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿæ–½
    - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–: README.mdå¿…é ˆ
    
    ```text title="ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ ä¾‹"
    modules/
      spoke-vnet/
        main.tf          # ãƒªã‚½ãƒ¼ã‚¹å®šç¾©
        variables.tf     # å…¥åŠ›å¤‰æ•°
        outputs.tf       # å‡ºåŠ›å€¤
        README.md        # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
        examples/        # ä½¿ç”¨ä¾‹
          basic/
            main.tf
    ```

### ãƒãƒ¼ãƒ å”åƒã®æ”¹å–„

ãƒãƒ¼ãƒ ã§ã®å”åƒã‚’æ”¹å–„ã—ã¾ã™ã€‚

=== "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ–‡åŒ–"

    **å¿…é ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
    
    - [ ] README.mdï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ï¼‰
    - [ ] ARCHITECTURE.mdï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ï¼‰
    - [ ] OPERATIONS.mdï¼ˆé‹ç”¨æ‰‹é †ï¼‰
    - [ ] TROUBLESHOOTING.mdï¼ˆãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
    - [ ] CHANGELOG.mdï¼ˆå¤‰æ›´å±¥æ­´ï¼‰
    
    ```markdown title="README.md ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"
    # Azure Landing Zones
    
    ## æ¦‚è¦
    
    ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯Azure Landing Zonesã®æ§‹æˆã‚’ç®¡ç†ã—ã¾ã™ã€‚
    
    ## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
    
    [ARCHITECTURE.md](ARCHITECTURE.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
    
    ## ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
    
    [Chapter 14](docs-site/docs/14_Bootstrap_Phase_1.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
    
    ## é‹ç”¨æ‰‹é †
    
    [OPERATIONS.md](OPERATIONS.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
    
    ## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    
    [TROUBLESHOOTING.md](TROUBLESHOOTING.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
    ```

=== "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼åŸºæº–"

    **ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
    
    - [ ] ã‚³ãƒ¼ãƒ‰ãŒæ•´å½¢ã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆterraform fmtï¼‰
    - [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒé€šã‚‹ã‹ï¼ˆterraform validateï¼‰
    - [ ] Planå‡ºåŠ›ã‚’ç¢ºèªã—ãŸã‹
    - [ ] æ„å›³ã—ãªã„å¤‰æ›´ãŒãªã„ã‹
    - [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã‹
    - [ ] ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‹
    - [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãŒãªã„ã‹
    
    **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆä¾‹**:
    
    ```markdown
    ## ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ
    
    âœ… Planç¢ºèªã—ã¾ã—ãŸã€‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
    
    ### æ°—ã«ãªã£ãŸç‚¹
    
    - SubnetåãŒ `subnet1` ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã€ç”¨é€”ãŒã‚ã‹ã‚‹åå‰ã«ã—ã¾ã›ã‚“ã‹ï¼Ÿ
      ä¾‹: `app-subnet`, `data-subnet`
    
    ### ææ¡ˆ
    
    - Route Tableã®è¨­å®šã‚‚ä¸€ç·’ã«PRã«å«ã‚ãŸæ–¹ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚
    ```

=== "ãƒŠãƒ¬ãƒƒã‚¸å…±æœ‰"

    **å®šæœŸãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°**:
    
    - é€±æ¬¡: é‹ç”¨ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¼šï¼ˆ30åˆ†ï¼‰
      - å…ˆé€±ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
      - ä»Šé€±ã®äºˆå®šå¤‰æ›´
      - æ°—ã«ãªã£ãŸç‚¹ã®å…±æœ‰
    
    - æœˆæ¬¡: ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ï¼ˆ1æ™‚é–“ï¼‰
      - æ–°æ©Ÿèƒ½ã®ç´¹ä»‹
      - ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®å…±æœ‰
      - æ”¹å–„ææ¡ˆã®è­°è«–
    
    **ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹**:
    
    - GitHub Wiki
    - Confluence
    - Notion
    
    ã‚ˆãã‚ã‚‹è³ªå•ã€ãƒˆãƒ©ãƒ–ãƒ«äº‹ä¾‹ã€TIPSã‚’è“„ç©ã€‚

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æœ€æ–°ã«ä¿ã¡ã¾ã™ã€‚

=== "æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°"

    **å³åº§ã«æ›´æ–°**:
    
    - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´æ™‚
    - é‹ç”¨æ‰‹é †å¤‰æ›´æ™‚
    - ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œå¾Œï¼ˆäº‹ä¾‹è¿½åŠ ï¼‰
    
    **å®šæœŸæ›´æ–°**:
    
    - å››åŠæœŸã”ã¨: å…¨ä½“ãƒ¬ãƒ“ãƒ¥ãƒ¼
    - åŠæœŸã”ã¨: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ›´æ–°
    - å¹´æ¬¡: å¤§è¦æ¨¡æ”¹è¨‚

=== "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼"

    ```markdown title="ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ"
    ## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼ - 2026 Q1
    
    ### README.md
    - [x] æœ€æ–°ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³
    - [x] ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ãŒæ­£ç¢º
    - [ ] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ›´æ–°ï¼ˆå¤ã„ç”»é¢ã‚ã‚Šï¼‰
    
    ### OPERATIONS.md
    - [x] é‹ç”¨æ‰‹é †ãŒæœ€æ–°
    - [x] æ–°ã—ã„ã‚¿ã‚¹ã‚¯è¿½åŠ æ¸ˆã¿
    - [x] å•é¡Œãªã—
    
    ### TROUBLESHOOTING.md
    - [x] æœ€è¿‘ã®ãƒˆãƒ©ãƒ–ãƒ«äº‹ä¾‹è¿½åŠ 
    - [ ] å¤ã„æƒ…å ±ã®å‰Šé™¤ãŒå¿…è¦
    
    ### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
    - ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ›´æ–°ã™ã‚‹ï¼ˆæ‹…å½“: å±±ç”°ï¼‰
    - å¤ã„æƒ…å ±ã‚’å‰Šé™¤ã™ã‚‹ï¼ˆæ‹…å½“: ä½è—¤ï¼‰
    ```

### å®šæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å®Ÿæ–½

å®šæœŸçš„ã«ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¾ã™ã€‚

=== "æœˆæ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼"

    **ãƒã‚§ãƒƒã‚¯é …ç›®**:
    
    - [ ] Policyæº–æ‹ çŠ¶æ³ï¼ˆç›®æ¨™: 95%ä»¥ä¸Šï¼‰
    - [ ] ã‚³ã‚¹ãƒˆçŠ¶æ³ï¼ˆäºˆç®—å†…ã‹ï¼‰
    - [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢ï¼ˆç›®æ¨™: 80ç‚¹ä»¥ä¸Šï¼‰
    - [ ] ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆä»¶æ•°ï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰ç¢ºèªï¼‰
    - [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆåŠŸç‡ï¼ˆç›®æ¨™: 100%ï¼‰
    
    **ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ**:
    
    ```markdown title="æœˆæ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ"
    # æœˆæ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ - 2026å¹´1æœˆ
    
    ## ã‚µãƒãƒªãƒ¼
    
    - Policyæº–æ‹ ç‡: 97% âœ…
    - ã‚³ã‚¹ãƒˆ: äºˆç®—ã®85% âœ…
    - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢: 83ç‚¹ âœ…
    - ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ: 2ä»¶ï¼ˆå‰æœˆæ¯” -1ï¼‰
    - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆåŠŸç‡: 100% âœ…
    
    ## è©³ç´°
    
    ### Policyæº–æ‹ 
    - éæº–æ‹ ãƒªã‚½ãƒ¼ã‚¹: 5ä»¶
    - ä¸»ãªåŸå› : ã‚¿ã‚°æœªè¨­å®š
    - ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ã‚¿ã‚°ãƒãƒªã‚·ãƒ¼ã‚’å¼·åŒ–
    
    ### ã‚³ã‚¹ãƒˆ
    - ç·é¡: $42,500ï¼ˆäºˆç®—: $50,000ï¼‰
    - å‰Šæ¸›æ–½ç­–: æœªä½¿ç”¨Public IPå‰Šé™¤ã§$50/æœˆå‰Šæ¸›
    
    ### ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
    1. Firewall SNATæ¯æ¸‡ï¼ˆå½±éŸ¿: è»½å¾®ï¼‰
       - å¯¾å¿œ: ãƒ«ãƒ¼ãƒ«æœ€é©åŒ–
    2. VMãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¤±æ•—ï¼ˆå½±éŸ¿: ãªã—ï¼‰
       - å¯¾å¿œ: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå†èµ·å‹•
    
    ## æ¬¡æœˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³
    - [ ] Reserved Instancesè³¼å…¥æ¤œè¨
    - [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½
    - [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
    ```

=== "å››åŠæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼"

    **ãƒã‚§ãƒƒã‚¯é …ç›®**:
    
    - [ ] ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è¦‹ç›´ã—
    - [ ] ãƒãƒªã‚·ãƒ¼ã®æœ‰åŠ¹æ€§è©•ä¾¡
    - [ ] ã‚³ã‚¹ãƒˆæœ€é©åŒ–æ–½ç­–ã®åŠ¹æœæ¸¬å®š
    - [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
    - [ ] DRè¨“ç·´ã®å®Ÿæ–½
    - [ ] ãƒãƒ¼ãƒ ã‚¹ã‚­ãƒ«ã®è©•ä¾¡
    
    **æ”¹å–„è¨ˆç”»**:
    
    ```markdown
    # å››åŠæœŸæ”¹å–„è¨ˆç”» - 2026 Q2
    
    ## ç›®æ¨™
    
    1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢ã‚’90ç‚¹ä»¥ä¸Šã«å‘ä¸Š
    2. ã‚³ã‚¹ãƒˆã‚’10%å‰Šæ¸›
    3. ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ™‚é–“ã‚’50%çŸ­ç¸®
    
    ## æ–½ç­–
    
    ### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Š
    - [ ] MFAå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼é©ç”¨ï¼ˆ4æœˆï¼‰
    - [ ] JIT Accesså°å…¥ï¼ˆ5æœˆï¼‰
    - [ ] è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³è‡ªå‹•åŒ–ï¼ˆ6æœˆï¼‰
    
    ### ã‚³ã‚¹ãƒˆå‰Šæ¸›
    - [ ] RIè³¼å…¥ï¼ˆ4æœˆï¼‰
    - [ ] æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹è‡ªå‹•å‰Šé™¤ï¼ˆ5æœˆï¼‰
    - [ ] ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸éšå±¤æœ€é©åŒ–ï¼ˆ6æœˆï¼‰
    
    ### é‹ç”¨åŠ¹ç‡åŒ–
    - [ ] Runbookæ•´å‚™ï¼ˆ4-6æœˆï¼‰
    - [ ] ã‚¢ãƒ©ãƒ¼ãƒˆè‡ªå‹•å¯¾å¿œï¼ˆ5-6æœˆï¼‰
    - [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ”¹å–„ï¼ˆ6æœˆï¼‰
    ```

---

## ã¾ã¨ã‚

ã“ã®ç« ã§å­¦ã‚“ã ã“ã¨ï¼š

### âœ… Part 1: é‹ç”¨è‡ªå‹•åŒ–ã®è¨­è¨ˆ

- è‡ªå‹•åŒ–ã™ã¹ãã‚¿ã‚¹ã‚¯ã®é¸å®š
- GitHub Actionsã§ã®è‡ªå‹•åŒ–
- Scheduled Workflowã®æ´»ç”¨
- Slacké€šçŸ¥ã®çµ±åˆ
- è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

### âœ… Part 2: ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ

- Log Analyticsã®æ´»ç”¨
- Azure Monitorã®è¨­å®š
- Policyé•åã®ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
- ã‚³ã‚¹ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®š
- Dashboardã®ä½œæˆ

### âœ… Part 3: ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®å®Ÿè·µ

- ã‚³ã‚¹ãƒˆåˆ†æã®æ–¹æ³•
- ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ã®ã‚³ã‚¹ãƒˆé…è³¦
- æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã®æ¤œå‡º
- Reserved Instancesã®æ´»ç”¨
- ã‚³ã‚¹ãƒˆå‰Šæ¸›æ–½ç­–

### âœ… Part 4: é‹ç”¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®ãƒ¬ãƒ“ãƒ¥ãƒ¼
- IaCã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- ãƒãƒ¼ãƒ å”åƒã®æ”¹å–„
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
- å®šæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å®Ÿæ–½

## ç·´ç¿’å•é¡Œ

ç†è§£åº¦ãƒã‚§ãƒƒã‚¯ã§ã™ã€‚ä¼‘æ†©ä¸­ã«è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### å•é¡Œ1
Azure Monitorã§ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹éš›ã€  
é€šçŸ¥å…ˆã¨ã—ã¦è¨­å®šã§ãã‚‹ã‚‚ã®ã¯ä½•ã§ã™ã‹ï¼Ÿï¼ˆ3ã¤ç­”ãˆã¦ãã ã•ã„ï¼‰

### å•é¡Œ2
ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ãŸã‚ã«ç¢ºèªã™ã¹ããƒªã‚½ãƒ¼ã‚¹ã¯ä½•ã§ã™ã‹ï¼Ÿ

### å•é¡Œ3
Scheduled Workflowã‚’ä½¿ã£ã¦è‡ªå‹•åŒ–ã§ãã‚‹é‹ç”¨ã‚¿ã‚¹ã‚¯ã‚’2ã¤æŒ™ã’ã¦ãã ã•ã„ã€‚

---

## ç·´ç¿’å•é¡Œã®ç­”ãˆ

### ç­”ãˆ1
1. **Email**ï¼ˆãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼‰
2. **Logic Apps**ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼‰
3. **Webhook**ï¼ˆSlackã€Teamsç­‰ã¸ã®é€šçŸ¥ï¼‰

ãã®ä»–:
- **SMS**ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
- **Voice**ï¼ˆéŸ³å£°é€šè©±ï¼‰
- **Azure Mobile App**ï¼ˆãƒ¢ãƒã‚¤ãƒ«é€šçŸ¥ï¼‰

è¨­å®šä¾‹:
```hcl
resource "azurerm_monitor_action_group" "alerts" {
  name                = "action-group-alerts"
  resource_group_name = azurerm_resource_group.management.name
  short_name          = "alerts"

  email_receiver {
    name          = "admin"
    email_address = "admin@example.com"
  }

  webhook_receiver {
    name        = "slack"
    service_uri = "https://hooks.slack.com/services/xxx"
  }
}
```

### ç­”ãˆ2

1. **ä½¿ã‚ã‚Œã¦ã„ãªã„ãƒªã‚½ãƒ¼ã‚¹**
   - å‰Šé™¤ã—å¿˜ã‚ŒãŸVMã€Disk
   - æœªå‰²ã‚Šå½“ã¦ã®Public IP
   - æœªä½¿ç”¨ã®Storage Account

2. **éå‰°ã‚¹ãƒšãƒƒã‚¯ã®ãƒªã‚½ãƒ¼ã‚¹**
   - VM ã‚µã‚¤ã‚ºï¼ˆStandard_D16s â†’ Standard_D4sï¼‰
   - Log Analytics ä¿æŒæœŸé–“ï¼ˆ365æ—¥ â†’ 90æ—¥ï¼‰
   - Firewall SKUï¼ˆPremium â†’ Standardï¼‰

3. **äºˆç´„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§å‰²å¼•å¯èƒ½ãªãƒªã‚½ãƒ¼ã‚¹**
   - é•·æœŸé‹ç”¨ã®VM
   - Log Analytics Commitment Tier

Azure Cost Management + Billingã§ç¢ºèª:
```
Cost analysis â†’ Resource â†’ æœ€ã‚‚ã‚³ã‚¹ãƒˆãŒã‹ã‹ã£ã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹
Advisor â†’ Cost recommendations â†’ ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®æ¨å¥¨äº‹é …
```

### ç­”ãˆ3

1. **å®šæœŸçš„ãªã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯**
   ```yaml
   on:
     schedule:
       - cron: '0 9 * * 1'  # æ¯é€±æœˆæ›œ 9æ™‚
   
   jobs:
     compliance:
       runs-on: ubuntu-latest
       steps:
         - name: Check Policy Compliance
           run: |
             az policy state list --resource-group rg-management-jp
   ```

2. **æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**
   ```yaml
   on:
     schedule:
       - cron: '0 0 1 * *'  # æ¯æœˆ1æ—¥ 0æ™‚
   
   jobs:
     unused-resources:
       runs-on: ubuntu-latest
       steps:
         - name: List unused resources
           run: |
             # æœªå‰²ã‚Šå½“ã¦ã®Public IP
             az network public-ip list --query "[?ipConfiguration==null]"
             
             # åœæ­¢ä¸­ã®VM
             az vm list --query "[?powerState=='VM stopped']"
   ```

ãã®ä»–ã®ä¾‹:
- State Lockã®è‡ªå‹•è§£é™¤
- ãƒ­ã‚°ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¤œè¨¼

!!! success "æ•™ç§‘æ›¸å®Œäº†"
    ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ã“ã‚Œã§Azure Landing Zonesã®æ§‹ç¯‰ã‹ã‚‰é‹ç”¨ã¾ã§ã€ã™ã¹ã¦ã‚’å­¦ã³ã¾ã—ãŸã€‚
    
    å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚
