# 02. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€  - ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã®å…¨ä½“åƒ

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®é³¥ç°å›³

ã¾ãšã€å…¨ä½“ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```text title="ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®é³¥ç°å›³"
alz-mgmt/
â”œâ”€â”€ ğŸ“ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚ãªãŸãŒç·¨é›†ã™ã‚‹ï¼‰
â”‚   â”œâ”€â”€ platform-landing-zone.auto.tfvars  â† ãƒ¡ã‚¤ãƒ³è¨­å®šï¼ˆã“ã“ã ã‘è§¦ã‚Œã°OKï¼‰
â”‚   â”œâ”€â”€ terraform.tfvars.json              â† ç§˜å¯†æƒ…å ±ï¼ˆGitç®¡ç†å¤–ï¼‰
â”‚   â””â”€â”€ terraform.tf                       â† Terraformè‡ªä½“ã®è¨­å®š
â”‚
â”œâ”€â”€ ğŸ¯ å¤‰æ•°å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå¤‰æ•°ã®å‹ã‚’å®šç¾©ï¼‰
â”‚   â”œâ”€â”€ variables.tf                                      â† å…±é€šå¤‰æ•°
â”‚   â”œâ”€â”€ variables.connectivity.tf                         â† æ¥ç¶šé–¢é€£
â”‚   â”œâ”€â”€ variables.connectivity.hub.and.spoke.virtual.network.tf
â”‚   â”œâ”€â”€ variables.connectivity.virtual.wan.tf
â”‚   â”œâ”€â”€ variables.management.tf                           â† ç®¡ç†é–¢é€£
â”‚   â””â”€â”€ variables.moved.tf                                â† å¾Œæ–¹äº’æ›ç”¨
â”‚
â”œâ”€â”€ ğŸ”§ ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ï¼ˆè¨ˆç®—æ¸ˆã¿ã®å€¤ï¼‰
â”‚   â””â”€â”€ locals.tf                          â† å¤‰æ•°ã‚’åŠ å·¥ã—ãŸå€¤
â”‚
â”œâ”€â”€ ğŸš€ ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå®Ÿéš›ã®å‡¦ç†ï¼‰
â”‚   â”œâ”€â”€ main.config.tf                                    â† è¨­å®šå‡¦ç†
â”‚   â”œâ”€â”€ main.resource.groups.tf                           â† ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
â”‚   â”œâ”€â”€ main.management.tf                                â† ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ãƒ»ãƒãƒªã‚·ãƒ¼
â”‚   â”œâ”€â”€ main.connectivity.hub.and.spoke.virtual.network.tf â† Hub-Spokeãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
â”‚   â””â”€â”€ main.connectivity.virtual.wan.tf                  â† Virtual WAN
â”‚
â”œâ”€â”€ ğŸ“¤ å‡ºåŠ›å®šç¾©ï¼ˆä½œã£ãŸãƒªã‚½ãƒ¼ã‚¹ã®æƒ…å ±ã‚’å‡ºåŠ›ï¼‰
â”‚   â”œâ”€â”€ outputs.tf                         â† å‡ºåŠ›å®šç¾©
â”‚   â””â”€â”€ outputs.moved.tf                   â† å¾Œæ–¹äº’æ›ç”¨
â”‚
â”œâ”€â”€ ğŸ“¦ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆå†åˆ©ç”¨å¯èƒ½ãªéƒ¨å“ï¼‰
â”‚   â”œâ”€â”€ config-templating/                 â† è¨­å®šã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†
â”‚   â”œâ”€â”€ management_groups/                 â† ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ãƒ»ãƒãƒªã‚·ãƒ¼
â”‚   â””â”€â”€ management_resources/              â† Log Analyticsç­‰
â”‚
â”œâ”€â”€ ğŸ“š ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆãƒãƒªã‚·ãƒ¼å®šç¾©ã®YAMLï¼‰
â”‚   â”œâ”€â”€ alz_library_metadata.json
â”‚   â”œâ”€â”€ archetype_definitions/             â† ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã®ç¨®é¡
â”‚   â””â”€â”€ architecture_definitions/          â† å…¨ä½“æ§‹æˆ
â”‚
â”œâ”€â”€ ğŸ¤– CI/CDï¼ˆè‡ªå‹•åŒ–ï¼‰
â”‚   â””â”€â”€ .github/
â”‚       â””â”€â”€ workflows/
â”‚           â””â”€â”€ cd.yaml                    â† GitHub Actionsè¨­å®š
â”‚
â””â”€â”€ ğŸ“– ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”œâ”€â”€ README.md                          â† å…ƒã®èª¬æ˜æ›¸
    â”œâ”€â”€ README_STORY.md                    â† ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç‰ˆèª¬æ˜æ›¸
    â””â”€â”€ docs/                              â† ã“ã®ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆæ•™ç§‘æ›¸ï¼‰
```

## ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã¨ã‚³ãƒ¼ãƒ‰é‡

å…¨ä½“ã§ï¼š

- Terraformãƒ•ã‚¡ã‚¤ãƒ«: ç´„20å€‹
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ãƒ•ã‚¡ã‚¤ãƒ«: ç´„10å€‹
- YAMLãƒ•ã‚¡ã‚¤ãƒ«: ç´„10å€‹
- ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•°: ç´„3,000è¡Œ

ä¸€è¦‹å¤šãã†ã§ã™ãŒã€å®Ÿã¯æ•´ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

**ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®é–¢ä¿‚å›³**

```text title="ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ"
ã€è¨­å®šå±¤ã€‘
platform-landing-zone.auto.tfvars â†â”€â” ã‚ãªãŸãŒç·¨é›†
terraform.tfvars.json            â†â”€â”¤ ã™ã‚‹éƒ¨åˆ†
                                    â”‚
        â†“ èª­ã¿è¾¼ã¿                  â”‚
                                    â”‚
ã€å¤‰æ•°å®šç¾©å±¤ã€‘                      â”‚
variables.tf                        â”‚
variables.*.tf                      â”‚
        â†“                           â”‚
                                    â”‚
ã€åŠ å·¥å±¤ã€‘                          â”‚
locals.tf â† è¨ˆç®—ãƒ»å¤‰æ›              â”‚
        â†“                           â”‚
                                    â”‚
ã€å‡¦ç†å±¤ã€‘                          â”‚
main.*.tf â† å®Ÿéš›ã®å‡¦ç†              â”‚
        â†“                           â”‚
        â”œâ†’ modules/config-templating  â† è¨­å®šã®åŠ å·¥
        â”œâ†’ modules/management_groups  â† ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
        â””â†’ modules/management_resources â† ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
                â†“                   â”‚
                                    â”‚
ã€å‡ºåŠ›å±¤ã€‘                          â”‚
outputs.tf â† ä½œæˆçµæœ               â”‚
        â†“                           â”‚
        è¡¨ç¤ºãƒ»ä»–ã®Terraformã§åˆ©ç”¨    â”‚
                                    â”‚
        â†“                           â”‚
ã€å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã€‘                    â”‚
lib/archetype_definitions/ â†â”€â”€â”€â”€â”€â”€â”€â”˜ ãƒãƒªã‚·ãƒ¼å®šç¾©
lib/architecture_definitions/        éšå±¤å®šç¾©
```

**ğŸ”„ å®Ÿéš›ã®å‡¦ç†ã®æµã‚Œ**

```text title="å‡¦ç†ãƒ•ãƒ­ãƒ¼"
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†
   â†“
   platform-landing-zone.auto.tfvars
   starter_locations = ["japaneast"]
   
2. å¤‰æ•°å®šç¾©ã§å‹ãƒã‚§ãƒƒã‚¯
   â†“
   variables.tf
   variable "starter_locations" {
     type = list(string)
   }
   
3. localsã§åŠ å·¥
   â†“
   locals.tf
   starter_location_01 = "japaneast"
   
4. moduleã§å‡¦ç†
   â†“
   modules/config-templating
   ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã‚’å±•é–‹
   
5. mainã§å®Ÿè¡Œ
   â†“
   main.management.tf
   å®Ÿéš›ã«ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
   
6. outputã§çµæœå‡ºåŠ›
   â†“
   outputs.tf
   ä½œæˆã—ãŸãƒªã‚½ãƒ¼ã‚¹ã®IDãªã©
```

---

## Part 1: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŸã¡

### platform-landing-zone.auto.tfvars

**å½¹å‰²**: ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚¤ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«  
**ç·¨é›†**: âœ… ã‚ãªãŸãŒç·¨é›†ã™ã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜…

```hcl title="platform-landing-zone.auto.tfvars"
starter_locations = ["japaneast", "japanwest"]

custom_replacements = {
  names = {
    primary_firewall_enabled = true
    # ...500è¡Œãã‚‰ã„ç¶šã
  }
}
```

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ç·¨é›†ã™ã‚Œã°ã€ã»ã¨ã‚“ã©ã®è¨­å®šãŒå¤‰æ›´ã§ãã¾ã™ã€‚

**ãªãœ`.auto.tfvars`ï¼Ÿ**
- `.tfvars`ã ã¨`terraform apply -var-file=xxx.tfvars`ã£ã¦æŒ‡å®šãŒå¿…è¦
- `.auto.tfvars`ã¯è‡ªå‹•ã§èª­ã¿è¾¼ã¾ã‚Œã‚‹
- æ¥½ã ã‹ã‚‰`.auto`ã‚’ã¤ã‘ã¦ã‚‹

### terraform.tfvars.json

**å½¹å‰²**: ç§˜å¯†æƒ…å ±ï¼ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³IDã¨ã‹ï¼‰  
**ç·¨é›†**: âœ… æœ€åˆã ã‘ç·¨é›†ã™ã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜†

```json title="terraform.tfvars.json"
{
  "subscription_ids": {
    "management": "ã‚ãªãŸã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID",
    "connectivity": "ã‚ãªãŸã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID",
    "identity": "ã‚ãªãŸã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID"
  }
}
```

**ãªãœJSONå½¢å¼ï¼Ÿ**
- HCLã‚ˆã‚Šæ©Ÿæ¢°çš„ã«ç”Ÿæˆã—ã‚„ã™ã„
- CI/CDã§å‹•çš„ã«ä½œã‚Šã‚„ã™ã„

**æ³¨æ„**: `.gitignore`ã«å…¥ã£ã¦ã‚‹ï¼ˆGitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œãªã„ï¼‰

### terraform.tf

**å½¹å‰²**: Terraformè‡ªä½“ã®è¨­å®š  
**ç·¨é›†**: âŒ åŸºæœ¬è§¦ã‚‰ãªã„  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜†â˜†

```hcl title="terraform.tf"
terraform {
  required_version = "~> 1.12"
  
  required_providers {
    alz = {
      source  = "Azure/alz"
      version = "0.20.0"
    }
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 4.0"
    }
  }
  
  backend "azurerm" {}
}
```

#### required_version
```hcl
required_version = "~> 1.12"
```
Terraform 1.12.x ã˜ã‚ƒãªã„ã¨å‹•ã‹ãªã„å®£è¨€ã€‚

#### required_providers
ä½¿ã†ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã€‚

**ãªãœ`~> 4.0`ï¼Ÿ**
- `~>` = äº’æ›æ€§ã®ã‚ã‚‹ç¯„å›²ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—OK
- `4.0` = 4.0.x, 4.1.x, 4.99.x ã¯OKã€5.0.x ã¯NG
- ãƒã‚°ä¿®æ­£ã¯å—ã‘å–ã‚ŠãŸã„ã‘ã©ã€ç ´å£Šçš„å¤‰æ›´ã¯é¿ã‘ãŸã„

#### backend
```hcl
backend "azurerm" {}
```
çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`terraform.tfstate`ï¼‰ã‚’Azure Storageã«ä¿å­˜ã€‚

`{}`ãŒç©ºãªã®ã¯ã€å®Ÿè¡Œæ™‚ã«æŒ‡å®šã™ã‚‹ã‹ã‚‰ï¼š
```bash title="backendã®åˆæœŸåŒ–"
terraform init \
  -backend-config="resource_group_name=rg-tfstate" \
  -backend-config="storage_account_name=stotfstate" \
  -backend-config="container_name=tfstate" \
  -backend-config="key=terraform.tfstate"
```

GitHub Actionsã§ã“ã®æŒ‡å®šã‚’ã‚„ã£ã¦ã¾ã™ã€‚

---

## Part 2: å¤‰æ•°å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ãŸã¡

### å¤‰æ•°å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²

Terraformã®å¤‰æ•°ã«ã¯å‹ãŒã‚ã‚Šã¾ã™ã€‚

```hcl title="å¤‰æ•°å®šç¾©ã®ä¾‹"
# variables.tf
variable "location" {
  type        = string           # å‹ã¯æ–‡å­—åˆ—
  description = "Azure region"   # èª¬æ˜
  default     = "japaneast"      # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
}
```

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€Œã©ã‚“ãªå¤‰æ•°ã‚’å—ã‘å–ã‚‹ã‹ã€ã‚’å®šç¾©ã—ã¾ã™ã€‚

### variables.tfï¼ˆãƒ¡ã‚¤ãƒ³å¤‰æ•°ï¼‰

**å½¹å‰²**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ä½¿ã†å…±é€šå¤‰æ•°  
**ç·¨é›†**: âŒ è§¦ã‚‰ãªã„  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜†â˜†

```hcl title="variables.tfã®ä¸»è¦å¤‰æ•°"
variable "starter_locations" {
  type = list(string)
  description = <<DESCRIPTION
The locations to use for the starter module.
The first location in the list is used as the primary location.
DESCRIPTION
}

variable "custom_replacements" {
  type = object({
    names                      = map(string)
    resource_group_identifiers = map(string)
    resource_identifiers       = map(string)
  })
  description = "Custom replacements for the configuration."
}
```

#### list(string)å‹
```hcl
starter_locations = ["japaneast", "japanwest"]
```
æ–‡å­—åˆ—ã®ãƒªã‚¹ãƒˆã€‚ä½•å€‹ã§ã‚‚OKã€‚

#### objectå‹
```hcl
custom_replacements = {
  names = {
    firewall_name = "fw-hub"
  }
  resource_group_identifiers = {
    # ...
  }
}
```
æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã€‚JavaScriptã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¿ãŸã„ãªã‚‚ã®ã€‚

### variables.connectivity.tfï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¤‰æ•°ï¼‰

**å½¹å‰²**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–¢é€£ã®å¤‰æ•°å®šç¾©  
**ç·¨é›†**: âŒ è§¦ã‚‰ãªã„  
**é‡è¦åº¦**: â˜…â˜…â˜†â˜†â˜†

```hcl
variable "hub_and_spoke_vnet_settings" {
  type = object({
    enabled = bool
    primary = object({
      # ... è¤‡é›‘ãªæ§‹é€  ...
    })
    secondary = object({
      # ... è¤‡é›‘ãªæ§‹é€  ...
    })
  })
  description = "Hub and spoke network settings"
  default     = null
}
```

**ãªãœãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†ã‘ã¦ã‚‹ï¼Ÿ**
- 1ãƒ•ã‚¡ã‚¤ãƒ«ã ã¨é•·ã™ãã‚‹ï¼ˆ1000è¡Œè¶…ãˆã‚‹ï¼‰
- å½¹å‰²ã”ã¨ã«åˆ†ã‘ãŸæ–¹ãŒè¦‹ã‚„ã™ã„
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ‹…å½“è€…ã¯`variables.connectivity.tf`ã ã‘è¦‹ã‚Œã°ã„ã„

### variables.moved.tfï¼ˆå¾Œæ–¹äº’æ›ç”¨ï¼‰

**å½¹å‰²**: å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®äº’æ›æ€§ç¶­æŒ  
**ç·¨é›†**: âŒ çµ¶å¯¾è§¦ã‚‰ãªã„  
**é‡è¦åº¦**: â˜…â˜†â˜†â˜†â˜†

```hcl
moved {
  from = var.old_variable_name
  to   = var.new_variable_name
}
```

å¤‰æ•°åãŒå¤‰ã‚ã£ãŸã¨ãã€å¤ã„åå‰ã§ã‚‚å‹•ãã‚ˆã†ã«ã™ã‚‹ãŠã¾ã˜ãªã„ã€‚  
æ™®é€šã¯æ°—ã«ã—ãªãã¦ã„ã„ã§ã™ã€‚

---

## Part 3: ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«

### locals.tf

**å½¹å‰²**: å¤‰æ•°ã‚’åŠ å·¥ã—ãŸå€¤ã‚’å®šç¾©  
**ç·¨é›†**: â–³ ãŸã¾ã«è§¦ã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜†â˜†

```hcl
locals {
  # è¨­å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ã®å‡ºåŠ›ã‚’å–å¾—
  config_template_output = module.config[0].configuration_update_results
  
  # Hub-Spokeè¨­å®šï¼ˆãƒ—ãƒ©ã‚¤ãƒãƒªï¼‰
  hub_and_spoke_vnet_primary_settings = {
    enabled   = var.hub_and_spoke_vnet_settings.enabled
    location  = local.config_template_output.starter_locations[0]
    # ...
  }
}
```

**å¤‰æ•°ã¨ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã®é•ã„**

| é …ç›® | å¤‰æ•°ï¼ˆvariableï¼‰ | ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ï¼ˆlocalï¼‰ |
|------|-----------------|---------------------|
| å®šç¾© | `variable "x"` | `locals { x = }` |
| å€¤ã®è¨­å®š | `.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã§ | Terraformå†…ã§è¨ˆç®— |
| ç”¨é€” | å¤–éƒ¨ã‹ã‚‰è¨­å®š | å†…éƒ¨ã§è¨ˆç®— |
| ä¾‹ | ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å | "japaneast-rg" |

**ãªãœlocalsã‚’ä½¿ã†ï¼Ÿ**

ã“ã†ã„ã†ã‚³ãƒ¼ãƒ‰ãŒã‚ã£ãŸã¨ã—ã¾ã™ï¼š
```hcl
resource "azurerm_resource_group" "primary" {
  name     = "${var.prefix}-rg-${var.location}"
  location = var.location
}

resource "azurerm_virtual_network" "primary" {
  name                = "${var.prefix}-vnet-${var.location}"
  resource_group_name = "${var.prefix}-rg-${var.location}"  # åŒã˜è¨ˆç®—ã‚’2å›
  location            = var.location
}
```

åŒã˜è¨ˆç®—ã‚’ä½•åº¦ã‚‚ã—ã¦ã‚‹ã€‚localsã‚’ä½¿ã†ã¨ï¼š

```hcl title="localsã§å†åˆ©ç”¨"
locals {
  rg_name = "${var.prefix}-rg-${var.location}"
}

resource "azurerm_resource_group" "primary" {
  name     = local.rg_name
  location = var.location
}

resource "azurerm_virtual_network" "primary" {
  name                = "${var.prefix}-vnet-${var.location}"
  resource_group_name = local.rg_name  # å†åˆ©ç”¨
  location            = var.location
}
```

DRYåŸå‰‡ï¼ˆDon't Repeat Yourselfï¼‰ã§ã™ã­ã€‚

---

## Part 4: ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ•ã‚¡ã‚¤ãƒ«ãŸã¡

### ãƒ•ã‚¡ã‚¤ãƒ«åã®å‘½åè¦å‰‡

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¯`main.*.tf`ã¨ã„ã†åå‰ã§ã™ã€‚

- `main.config.tf` â†’ è¨­å®šå‡¦ç†
- `main.resource.groups.tf` â†’ ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—
- `main.management.tf` â†’ ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—
- `main.connectivity.hub.and.spoke.virtual.network.tf` â†’ Hub-Spoke
- `main.connectivity.virtual.wan.tf` â†’ Virtual WAN

**ãªãœåˆ†ã‘ã¦ã‚‹ï¼Ÿ**
- 1ãƒ•ã‚¡ã‚¤ãƒ«ã ã¨å·¨å¤§ã™ãã‚‹
- å½¹å‰²ã”ã¨ã«åˆ†ã‘ã‚‹ã¨è¦‹ã‚„ã™ã„
- ä¸¦è¡Œä½œæ¥­ã—ã‚„ã™ã„ï¼ˆåˆ¥ã®äººãŒåˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ï¼‰

**Terraformã®èª­ã¿è¾¼ã¿é †**
å®Ÿã¯é †ç•ªã¯é–¢ä¿‚ãªã„ï¼  
TerraformãŒä¾å­˜é–¢ä¿‚ã‚’è§£æã—ã¦ã€è‡ªå‹•ã§é †åºã‚’æ±ºã‚ã¦ãã‚Œã¾ã™ã€‚

### main.config.tf

**å½¹å‰²**: è¨­å®šã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜†

```hcl title="main.config.tf"
module "config" {
  count  = var.bootstrap_settings.enabled ? 1 : 0
  source = "./modules/config-templating"
  
  starter_locations = var.starter_locations
  root_parent_id    = var.management_group_settings.parent_resource_id
  
  configuration_file_path = "${path.root}/platform-landing-zone.auto.tfvars"
  custom_replacements     = var.custom_replacements
}
```

**ãƒã‚¤ãƒ³ãƒˆ1: count**
```hcl
count = var.bootstrap_settings.enabled ? 1 : 0
```
- `enabled`ãŒ`true`ãªã‚‰1å€‹ä½œã‚‹ï¼ˆmoduleä½œã‚‹ï¼‰
- `false`ãªã‚‰0å€‹ï¼ˆmoduleä½œã‚‰ãªã„ï¼‰

æ¡ä»¶åˆ†å²ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã€‚

**ãƒã‚¤ãƒ³ãƒˆ2: path.root**
```hcl
configuration_file_path = "${path.root}/platform-landing-zone.auto.tfvars"
```
`path.root`= ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€‚  
ã©ã“ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã—ã¦ã‚‚åŒã˜ãƒ‘ã‚¹ã«ãªã‚‹ã€‚

### main.resource.groups.tf

**å½¹å‰²**: ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜†â˜†

```hcl title="main.resource.groups.tf"
module "resource_groups" {
  source = "Azure/avm-res-resources-resourcegroup/azurerm"
  version = "0.2.1"
  
  for_each = local.resource_groups
  
  name     = each.value.name
  location = each.value.location
  tags     = each.value.tags
  
  enable_telemetry = var.enable_telemetry
}
```

**ãƒã‚¤ãƒ³ãƒˆ: for_each**
```hcl
for_each = local.resource_groups
```

`local.resource_groups`ã¯ä¾‹ãˆã°ã“ã‚“ãªæ„Ÿã˜ï¼š
```hcl
{
  "primary_connectivity" = {
    name     = "rg-hub-japaneast"
    location = "japaneast"
    tags     = {}
  }
  "secondary_connectivity" = {
    name     = "rg-hub-japanwest"
    location = "japanwest"
    tags     = {}
  }
}
```

`for_each`ã§ãƒ«ãƒ¼ãƒ—ã—ã¦ã€è¤‡æ•°ã®RGã‚’ä½œã‚‹ã€‚

`each.value.name`ã§å„è¦ç´ ã«ã‚¢ã‚¯ã‚»ã‚¹ã€‚

### main.management.tf

**å½¹å‰²**: ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒãƒªã‚·ãƒ¼ã‚’ä½œã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜…

```hcl
module "management_groups" {
  count  = var.management_group_settings.enabled ? 1 : 0
  source = "./modules/management_groups"
  
  management_group_settings = {
    architecture_name = local.config_template_output.architecture_name
    parent_resource_id = local.config_template_output.root_parent_management_group_id
    # ... é•·ã„ã®ã§çœç•¥ ...
  }
}
```

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§200å€‹ä»¥ä¸Šã®ãƒãƒªã‚·ãƒ¼ãŒä½œã‚‰ã‚Œã¾ã™ã€‚  
è©³ã—ãã¯å¾Œã®ç« ã§ã€‚

### main.connectivity.hub.and.spoke.virtual.network.tf

**å½¹å‰²**: Hub-Spokeå‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜†

åå‰ãŒé•·ã™ãã‚‹ã‚ˆã­()

```hcl
module "hub_and_spoke_vnet" {
  count   = var.hub_and_spoke_vnet_settings.enabled ? 1 : 0
  source  = "Azure/avm-ptn-alz-connectivity-hub-and-spoke-vnet/azurerm"
  version = "0.16.8"
  
  primary_settings = local.hub_and_spoke_vnet_primary_settings
  secondary_settings = local.hub_and_spoke_vnet_secondary_settings
  # ...
}
```

Firewall, Bastion, VPN Gateway, VNetå…¨éƒ¨ã“ã“ã§ä½œã‚‰ã‚Œã¾ã™ã€‚

### main.connectivity.virtual.wan.tf

**å½¹å‰²**: Virtual WANã‚’ä½œã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜†â˜†

Hub-Spokeã®ä»£ã‚ã‚Šã«Virtual WANã‚’ä½¿ã†å ´åˆã€‚

```hcl
module "virtual_wan" {
  count   = var.virtual_wan_settings.enabled ? 1 : 0
  source  = "Azure/avm-ptn-alz-connectivity-virtual-wan/azurerm"
  version = "0.13.5"
  
  # ...
}
```

`hub_and_spoke_vnet`ã‹`virtual_wan`ã€ã©ã¡ã‚‰ã‹ä¸€æ–¹ã ã‘ãŒå‹•ãä»•çµ„ã¿ã€‚

---

## Part 5: å‡ºåŠ›å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«

### outputs.tf

**å½¹å‰²**: ä½œã£ãŸãƒªã‚½ãƒ¼ã‚¹ã®æƒ…å ±ã‚’å‡ºåŠ›  
**é‡è¦åº¦**: â˜…â˜…â˜†â˜†â˜†

```hcl
output "resource_groups" {
  value = module.resource_groups
  description = "Created resource groups"
}

output "hub_virtual_network_id" {
  value = try(
    module.hub_and_spoke_vnet[0].virtual_networks.primary.id,
    null
  )
  description = "Primary hub virtual network ID"
}
```

**ãªãœå‡ºåŠ›ã™ã‚‹ï¼Ÿ**
- ä»–ã®Terraformãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ã†
- ãƒ‡ãƒãƒƒã‚°ç”¨
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆç”¨

**tryé–¢æ•°**
```hcl
try(
  module.hub_and_spoke_vnet[0].virtual_networks.primary.id,
  null
)
```

`hub_and_spoke_vnet`ãŒç„¡åŠ¹ï¼ˆcount=0ï¼‰ãªã‚‰ã€ã‚¨ãƒ©ãƒ¼ã˜ã‚ƒãªãã¦`null`ã‚’è¿”ã™ã€‚

---

## Part 6: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€

### modules/config-templating/

**å½¹å‰²**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†

```
modules/config-templating/
â”œâ”€â”€ data.tf          â† ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹å®šç¾©
â”œâ”€â”€ locals.config.tf â† ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç½®æ›ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ outputs.tf       â† å‡¦ç†çµæœã‚’å‡ºåŠ›
â”œâ”€â”€ terraform.tf     â† ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â””â”€â”€ variables.tf     â† å…¥åŠ›å¤‰æ•°
```

`$${starter_location_01}`ã‚’`japaneast`ã«å¤‰æ›ã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ã€‚

è©³ã—ãã¯[06_è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.md](./06_è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.md)ã§ã€‚

### modules/management_groups/

**å½¹å‰²**: ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒãƒªã‚·ãƒ¼ã‚’ä½œã‚‹

```
modules/management_groups/
â”œâ”€â”€ locals.tf     â† ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°
â”œâ”€â”€ main.tf       â† ãƒ¡ã‚¤ãƒ³å‡¦ç†
â”œâ”€â”€ terraform.tf  â† ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â””â”€â”€ variables.tf  â† å…¥åŠ›å¤‰æ•°
```

å®Ÿéš›ã¯`main.tf`ãŒ`Azure/avm-ptn-alz/azurerm`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‘¼ã‚“ã§ã‚‹ã ã‘ã€‚  
ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€‚(ãƒ©ãƒƒãƒ‘ãƒ¼ã¯å›²ã†ã‚„ã¤ã¿ãŸã„ãªæ„Ÿã˜ã‹ãªã€‚ã‚µãƒ©ãƒ³ãƒ©ãƒƒãƒ—ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ã„)

### modules/management_resources/

**å½¹å‰²**: Log Analyticsã¨Automation Accountã‚’ä½œã‚‹

```
modules/management_resources/
â”œâ”€â”€ main.tf       â† ãƒ¡ã‚¤ãƒ³å‡¦ç†
â”œâ”€â”€ outputs.tf    â† å‡ºåŠ›
â”œâ”€â”€ terraform.tf  â† ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â””â”€â”€ variables.tf  â† å…¥åŠ›å¤‰æ•°
```

ã“ã‚Œã‚‚`Azure/avm-ptn-alz-management/azurerm`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã€‚

---

## Part 7: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚©ãƒ«ãƒ€

### lib/

**å½¹å‰²**: ãƒãƒªã‚·ãƒ¼å®šç¾©ã‚’YAMLã§ç®¡ç†

```
lib/
â”œâ”€â”€ alz_library_metadata.json        â† ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ archetype_definitions/           â† ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã®ç¨®é¡
â”‚   â”œâ”€â”€ connectivity_custom.alz_archetype_override.yaml
â”‚   â”œâ”€â”€ corp_custom.alz_archetype_override.yaml
â”‚   â”œâ”€â”€ landing_zones_custom.alz_archetype_override.yaml
â”‚   â”œâ”€â”€ management_custom.alz_archetype_override.yaml
â”‚   â”œâ”€â”€ online_custom.alz_archetype_override.yaml
â”‚   â””â”€â”€ ...
â””â”€â”€ architecture_definitions/        â† å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
    â””â”€â”€ alz_custom.alz_architecture_definition.yaml
```

**Archetypeï¼ˆã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ï¼‰ã¨ã¯ï¼Ÿ**
ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã®ã€Œç¨®é¡ã€ã€‚

- `connectivity`: æ¥ç¶šç”¨ï¼ˆFirewallç­‰ï¼‰
- `management`: ç®¡ç†ç”¨ï¼ˆLog Analyticsç­‰ï¼‰
- `corp`: ä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚ã‚Š
- `online`: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã®ã¿
- `landing_zones`: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨

å„ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ã«é©ç”¨ã™ã‚‹ãƒãƒªã‚·ãƒ¼ãŒYAMLã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä¾‹: `corp_custom.alz_archetype_override.yaml`
```yaml
archetypes:
  corp:
    policy_assignments:
      - Deny-Public-IP
      - Deny-RDP-From-Internet
      - Enforce-TLS
    # ...
```

---

## Part 8: CI/CDãƒ•ã‚©ãƒ«ãƒ€

### .github/workflows/cd.yaml

**å½¹å‰²**: GitHub Actionsã®è¨­å®š

```yaml
name: 02 Azure Landing Zones Continuous Delivery

on:
  workflow_dispatch:
    inputs:
      terraform_action:
        description: 'Terraform action'
        required: true
        type: choice
        options:
          - apply
          - destroy

jobs:
  cd:
    uses: shuhei0720org01/alz-mgmt-templates/.github/workflows/cd-template.yaml@main
    with:
      terraform_action: ${{ inputs.terraform_action }}
    secrets: inherit
```

**workflow_dispatch**: æ‰‹å‹•å®Ÿè¡Œ  
**inputs**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã¶ï¼ˆapplyã‹destroyã‹ï¼‰  
**uses**: åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ã†

å®Ÿéš›ã®å‡¦ç†ã¯`alz-mgmt-templates`ãƒªãƒã‚¸ãƒˆãƒªã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚

---

## ã¾ã¨ã‚

### ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²åˆ†æ‹…

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² | ç·¨é›† |
|---------|------|------|
| `platform-landing-zone.auto.tfvars` | ãƒ¡ã‚¤ãƒ³è¨­å®š | âœ… |
| `terraform.tfvars.json` | ç§˜å¯†æƒ…å ± | âœ…åˆå›ã®ã¿ |
| `terraform.tf` | Terraformè¨­å®š | âŒ |
| `variables.*.tf` | å¤‰æ•°å®šç¾© | âŒ |
| `locals.tf` | ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•° | â–³ |
| `main.*.tf` | ãƒ¡ã‚¤ãƒ³å‡¦ç† | âŒ |
| `outputs.tf` | å‡ºåŠ›å®šç¾© | âŒ |
| `modules/` | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | â–³ |
| `lib/` | ãƒãƒªã‚·ãƒ¼å®šç¾© | â–³ |
| `.github/` | CI/CD | âŒ |

### ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œï¼ˆå†æ²ï¼‰

```
.tfvarsï¼ˆè¨­å®šï¼‰
  â†“
variables.tfï¼ˆå¤‰æ•°å®šç¾©ï¼‰
  â†“
modules/config-templatingï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†ï¼‰
  â†“
locals.tfï¼ˆãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ï¼‰
  â†“
main.*.tfï¼ˆãƒ¡ã‚¤ãƒ³å‡¦ç†ï¼‰
  â†“
modules/ï¼ˆå„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œï¼‰
  â†“
Azureï¼ˆãƒªã‚½ãƒ¼ã‚¹ä½œæˆï¼‰
  â†“
outputs.tfï¼ˆçµæœå‡ºåŠ›ï¼‰
```

### é‡è¦åº¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°

ç†è§£ã™ã¹ãå„ªå…ˆåº¦ï¼š

1. â˜…â˜…â˜…â˜…â˜… `platform-landing-zone.auto.tfvars`
2. â˜…â˜…â˜…â˜…â˜† `main.management.tf`, `main.connectivity.hub.and.spoke.virtual.network.tf`
3. â˜…â˜…â˜…â˜†â˜† `locals.tf`, `main.config.tf`
4. â˜…â˜…â˜†â˜†â˜† `variables.tf`, `outputs.tf`
5. â˜…â˜†â˜†â˜†â˜† ãã®ä»–

---

## ç·´ç¿’å•é¡Œ

### å•é¡Œ1
`.auto.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã¨æ™®é€šã®`.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã®é•ã„ã¯ä½•ã§ã™ã‹ï¼Ÿ

### å•é¡Œ2
`locals.tf`ã¨`variables.tf`ã®ä½¿ã„åˆ†ã‘ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚

### å•é¡Œ3
`main.*.tf`ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¤‡æ•°ã«åˆ†ã‹ã‚Œã¦ã„ã‚‹ç†ç”±ã‚’2ã¤æŒ™ã’ã¦ãã ã•ã„ã€‚

### å•é¡Œ4
`for_each`ã¨`count`ã®é•ã„ã¯ä½•ã§ã™ã‹ï¼Ÿ

---

## ç·´ç¿’å•é¡Œã®ç­”ãˆ

### ç­”ãˆ1
`.auto.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€TerraformãŒè‡ªå‹•çš„ã«èª­ã¿è¾¼ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚æ™®é€šã®`.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã¯`-var-file`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æ˜ç¤ºçš„ã«æŒ‡å®šã—ãªã„ã¨èª­ã¿è¾¼ã¾ã‚Œã¾ã›ã‚“ã€‚`.auto.tfvars`ã‚’ä½¿ã†ã¨ã€`terraform apply`ã ã‘ã§è‡ªå‹•çš„ã«è¨­å®šãŒé©ç”¨ã•ã‚Œã‚‹ã®ã§ä¾¿åˆ©ã§ã™ã€‚

### ç­”ãˆ2

variables.tfã¯å¤–éƒ¨ã‹ã‚‰æ¸¡ã•ã‚Œã‚‹å¤‰æ•°ã‚’å®šç¾©ã—ã¾ã™ï¼ˆå…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰ã€‚locals.tfã¯å†…éƒ¨ã§è¨ˆç®—ã•ã‚Œã‚‹å¤‰æ•°ã‚’å®šç¾©ã—ã¾ã™ï¼ˆè¨ˆç®—çµæœï¼‰ã€‚

ä¾‹ï¼š

- `variables.tf`: `var.location`ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šï¼‰
- `locals.tf`: `local.location_short`ï¼ˆlocationã‹ã‚‰è‡ªå‹•è¨ˆç®—ï¼‰

### ç­”ãˆ3
`main.*.tf`ãƒ•ã‚¡ã‚¤ãƒ«ãŒåˆ†ã‹ã‚Œã¦ã„ã‚‹ç†ç”±ï¼š

1. **å½¹å‰²ã®æ˜ç¢ºåŒ–**: ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¦‹ãŸã ã‘ã§ä½•ã®ãƒªã‚½ãƒ¼ã‚¹ã‹åˆ†ã‹ã‚‹ï¼ˆ`main.connectivity.*.tf`ãªã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–¢é€£ï¼‰
2. **ä¿å®ˆæ€§ã®å‘ä¸Š**: å¤‰æ›´ã—ãŸã„æ©Ÿèƒ½ã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚’é–‹ã‘ã°ã‚ˆãã€æ•°åƒè¡Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã—å›ã‚‹å¿…è¦ãŒãªã„

### ç­”ãˆ4
countã¯æ•°å€¤ã§ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚Šã¾ã™ï¼ˆ`count = 3`ãªã‚‰3å€‹ï¼‰ã€‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯`count.index`ã§0,1,2...

for_eachã¯ãƒãƒƒãƒ—ã‚„ã‚»ãƒƒãƒˆã§ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚Šã¾ã™ã€‚å„è¦ç´ ã«åå‰ãŒã‚ã‚Šã€`each.key`ã‚„`each.value`ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

ä¾‹ï¼š
```hcl
# count: ãƒªã‚½ãƒ¼ã‚¹åãŒ resource[0], resource[1]...
count = 2

# for_each: ãƒªã‚½ãƒ¼ã‚¹åãŒ resource["app1"], resource["app2"]...
for_each = toset(["app1", "app2"])
```

for_eachã®ã»ã†ãŒã€ãƒªã‚½ãƒ¼ã‚¹ã®è¿½åŠ ãƒ»å‰Šé™¤æ™‚ã«ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã«å½±éŸ¿ã—ãªã„ãŸã‚æ¨å¥¨ã•ã‚Œã¾ã™ã€‚

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã¯ç†è§£ã§ãã¾ã—ãŸã‹ï¼Ÿ

æ¬¡ã¯[03_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md](./03_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md)ã§ã€  
`platform-landing-zone.auto.tfvars`ã‚’1è¡Œãšã¤è§£èª­ã—ã¦ã„ãã¾ã™ã€‚

ã“ã‚ŒãŒä¸€ç•ªé‡è¦ãªç« ã§ã™ã€‚ã˜ã£ãã‚Šèª­ã‚“ã§ãã ã•ã„ã€‚

---

**æ‰€è¦æ™‚é–“**: 40åˆ†  
**é›£æ˜“åº¦**: â˜…â˜…â˜…â˜†â˜†  
**å‰**: [01_åŸºç¤çŸ¥è­˜.md](./01_åŸºç¤çŸ¥è­˜.md)  
**æ¬¡**: [03_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md](./03_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md)
