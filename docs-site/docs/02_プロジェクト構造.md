# 02. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€  - ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã®å…¨ä½“åƒ

!!! info "ã“ã®ç« ã§å­¦ã¶ã“ã¨"
    ã“ã®ãƒªãƒã‚¸ãƒˆãƒªï¼ˆå®Œæˆæ¸ˆã¿ã®ã‚³ãƒ¼ãƒ‰ä¾‹ï¼‰ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ç†è§£ã—ã¾ã™ã€‚
    
    **æ³¨æ„**: ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯å­¦ç¿’ç”¨ã®å®Œæˆæ¸ˆã¿ã‚³ãƒ¼ãƒ‰ä¾‹ã§ã™ã€‚å®Ÿéš›ã«Azure Landing Zonesã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã¯ã€Chapter 14-15ã®Azureå…¬å¼Bootstrapæ‰‹é †ã«å¾“ã£ã¦ã€æ–°ã—ã„ãƒªãƒã‚¸ãƒˆãƒªãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã™ã€‚ãã®ãƒªãƒã‚¸ãƒˆãƒªãŒã“ã®ã‚ˆã†ãªæ§‹é€ ã«ãªã‚Šã¾ã™ã€‚

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®é³¥ç°å›³

ã¾ãšã€å…¨ä½“ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```text title="ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®é³¥ç°å›³"
alz-mgmt/
â”œâ”€â”€ ğŸ“ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚ãªãŸãŒç·¨é›†ã™ã‚‹ï¼‰
â”‚   â”œâ”€â”€ platform-landing-zone.auto.tfvars  â† ãƒ¡ã‚¤ãƒ³è¨­å®šï¼ˆã“ã“ã ã‘è§¦ã‚Œã°OKï¼‰
â”‚   â”œâ”€â”€ terraform.tfvars.json              â† ç§˜å¯†æƒ…å ±ï¼ˆGitç®¡ç†å¤–ï¼‰
â”‚   â””â”€â”€ terraform.tf                       â† Terraformè‡ªä½“ã®è¨­å®š
â”‚
â”œâ”€â”€ ğŸ¯ å¤‰æ•°å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå¤‰æ•°ã®å‹ã‚’å®šç¾©ï¼‰
â”‚   â”œâ”€â”€ variables.tf                                      â† å…±é€šå¤‰æ•°
â”‚   â”œâ”€â”€ variables.connectivity.tf                         â† æ¥ç¶šé–¢é€£
â”‚   â”œâ”€â”€ variables.connectivity.hub.and.spoke.virtual.network.tf
â”‚   â”œâ”€â”€ variables.connectivity.virtual.wan.tf
â”‚   â”œâ”€â”€ variables.management.tf                           â† ç®¡ç†é–¢é€£
â”‚   â””â”€â”€ variables.moved.tf                                â† å¾Œæ–¹äº’æ›ç”¨
â”‚
â”œâ”€â”€ ğŸ”§ ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ï¼ˆè¨ˆç®—æ¸ˆã¿ã®å€¤ï¼‰
â”‚   â””â”€â”€ locals.tf                          â† å¤‰æ•°ã‚’åŠ å·¥ã—ãŸå€¤
â”‚
â”œâ”€â”€ ğŸš€ ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå®Ÿéš›ã®å‡¦ç†ï¼‰
â”‚   â”œâ”€â”€ main.config.tf                                    â† è¨­å®šå‡¦ç†
â”‚   â”œâ”€â”€ main.resource.groups.tf                           â† ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
â”‚   â”œâ”€â”€ main.management.tf                                â† ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ãƒ»ãƒãƒªã‚·ãƒ¼
â”‚   â”œâ”€â”€ main.connectivity.hub.and.spoke.virtual.network.tf â† Hub-Spokeãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
â”‚   â””â”€â”€ main.connectivity.virtual.wan.tf                  â† Virtual WAN
â”‚
â”œâ”€â”€ ğŸ“¤ å‡ºåŠ›å®šç¾©ï¼ˆä½œã£ãŸãƒªã‚½ãƒ¼ã‚¹ã®æƒ…å ±ã‚’å‡ºåŠ›ï¼‰
â”‚   â”œâ”€â”€ outputs.tf                         â† å‡ºåŠ›å®šç¾©
â”‚   â””â”€â”€ outputs.moved.tf                   â† å¾Œæ–¹äº’æ›ç”¨
â”‚
â”œâ”€â”€ ğŸ“¦ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆå†åˆ©ç”¨å¯èƒ½ãªéƒ¨å“ï¼‰
â”‚   â”œâ”€â”€ config-templating/                 â† è¨­å®šã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†
â”‚   â”œâ”€â”€ management_groups/                 â† ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ãƒ»ãƒãƒªã‚·ãƒ¼
â”‚   â””â”€â”€ management_resources/              â† Log Analyticsç­‰
â”‚
â”œâ”€â”€ ğŸ“š ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆãƒãƒªã‚·ãƒ¼å®šç¾©ã®YAMLï¼‰
â”‚   â”œâ”€â”€ alz_library_metadata.json
â”‚   â”œâ”€â”€ archetype_definitions/             â† ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã®ç¨®é¡
â”‚   â””â”€â”€ architecture_definitions/          â† å…¨ä½“æ§‹æˆ
â”‚
â”œâ”€â”€ ğŸ¤– CI/CDï¼ˆè‡ªå‹•åŒ–ï¼‰
â”‚   â””â”€â”€ .github/
â”‚       â””â”€â”€ workflows/
â”‚           â””â”€â”€ cd.yaml                    â† GitHub Actionsè¨­å®š
â”‚
â””â”€â”€ ğŸ“– ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”œâ”€â”€ README.md                          â† èª¬æ˜æ›¸
    â””â”€â”€ docs/                              â† ã“ã®ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆæ•™ç§‘æ›¸ï¼‰
```

## ãƒ•ã‚¡ã‚¤ãƒ«æ•°

å…¨ä½“ã§ï¼š

- Terraformãƒ•ã‚¡ã‚¤ãƒ«: ç´„20å€‹
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ãƒ•ã‚¡ã‚¤ãƒ«: ç´„10å€‹
- YAMLãƒ•ã‚¡ã‚¤ãƒ«: ç´„10å€‹

ä¸€è¦‹å¤šãã†ã§ã™ãŒã€å®Ÿã¯æ•´ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

**ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®é–¢ä¿‚å›³**

```text title="ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ"
ã€è¨­å®šå±¤ã€‘
platform-landing-zone.auto.tfvars â†â”€â” ã‚ãªãŸãŒç·¨é›†
terraform.tfvars.json             â†â”€â”¤ ã™ã‚‹éƒ¨åˆ†
                                    â”‚
        â†“ èª­ã¿è¾¼ã¿                   â”‚
                                    â”‚
ã€å¤‰æ•°å®šç¾©å±¤ã€‘                       â”‚
variables.tf                        â”‚
variables.*.tf                      â”‚
        â†“                           â”‚
                                    â”‚
ã€åŠ å·¥å±¤ã€‘                           â”‚
locals.tf â† è¨ˆç®—ãƒ»å¤‰æ›               â”‚
        â†“                           â”‚
                                    â”‚
ã€å‡¦ç†å±¤ã€‘                           â”‚
main.*.tf â† å®Ÿéš›ã®å‡¦ç†               â”‚
        â†“                           â”‚
        â”œâ†’ modules/config-templating  â† è¨­å®šã®åŠ å·¥
        â”œâ†’ modules/management_groups  â† ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
        â””â†’ modules/management_resources â† ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
                â†“                   â”‚
                                    â”‚
ã€å‡ºåŠ›å±¤ã€‘                           â”‚
outputs.tf â† ä½œæˆçµæœ                â”‚
        â†“                           â”‚
        è¡¨ç¤ºãƒ»ä»–ã®Terraformã§åˆ©ç”¨    â”‚
                                    â”‚
        â†“                           â”‚
ã€å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã€‘                     â”‚
lib/archetype_definitions/ â†â”€â”€â”€â”€â”€â”€â”€â”˜ ãƒãƒªã‚·ãƒ¼å®šç¾©
lib/architecture_definitions/        éšå±¤å®šç¾©
```

**ğŸ”„ å®Ÿéš›ã®å‡¦ç†ã®æµã‚Œ**

```text title="å‡¦ç†ãƒ•ãƒ­ãƒ¼"
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†
   â†“
   platform-landing-zone.auto.tfvars
   starter_locations = ["japaneast"]
   
2. å¤‰æ•°å®šç¾©ã§å‹ãƒã‚§ãƒƒã‚¯
   â†“
   variables.tf
   variable "starter_locations" {
     type = list(string)
   }
   
3. localsã§åŠ å·¥
   â†“
   locals.tf
   starter_location_01 = "japaneast"
   
4. moduleã§å‡¦ç†
   â†“
   modules/config-templating
   ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã‚’å±•é–‹
   
5. mainã§å®Ÿè¡Œ
   â†“
   main.management.tf
   å®Ÿéš›ã«ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
   
6. outputã§çµæœå‡ºåŠ›
   â†“
   outputs.tf
   ä½œæˆã—ãŸãƒªã‚½ãƒ¼ã‚¹ã®IDãªã©
```

---

## Part 1: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŸã¡

ã“ã“ã‹ã‚‰ã¯å®Ÿéš›ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰‹å…ƒã§é–‹ã„ã¦ã¿ã¦ã­ï¼

### platform-landing-zone.auto.tfvars

**å½¹å‰²**: ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚¤ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«  
**ç·¨é›†**: âœ… ã‚ãªãŸãŒç·¨é›†ã™ã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜…

```hcl title="platform-landing-zone.auto.tfvarsï¼ˆæŠœç²‹ï¼‰"
/*
--- Built-in Replacements ---
This file contains built-in replacements to avoid repeating the same hard-coded values.
Replacements are denoted by the dollar-dollar curly braces token (e.g. $${starter_location_01}).
ï¼ˆ...èª¬æ˜ãŒç¶šã...ï¼‰
*/

/*
--- Starter Locations ---
You can define the Azure regions to use throughout the configuration.
*/
starter_locations = ["japaneast", "japanwest"]

/*
--- Custom Replacements ---
You can define custom replacements to use throughout the configuration.
*/
custom_replacements = {
  names = {
    # Defender email security contact
    defender_email_security_contact = "shuhei_0720@icloud.com"

    # Resource group names
    management_resource_group_name                 = "rg-management-$${starter_location_01}"
    connectivity_hub_primary_resource_group_name   = "rg-hub-$${starter_location_01}"
    connectivity_hub_secondary_resource_group_name = "rg-hub-$${starter_location_02}"
    dns_resource_group_name                        = "rg-hub-dns-$${starter_location_01}"
    # ï¼ˆ...ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—åãŒç¶šã...ï¼‰
    
    # Resource provisioning primary connectivity
    primary_firewall_enabled                      = true
    primary_virtual_network_gateway_vpn_enabled   = true
    primary_bastion_enabled                       = true
    # ï¼ˆ...ä»–ã®è¨­å®šãŒ500è¡Œä»¥ä¸Šç¶šã...ï¼‰
  }
}
```

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ç·¨é›†ã™ã‚Œã°ã€ã»ã¨ã‚“ã©ã®è¨­å®šãŒå¤‰æ›´ã§ãã¾ã™ã€‚

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**

- `$${starter_location_01}`ã®ã‚ˆã†ãªå¤‰æ•°å±•é–‹ãŒä½¿ãˆã‚‹ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½ï¼‰
- ãƒªã‚½ãƒ¼ã‚¹åã€ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—åã‚’ä¸€æ‹¬å®šç¾©
- ã©ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æœ‰åŠ¹/ç„¡åŠ¹ã«ã™ã‚‹ã‹ã‚‚ã“ã“ã§è¨­å®š

**ãªãœ`.auto.tfvars`ï¼Ÿ**

- `.tfvars`ã ã¨`terraform apply -var-file=xxx.tfvars`ã£ã¦æŒ‡å®šãŒå¿…è¦
- `.auto.tfvars`ã¯è‡ªå‹•ã§èª­ã¿è¾¼ã¾ã‚Œã‚‹
- æ¥½ã ã‹ã‚‰`.auto`ã‚’ã¤ã‘ã¦ã‚‹

### terraform.tfvars.json

**å½¹å‰²**: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³IDã‚„å„ç¨®è¨­å®š  
**ç·¨é›†**: âœ… æœ€åˆã ã‘ç·¨é›†ã™ã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜†

```json title="terraform.tfvars.jsonï¼ˆå®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰"
{
  "connectivity_tags": null,
  "management_groups_enabled": true,
  "management_resources_enabled": true,
  "private_link_private_dns_zone_virtual_network_link_moved_blocks_enabled": false,
  "root_parent_management_group_id": "ã‚ãªãŸã®ãƒ†ãƒŠãƒ³ãƒˆãƒ«ãƒ¼ãƒˆMG ID",
  "starter_locations_short": {},
  "subscription_id_connectivity": null,
  "subscription_id_identity": null,
  "subscription_id_management": null,
  "subscription_ids": {
    "management": "ã‚ãªãŸã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID",
    "identity": "ã‚ãªãŸã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID",
    "connectivity": "ã‚ãªãŸã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID",
    "security": "ã‚ãªãŸã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID"
  },
  "virtual_hubs": {},
  "virtual_wan_settings": {}
}
```

**ãªãœJSONå½¢å¼ï¼Ÿ**

- HCLã‚ˆã‚Šæ©Ÿæ¢°çš„ã«ç”Ÿæˆã—ã‚„ã™ã„
- CI/CDã§å‹•çš„ã«ä½œã‚Šã‚„ã™ã„
- è¤‡æ•°ã®è¨­å®šã‚’1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã‚‰ã‚Œã‚‹


**ä¸»è¦ãªè¨­å®šé …ç›®ï¼š**

- `subscription_ids`: æ–°å½¢å¼ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³IDæŒ‡å®šï¼ˆmapå½¢å¼ï¼‰
- `subscription_id_*`: æ—§å½¢å¼ï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã£ã¦ã„ã‚‹ã€é€šå¸¸ã¯nullï¼‰
- `root_parent_management_group_id`: ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—éšå±¤ã®è¦ªã¨ãªã‚‹MG ID
- `management_groups_enabled`: ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã™ã‚‹ã‹ï¼ˆtrue/falseï¼‰
- `management_resources_enabled`: ç®¡ç†ãƒªã‚½ãƒ¼ã‚¹ï¼ˆLog Analyticsãªã©ï¼‰ã‚’ä½œæˆã™ã‚‹ã‹
- `starter_locations_short`: ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®çŸ­ç¸®åã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å ´åˆï¼ˆé€šå¸¸ã¯ç©ºï¼‰
- `connectivity_tags`: æ¥ç¶šãƒªã‚½ãƒ¼ã‚¹ç”¨ã®è¿½åŠ ã‚¿ã‚°ï¼ˆé€šå¸¸ã¯nullï¼‰
- `virtual_hubs`: Virtual WANä½¿ç”¨æ™‚ã®Hubè¨­å®šï¼ˆé€šå¸¸ã¯ç©ºï¼‰
- `virtual_wan_settings`: Virtual WANä½¿ç”¨æ™‚ã®è¨­å®šï¼ˆé€šå¸¸ã¯ç©ºï¼‰
- `private_link_private_dns_zone_virtual_network_link_moved_blocks_enabled`: å¾Œæ–¹äº’æ›æ€§ãƒ•ãƒ©ã‚°

### terraform.tf

**å½¹å‰²**: Terraformè‡ªä½“ã®è¨­å®š  
**ç·¨é›†**: âŒ åŸºæœ¬è§¦ã‚‰ãªã„  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜†â˜†

```hcl title="terraform.tf"
terraform {
  required_version = "~> 1.12"
  
  required_providers {
    alz = {
      source  = "Azure/alz"
      version = "0.20.0"
    }
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 4.0"
    }
    azapi = {
      source  = "Azure/azapi"
      version = "~> 2.0"
    }
    local = {
      source  = "hashicorp/local"
      version = "~> 2.5"
    }
  }
  
  backend "azurerm" {}
}
```

#### required_version
```hcl
required_version = "~> 1.12"
```
Terraform 1.12.x ã˜ã‚ƒãªã„ã¨å‹•ã‹ãªã„å®£è¨€ã€‚

#### required_providers

ä½¿ã†ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã€‚

**alz**: Azure Landing Zoneså°‚ç”¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ãƒ»ãƒãƒªã‚·ãƒ¼ç®¡ç†ï¼‰  
**azurerm**: Azure Resource Managerï¼ˆAzureã®ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼‰  
**azapi**: Azure APIç›´æ¥å©ãç”¨ï¼ˆazurermã§ã§ããªã„ã“ã¨ã«ä½¿ã†ï¼‰  
**local**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œç”¨ï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ãï¼‰

**ãªãœ`~> 4.0`ï¼Ÿ**

- `~>` = äº’æ›æ€§ã®ã‚ã‚‹ç¯„å›²ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—OK
- `4.0` = 4.0.x, 4.1.x, 4.99.x ã¯OKã€5.0.x ã¯NG
- ãƒã‚°ä¿®æ­£ã¯å—ã‘å–ã‚ŠãŸã„ã‘ã©ã€ç ´å£Šçš„å¤‰æ›´ã¯é¿ã‘ãŸã„

#### backend
```hcl
backend "azurerm" {}
```
çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`terraform.tfstate`ï¼‰ã‚’Azure Storageã«ä¿å­˜ã€‚

`{}`ãŒç©ºãªã®ã¯ã€å®Ÿè¡Œæ™‚ã«æŒ‡å®šã™ã‚‹ã‹ã‚‰ï¼š
```bash title="backendã®åˆæœŸåŒ–"
terraform init \
  -backend-config="resource_group_name=rg-tfstate" \
  -backend-config="storage_account_name=stotfstate" \
  -backend-config="container_name=tfstate" \
  -backend-config="key=terraform.tfstate"
```

GitHub Actionsã§ã“ã®æŒ‡å®šã‚’ã‚„ã£ã¦ã¾ã™ã€‚

---

## Part 2: å¤‰æ•°å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ãŸã¡

### å¤‰æ•°å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²

Terraformã®å¤‰æ•°ã«ã¯å‹ãŒã‚ã‚Šã¾ã™ã€‚

```hcl title="å¤‰æ•°å®šç¾©ã®ä¾‹"
# variables.tf
variable "location" {
  type        = string           # å‹ã¯æ–‡å­—åˆ—
  description = "Azure region"   # èª¬æ˜
  default     = "japaneast"      # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
}
```

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€Œã©ã‚“ãªå¤‰æ•°ã‚’å—ã‘å–ã‚‹ã‹ã€ã‚’å®šç¾©ã—ã¾ã™ã€‚

### variables.tfï¼ˆãƒ¡ã‚¤ãƒ³å¤‰æ•°ï¼‰

**å½¹å‰²**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ä½¿ã†å…±é€šå¤‰æ•°  
**ç·¨é›†**: âŒ è§¦ã‚‰ãªã„  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜†â˜†

```hcl title="variables.tfï¼ˆæŠœç²‹ï¼šä¸»è¦ãª3ã¤ã®å¤‰æ•°ã®ã¿æ²è¼‰ã€å®Ÿéš›ã¯10å€‹ã®å¤‰æ•°ãŒã‚ã‚‹ï¼‰"
variable "starter_locations" {
  type        = list(string)
  description = "The default for Azure resources. (e.g 'uksouth')"
  validation {
    condition     = length(var.starter_locations) > 0
    error_message = "You must provide at least one starter location region."
  }
}

# ï¼ˆçœç•¥: starter_locations_shortï¼‰

variable "subscription_ids" {
  description = "The list of subscription IDs to deploy the Platform Landing Zones into"
  type        = map(string)
  default     = {}
  nullable    = false
  validation {
    condition     = length(var.subscription_ids) == 0 || alltrue([for id in values(var.subscription_ids) : can(regex("^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$", id))])
    error_message = "All subscription IDs must be valid GUIDs"
  }
}

# ï¼ˆçœç•¥: subscription_id_connectivity, subscription_id_identity, subscription_id_management - æ—§å½¢å¼ã§éæ¨å¥¨ï¼‰
# ï¼ˆçœç•¥: root_parent_management_group_id, enable_telemetryï¼‰

variable "custom_replacements" {
  type = object({
    names                      = optional(map(string), {})
    resource_group_identifiers = optional(map(string), {})
    resource_identifiers       = optional(map(string), {})
  })
  default = {
    names                      = {}
    resource_group_identifiers = {}
    resource_identifiers       = {}
  }
  description = "Custom replacements"
}

# ï¼ˆçœç•¥: tagsï¼‰
```

#### list(string)å‹

```hcl
starter_locations = ["japaneast", "japanwest"]
```

æ–‡å­—åˆ—ã®ãƒªã‚¹ãƒˆã€‚ä½•å€‹ã§ã‚‚OKã€‚

**validationï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰**:

```hcl
validation {
  condition     = length(var.starter_locations) > 0
  error_message = "You must provide at least one starter location region."
}
```

- æœ€ä½1ã¤ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¿…è¦
- ç©ºã®ãƒªã‚¹ãƒˆã‚’æ¸¡ã™ã¨ã‚¨ãƒ©ãƒ¼

#### map(string)å‹

```hcl
subscription_ids = {
  "management"   = "xxx-xxx-xxx"
  "connectivity" = "yyy-yyy-yyy"
}
```

ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã€‚JavaScriptã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¿ãŸã„ãªã‚‚ã®ã€‚

**validationï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰**:

- å…¨ã¦ã®IDãŒGUIDå½¢å¼ã‹æ¤œè¨¼
- ã‚­ãƒ¼ã¯`management`, `connectivity`, `identity`, `security`ã®ã„ãšã‚Œã‹ã®ã¿è¨±å¯

#### objectå‹

```hcl
custom_replacements = {
  names = {
    firewall_name = "fw-hub"
  }
  resource_group_identifiers = {
    # ...
  }
  resource_identifiers = {
    # ...
  }
}
```

æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã€‚JavaScriptã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¿ãŸã„ãªã‚‚ã®ã€‚

**optionalï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰**:

```hcl
names = optional(map(string), {})
```

- `optional`= ã“ã®é …ç›®ã¯çœç•¥å¯èƒ½
- ç¬¬2å¼•æ•°ã®`{}`ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆçœç•¥æ™‚ã¯ç©ºãƒãƒƒãƒ—ï¼‰
- Terraform 1.3ä»¥é™ã®æ©Ÿèƒ½

### variables.connectivity.tfï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¤‰æ•°ï¼‰

**å½¹å‰²**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–¢é€£ã®å¤‰æ•°å®šç¾©  
**ç·¨é›†**: âŒ è§¦ã‚‰ãªã„  
**é‡è¦åº¦**: â˜…â˜…â˜†â˜†â˜†

```hcl
variable "hub_and_spoke_vnet_settings" {
  type = object({
    enabled = bool
    primary = object({
      # ... è¤‡é›‘ãªæ§‹é€  ...
    })
    secondary = object({
      # ... è¤‡é›‘ãªæ§‹é€  ...
    })
  })
  description = "Hub and spoke network settings"
  default     = null
}
```

**ãªãœãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†ã‘ã¦ã‚‹ï¼Ÿ**

- 1ãƒ•ã‚¡ã‚¤ãƒ«ã ã¨é•·ã™ãã‚‹ï¼ˆ1000è¡Œè¶…ãˆã‚‹ï¼‰
- å½¹å‰²ã”ã¨ã«åˆ†ã‘ãŸæ–¹ãŒè¦‹ã‚„ã™ã„
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ‹…å½“è€…ã¯`variables.connectivity.tf`ã ã‘è¦‹ã‚Œã°ã„ã„

### variables.moved.tfï¼ˆå¾Œæ–¹äº’æ›ç”¨ï¼‰

**å½¹å‰²**: å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®äº’æ›æ€§ç¶­æŒ  
**ç·¨é›†**: âŒ çµ¶å¯¾è§¦ã‚‰ãªã„  
**é‡è¦åº¦**: â˜…â˜†â˜†â˜†â˜†

```hcl
moved {
  from = var.old_variable_name
  to   = var.new_variable_name
}
```

å¤‰æ•°åãŒå¤‰ã‚ã£ãŸã¨ãã€å¤ã„åå‰ã§ã‚‚å‹•ãã‚ˆã†ã«ã™ã‚‹ãŠã¾ã˜ãªã„ã€‚  
æ™®é€šã¯æ°—ã«ã—ãªãã¦ã„ã„ã§ã™ã€‚

---

## Part 3: ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«

### locals.tf

**å½¹å‰²**: å¤‰æ•°ã‚’åŠ å·¥ã—ãŸå€¤ã‚’å®šç¾©  
**ç·¨é›†**: â–³ ãŸã¾ã«è§¦ã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜†â˜†

```hcl title="locals.tfï¼ˆæŠœç²‹ï¼šå®Ÿéš›ã¯ã‚‚ã£ã¨é•·ã„ï¼‰"
# å®šæ•°å®šç¾©
locals {
  const = {
    connectivity = {
      virtual_wan        = "virtual_wan"
      hub_and_spoke_vnet = "hub_and_spoke_vnet"
      none               = "none"
    }
  }
}

# æ¥ç¶šã‚¿ã‚¤ãƒ—ã®ãƒ•ãƒ©ã‚°
locals {
  connectivity_enabled                    = var.connectivity_type != local.const.connectivity.none
  connectivity_virtual_wan_enabled        = var.connectivity_type == local.const.connectivity.virtual_wan
  connectivity_hub_and_spoke_vnet_enabled = var.connectivity_type == local.const.connectivity.hub_and_spoke_vnet
}

# ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¾å­˜é–¢ä¿‚ã‚’æ§‹ç¯‰
locals {
  resource_groups = {
    resource_groups = module.resource_groups
  }
  hub_and_spoke_networks_settings = merge(module.config.outputs.hub_and_spoke_networks_settings, local.resource_groups)
  hub_virtual_networks            = (merge({ vnets = module.config.outputs.hub_virtual_networks }, local.resource_groups)).vnets
  # ï¼ˆ...ä»–ã®è¨­å®šãŒç¶šã...ï¼‰
}

# ãƒãƒªã‚·ãƒ¼ã®ä¾å­˜é–¢ä¿‚ã‚’æ§‹ç¯‰
locals {
  management_group_dependencies = {
    policy_assignments = [
      module.management_resources,
      module.hub_and_spoke_vnet,
      module.virtual_wan
    ]
    # ï¼ˆ...ä»–ã®è¨­å®šãŒç¶šã...ï¼‰
  }
}
```

**ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ï¼š**

1. **å®šæ•°å®šç¾©**: æ¥ç¶šã‚¿ã‚¤ãƒ—ã®æ–‡å­—åˆ—ã‚’å®šæ•°åŒ–
2. **ãƒ•ãƒ©ã‚°è¨ˆç®—**: ã©ã®æ¥ç¶šã‚¿ã‚¤ãƒ—ãŒæœ‰åŠ¹ã‹ã‚’è¨ˆç®—
3. **ä¾å­˜é–¢ä¿‚æ§‹ç¯‰**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤ºçš„ã«å®šç¾©
4. **è¨­å®šã®ãƒãƒ¼ã‚¸**: configãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‡ºåŠ›ã¨ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‡ºåŠ›ã‚’çµ±åˆ

**å¤‰æ•°ã¨ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã®é•ã„**

| é …ç›® | å¤‰æ•°ï¼ˆvariableï¼‰ | ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ï¼ˆlocalï¼‰ |
|------|-----------------|---------------------|
| å®šç¾© | `variable "x"` | `locals { x = }` |
| å€¤ã®è¨­å®š | `.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã§ | Terraformå†…ã§è¨ˆç®— |
| ç”¨é€” | å¤–éƒ¨ã‹ã‚‰è¨­å®š | å†…éƒ¨ã§è¨ˆç®— |
| ä¾‹ | ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å | "japaneast-rg" |

**ãªãœlocalsã‚’ä½¿ã†ï¼Ÿ**

ã“ã†ã„ã†ã‚³ãƒ¼ãƒ‰ãŒã‚ã£ãŸã¨ã—ã¾ã™ï¼š
```hcl
resource "azurerm_resource_group" "primary" {
  name     = "${var.prefix}-rg-${var.location}"
  location = var.location
}

resource "azurerm_virtual_network" "primary" {
  name                = "${var.prefix}-vnet-${var.location}"
  resource_group_name = "${var.prefix}-rg-${var.location}"  # åŒã˜è¨ˆç®—ã‚’2å›
  location            = var.location
}
```

åŒã˜è¨ˆç®—ã‚’ä½•åº¦ã‚‚ã—ã¦ã‚‹ã€‚localsã‚’ä½¿ã†ã¨ï¼š

```hcl title="localsã§å†åˆ©ç”¨"
locals {
  rg_name = "${var.prefix}-rg-${var.location}"
}

resource "azurerm_resource_group" "primary" {
  name     = local.rg_name
  location = var.location
}

resource "azurerm_virtual_network" "primary" {
  name                = "${var.prefix}-vnet-${var.location}"
  resource_group_name = local.rg_name  # å†åˆ©ç”¨
  location            = var.location
}
```

DRYåŸå‰‡ï¼ˆDon't Repeat Yourselfï¼‰ã§ã™ã­ã€‚

---

## Part 4: ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ•ã‚¡ã‚¤ãƒ«ãŸã¡

### ãƒ•ã‚¡ã‚¤ãƒ«åã®å‘½åè¦å‰‡

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¯`main.*.tf`ã¨ã„ã†åå‰ã§ã™ã€‚

- `main.config.tf` â†’ è¨­å®šå‡¦ç†
- `main.resource.groups.tf` â†’ ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—
- `main.management.tf` â†’ ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—
- `main.connectivity.hub.and.spoke.virtual.network.tf` â†’ Hub-Spoke
- `main.connectivity.virtual.wan.tf` â†’ Virtual WAN

**ãªãœåˆ†ã‘ã¦ã‚‹ï¼Ÿ**

- 1ãƒ•ã‚¡ã‚¤ãƒ«ã ã¨å·¨å¤§ã™ãã‚‹
- å½¹å‰²ã”ã¨ã«åˆ†ã‘ã‚‹ã¨è¦‹ã‚„ã™ã„
- ä¸¦è¡Œä½œæ¥­ã—ã‚„ã™ã„ï¼ˆåˆ¥ã®äººãŒåˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ï¼‰

**Terraformã®èª­ã¿è¾¼ã¿é †**

å®Ÿã¯é †ç•ªã¯é–¢ä¿‚ãªã„ï¼  
TerraformãŒä¾å­˜é–¢ä¿‚ã‚’è§£æã—ã¦ã€è‡ªå‹•ã§é †åºã‚’æ±ºã‚ã¦ãã‚Œã¾ã™ã€‚

### main.config.tf

**å½¹å‰²**: è¨­å®šã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜†

```hcl title="main.config.tfï¼ˆå®Œå…¨ç‰ˆï¼‰"
module "config" {
  source = "./modules/config-templating"

  starter_locations               = var.starter_locations
  starter_locations_short         = var.starter_locations_short
  subscription_id_connectivity    = try(var.subscription_ids["connectivity"], var.subscription_id_connectivity)
  subscription_id_identity        = try(var.subscription_ids["identity"], var.subscription_id_identity)
  subscription_id_management      = try(var.subscription_ids["management"], var.subscription_id_management)
  subscription_id_security        = try(var.subscription_ids["security"], "")
  root_parent_management_group_id = var.root_parent_management_group_id

  custom_replacements = var.custom_replacements

  inputs = {
    connectivity_resource_groups    = var.connectivity_resource_groups
    hub_and_spoke_networks_settings = var.hub_and_spoke_networks_settings
    hub_virtual_networks            = var.hub_virtual_networks
    virtual_wan_settings            = var.virtual_wan_settings
    virtual_hubs                    = var.virtual_hubs
    management_resource_settings    = var.management_resource_settings
    management_group_settings       = var.management_group_settings
    tags                            = var.tags
    connectivity_tags               = var.connectivity_tags
  }

  enable_telemetry = var.enable_telemetry
}
```

**ãƒã‚¤ãƒ³ãƒˆ1: tryé–¢æ•°**

```hcl
subscription_id_management = try(var.subscription_ids["management"], var.subscription_id_management)
```

- æ–°ã—ã„å½¢å¼ï¼ˆ`subscription_ids`ãƒãƒƒãƒ—ï¼‰ã‚’è©¦ã™
- å¤±æ•—ã—ãŸã‚‰å¤ã„å½¢å¼ï¼ˆ`subscription_id_management`ï¼‰ã‚’ä½¿ã†
- å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¤ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

**ãƒã‚¤ãƒ³ãƒˆ2: inputsãƒ–ãƒ­ãƒƒã‚¯**

```hcl
inputs = {
  connectivity_resource_groups = var.connectivity_resource_groups
  # ...
}
```

è¤‡æ•°ã®è¨­å®šã‚’1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ã¨ã‚ã¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«æ¸¡ã™ã€‚  
ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã®å±•é–‹å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚

### main.resource.groups.tf

**å½¹å‰²**: ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜†â˜†

```hcl title="main.resource.groups.tfï¼ˆå®Œå…¨ç‰ˆï¼‰"
module "resource_groups" {
  source  = "Azure/avm-res-resources-resourcegroup/azurerm"
  version = "0.2.1"

  for_each = { for key, value in module.config.outputs.connectivity_resource_groups : key => value if try(value.settings.enabled, true) }

  name             = each.value.name
  location         = each.value.location
  enable_telemetry = var.enable_telemetry
  tags             = try(each.value.tags, null) == null ? module.config.outputs.tags : each.value.tags

  providers = {
    azurerm = azurerm.connectivity
  }
}
```

**ãƒã‚¤ãƒ³ãƒˆ: for_eachã¨æ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿**

```hcl
for_each = { for key, value in module.config.outputs.connectivity_resource_groups : key => value if try(value.settings.enabled, true) }
```

ã“ã‚Œã¯è¤‡é›‘ã§ã™ãŒï¼š

1. `module.config.outputs.connectivity_resource_groups`ã‹ã‚‰å…¨ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å–å¾—
2. `for key, value in ...`ã§ãƒ«ãƒ¼ãƒ—
3. `if try(value.settings.enabled, true)`ã§æœ‰åŠ¹ãªã‚‚ã®ã ã‘ãƒ•ã‚£ãƒ«ã‚¿
4. çµæœã‚’ãƒãƒƒãƒ—ã¨ã—ã¦`for_each`ã«æ¸¡ã™

`for_each`ã§ãƒ«ãƒ¼ãƒ—ã—ã¦ã€è¤‡æ•°ã®RGã‚’ä½œã‚‹ã€‚

`each.value.name`ã§å„è¦ç´ ã«ã‚¢ã‚¯ã‚»ã‚¹ã€‚

**tagsã®æ¡ä»¶å¼**:

```hcl
tags = try(each.value.tags, null) == null ? module.config.outputs.tags : each.value.tags
```

- ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å›ºæœ‰ã®ã‚¿ã‚°ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†
- ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¿ã‚°ã‚’ä½¿ã†

### main.management.tf

**å½¹å‰²**: ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒãƒªã‚·ãƒ¼ã‚’ä½œã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜…

```hcl title="main.management.tfï¼ˆå®Œå…¨ç‰ˆï¼‰"
module "management_resources" {
  source = "./modules/management_resources"

  count = var.management_resources_enabled ? 1 : 0

  enable_telemetry             = var.enable_telemetry
  management_resource_settings = local.management_resource_settings

  providers = {
    azurerm = azurerm.management
  }
}

module "management_groups" {
  source = "./modules/management_groups"

  count = var.management_groups_enabled ? 1 : 0

  enable_telemetry          = var.enable_telemetry
  management_group_settings = local.management_group_settings
}

moved {
  from = module.management_groups
  to   = module.management_groups[0]
}

moved {
  from = module.management_resources
  to   = module.management_resources[0]
}
```

**ãƒã‚¤ãƒ³ãƒˆ1: 2ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**

- `management_resources`: Log Analyticsã‚„Automation Accountã‚’ä½œã‚‹
- `management_groups`: ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒãƒªã‚·ãƒ¼ã‚’ä½œã‚‹

ä¸¡æ–¹ã¨ã‚‚`count`ã§æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã€‚

**ãƒã‚¤ãƒ³ãƒˆ2: moved ãƒ–ãƒ­ãƒƒã‚¯**

```hcl
moved {
  from = module.management_groups
  to   = module.management_groups[0]
}
```

æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®äº’æ›æ€§ç¶­æŒã€‚ä»¥å‰ã¯`count`ãªã—ã ã£ãŸãŒã€ä»Šã¯`count`ã‚ã‚Šã«å¤‰æ›´ã€‚  
æ—¢å­˜ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã›ãšã«ç§»è¡Œã™ã‚‹ãŸã‚ã®ãƒ–ãƒ­ãƒƒã‚¯ã€‚

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§200å€‹ä»¥ä¸Šã®ãƒãƒªã‚·ãƒ¼ãŒä½œã‚‰ã‚Œã¾ã™ã€‚  
è©³ã—ãã¯å¾Œã®ç« ã§ã€‚

### main.connectivity.hub.and.spoke.virtual.network.tf

**å½¹å‰²**: Hub-Spokeå‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜…â˜†

åå‰ãŒé•·ã™ãã‚‹ã‚ˆã­()

```hcl title="main.connectivity.hub.and.spoke.virtual.network.tfï¼ˆå®Œå…¨ç‰ˆï¼‰"
module "hub_and_spoke_vnet" {
  source  = "Azure/avm-ptn-alz-connectivity-hub-and-spoke-vnet/azurerm"
  version = "0.16.8"

  count = local.connectivity_hub_and_spoke_vnet_enabled ? 1 : 0

  hub_and_spoke_networks_settings = local.hub_and_spoke_networks_settings
  hub_virtual_networks            = local.hub_virtual_networks
  enable_telemetry                = var.enable_telemetry
  tags                            = coalesce(module.config.outputs.connectivity_tags, module.config.outputs.tags)

  providers = {
    azurerm = azurerm.connectivity
    azapi   = azapi.connectivity
  }
}
```

Firewall, Bastion, VPN Gateway, VNetå…¨éƒ¨ã“ã“ã§ä½œã‚‰ã‚Œã¾ã™ã€‚

**ãƒã‚¤ãƒ³ãƒˆ: coalesceé–¢æ•°**

```hcl
tags = coalesce(module.config.outputs.connectivity_tags, module.config.outputs.tags)
```

- `connectivity_tags`ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†
- ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`tags`ã‚’ä½¿ã†
- coalesce = æœ€åˆã®nullã§ãªã„å€¤ã‚’è¿”ã™

### main.connectivity.virtual.wan.tf

**å½¹å‰²**: Virtual WANã‚’ä½œã‚‹  
**é‡è¦åº¦**: â˜…â˜…â˜…â˜†â˜†

Hub-Spokeã®ä»£ã‚ã‚Šã«Virtual WANã‚’ä½¿ã†å ´åˆã€‚

```hcl title="main.connectivity.virtual.wan.tfï¼ˆå®Œå…¨ç‰ˆï¼‰"
module "virtual_wan" {
  source  = "Azure/avm-ptn-alz-connectivity-virtual-wan/azurerm"
  version = "0.13.5"

  count = local.connectivity_virtual_wan_enabled ? 1 : 0

  virtual_wan_settings = local.virtual_wan_settings
  virtual_hubs         = local.virtual_hubs
  enable_telemetry     = var.enable_telemetry
  tags                 = coalesce(module.config.outputs.connectivity_tags, module.config.outputs.tags)

  providers = {
    azurerm = azurerm.connectivity
  }
}
```

`hub_and_spoke_vnet`ã‹`virtual_wan`ã€ã©ã¡ã‚‰ã‹ä¸€æ–¹ã ã‘ãŒå‹•ãä»•çµ„ã¿ã€‚

---

## Part 5: å‡ºåŠ›å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«

### outputs.tf

**å½¹å‰²**: ä½œã£ãŸãƒªã‚½ãƒ¼ã‚¹ã®æƒ…å ±ã‚’å‡ºåŠ›  
**é‡è¦åº¦**: â˜…â˜…â˜†â˜†â˜†

```hcl title="outputs.tfï¼ˆæŠœç²‹ï¼šå®Ÿéš›ã¯132è¡Œï¼‰"
output "dns_server_ip_address" {
  value = local.connectivity_enabled ? (local.connectivity_hub_and_spoke_vnet_enabled ? module.hub_and_spoke_vnet[0].dns_server_ip_addresses : module.virtual_wan[0].dns_server_ip_address) : null
}

output "hub_and_spoke_vnet_virtual_network_resource_ids" {
  value = local.connectivity_hub_and_spoke_vnet_enabled ? module.hub_and_spoke_vnet[0].virtual_network_resource_ids : null
}

output "hub_and_spoke_vnet_bastion_host_public_ip_address" {
  value = local.connectivity_hub_and_spoke_vnet_enabled ? module.hub_and_spoke_vnet[0].bastion_host_public_ip_address : null
}

output "hub_and_spoke_vnet_firewall_resource_ids" {
  value = local.connectivity_hub_and_spoke_vnet_enabled ? module.hub_and_spoke_vnet[0].firewall_resource_ids : null
}

output "hub_and_spoke_vnet_firewall_private_ip_address" {
  value = local.connectivity_hub_and_spoke_vnet_enabled ? module.hub_and_spoke_vnet[0].firewall_private_ip_addresses : null
}

ï¼ˆ...ä»–ã®Hub-Spokeå‡ºåŠ›ã€Virtual WANå‡ºåŠ›ã€Managementå‡ºåŠ›ãŒç¶šã...ï¼‰
```

**ãªãœå‡ºåŠ›ã™ã‚‹ï¼Ÿ**

- ä»–ã®Terraformãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ã†
- ãƒ‡ãƒãƒƒã‚°ç”¨
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆç”¨

**ä¸‰é …æ¼”ç®—å­ã®é€£é–**
```hcl
value = local.connectivity_enabled ? 
  (local.connectivity_hub_and_spoke_vnet_enabled ? 
    module.hub_and_spoke_vnet[0].dns_server_ip_addresses : 
    module.virtual_wan[0].dns_server_ip_address) : 
  null
```

- Connectivityç„¡åŠ¹ â†’ `null`
- Hub-Spokeæœ‰åŠ¹ â†’ Hub-Spokeã®DNS
- Virtual WANæœ‰åŠ¹ â†’ Virtual WANã®DNS

---

## Part 6: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€

### modules/config-templating/

**å½¹å‰²**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†

```text title="ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ "
modules/config-templating/
â”œâ”€â”€ data.tf          â† ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹å®šç¾©
â”œâ”€â”€ locals.config.tf â† ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç½®æ›ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ outputs.tf       â† å‡¦ç†çµæœã‚’å‡ºåŠ›
â”œâ”€â”€ terraform.tf     â† ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â””â”€â”€ variables.tf     â† å…¥åŠ›å¤‰æ•°
```

`$${starter_location_01}`ã‚’`japaneast`ã«å¤‰æ›ã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ã€‚

è©³ã—ãã¯[06_è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.md](./06_è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.md)ã§ã€‚

### modules/management_groups/

**å½¹å‰²**: ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒãƒªã‚·ãƒ¼ã‚’ä½œã‚‹

```text title="ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ "
modules/management_groups/
â”œâ”€â”€ locals.tf     â† ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°
â”œâ”€â”€ main.tf       â† ãƒ¡ã‚¤ãƒ³å‡¦ç†
â”œâ”€â”€ terraform.tf  â† ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â””â”€â”€ variables.tf  â† å…¥åŠ›å¤‰æ•°
```

å®Ÿéš›ã¯`main.tf`ãŒ`Azure/avm-ptn-alz/azurerm`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‘¼ã‚“ã§ã‚‹ã ã‘ã€‚  
ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€‚(ãƒ©ãƒƒãƒ‘ãƒ¼ã¯å›²ã†ã‚„ã¤ã¿ãŸã„ãªæ„Ÿã˜ã‹ãªã€‚ã‚µãƒ©ãƒ³ãƒ©ãƒƒãƒ—ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ã„)

### modules/management_resources/

**å½¹å‰²**: Log Analyticsã¨Automation Accountã‚’ä½œã‚‹

```text title="ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ "
modules/management_resources/
â”œâ”€â”€ main.tf       â† ãƒ¡ã‚¤ãƒ³å‡¦ç†
â”œâ”€â”€ outputs.tf    â† å‡ºåŠ›
â”œâ”€â”€ terraform.tf  â† ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â””â”€â”€ variables.tf  â† å…¥åŠ›å¤‰æ•°
```

ã“ã‚Œã‚‚`Azure/avm-ptn-alz-management/azurerm`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã€‚

---

## Part 7: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚©ãƒ«ãƒ€

### lib/

**å½¹å‰²**: ãƒãƒªã‚·ãƒ¼å®šç¾©ã‚’YAMLã§ç®¡ç†

```text title="libãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ "
lib/
â”œâ”€â”€ alz_library_metadata.json        â† ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ archetype_definitions/           â† ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã®ç¨®é¡
â”‚   â”œâ”€â”€ connectivity_custom.alz_archetype_override.yaml
â”‚   â”œâ”€â”€ corp_custom.alz_archetype_override.yaml
â”‚   â”œâ”€â”€ landing_zones_custom.alz_archetype_override.yaml
â”‚   â”œâ”€â”€ management_custom.alz_archetype_override.yaml
â”‚   â”œâ”€â”€ online_custom.alz_archetype_override.yaml
â”‚   â””â”€â”€ ...
â””â”€â”€ architecture_definitions/        â† å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
    â””â”€â”€ alz_custom.alz_architecture_definition.yaml
```

**Archetypeï¼ˆã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ï¼‰ã¨ã¯ï¼Ÿ**
ç®¡ç†ã‚°ãƒ«ãƒ¼ãƒ—ã®ã€Œç¨®é¡ã€ã€‚

- `connectivity`: æ¥ç¶šç”¨ï¼ˆFirewallç­‰ï¼‰
- `management`: ç®¡ç†ç”¨ï¼ˆLog Analyticsç­‰ï¼‰
- `corp`: ä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚ã‚Š
- `online`: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã®ã¿
- `landing_zones`: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨

å„ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ã«é©ç”¨ã™ã‚‹ãƒãƒªã‚·ãƒ¼ãŒYAMLã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä¾‹: `connectivity_custom.alz_archetype_override.yaml`
```yaml title="connectivity_custom.alz_archetype_override.yamlï¼ˆå®Œå…¨ç‰ˆï¼‰"
base_archetype: connectivity
name: connectivity_custom
policy_assignments_to_add: []
policy_assignments_to_remove: [
# To remove the DDOS modify policy, uncomment the following line:
  # Enable-DDoS-VNET,
]
policy_definitions_to_add: []
policy_definitions_to_remove: []
policy_set_definitions_to_add: []
policy_set_definitions_to_remove: []
role_definitions_to_add: []
role_definitions_to_remove: []
```

**ãƒã‚¤ãƒ³ãƒˆ:**

- `base_archetype: connectivity`: æ—¢å­˜ã®connectivityã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ã‚’ç¶™æ‰¿
- `policy_assignments_to_remove`: DDOSä¿è­·ãƒãƒªã‚·ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ä¾‹ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
- ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚åŒæ§˜ã«ã€ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ã‚’ä¸Šæ›¸ãï¼ˆoverrideï¼‰ã™ã‚‹å½¢å¼

---

## Part 8: CI/CDãƒ•ã‚©ãƒ«ãƒ€

### .github/workflows/cd.yaml

**å½¹å‰²**: GitHub Actionsã®è¨­å®š

```yaml title="cd.yamlï¼ˆæŠœç²‹ï¼‰"
---
name: 02 Azure Landing Zones Continuous Delivery
on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      terraform_action:
        description: 'Terraform Action to perform'
        required: true
        default: 'apply'
        type: choice
        options:
          - 'apply'
          - 'destroy'
      terraform_cli_version:
        description: 'Terraform CLI Version'
        required: true
        default: 'latest'
        type: string

jobs:
  plan_and_apply:
    uses: shuhei0720org01/alz-mgmt-templates/.github/workflows/cd-template.yaml@main
    name: 'CD'
    permissions:
      id-token: write
      contents: read
    with:
      terraform_action: ${{ inputs.terraform_action }}
      root_module_folder_relative_path: '.'
      terraform_cli_version: ${{ inputs.terraform_cli_version }}
```

**ãƒã‚¤ãƒ³ãƒˆ:**

- `on.push.branches`: mainãƒ–ãƒ©ãƒ³ãƒã¸ã®pushã§è‡ªå‹•å®Ÿè¡Œ
- `workflow_dispatch`: æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
- `inputs`: applyã‹destroyã‚’é¸æŠ
- `uses`: åˆ¥ãƒªãƒã‚¸ãƒˆãƒªï¼ˆalz-mgmt-templatesï¼‰ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å†åˆ©ç”¨
- `permissions`: OIDCèªè¨¼ã§Azureã«ã‚¢ã‚¯ã‚»ã‚¹

å®Ÿéš›ã®å‡¦ç†ã¯`alz-mgmt-templates`ãƒªãƒã‚¸ãƒˆãƒªã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚

---

## ã¾ã¨ã‚

### ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²åˆ†æ‹…

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² | ç·¨é›† |
|---------|------|------|
| `platform-landing-zone.auto.tfvars` | ãƒ¡ã‚¤ãƒ³è¨­å®š | âœ… |
| `terraform.tfvars.json` | ç§˜å¯†æƒ…å ± | âœ…åˆå›ã®ã¿ |
| `terraform.tf` | Terraformè¨­å®š | âŒ |
| `variables.*.tf` | å¤‰æ•°å®šç¾© | âŒ |
| `locals.tf` | ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•° | â–³ |
| `main.*.tf` | ãƒ¡ã‚¤ãƒ³å‡¦ç† | âŒ |
| `outputs.tf` | å‡ºåŠ›å®šç¾© | âŒ |
| `modules/` | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | â–³ |
| `lib/` | ãƒãƒªã‚·ãƒ¼å®šç¾© | â–³ |
| `.github/` | CI/CD | âŒ |

### ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œï¼ˆå†æ²ï¼‰

```text title="å…¨ä½“ã®ãƒ•ãƒ­ãƒ¼"
.tfvarsï¼ˆè¨­å®šï¼‰
  â†“
variables.tfï¼ˆå¤‰æ•°å®šç¾©ï¼‰
  â†“
modules/config-templatingï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†ï¼‰
  â†“
locals.tfï¼ˆãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ï¼‰
  â†“
main.*.tfï¼ˆãƒ¡ã‚¤ãƒ³å‡¦ç†ï¼‰
  â†“
modules/ï¼ˆå„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œï¼‰
  â†“
Azureï¼ˆãƒªã‚½ãƒ¼ã‚¹ä½œæˆï¼‰
  â†“
outputs.tfï¼ˆçµæœå‡ºåŠ›ï¼‰
```

### é‡è¦åº¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°

ç†è§£ã™ã¹ãå„ªå…ˆåº¦ï¼š

1. â˜…â˜…â˜…â˜…â˜… `platform-landing-zone.auto.tfvars`
2. â˜…â˜…â˜…â˜…â˜† `main.management.tf`, `main.connectivity.hub.and.spoke.virtual.network.tf`
3. â˜…â˜…â˜…â˜†â˜† `locals.tf`, `main.config.tf`
4. â˜…â˜…â˜†â˜†â˜† `variables.tf`, `outputs.tf`
5. â˜…â˜†â˜†â˜†â˜† ãã®ä»–

---

## ç·´ç¿’å•é¡Œ

### å•é¡Œ1
`.auto.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã¨æ™®é€šã®`.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã®é•ã„ã¯ä½•ã§ã™ã‹ï¼Ÿ

### å•é¡Œ2
`locals.tf`ã¨`variables.tf`ã®ä½¿ã„åˆ†ã‘ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚

### å•é¡Œ3
`main.*.tf`ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¤‡æ•°ã«åˆ†ã‹ã‚Œã¦ã„ã‚‹ç†ç”±ã‚’2ã¤æŒ™ã’ã¦ãã ã•ã„ã€‚

### å•é¡Œ4
`for_each`ã¨`count`ã®é•ã„ã¯ä½•ã§ã™ã‹ï¼Ÿ

---

## ç·´ç¿’å•é¡Œã®ç­”ãˆ

### ç­”ãˆ1
`.auto.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€TerraformãŒè‡ªå‹•çš„ã«èª­ã¿è¾¼ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚æ™®é€šã®`.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã¯`-var-file`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æ˜ç¤ºçš„ã«æŒ‡å®šã—ãªã„ã¨èª­ã¿è¾¼ã¾ã‚Œã¾ã›ã‚“ã€‚`.auto.tfvars`ã‚’ä½¿ã†ã¨ã€`terraform apply`ã ã‘ã§è‡ªå‹•çš„ã«è¨­å®šãŒé©ç”¨ã•ã‚Œã‚‹ã®ã§ä¾¿åˆ©ã§ã™ã€‚

### ç­”ãˆ2

variables.tfã¯å¤–éƒ¨ã‹ã‚‰æ¸¡ã•ã‚Œã‚‹å¤‰æ•°ã‚’å®šç¾©ã—ã¾ã™ï¼ˆå…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰ã€‚locals.tfã¯å†…éƒ¨ã§è¨ˆç®—ã•ã‚Œã‚‹å¤‰æ•°ã‚’å®šç¾©ã—ã¾ã™ï¼ˆè¨ˆç®—çµæœï¼‰ã€‚

ä¾‹ï¼š

- `variables.tf`: `var.location`ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šï¼‰
- `locals.tf`: `local.location_short`ï¼ˆlocationã‹ã‚‰è‡ªå‹•è¨ˆç®—ï¼‰

### ç­”ãˆ3
`main.*.tf`ãƒ•ã‚¡ã‚¤ãƒ«ãŒåˆ†ã‹ã‚Œã¦ã„ã‚‹ç†ç”±ï¼š

1. **å½¹å‰²ã®æ˜ç¢ºåŒ–**: ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¦‹ãŸã ã‘ã§ä½•ã®ãƒªã‚½ãƒ¼ã‚¹ã‹åˆ†ã‹ã‚‹ï¼ˆ`main.connectivity.*.tf`ãªã‚‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–¢é€£ï¼‰
2. **ä¿å®ˆæ€§ã®å‘ä¸Š**: å¤‰æ›´ã—ãŸã„æ©Ÿèƒ½ã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚’é–‹ã‘ã°ã‚ˆãã€æ•°åƒè¡Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã—å›ã‚‹å¿…è¦ãŒãªã„

### ç­”ãˆ4
countã¯æ•°å€¤ã§ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚Šã¾ã™ï¼ˆ`count = 3`ãªã‚‰3å€‹ï¼‰ã€‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯`count.index`ã§0,1,2...

for_eachã¯ãƒãƒƒãƒ—ã‚„ã‚»ãƒƒãƒˆã§ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚Šã¾ã™ã€‚å„è¦ç´ ã«åå‰ãŒã‚ã‚Šã€`each.key`ã‚„`each.value`ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

ä¾‹ï¼š
```hcl title="count vs for_each"
# count: ãƒªã‚½ãƒ¼ã‚¹åãŒ resource[0], resource[1]...
count = 2

# for_each: ãƒªã‚½ãƒ¼ã‚¹åãŒ resource["app1"], resource["app2"]...
for_each = toset(["app1", "app2"])
```

for_eachã®ã»ã†ãŒã€ãƒªã‚½ãƒ¼ã‚¹ã®è¿½åŠ ãƒ»å‰Šé™¤æ™‚ã«ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã«å½±éŸ¿ã—ãªã„ãŸã‚æ¨å¥¨ã•ã‚Œã¾ã™ã€‚

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã¯ç†è§£ã§ãã¾ã—ãŸã‹ï¼Ÿ

æ¬¡ã¯[03_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md](./03_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md)ã§ã€  
`platform-landing-zone.auto.tfvars`ã‚’1è¡Œãšã¤è§£èª­ã—ã¦ã„ãã¾ã™ã€‚

ã“ã‚ŒãŒä¸€ç•ªé‡è¦ãªç« ã§ã™ã€‚ã˜ã£ãã‚Šèª­ã‚“ã§ãã ã•ã„ã€‚

---

**æ‰€è¦æ™‚é–“**: 40åˆ†  
**é›£æ˜“åº¦**: â˜…â˜…â˜…â˜†â˜†  
**å‰**: [01_åŸºç¤çŸ¥è­˜.md](./01_åŸºç¤çŸ¥è­˜.md)  
**æ¬¡**: [03_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md](./03_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨è§£èª¬.md)
